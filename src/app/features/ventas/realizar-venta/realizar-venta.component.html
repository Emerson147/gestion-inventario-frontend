<!-- Toast y confirmaciones con animaciones mejoradas -->
<p-toast 
  position="top-right" 
  [life]="5000"
  styleClass="custom-toast-container">
</p-toast>
<p-confirmDialog 
  [style]="{width: '500px'}"
  styleClass="custom-confirm-dialog">
</p-confirmDialog>

<!-- Header Premium ULTRA del M√≥dulo de Ventas -->
<div class="relative -mx-4 -mt-4 mb-8 overflow-hidden">
  <!-- Mega Glass Container con Efectos Avanzados -->
  <div class="relative bg-gradient-to-br from-blue-50/90 via-indigo-50/80 to-purple-50/90 
              backdrop-blur-2xl border border-white/40 rounded-[2rem] shadow-2xl 
              hover:shadow-[0_35px_60px_-15px_rgba(0,0,0,0.3)] transition-all duration-700
              before:absolute before:inset-0 before:bg-gradient-to-r 
              before:from-blue-500/10 before:via-purple-500/10 before:to-pink-500/10 
              before:rounded-[2rem] before:blur-3xl before:-z-10
              overflow-hidden group">
    
    <!-- Background Pattern Mejorado -->
    <div class="absolute inset-0 opacity-[0.03]">
      <div class="absolute inset-0" 
           style="background-image: 
                  radial-gradient(circle at 2px 2px, rgb(59 130 246 / 0.4) 1.5px, transparent 0),
                  radial-gradient(circle at 15px 15px, rgb(139 92 246 / 0.3) 1px, transparent 0); 
                  background-size: 40px 40px, 60px 60px;
                  animation: backgroundShift 20s ease-in-out infinite;">
      </div>
    </div>
    
    <!-- Floating Orbs Mejorados con M√°s Efectos -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <!-- Orb 1 - Grande con rotaci√≥n -->
      <div class="absolute top-8 left-16 w-32 h-32 bg-gradient-to-r from-blue-400/30 to-cyan-400/30 
                  rounded-full blur-2xl animate-float-slow">
      </div>
      
      <!-- Orb 2 - Mediano con pulse -->
      <div class="absolute top-20 right-20 w-24 h-24 bg-gradient-to-r from-purple-400/25 to-pink-400/25 
                  rounded-full blur-xl animate-pulse-glow">
      </div>
      
      <!-- Orb 3 - Peque√±o con bounce -->
      <div class="absolute bottom-16 left-1/3 w-16 h-16 bg-gradient-to-r from-emerald-400/30 to-teal-400/30 
                  rounded-full blur-lg animate-bounce-gentle">
      </div>
      
      <!-- Orb 4 - Extra con movimiento -->
      <div class="absolute bottom-32 right-1/4 w-20 h-20 bg-gradient-to-r from-yellow-400/20 to-orange-400/20 
                  rounded-full blur-xl animate-drift">
      </div>
      
      <!-- Part√≠culas Flotantes -->
      <div class="absolute inset-0">
        <div class="particle particle-1"></div>
        <div class="particle particle-2"></div>
        <div class="particle particle-3"></div>
        <div class="particle particle-4"></div>
        <div class="particle particle-5"></div>
      </div>
    </div>
    
    <!-- Efecto de Brillo en Bordes -->
    <div class="absolute inset-0 rounded-[2rem] bg-gradient-to-r 
                from-blue-500/20 via-purple-500/20 to-pink-500/20 
                opacity-0 group-hover:opacity-100 transition-opacity duration-1000 
                blur-xl animate-border-glow">
    </div>
    
    <div class="relative z-10 p-10">
      <!-- Header Principal con Animaciones Mejoradas -->
      <div class="flex flex-col xl:flex-row xl:justify-between xl:items-start gap-10">
        
        <!-- Secci√≥n del T√≠tulo ULTRA -->
        <div class="flex-1 space-y-8">
          <div class="flex items-center gap-8 mb-8">
            <!-- √çcono Principal Ultra Premium -->
            <div class="relative group/icon">
              <!-- √çcono Principal -->
              <div class="w-24 h-24 bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-700 
                          rounded-3xl flex items-center justify-center shadow-2xl 
                          transform rotate-3 hover:rotate-6 hover:scale-110
                          transition-all duration-500 ease-out
                          before:absolute before:inset-0 before:bg-gradient-to-br 
                          before:from-white/20 before:to-transparent before:rounded-3xl
                          after:absolute after:inset-0 after:bg-gradient-to-t 
                          after:from-black/10 after:to-transparent after:rounded-3xl">
                <i class="pi pi-shopping-cart text-white text-4xl transform 
                         group-hover/icon:scale-110 transition-transform duration-300"></i>
              </div>
              
              <!-- Pulse Rings M√∫ltiples -->
              <div class="absolute inset-0 rounded-3xl border-2 border-blue-400/40 
                          animate-ping-slow transform rotate-3"></div>
              <div class="absolute inset-0 rounded-3xl border border-purple-400/30 
                          animate-ping-slower transform rotate-3" style="animation-delay: 1s;"></div>
              
              <!-- Glow Effect -->
              <div class="absolute inset-0 rounded-3xl bg-gradient-to-r from-blue-600/30 to-purple-600/30 
                          blur-xl scale-150 opacity-0 group-hover/icon:opacity-100 
                          transition-opacity duration-500"></div>
              
              <!-- Badge de Status -->
              <div class="absolute -top-2 -right-2 w-8 h-8 bg-gradient-to-r from-green-400 to-emerald-500 
                          rounded-full flex items-center justify-center shadow-lg animate-pulse-gentle">
                <i class="pi pi-check text-white text-sm font-bold"></i>
              </div>
            </div>
            
            <!-- T√≠tulos Ultra Premium -->
            <div class="space-y-4">
              <!-- T√≠tulo Principal con Efectos -->
              <h1 class="text-5xl xl:text-6xl font-black leading-tight">
                <span class="bg-gradient-to-r from-gray-900 via-gray-700 to-gray-800 
                           bg-clip-text text-transparent animate-text-shimmer">
                  Gestion de Ventas 
                </span>
                <br>       
              </h1>
              
              <!-- Subt√≠tulo Animado -->
              <p class="text-xl font-bold text-gray-600 flex items-center gap-3 animate-fade-in-up">
                <span class="inline-block w-2 h-2 bg-gradient-to-r from-yellow-400 to-orange-500 
                           rounded-full animate-pulse-fast"></span>
                <span class="bg-gradient-to-r from-gray-600 to-gray-500 bg-clip-text text-transparent">
                  Gesti√≥n empresarial
                </span>
                <span class="inline-block animate-wiggle">üöÄ</span>
              </p>
            </div>
          </div>
          
         <!-- Reemplazar l√≠neas 169-268 con: -->
          <app-user-info-card 
            class="absolute top-2 right-12 mb-3 pb-3"
            [user]="currentUserInfo" 
            [ping]="ping">
          </app-user-info-card>
      </div>
    </div>
  </div>
</div>

<!-- Gradientes SVG para efectos avanzados -->
<svg width="0" height="0" style="position: absolute;">
  <defs>
    <linearGradient id="gradient-purple" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
    </linearGradient>
  </defs>
</svg>

<!-- Dashboard de M√©tricas ULTRA PREMIUM -->
<div class="relative -mx-4 mt-6 mb-10 overflow-hidden">
  <!-- Background decoration mejorado -->
  <div class="absolute inset-0 bg-gradient-to-br from-blue-50/95 via-indigo-50/85 to-purple-50/95
              backdrop-blur-xl border border-white/40 rounded-3xl shadow-xl overflow-hidden
              animate-background-shift"></div>
  
  <!-- Decorative elements -->
  <div class="absolute top-4 left-4 w-32 h-32 bg-gradient-to-r from-blue-400/20 to-cyan-400/20 
              rounded-full blur-3xl animate-pulse-slow"></div>
  <div class="absolute bottom-4 right-4 w-24 h-24 bg-gradient-to-r from-purple-400/15 to-pink-400/15 
              rounded-full blur-2xl animate-pulse-slower"></div>
  

</div>

<!-- Navegaci√≥n por pesta√±as -->
<div class="relative mb-8">
  <!-- Container de Pesta√±as con Glassmorphism -->
  <div class="bg-white/80 backdrop-blur-xl border border-white/30 rounded-2xl shadow-xl overflow-hidden">
    
    <!-- Indicador de Estado Global -->
    <div class="bg-gradient-to-r from-emerald-500/10 via-blue-500/10 to-purple-500/10 px-6 py-3 border-b border-white/20">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
            <span class="text-sm font-semibold text-gray-700">Sistema Activo</span>
          </div>
          
          <div class="h-4 w-px bg-gray-300"></div>
          
          <div class="flex items-center gap-2 text-sm text-gray-600">
            <i class="pi pi-users text-blue-500"></i>
            <span>{{clienteSeleccionado ? clienteSeleccionado.nombres + ' ' + clienteSeleccionado.apellidos : 'Sin cliente'}}</span>
          </div>
          
          <div class="h-4 w-px bg-gray-300"></div>
          
          <div class="flex items-center gap-2 text-sm text-gray-600">
            <i class="pi pi-shopping-cart text-emerald-500"></i>
            <span>{{carrito.length}} producto(s)</span>
          </div>
        </div>
        
        <!-- Informaci√≥n de Sesi√≥n -->
        <div class="flex items-center gap-4 text-sm text-gray-500">
          <div class="flex items-center gap-2">
            <i class="pi pi-clock text-blue-500"></i>
            <span>{{getCurrentTime() | date:'HH:mm:ss'}}</span>
          </div>
          <div class="flex items-center gap-2">
            <i class="pi pi-calendar text-purple-500"></i>
            <span>{{getCurrentTime() | date:'dd/MM/yyyy'}}</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- TabView Premium -->
    <p-tabView 
      [(activeIndex)]="activeTabIndex" 
      styleClass="premium-tabview-custom"
      (onChange)="onTabChange($event)">
      
      <!-- PESTA√ëA 1: PUNTO DE VENTA -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-premium group">
            <!-- √çcono de la pesta√±a -->
            <div class="tab-icon-container">
              <div class="tab-icon-bg"></div>
              <i class="pi pi-shopping-cart text-xl relative z-10 
                        group-hover:scale-110 transition-transform duration-300"></i>
              
              <!-- Badge din√°mico -->
              <div *ngIf="carrito.length > 0" 
                   class="absolute -top-2 -right-2 bg-gradient-to-r from-emerald-500 to-green-600 
                          text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center 
                          justify-center shadow-lg animate-bounce">
                {{carrito.length}}
              </div>
              
              <!-- Pulse effect cuando est√° activo -->
              <div *ngIf="activeTabIndex === 0" 
                   class="absolute inset-0 bg-blue-400/30 rounded-full animate-ping"></div>
            </div>
            
            <!-- Contenido del header -->
            <div class="tab-content">
              <div class="tab-title">Punto de Venta</div>
              <div class="tab-subtitle">Nueva venta en tiempo real</div>
              
              <!-- Indicadores de estado -->
              <div class="tab-indicators">
                <div *ngIf="clienteSeleccionado" 
                     class="indicator success">
                  <i class="pi pi-check-circle"></i>
                  <span>Cliente</span>
                </div>
                
                <div *ngIf="carrito.length > 0" 
                     class="indicator info">
                  <i class="pi pi-shopping-bag"></i>
                  <span>{{carrito.length}} items</span>
                </div>
                
                <div *ngIf="totalVenta > 0" 
                     class="indicator warning">
                  <i class="pi pi-dollar"></i>
                  <span>{{formatearMoneda(totalVenta)}}</span>
                </div>
              </div>
            </div>
            
            <!-- Progress bar del proceso -->
            <div class="tab-progress">
              <div class="progress-track">
                <div class="progress-fill" 
                     [style.width.%]="getPasoProgress()"></div>
              </div>
              <div class="progress-label">
                Paso {{pasoActual + 1}} de 4
              </div>
            </div>
          </div>
        </ng-template>
        
        <!-- Contenido de POS -->
          <!-- üî• AQU√ç VA TU POS COMPLETO üî• -->
         <div class="h-screen bg-slate-100 flex flex-col">
  
            <!-- Header Profesional -->
            
<!-- Reemplazar todo el <header> actual por este -->
<header class="bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-white shadow-2xl border-b-4 border-blue-500">
  <div class="flex justify-between items-center p-4">
    
    <!-- SECCI√ìN IZQUIERDA: Branding + Info Sistema -->
    <div class="flex items-center gap-6">
      
      <!-- Logo y Empresa -->
      <div class="flex items-center gap-4">
        <div class="relative">
          <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
            <i class="pi pi-shop text-white text-2xl"></i>
          </div>
          <!-- Indicador online -->
          <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-white animate-pulse"></div>
        </div>
        
        <div>
          <h1 class="text-2xl font-bold tracking-wide">SISTEMA EMPRESARIAL POS</h1>
          <div class="flex items-center gap-4 text-sm text-slate-300">
            <span class="flex items-center gap-1">
              <i class="pi pi-building text-xs"></i>
              RUC: 20123456789
            </span>
            <span>‚Ä¢</span>
            <span class="flex items-center gap-1">
              <i class="pi pi-desktop text-xs"></i>
              Caja: POS-001
            </span>
          </div>
        </div>
      </div>
      
      <!-- Estado del Sistema -->
      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2 bg-green-600/20 backdrop-blur-sm px-3 py-1.5 rounded-full border border-green-500/30">
          <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
          <span class="text-xs font-medium">SUNAT Online</span>
        </div>
        
        <div class="flex items-center gap-2 bg-blue-600/20 backdrop-blur-sm px-3 py-1.5 rounded-full border border-blue-500/30">
          <i class="pi pi-user text-xs"></i>
          <span class="text-xs font-medium">Emerson147</span>
        </div>
      </div>
    </div>
    
    <!-- SECCI√ìN CENTRO: Informaci√≥n de Venta Actual -->
    <div class="text-center px-6">
      <div class="bg-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/10">
        <div class="text-sm text-slate-300 mb-1">
          Cliente: {{clienteSeleccionado?.nombres || 'P√∫blico General'}}
          <button *ngIf="!clienteSeleccionado" 
                  class="ml-2 bg-blue-500/80 hover:bg-blue-500 px-2 py-0.5 rounded text-xs transition-colors"
                  (click)="openClientModal()">
            <i class="pi pi-plus mr-1"></i>Seleccionar
          </button>
        </div>
        <div class="text-4xl font-mono font-bold text-green-400 mb-1">
          {{formatearMoneda(totalVenta)}}
        </div>
        <div class="text-xs text-slate-400">
          Venta #{{getNumeroVenta()}} ‚Ä¢ {{carrito.length}} productos ‚Ä¢ {{getCurrentDateTime()}}
        </div>
      </div>
    </div>
    
    <!-- SECCI√ìN DERECHA: Panel de Control -->
    <div class="flex items-center gap-3">
      
      <!-- M√©tricas R√°pidas -->
      <div class="text-right mr-4">
        <div class="text-xs text-slate-400">Ventas Hoy</div>
        <div class="text-lg font-bold text-blue-400">{{formatearMoneda(ventasHoy)}}</div>
        <div class="text-xs text-slate-400">{{transaccionesHoy}} transacciones</div>
      </div>
      
      <!-- Botones de Acci√≥n -->
      <div class="flex gap-2">
        <button class="group p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-200 hover:scale-105"
                title="Dashboard Gerencial"
                (click)="abrirDashboard()">
          <i class="pi pi-chart-line text-slate-300 group-hover:text-white"></i>
        </button>
        
        <button class="group p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-200 hover:scale-105"
                title="Reportes"
                (click)="abrirReportes()">
          <i class="pi pi-chart-bar text-slate-300 group-hover:text-white"></i>
        </button>
        
        <button class="group p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-200 hover:scale-105"
                title="Configuraci√≥n"
                (click)="abrirConfiguracion()">
          <i class="pi pi-cog text-slate-300 group-hover:text-white"></i>
        </button>
        
        <div class="w-px h-8 bg-white/20 mx-1"></div>
        
        <button class="group p-2 bg-red-500/20 hover:bg-red-500/40 rounded-lg transition-all duration-200 hover:scale-105"
                title="Cerrar Sesi√≥n"
                (click)="cerrarSesion()">
          <i class="pi pi-sign-out text-red-300 group-hover:text-red-200"></i>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Barra de Estado Inferior -->
  <div class="bg-black/20 px-4 py-2 text-xs flex justify-between items-center border-t border-white/10">
    <div class="flex items-center gap-6">
      <span class="flex items-center gap-1">
        <i class="pi pi-calendar text-blue-400"></i>
        {{getCurrentTime()}}
      </span>
      <span class="flex items-center gap-1">
        <i class="pi pi-clock text-green-400"></i>
        Turno iniciado: {{horaInicioTurno}}
      </span>
    </div>
    
    <div class="flex items-center gap-4">
      <span class="bg-green-500/20 text-green-300 px-2 py-1 rounded">
        <i class="pi pi-check-circle mr-1"></i>
        Sistema Operativo
      </span>
      <span class="text-slate-400">
        v2.1.0 ‚Ä¢ Build 2025.06.06.1
      </span>
    </div>
  </div>
</header>


            <!-- Contenido Principal -->
            <main class="flex-1 flex overflow-hidden">
              
              <!-- Panel Izquierdo: Productos (65%) -->
              <section class="w-[65%] flex flex-col p-4 space-y-4">
                
                <!-- B√∫squeda Principal -->
                <div class="bg-white rounded-xl p-4 shadow-md">
                  <div class="grid grid-cols-1 lg:grid-cols-4 gap-3">
                    <!-- B√∫squeda por c√≥digo -->
                    <div class="lg:col-span-2">
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        üì¶ C√≥digo de Producto
                      </label>
                      <div class="flex gap-2">
                        <input #codigoInput
                              pInputText 
                              [(ngModel)]="codigoBusqueda" 
                              placeholder="Escanear o escribir c√≥digo..." 
                              (keyup.enter)="buscarProductoPorCodigo()"
                              class="flex-1 text-lg font-mono"
                              autofocus />
                        <p-button icon="pi pi-search" 
                                (click)="buscarProductoPorCodigo()"></p-button>
                      </div>
                    </div>
                    
                    <!-- Cantidad -->
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        üî¢ Cantidad
                      </label>
                      <p-inputNumber [(ngModel)]="cantidadInput" 
                                    [min]="1" 
                                    [max]="999"
                                    [showButtons]="true"
                                    styleClass="w-full"></p-inputNumber>
                    </div>
                    
                    <!-- Scanner -->
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        üì∑ Esc√°ner
                      </label>
                      <p-button icon="pi pi-camera"
                              label="F8"
                              [outlined]="true"
                              severity="secondary"
                              styleClass="w-full"
                              (click)="activarScanner()"></p-button>
                    </div>
                  </div>
                  
                  <!-- B√∫squeda avanzada -->
                    <div class="mt-4">
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        üîç B√∫squeda Avanzada
                      </label>
                      <p-autoComplete [(ngModel)]="productoBusqueda"
                [suggestions]="productosAutoComplete"
                (completeMethod)="buscarProductosAutoComplete($event)"
                (onSelect)="seleccionarProductoAutoComplete($event)"
                field="displayLabel"
                placeholder="Buscar por nombre, c√≥digo o descripci√≥n..."
                styleClass="w-full"
                [dropdown]="true"
                scrollHeight="400px"
                [virtualScroll]="true"
                [itemSize]="80"
                [showClear]="true"
                [minLength]="0">
                      
  <ng-template let-producto pTemplate="item">
    <div class="flex items-center gap-3 p-2 hover:bg-slate-50 rounded-lg">
      <div class="flex-shrink-0">
        <img *ngIf="producto?.imagen"
             [src]="getImageUrl(producto.producto?.imagen)"
             alt="{{producto.producto?.nombre}}"
             class="w-12 h-12 object-cover rounded-lg">
        <span *ngIf="!producto.producto?.imagen"
              class="w-12 h-12 bg-gray-200 flex items-center justify-center rounded-lg">
          <i class="pi pi-image text-gray-400"></i>
        </span>
      </div>
      <div class="flex-1">
        <div class="font-medium">{{producto.producto?.codigo}} ‚Ä¢ {{producto.producto?.nombre}}</div>
        <div class="text-sm text-gray-500">
          {{producto.color?.nombre}} ‚Ä¢ {{producto.talla?.numero}} ‚Ä¢ {{producto.serie}}
        </div>
        <div class="text-lg font-bold text-blue-600">{{formatearMoneda(producto.precioVenta || 0)}}</div>
      </div>
      <div class="text-right">
        <div [class]="getStockClass(producto.cantidad)">Stock: {{producto.cantidad}}</div>
      </div>
    </div>
  </ng-template>
</p-autoComplete>
                  </div>
                </div>
                
                <!-- Scanner (si est√° activo) -->
                <div *ngIf="scannerActive" class="bg-gray-900 rounded-xl p-4">
                  <div class="relative h-64 rounded-lg overflow-hidden">
                    <video #videoElement class="w-full h-full object-cover"></video>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                      <div class="scanner-overlay">
                        <div class="scanner-corners">
                          <div class="corner-tl"></div>
                          <div class="corner-tr"></div>
                          <div class="corner-bl"></div>
                          <div class="corner-br"></div>
                        </div>
                        <div class="scanner-line"></div>
                      </div>
                    </div>
                    <button class="absolute top-4 right-4 bg-red-500 text-white p-2 rounded-full"
                            (click)="cerrarScanner()">
                      <i class="pi pi-times"></i>
                    </button>
                  </div>
                </div>
                
                <!-- Productos Populares -->
                <div *ngIf="productosPopulares.length > 0 && !scannerActive" class="flex-1">
                  <div class="bg-white rounded-xl p-4 shadow-md h-full flex flex-col">
                    <div class="flex items-center gap-2 mb-4">
                      <i class="pi pi-star-fill text-yellow-500"></i>
                      <h3 class="font-semibold text-gray-800">Productos Populares</h3>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 flex-1">
                      <div *ngFor="let producto of productosPopulares" 
                          class="bg-slate-50 hover:bg-slate-100 border-2 border-transparent hover:border-blue-300 rounded-lg p-3 cursor-pointer transition-all"
                          (click)="seleccionarProductoPopular(producto)">
                        <div class="text-center">
                          <div class="relative mb-2">
                            <img [src]="producto.imagen || '/assets/images/product-placeholder.jpg'"
                                [alt]="producto.producto?.nombre"
                                class="w-full h-16 object-cover rounded-lg"
                                onerror="this.src='/assets/images/product-placeholder.jpg'" />
                            <span class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs px-1 rounded-full">
                              {{producto.stock}}
                            </span>
                          </div>
                          <div class="text-xs font-medium text-gray-700 truncate mb-1">
                            {{producto.producto?.nombre}}
                          </div>
                          <div class="text-sm font-bold text-blue-600">
                            {{formatearMoneda(producto.precioVenta)}}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
              
              <!-- Panel Derecho: Carrito y Pago (35%) -->
              <aside class="w-[35%] bg-white border-l border-gray-200 flex flex-col">
                
                <!-- Cliente Actual -->
                <div class="p-4 border-b border-gray-200">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="pi pi-user text-blue-600"></i>
                      </div>
                      <div>
                        <div class="font-medium text-gray-800">
                          {{clienteSeleccionado ? (clienteSeleccionado.nombres + ' ' + clienteSeleccionado.apellidos) : 'Cliente General'}}
                        </div>
                        <div class="text-sm text-gray-500" *ngIf="clienteSeleccionado">
                          {{clienteSeleccionado.dni || clienteSeleccionado.ruc}}
                        </div>
                      </div>
                    </div>
                    <p-button icon="pi pi-user-edit"
                            [outlined]="true"
                            size="small"
                            (click)="openClientModal()"></p-button>
                  </div>
                </div>
                
                <!-- Carrito de Compras -->
                <div class="flex-1 flex flex-col">
                  <div class="p-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                      <h3 class="font-semibold text-gray-800 flex items-center gap-2">
                        <i class="pi pi-shopping-cart text-blue-600"></i>
                        Carrito ({{carrito.length}})
                      </h3>
                      <p-button *ngIf="carrito.length > 0"
                              icon="pi pi-trash"
                              severity="danger"
                              [outlined]="true"
                              size="small"
                              (click)="limpiarCarrito()"></p-button>
                    </div>
                  </div>
                  
                  <!-- Items del carrito -->
                  <div class="flex-1 overflow-y-auto">
                    <!-- Carrito vac√≠o -->
                    <div *ngIf="carrito.length === 0" class="p-8 text-center text-gray-500">
                      <i class="pi pi-shopping-cart text-4xl mb-4 block"></i>
                      <p class="font-medium">Carrito Vac√≠o</p>
                      <p class="text-sm">Agregue productos para comenzar</p>
                    </div>
                    
                    <!-- Lista de productos -->
                    <div *ngIf="carrito.length > 0" class="p-4 space-y-3">
                      <div *ngFor="let item of carrito; trackBy: trackByInventarioId; let i = index" 
                          class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                        
                        <div class="flex items-start gap-3">
                          <!-- Imagen -->
                          <div class="relative">
                            <img *ngIf="item.producto?.imagen"
                                  [src]="item.producto.imagen"
                                  alt="{{item.producto?.nombre}}"
                                  class="w-16 h-16 object-cover rounded-lg"
                                  onerror="this.src='/assets/images/product-placeholder.jpg'" />
                            <span *ngIf="!item.producto?.imagenUrl"
                                  class="w-16 h-16 bg-gray-200 flex items-center justify-center rounded-lg">
                              <i class="pi pi-image text-gray-400"></i>
                            </span>                           
                            <span class="absolute -top-1 -left-1 bg-blue-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">
                              {{i + 1}}
                            </span>
                          </div>
                          
                          <!-- Info del producto -->
                          <div class="flex-1 min-w-0">
                            <div class="font-medium text-sm text-gray-800 truncate">
                              {{item.producto?.nombre}}
                            </div>
                            <div class="flex gap-1 flex-wrap mt-1">
                              <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">{{item.color?.nombre}}</span>
                              <span class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">{{item.talla?.numero}}</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">{{item.codigoCompleto}}</div>
                            
                            <!-- Controles de cantidad -->
                            <div class="flex items-center gap-2 mt-2">
                              <button class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs flex items-center justify-center"
                                      [disabled]="item.cantidad <= 1"
                                      (click)="actualizarCantidadItem(item, item.cantidad - 1)">
                                <i class="pi pi-minus text-xs"></i>
                              </button>
                              
                              <input type="number" 
                                    [(ngModel)]="item.cantidad"
                                    (blur)="actualizarCantidadItem(item, item.cantidad)"
                                    min="1"
                                    [max]="item.stock"
                                    class="w-12 text-center text-sm border border-gray-300 rounded px-1 py-1" />
                              
                              <button class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs flex items-center justify-center"
                                      [disabled]="item.cantidad >= item.stock"
                                      (click)="actualizarCantidadItem(item, item.cantidad + 1)">
                                <i class="pi pi-plus text-xs"></i>
                              </button>
                              
                              <div class="text-xs text-gray-500 ml-2">Stock: {{item.stock}}</div>
                            </div>
                          </div>
                          
                          <!-- Precio y eliminar -->
                          <div class="text-right">
                            <div class="font-bold text-blue-600">{{formatearMoneda(item.subtotal)}}</div>
                            <div class="text-xs text-gray-500">{{formatearMoneda(item.precioUnitario)}} c/u</div>
                            <button class="mt-1 text-red-500 hover:text-red-700 text-xs"
                                    (click)="eliminarItemCarrito(item)">
                              <i class="pi pi-trash"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Resumen y Pago -->
                <div class="border-t border-gray-200 p-4 space-y-4">
                  
                  <!-- Totales -->
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span class="text-gray-600">Subtotal:</span>
                      <span class="font-medium">{{formatearMoneda(subtotalVenta)}}</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">IGV (18%):</span>
                      <span class="font-medium">{{formatearMoneda(igvVenta)}}</span>
                    </div>
                    <div *ngIf="descuentoVenta > 0" class="flex justify-between text-green-600">
                      <span>Descuento:</span>
                      <span class="font-medium">-{{formatearMoneda(descuentoVenta)}}</span>
                    </div>
                    <div class="border-t pt-2 flex justify-between text-lg font-bold">
                      <span>TOTAL:</span>
                      <span class="text-green-600">{{formatearMoneda(totalVenta)}}</span>
                    </div>
                  </div>
                  
                  <!-- Descuento r√°pido -->
                  <div class="flex items-center gap-2">
                    <input type="checkbox" 
                          [(ngModel)]="aplicarDescuento" 
                          (change)="toggleDescuento()"
                          class="rounded">
                    <label class="text-sm font-medium">Descuento</label>
                    <input *ngIf="aplicarDescuento"
                          type="number" 
                          [(ngModel)]="porcentajeDescuento"
                          (input)="calcularDescuento()"
                          min="0" max="100" step="0.1"
                          placeholder="%" 
                          class="w-16 px-2 py-1 text-sm border rounded">
                  </div>
                  
                  <!-- Comprobante -->
                  <div class="grid grid-cols-2 gap-2">
                    <select [(ngModel)]="nuevaVenta.tipoComprobante" 
                            (change)="onComprobanteChange()"
                            class="px-3 py-2 text-sm border rounded">
                      <option value="">Tipo</option>
                      <option *ngFor="let tipo of tiposComprobante" [value]="tipo.value">
                        {{tipo.label}}
                      </option>
                    </select>
                    
                    <select [(ngModel)]="nuevaVenta.serieComprobante"
                            [disabled]="!nuevaVenta.tipoComprobante"
                            class="px-3 py-2 text-sm border rounded">
                      <option value="">Serie</option>
                      <option *ngFor="let serie of seriesComprobante" [value]="serie.value">
                        {{serie.label}}
                      </option>
                    </select>
                  </div>
                  
                  <!-- Observaciones -->
                  <textarea [(ngModel)]="nuevaVenta.observaciones"
                            placeholder="Observaciones..."
                            rows="2"
                            class="w-full px-3 py-2 text-sm border rounded resize-none"></textarea>
                  
                  <!-- Botones de Pago -->
                  <div class="space-y-2">
                    <!-- Bot√≥n principal -->
                    <button class="w-full bg-green-600 hover:bg-green-700 text-white py-4 px-6 rounded-lg font-bold text-lg transition-colors"
                            [disabled]="!canProcessPayment()"
                            (click)="iniciarPago()">
                      üí≥ PROCESAR PAGO - {{formatearMoneda(totalVenta)}}
                    </button>
                    
                    <!-- M√©todos r√°pidos -->
                    <div class="grid grid-cols-3 gap-2">
                      <button class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm font-medium"
                              [disabled]="!canProcessPayment()"
                              (click)="pagoRapido('EFECTIVO')">
                        üíµ Efectivo
                      </button>
                      <button class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-3 rounded text-sm font-medium"
                              [disabled]="!canProcessPayment()"
                              (click)="pagoRapido('TARJETA_DEBITO')">
                        üí≥ Tarjeta
                      </button>
                      <button class="bg-orange-500 hover:bg-orange-600 text-white py-2 px-3 rounded text-sm font-medium"
                              [disabled]="!canProcessPayment()"
                              (click)="pagoRapido('YAPE')">
                        üì± Digital
                      </button>
                    </div>
                  </div>
                  
                  <!-- Venta a cr√©dito -->
                  <div class="flex items-center gap-2 text-sm">
                    <input type="checkbox" 
                          [(ngModel)]="esVentaCredito"
                          class="rounded">
                    <label>Venta a cr√©dito</label>
                    <select *ngIf="esVentaCredito" 
                            [(ngModel)]="cuotasCredito"
                            class="ml-auto px-2 py-1 text-xs border rounded">
                      <option *ngFor="let cuota of opcionesCuotas" [value]="cuota.value">
                        {{cuota.label}}
                      </option>
                    </select>
                  </div>
                  <!-- REEMPLAZAR el panel de atajos en el aside con esto -->

<div class="bg-gradient-to-r from-slate-50 to-blue-50 p-3 border-t border-gray-200">
  <div class="flex items-center justify-between mb-2">
    <h5 class="text-xs font-semibold text-gray-600 uppercase tracking-wide">
      ‚å®Ô∏è Atajos R√°pidos
    </h5>
    <button class="text-xs text-blue-600 hover:text-blue-800"
            (click)="showKeyboardHelp = true">
      Ver todos
    </button>
  </div>
  
  <div class="grid grid-cols-2 gap-1 text-xs">
    <div class="flex items-center justify-between py-1">
      <span class="text-gray-600">Cliente</span>
      <kbd class="px-1.5 py-0.5 bg-white border border-gray-300 rounded text-xs font-mono shadow-sm">F3</kbd>
    </div>
    <div class="flex items-center justify-between py-1">
      <span class="text-gray-600">Esc√°ner</span>
      <kbd class="px-1.5 py-0.5 bg-white border border-gray-300 rounded text-xs font-mono shadow-sm">F8</kbd>
    </div>
    <div class="flex items-center justify-between py-1">
      <span class="text-gray-600">Efectivo</span>
      <kbd class="px-1 py-0.5 bg-white border border-gray-300 rounded text-xs font-mono shadow-sm">Ctrl+1</kbd>
    </div>
    <div class="flex items-center justify-between py-1">
      <span class="text-green-600 font-medium">Procesar</span>
      <kbd class="px-1.5 py-0.5 bg-green-100 border border-green-300 rounded text-xs font-mono shadow-sm">F12</kbd>
    </div>
  </div>
  
  <div class="mt-2 text-center">
    <span class="text-xs text-gray-500">Presiona </span>
    <kbd class="px-1 py-0.5 bg-blue-100 border border-blue-300 rounded text-xs font-mono">F1</kbd>
    <span class="text-xs text-gray-500"> para ayuda completa</span>
  </div>
</div>
                </div>
              </aside>
            </main>
            
            <!-- üí≥ Loading de Procesamiento de Pago -->
<div *ngIf="procesandoPago" 
     class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm">
  <div class="bg-white rounded-2xl p-8 text-center max-w-md mx-4 shadow-2xl transform animate-pulse">
    
    <!-- Icono animado -->
    <div class="w-20 h-20 mx-auto mb-6 bg-green-100 rounded-full flex items-center justify-center relative">
      <i class="pi pi-credit-card text-3xl text-green-600"></i>
      
      <!-- Anillo de progreso -->
      <svg class="absolute inset-0 w-20 h-20 transform -rotate-90" viewBox="0 0 80 80">
        <circle cx="40" cy="40" r="35" stroke="#e5e7eb" stroke-width="6" fill="none"></circle>
        <circle cx="40" cy="40" r="35" 
                stroke="#10b981" 
                stroke-width="6" 
                fill="none"
                stroke-linecap="round"
                [style.stroke-dasharray]="220"
                [style.stroke-dashoffset]="220 - (220 * progressPercentage / 100)"
                class="transition-all duration-500 ease-out"></circle>
      </svg>
      
      <!-- Porcentaje -->
      <span class="absolute text-xs font-bold text-green-600">{{progressPercentage}}%</span>
    </div>
    
    <!-- Mensaje principal -->
    <h3 class="text-xl font-bold text-gray-800 mb-2">Procesando Pago</h3>
    <div class="text-2xl font-mono font-bold text-green-600 mb-4">
      {{formatearMoneda(totalVenta)}}
    </div>
    
    <!-- Mensaje de progreso -->
    <p class="text-gray-600 mb-4">{{loadingMessage}}</p>
    
    <!-- Advertencia -->
    <div class="text-sm text-orange-600 bg-orange-50 p-3 rounded-lg border border-orange-200">
      <i class="pi pi-exclamation-triangle mr-2"></i>
      No interrumpa este proceso
    </div>
  </div>
</div>

<!-- üîç Loading de B√∫squeda de Productos -->
<div *ngIf="searchingProducts" 
     class="absolute inset-0 bg-white bg-opacity-95 flex items-center justify-center z-40 rounded-lg">
  <div class="text-center">
    <div class="w-12 h-12 mx-auto mb-3 relative">
      <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
      <i class="pi pi-search absolute inset-0 m-auto text-blue-600"></i>
    </div>
    <div class="text-sm font-medium text-gray-700">{{loadingMessage}}</div>
    <div class="text-xs text-gray-500 mt-1">Buscando en inventario...</div>
  </div>
</div>

<!-- üõí Loading de Agregar al Carrito -->
<div *ngIf="addingToCart" 
     class="fixed top-4 right-4 bg-white p-4 rounded-lg shadow-lg border-l-4 border-blue-500 z-50 transform transition-all duration-300">
  <div class="flex items-center gap-3">
    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
      <i class="pi pi-spin pi-spinner text-blue-600"></i>
    </div>
    <div>
      <div class="font-medium text-gray-800">{{loadingMessage}}</div>
      <div class="text-xs text-gray-500">Validando stock...</div>
    </div>
  </div>
</div>

<!-- üë§ Loading de Cliente -->
<div *ngIf="loadingClient" 
     class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded-xl shadow-xl z-50">
  <div class="flex items-center gap-4">
    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
      <i class="pi pi-spin pi-spinner text-green-600"></i>
    </div>
    <div>
      <div class="font-semibold text-gray-800">{{loadingMessage}}</div>
      <div class="text-sm text-gray-500">Obteniendo historial...</div>
    </div>
  </div>
</div>

<!-- üì∑ Loading de Esc√°ner -->
<div *ngIf="connectingScanner" 
     class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white p-4 rounded-lg shadow-lg z-50">
  <div class="flex items-center gap-3">
    <div class="relative">
      <i class="pi pi-camera text-xl"></i>
      <div class="absolute -top-1 -right-1 w-3 h-3 bg-yellow-400 rounded-full animate-ping"></div>
    </div>
    <div>
      <div class="font-medium">{{loadingMessage}}</div>
      <div class="text-xs text-gray-300">Inicializando c√°mara...</div>
    </div>
  </div>
</div>

<!-- üíæ Loading General (para guardar, sincronizar, etc.) -->
<div *ngIf="savingData" 
     class="fixed bottom-4 left-4 bg-blue-600 text-white p-3 rounded-lg shadow-lg z-50 flex items-center gap-3">
  <i class="pi pi-spin pi-spinner"></i>
  <span class="text-sm font-medium">{{loadingMessage}}</span>
</div>

            <!-- Modal de Cliente -->
            <p-dialog 
   [(visible)]="showClientModal" 
  [modal]="true" 
  [closable]="true"
  [style]="{width: '800px', height: 'auto'}" 
  styleClass="border-0 shadow-2xl cliente-dialog-modern overflow-hidden cliente-dialog-tall"
  [blockScroll]="true">
  
  <!-- HEADER S√öPER MODERNO -->
  <ng-template pTemplate="header">
    <div class="flex items-center justify-between w-full bg-gradient-to-r from-indigo-600 via-blue-600 to-purple-600 text-white p-6 -mx-6 -mt-6 mb-6">
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg animate-pulse-subtle">
          <i class="pi pi-users text-white text-2xl"></i>
        </div>
        <div>
          <div class="text-sm text-blue-100 font-medium">üë• Gesti√≥n de Cliente</div>
          <div class="text-2xl font-bold">{{clienteSeleccionado ? 'Cliente Seleccionado' : 'Buscar o Crear Cliente'}}</div>
        </div>
      </div>
      
      <!-- CONTADOR DE CLIENTES -->
      <div class="flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-4 py-2">
        <i class="pi pi-database text-white"></i>
        <span class="text-sm font-medium">{{clientesFiltrados.length || 0}} clientes</span>
      </div>
    </div>
  </ng-template>
  
  <div class="p-6 space-y-6 max-h-96 overflow-y-auto custom-scrollbar">
    
    <!-- CONTENIDO DIN√ÅMICO BASADO EN ESTADO -->
    <div *ngIf="!clienteSeleccionado">
      
      <!-- SECCI√ìN DE B√öSQUEDA MODERNA -->
      <div class="space-y-4">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
            <i class="pi pi-search text-white text-sm"></i>
          </div>
          <h4 class="text-lg font-bold text-gray-900">Buscar Cliente</h4>
        </div>
        
        <!-- BUSCADOR AVANZADO -->
        <div class="relative">
          <p-autoComplete 
            [(ngModel)]="clienteBusqueda"
    [suggestions]="clientesFiltrados"
    (completeMethod)="buscarClientes($event)"
    (onSelect)="onClienteSelect($event)"
    field="nombres"
    placeholder="üîç Buscar por nombre, DNI, RUC o email..."
    styleClass="w-full cliente-search-modern"
    [dropdown]="true"
    [showClear]="true"
    scrollHeight="250px"
    [virtualScroll]="false"
    [itemSize]="70"
    [minLength]="0"
    [completeOnFocus]="true"
    appendTo="body">
            
            <ng-template let-cliente pTemplate="item">
              <div class="flex items-center gap-4 p-3 hover:bg-blue-50 rounded-lg transition-all duration-200 cursor-pointer group">
                <div class="flex-shrink-0">
                  <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-bold shadow-lg group-hover:scale-110 transition-transform">
                    {{cliente.nombres?.charAt(0) || 'C'}}{{cliente.apellidos?.charAt(0) || 'L'}}
                  </div>
                </div>
                <div class="flex-1">
                  <div class="font-semibold text-gray-900 group-hover:text-blue-700 transition-colors">
                    {{cliente.nombres}} {{cliente.apellidos}}
                  </div>
                  <div class="text-sm text-gray-500 flex items-center gap-2">
                    <i class="pi pi-id-card text-xs"></i>
                    {{cliente.dni || cliente.ruc}}
                    <span *ngIf="cliente.email" class="flex items-center gap-1">
                      <i class="pi pi-envelope text-xs"></i>
                      {{cliente.email}}
                    </span>
                  </div>
                  <div *ngIf="cliente.telefono" class="text-xs text-gray-400 flex items-center gap-1">
                    <i class="pi pi-phone"></i>
                    {{cliente.telefono}}
                  </div>
                </div>
                <div class="text-right">
                  <div class="text-sm font-semibold text-green-600">{{cliente.compras || 0}} compras</div>
                  <div class="text-xs text-gray-500">{{formatearMoneda(cliente.totalCompras || 0)}}</div>
                </div>
              </div>
            </ng-template>
          </p-autoComplete>
        </div>
        
        <!-- FILTROS R√ÅPIDOS -->
        <div class="flex gap-2 flex-wrap">
          <button 
            class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors"
            (click)="filtrarClientesPorTipo('frecuentes')">
            üåü Frecuentes
          </button>
          <button 
            class="px-3 py-1 text-xs bg-green-100 text-green-700 rounded-full hover:bg-green-200 transition-colors"
            (click)="filtrarClientesPorTipo('nuevos')">
            üÜï Nuevos
          </button>
          <button 
            class="px-3 py-1 text-xs bg-purple-100 text-purple-700 rounded-full hover:bg-purple-200 transition-colors"
            (click)="filtrarClientesPorTipo('vip')">
            üíé VIP
          </button>
        </div>
      </div>
      
      <!-- CLIENTES RECIENTES MODERNOS -->
      <div *ngIf="clientesRecientes.length > 0" class="animate-fade-in">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center">
            <i class="pi pi-clock text-white text-sm"></i>
          </div>
          <h4 class="text-lg font-bold text-gray-900">Clientes Recientes</h4>
          <span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-medium">{{clientesRecientes.length}}</span>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <button 
            *ngFor="let cliente of clientesRecientes.slice(0, 6)"
            class="text-left p-4 border-2 border-gray-200 rounded-xl hover:border-blue-400 hover:bg-blue-50 transition-all duration-300 group hover:shadow-lg transform hover:-translate-y-1"
            (click)="seleccionarCliente(cliente)">
            
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-r from-orange-400 to-pink-500 rounded-xl flex items-center justify-center text-white font-bold text-sm group-hover:scale-110 transition-transform">
                {{cliente.nombres.charAt(0) || 'C'}}{{cliente.apellidos.charAt(0) || 'L'}}
              </div>
              <div class="flex-1">
                <div class="font-semibold text-gray-900 group-hover:text-blue-700 transition-colors">
                  {{cliente.nombres}} {{cliente.apellidos}}
                </div>
                <div class="text-xs text-gray-500 flex items-center gap-2">
                  <span>{{cliente.dni || cliente.ruc}}</span>
                  <span *ngIf="cliente.compras" class="bg-gray-100 px-2 py-0.5 rounded-full">
                    {{cliente.compras}} compras
                  </span>
                </div>
              </div>
              <i class="pi pi-arrow-right text-gray-400 group-hover:text-blue-500 transition-colors"></i>
            </div>
          </button>
        </div>
      </div>
      
      <!-- CREAR NUEVO CLIENTE - DESTACADO -->
      <div class="text-center py-8 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl border-2 border-dashed border-green-300 hover:border-green-400 transition-colors">
        <div class="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4 animate-bounce-gentle">
          <i class="pi pi-user-plus text-white text-2xl"></i>
        </div>
        <h3 class="text-lg font-bold text-gray-900 mb-2">¬øCliente Nuevo?</h3>
        <p class="text-gray-600 mb-4 text-sm">Crea un nuevo perfil en segundos</p>
        <button 
          class="bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-8 rounded-xl font-semibold hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl"
          (click)="nuevoCliente()">
          <i class="pi pi-plus mr-2"></i>
          Crear Nuevo Cliente
        </button>
      </div>
    </div>
    
    <!-- CLIENTE SELECCIONADO - S√öPER MODERNO -->
    <div *ngIf="clienteSeleccionado" class="animate-slide-down">
      
      <!-- HEADER DEL CLIENTE -->
      <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-6 text-white shadow-xl">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center text-2xl font-bold shadow-lg">
            {{clienteSeleccionado.nombres.charAt(0) || 'C'}}{{clienteSeleccionado.apellidos.charAt(0) || 'L'}}
          </div>
          <div class="flex-1">
            <div class="text-2xl font-bold mb-1">
              {{clienteSeleccionado.nombres}} {{clienteSeleccionado.apellidos}}
            </div>
            <div class="text-green-100 flex items-center gap-2">
              <i class="pi pi-id-card"></i>
              {{clienteSeleccionado.dni ? 'DNI' : 'RUC'}}: {{clienteSeleccionado.dni || clienteSeleccionado.ruc}}
            </div>
          </div>
          <div class="text-right">
            <div class="text-3xl font-bold">{{clienteSeleccionado.compras || 0}}</div>
            <div class="text-sm text-green-100">compras realizadas</div>
          </div>
        </div>
        
        <!-- INDICADORES DE ESTADO -->
        <div class="flex gap-2">
          <span class="bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full text-sm font-medium">
            ‚úÖ Cliente Activo
          </span>
          <span *ngIf="(clienteSeleccionado.compras || 0) > 5" 
                class="bg-yellow-400/90 text-yellow-900 px-3 py-1 rounded-full text-sm font-medium">
            üåü Cliente Frecuente
          </span>
          <span *ngIf="(clienteSeleccionado.totalCompras || 0) > 1000" 
                class="bg-purple-500/90 text-white px-3 py-1 rounded-full text-sm font-medium">
            üíé Cliente VIP
          </span>
        </div>
      </div>
      
      <!-- INFORMACI√ìN DETALLADA -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        
        <!-- DATOS DE CONTACTO -->
        <div class="bg-blue-50 rounded-xl p-5 border border-blue-200">
          <div class="flex items-center gap-2 mb-4">
            <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
              <i class="pi pi-address-book text-white text-sm"></i>
            </div>
            <h5 class="font-bold text-gray-900">Informaci√≥n de Contacto</h5>
          </div>
          
          <div class="space-y-3">
            <div *ngIf="clienteSeleccionado.email" class="flex items-center gap-3">
              <i class="pi pi-envelope text-blue-500"></i>
              <div>
                <div class="text-xs text-gray-500">Email</div>
                <div class="font-medium text-gray-900">{{clienteSeleccionado.email}}</div>
              </div>
            </div>
            
            <div *ngIf="clienteSeleccionado.telefono" class="flex items-center gap-3">
              <i class="pi pi-phone text-blue-500"></i>
              <div>
                <div class="text-xs text-gray-500">Tel√©fono</div>
                <div class="font-medium text-gray-900">{{clienteSeleccionado.telefono}}</div>
              </div>
            </div>
            
            <div *ngIf="clienteSeleccionado.direccion" class="flex items-center gap-3">
              <i class="pi pi-map-marker text-blue-500"></i>
              <div>
                <div class="text-xs text-gray-500">Direcci√≥n</div>
                <div class="font-medium text-gray-900">{{clienteSeleccionado.direccion}}</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ESTAD√çSTICAS DE COMPRAS -->
        <div class="bg-purple-50 rounded-xl p-5 border border-purple-200">
          <div class="flex items-center gap-2 mb-4">
            <div class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center">
              <i class="pi pi-chart-bar text-white text-sm"></i>
            </div>
            <h5 class="font-bold text-gray-900">Historial de Compras</h5>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center p-3 bg-white/70 rounded-lg">
              <div class="text-2xl font-bold text-purple-600">{{clienteSeleccionado.compras || 0}}</div>
              <div class="text-xs text-gray-600">Compras</div>
            </div>
            
            <div class="text-center p-3 bg-white/70 rounded-lg">
              <div class="text-lg font-bold text-green-600">{{formatearMoneda(clienteSeleccionado.totalCompras || 0)}}</div>
              <div class="text-xs text-gray-600">Total</div>
            </div>
            

            <div class="text-center p-3 bg-white/70 rounded-lg">
              <div class="text-lg font-bold text-blue-600">
                {{formatearMoneda(getPromedioCompras(clienteSeleccionado))}}
              </div>
              <div class="text-xs text-gray-600">Promedio</div>
            </div>

            
            <div class="text-center p-3 bg-white/70 rounded-lg">
              <div class="text-sm font-bold text-orange-600">
                {{clienteSeleccionado.ultimaCompra ? (clienteSeleccionado.ultimaCompra | date:'dd/MM') : 'N/A'}}
              </div>
              <div class="text-xs text-gray-600">√öltima</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ACCIONES DEL CLIENTE -->
      <div class="flex gap-3 mt-6">
        <button 
          class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
          (click)="editarCliente()">
          <i class="pi pi-pencil"></i>
          Editar Cliente
        </button>
        
        <button 
          class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
          (click)="limpiarClienteSeleccionado()">
          <i class="pi pi-refresh"></i>
          Cambiar Cliente
        </button>
        
        <button 
          class="bg-orange-500 hover:bg-orange-600 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl"
          (click)="verHistorialCliente()">
          <i class="pi pi-history"></i>
        </button>
      </div>
    </div>
  </div>
  
  <!-- FOOTER MODERNO -->
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center p-6 bg-gray-50 -mx-6 -mb-6 mt-6 border-t border-gray-200">
      
      <!-- INFO R√ÅPIDA -->
      <div class="flex items-center gap-4 text-sm">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
          <span class="text-gray-600">Cliente:</span>
          <span class="font-bold text-gray-900">
            {{clienteSeleccionado ? (clienteSeleccionado.nombres + ' ' + clienteSeleccionado.apellidos) : 'No seleccionado'}}
          </span>
        </div>
      </div>
      
      <!-- BOTONES DE ACCI√ìN -->
      <div class="flex justify-end gap-3 px-6 pb-4">
        <p-button 
          label="Cancelar" 
          icon="pi pi-times" 
          severity="secondary"
          [outlined]="true"
          (click)="showClientModal = false"
          styleClass="px-6 py-2 hover:scale-105 transition-transform"
        ></p-button>
        
        <p-button 
          [label]="clienteSeleccionado ? 'Confirmar Cliente' : 'Seleccionar Cliente'" 
          [icon]="clienteSeleccionado ? 'pi pi-check' : 'pi pi-user'" 
          severity="success"
          [disabled]="!clienteSeleccionado"
          (click)="confirmarCliente()"
          styleClass="px-8 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 hover:scale-105 transition-all duration-300 shadow-lg"
        ></p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>

            <!-- Modal de Ayuda de Teclado -->
            <p-dialog header="‚å®Ô∏è Atajos de Teclado" 
                      [(visible)]="showKeyboardHelp" 
                      [modal]="true" 
                      [closable]="true"
                      [draggable]="false"
                      [resizable]="false"
                      styleClass="w-11/12 max-w-2xl">
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Funciones Principales -->
                <div>
                  <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <i class="pi pi-cog text-blue-600"></i>
                    Funciones Principales
                  </h4>
                  <div class="space-y-2">
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">Buscar Producto</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">F2</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">Seleccionar Cliente</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">F3</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">Aplicar Descuento</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">F4</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">Activar Esc√°ner</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">F8</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">Abrir Caja</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">F9</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-green-50 rounded border border-green-200">
                      <span class="text-sm font-medium">Procesar Pago</span>
                      <kbd class="px-2 py-1 bg-green-200 rounded text-xs font-mono">F12</kbd>
                    </div>
                  </div>
                </div>
                
                <!-- Pagos R√°pidos -->
                <div>
                  <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <i class="pi pi-credit-card text-green-600"></i>
                    Pagos R√°pidos
                  </h4>
                  <div class="space-y-2">
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">üíµ Pago Efectivo</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">Ctrl+1</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">üí≥ Pago Tarjeta</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">Ctrl+2</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">üì± Pago Digital</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">Ctrl+3</kbd>
                    </div>
                  </div>
                  
                  <h4 class="font-semibold text-gray-800 mb-3 mt-6 flex items-center gap-2">
                    <i class="pi pi-wrench text-purple-600"></i>
                    Utilidades
                  </h4>
                  <div class="space-y-2">
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">Limpiar Carrito</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">Ctrl+Del</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">Aumentar Cantidad</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">Ctrl++</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                      <span class="text-sm">Disminuir Cantidad</span>
                      <kbd class="px-2 py-1 bg-gray-200 rounded text-xs font-mono">Ctrl+-</kbd>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-red-50 rounded border border-red-200">
                      <span class="text-sm">Cancelar / Salir</span>
                      <kbd class="px-2 py-1 bg-red-200 rounded text-xs font-mono">ESC</kbd>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <p class="text-sm text-blue-800">
                  <i class="pi pi-info-circle mr-2"></i>
                  <strong>Tip profesional:</strong> Los atajos funcionan desde cualquier parte del sistema, 
                  excepto cuando est√©s escribiendo en un campo de texto.
                </p>
              </div>
              
              <ng-template pTemplate="footer">
                <div class="flex justify-center">
                  <button class="bg-blue-600 text-white px-6 py-2 rounded font-medium"
                          (click)="showKeyboardHelp = false">
                    Entendido
                  </button>
                </div>
              </ng-template>
            </p-dialog>
  
          </div>

          
      </p-tabPanel>

      <!-- PESTA√ëA 2: HISTORIAL DE VENTAS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-premium group">
            <div class="tab-icon-container">
              <div class="tab-icon-bg bg-gradient-to-r from-indigo-500 to-blue-600"></div>
              <i class="pi pi-history text-xl relative z-10 
                        group-hover:rotate-12 transition-transform duration-300"></i>
              
              <!-- Notification badge -->
              <div *ngIf="ventasPendientesCount > 0" 
                   class="absolute -top-2 -right-2 bg-gradient-to-r from-red-500 to-pink-600 
                          text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center 
                          justify-center shadow-lg animate-pulse">
                {{ventasPendientesCount}}
              </div>
            </div>
            
            <div class="tab-content">
              <div class="tab-title">Historial</div>
              <div class="tab-subtitle">Consultar ventas anteriores</div>
              
              <div class="tab-indicators">
                <div class="indicator info">
                  <i class="pi pi-list"></i>
                  <span>{{ventasFiltradas.length}} ventas</span>
                </div>
                
                <div *ngIf="ventasPendientesCount > 0" 
                     class="indicator danger">
                  <i class="pi pi-exclamation-triangle"></i>
                  <span>{{ventasPendientesCount}} pendientes</span>
                </div>
              </div>
            </div>
            
            <!-- Quick stats -->
            <div class="tab-stats">
              <div class="stat-item">
                <div class="stat-value">{{ventasHoyCount}}</div>
                <div class="stat-label">Hoy</div>
              </div>
              <div class="stat-divider"></div>
              <div class="stat-item">
                <div class="stat-value">{{formatearMoneda(montoTotalHoy)}}</div>
                <div class="stat-label">Total</div>
              </div>
            </div>
          </div>
        </ng-template>
      
        <!-- üî• AQU√ç VA EL COMPONENTE DE HISTORIAL -->
      <div class="tab-content-container historial-content">
        <app-historial-ventas></app-historial-ventas>
      </div>
 
      </p-tabPanel>
      
      <!-- PESTA√ëA 3: REPORTES Y AN√ÅLISIS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-premium group">
            <div class="tab-icon-container">
              <div class="tab-icon-bg bg-gradient-to-r from-emerald-500 to-teal-600"></div>
              <i class="pi pi-chart-bar text-xl relative z-10 
                        group-hover:scale-110 transition-transform duration-300"></i>
              
              <!-- Loading indicator cuando se cargan reportes -->
              <div *ngIf="loadingReportes" 
                   class="absolute -top-1 -right-1">
                <i class="pi pi-spin pi-spinner text-emerald-500 text-sm"></i>
              </div>
            </div>
            
            <div class="tab-content">
              <div class="tab-title">Reportes</div>
              <div class="tab-subtitle">An√°lisis y estad√≠sticas</div>
              
              <div class="tab-indicators">
                <div class="indicator success">
                  <i class="pi pi-trending-up"></i>
                  <span>Performance 96%</span>
                </div>
                
                <div class="indicator info">
                  <i class="pi pi-calendar"></i>
                  <span>Este mes</span>
                </div>
              </div>
            </div>
            
            <!-- Chart preview mini -->
            <div class="tab-chart-preview">
              <div class="chart-mini">
                <div class="chart-bar" style="height: 60%"></div>
                <div class="chart-bar" style="height: 80%"></div>
                <div class="chart-bar" style="height: 45%"></div>
                <div class="chart-bar" style="height: 90%"></div>
              </div>
            </div>
          </div>
        </ng-template>
        

         <!-- üî• COMPONENTE DE REPORTES INTEGRADO -->
    <div class="tab-content-container reportes-content">
      <app-reporte-ventas></app-reporte-ventas>
    </div>

        <!-- Contenido de Reportes -->
        <div class="tab-content-container reportes-content">
          <div class="p-6">
            <div class="text-center py-12">
              <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-emerald-500 to-teal-600 
                          rounded-2xl flex items-center justify-center shadow-lg">
                <i class="pi pi-chart-bar text-white text-3xl"></i>
              </div>
              <h3 class="text-2xl font-bold text-gray-800 mb-2">Reportes y An√°lisis</h3>
              <p class="text-gray-600">Estad√≠sticas detalladas y an√°lisis de performance</p>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- PESTA√ëA 4: CONFIGURACI√ìN -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-premium group">
            <div class="tab-icon-container">
              <div class="tab-icon-bg bg-gradient-to-r from-purple-500 to-pink-600"></div>
              <i class="pi pi-cog text-xl relative z-10 
                        group-hover:rotate-90 transition-transform duration-500"></i>
              
              <!-- Badge de configuraciones pendientes -->
              <div *ngIf="configPendientes > 0" 
                   class="absolute -top-2 -right-2 bg-gradient-to-r from-orange-500 to-red-500 
                          text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center 
                          justify-center shadow-lg">
                {{configPendientes}}
              </div>
            </div>
            
            <div class="tab-content">
              <div class="tab-title">Configuraci√≥n</div>
              <div class="tab-subtitle">Ajustes del sistema</div>
              
              <div class="tab-indicators">
                <div class="indicator info">
                  <i class="pi pi-shield"></i>
                  <span>Seguro</span>
                </div>
                
                <div *ngIf="configPendientes > 0" 
                     class="indicator warning">
                  <i class="pi pi-exclamation-circle"></i>
                  <span>{{configPendientes}} pendientes</span>
                </div>
              </div>
            </div>
            
            <!-- Settings preview -->
            <div class="tab-settings-preview">
              <div class="settings-dots">
                <div class="dot active"></div>
                <div class="dot"></div>
                <div class="dot"></div>
              </div>
            </div>
          </div>
        </ng-template>
        
        <!-- Contenido de Configuraci√≥n -->
        <div class="tab-content-container config-content">
          <div class="p-6">
            <div class="text-center py-12">
              <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-purple-500 to-pink-600 
                          rounded-2xl flex items-center justify-center shadow-lg">
                <i class="pi pi-cog text-white text-3xl"></i>
              </div>
              <h3 class="text-2xl font-bold text-gray-800 mb-2">Configuraci√≥n del Sistema</h3>
              <p class="text-gray-600">Ajustes personalizados y preferencias</p>
            </div>
          </div>
        </div>

        <!-- üî• COMPONENTE DE CONFIGURACI√ìN INTEGRADO -->
        <div class="tab-content-container configuracion-content">
          <app-configuracion></app-configuracion>
        </div>
      </p-tabPanel>
    </p-tabView>
    
    <!-- Barra de Estado Inferior -->
    <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-3 border-t border-white/20">
      <div class="flex items-center justify-between">
        <!-- Estado de la pesta√±a actual -->
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
            <span class="text-sm font-medium text-gray-700">{{getTabStatus()}}</span>
          </div>
          
          <!-- Shortcuts de navegaci√≥n -->
          <div class="flex items-center gap-2 text-xs text-gray-500">
            <span class="bg-gray-200 px-2 py-1 rounded">Ctrl+1</span>
            <span>POS</span>
            <span class="bg-gray-200 px-2 py-1 rounded">Ctrl+2</span>
            <span>Historial</span>
            <span class="bg-gray-200 px-2 py-1 rounded">Ctrl+3</span>
            <span>Reportes</span>
          </div>
        </div>
        
        <!-- Acciones r√°pidas de pesta√±a -->
        <div class="flex items-center gap-2">
          <!-- Bot√≥n de refrescar -->
          <p-button 
            icon="pi pi-refresh" 
            [text]="true" 
            [rounded]="true" 
            size="small"
            severity="secondary"
            pTooltip="Refrescar datos (F5)"
            (click)="refrescarPestanaActual()">
          </p-button>
          
          <!-- Bot√≥n de ayuda -->
          <p-button 
            icon="pi pi-question-circle" 
            [text]="true" 
            [rounded]="true" 
            size="small"
            severity="help"
            pTooltip="Ayuda contextual (F1)"
            (click)="mostrarAyuda()">
          </p-button>
          
          <!-- Bot√≥n de fullscreen -->
          <p-button 
            [icon]="isFullscreen ? 'pi pi-window-minimize' : 'pi pi-window-maximize'" 
            [text]="true" 
            [rounded]="true" 
            size="small"
            severity="secondary"
            pTooltip="Pantalla completa (F11)"
            (click)="toggleFullscreen()">
          </p-button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Floating Tab Switcher (Para mobile) -->
  <div class="fixed bottom-4 left-1/2 transform -translate-x-1/2 lg:hidden z-50">
    <div class="bg-white/90 backdrop-blur-xl border border-white/30 rounded-2xl shadow-xl p-2">
      <div class="flex items-center gap-2">
        <button 
          *ngFor="let tab of tabsInfo; let i = index"
          (click)="activeTabIndex = i"
          [class]="'w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-300 ' + 
                   (activeTabIndex === i ? 'bg-blue-500 text-white shadow-lg' : 'text-gray-500 hover:bg-gray-100')">
          <i [class]="tab.icon"></i>
        </button>
      </div>
    </div>
  </div>
</div>


<!-- DI√ÅLOGO: PROCESAMIENTO DE PAGO -->
<p-dialog 
  [(visible)]="pagoDialog" 
  [modal]="true" 
  [style]="{width: '750px', maxHeight: '90vh'}" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="border-0 shadow-2xl pago-dialog-modern overflow-hidden"
  [closable]="!procesandoPago"
  [closeOnEscape]="!procesandoPago"
  [blockScroll]="true"
  (onHide)="onPagoDialogHide()"
>
  <!-- HEADER S√öPER MODERNO -->
  <ng-template pTemplate="header">
    <div class="flex items-center justify-between w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 text-white p-6 -mx-6 -mt-6 mb-6">
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg animate-pulse-subtle">
          <i class="pi pi-credit-card text-white text-2xl"></i>
        </div>
        <div>
          <div class="text-sm text-blue-100 font-medium">üí≥ Procesar Pago</div>
          <div class="text-3xl font-bold">{{formatearMoneda(totalVenta)}}</div>
        </div>
      </div>
      
      <!-- INDICADOR DE PROGRESO -->
      <div class="flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-4 py-2">
        <div class="w-2 h-2 bg-white rounded-full animate-bounce"></div>
        <div class="w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
        <div class="w-2 h-2 bg-white/30 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
      </div>
    </div>
  </ng-template>
  
  <div class="p-6 space-y-6 max-h-96 overflow-y-auto custom-scrollbar">
    
    <!-- RESUMEN COMPACTO Y ELEGANTE -->
    <div class="bg-gradient-to-br from-slate-50 to-blue-50 rounded-2xl p-5 border border-slate-200/50 shadow-sm">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
          <i class="pi pi-shopping-cart text-white text-sm"></i>
        </div>
        <h4 class="text-lg font-bold text-gray-900">Resumen de Venta</h4>
      </div>
      
      <div class="grid grid-cols-3 gap-4">
        <div class="text-center p-3 bg-white/70 backdrop-blur-sm rounded-xl border border-white/50">
          <div class="text-2xl font-bold text-blue-600">{{carrito.length}}</div>
          <div class="text-xs text-gray-600 font-medium">Productos</div>
        </div>
        
        <div class="text-center p-3 bg-white/70 backdrop-blur-sm rounded-xl border border-white/50">
          <div class="text-2xl font-bold text-green-600">{{getTotalItems()}}</div>
          <div class="text-xs text-gray-600 font-medium">Unidades</div>
        </div>
        
        <div class="text-center p-3 bg-white/70 backdrop-blur-sm rounded-xl border border-white/50">
          <div class="text-sm font-bold text-purple-600">{{getTipoComprobanteLabel(nuevaVenta.tipoComprobante)}}</div>
          <div class="text-xs text-gray-600 font-medium">{{nuevaVenta.serieComprobante}}</div>
        </div>
      </div>
      
      <!-- CLIENTE INFO COMPACTA -->
      <div class="mt-4 p-3 bg-white/70 backdrop-blur-sm rounded-xl border border-white/50">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
            {{clienteSeleccionado?.nombres?.charAt(0)}}{{clienteSeleccionado?.apellidos?.charAt(0)}}
          </div>
          <div class="flex-1">
            <div class="font-semibold text-gray-900 text-sm">{{clienteSeleccionado?.nombres}} {{clienteSeleccionado?.apellidos}}</div>
            <div class="text-xs text-gray-600">{{clienteSeleccionado?.dni || clienteSeleccionado?.ruc}}</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- M√âTODOS DE PAGO S√öPER MODERNOS -->
    <div class="space-y-4">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
          <i class="pi pi-wallet text-white text-sm"></i>
        </div>
        <h4 class="text-lg font-bold text-gray-900">M√©todo de Pago</h4>
      </div>
      
      <!-- BOTONES DE M√âTODOS MODERNOS -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
        <div 
          *ngFor="let metodo of metodosPago"
          class="payment-method-card group cursor-pointer transition-all duration-300 transform hover:scale-105"
          [class.active]="pagoActual.metodoPago === metodo.value"
          (click)="seleccionarMetodoPago(metodo.value)"
        >
          <div class="p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-lg"
               [class]="pagoActual.metodoPago === metodo.value ? 
                       'border-blue-500 bg-blue-50 shadow-lg shadow-blue-200/50' : 
                       'border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50'">
            <div class="flex flex-col items-center gap-2">
              <!-- ICONOS DIN√ÅMICOS CON COLORES -->
              <div class="w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-300"
                   [class]="getMetodoPagoStyle(metodo.value)">
                <i [class]="getMetodoPagoIcon(metodo.value) + ' text-xl text-white'"></i>
              </div>
              <span class="text-sm font-semibold text-center"
                    [class]="pagoActual.metodoPago === metodo.value ? 'text-blue-700' : 'text-gray-700'">
                {{metodo.label}}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- FORMULARIO DE PAGO DIN√ÅMICO -->
    <div class="space-y-4 animate-fade-in">
      
      <!-- MONTO A PAGAR - SIEMPRE VISIBLE -->
      <div class="relative">
        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
          <i class="pi pi-dollar text-green-500"></i>
          Monto Recibido
        </label>
        <div class="relative">
          <p-inputNumber 
            [(ngModel)]="montoPagado" 
            mode="currency" 
            currency="PEN" 
            locale="es-PE"
            [min]="0"
            placeholder="S/ 0.00"
            styleClass="w-full pago-input-modern"
            (onInput)="calcularVuelto()"
            [class.border-red-300]="montoPagado < totalVenta"
          ></p-inputNumber>
          
          <!-- VALIDACI√ìN VISUAL -->
          <div *ngIf="montoPagado < totalVenta" 
               class="absolute -bottom-6 left-0 flex items-center gap-1 text-red-500 text-xs animate-shake">
            <i class="pi pi-exclamation-triangle"></i>
            <span>Monto insuficiente</span>
          </div>
          
          <div *ngIf="montoPagado >= totalVenta" 
               class="absolute -bottom-6 left-0 flex items-center gap-1 text-green-500 text-xs">
            <i class="pi pi-check-circle"></i>
            <span>Monto v√°lido</span>
          </div>
        </div>
      </div>
      
      <!-- CAMPOS ESPEC√çFICOS POR M√âTODO -->
      <div class="mt-8">
        
        <!-- TARJETAS -->
        <div *ngIf="pagoActual.metodoPago === 'TARJETA_CREDITO' || pagoActual.metodoPago === 'TARJETA_DEBITO'"  
             class="space-y-4 animate-slide-down">
          
          <div class="bg-gradient-to-r from-gray-800 to-gray-900 rounded-2xl p-5 text-white shadow-xl">
            <div class="flex items-center gap-3 mb-4">
              <i class="pi pi-credit-card text-2xl"></i>
              <span class="font-bold">Informaci√≥n de Tarjeta</span>
            </div>
            
            <div class="space-y-4">
              <div>
                <label class="text-sm text-gray-300 mb-1 block">Nombre del Titular</label>
                <input 
                  pInputText 
                  [(ngModel)]="pagoActual.nombreTarjeta" 
                  placeholder="JUAN P√âREZ GARC√çA"
                  class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-gray-400"
                />
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="text-sm text-gray-300 mb-1 block">√öltimos 4 d√≠gitos</label>
                  <p-inputMask 
                    [(ngModel)]="pagoActual.ultimos4Digitos" 
                    mask="9999" 
                    placeholder="****"
                    styleClass="w-full card-input"
                  ></p-inputMask>
                </div>
                
                <div>
                  <label class="text-sm text-gray-300 mb-1 block">N¬∞ Operaci√≥n</label>
                  <input 
                    pInputText 
                    [(ngModel)]="pagoActual.numeroReferencia" 
                    placeholder="123456789"
                    class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-gray-400"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- TRANSFERENCIAS DIGITALES -->
        <div *ngIf="pagoActual.metodoPago === 'TRANSFERENCIA' || 
                   pagoActual.metodoPago === 'YAPE' || 
                   pagoActual.metodoPago === 'PLIN'" 
             class="animate-slide-down">
          
          <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-5 border border-blue-200/50">
            <div class="flex items-center gap-3 mb-3">
              <div [class]="getMetodoPagoStyle(pagoActual.metodoPago)">
                <i [class]="getMetodoPagoIcon(pagoActual.metodoPago) + ' text-white'"></i>
              </div>
              <span class="font-bold text-gray-800">Referencia de {{getMetodoLabel(pagoActual.metodoPago)}}</span>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">N√∫mero de Operaci√≥n</label>
              <input 
                pInputText 
                [(ngModel)]="pagoActual.numeroReferencia" 
                placeholder="Ingresa el c√≥digo de operaci√≥n"
                class="w-full border-2 border-blue-200 rounded-lg px-4 py-3 focus:border-blue-500 transition-colors"
              />
            </div>
          </div>
        </div>
      </div>
      
      <!-- VUELTO DESTACADO -->
      <div *ngIf="pagoActual.metodoPago === 'EFECTIVO' && vuelto > 0" 
           class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-5 border-2 border-green-200 animate-bounce-gentle">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-green-500 rounded-2xl flex items-center justify-center animate-pulse">
              <i class="pi pi-money-bill text-white text-xl"></i>
            </div>
            <div>
              <div class="text-sm font-semibold text-green-700">üí∞ Vuelto para el Cliente</div>
              <div class="text-xs text-green-600">Cambio a entregar</div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-3xl font-bold text-green-600">{{formatearMoneda(vuelto)}}</div>
            <div class="text-xs text-green-500 font-medium">PEN</div>
          </div>
        </div>
      </div>
      
      <!-- OBSERVACIONES MEJORADAS -->
      <div class="space-y-2">
        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-comment text-blue-500"></i>
          Observaciones del Pago
        </label>
        <textarea 
          pInputTextarea 
          [(ngModel)]="pagoActual.observaciones" 
          placeholder="Agregar notas o comentarios adicionales..."
          rows="2"
          class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-blue-500 transition-colors resize-none"
        ></textarea>
      </div>
    </div>
  </div>
  
  <!-- FOOTER MODERNO -->
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center p-6 bg-gray-50 -mx-6 -mb-6 mt-6 border-t border-gray-200">
      
      <!-- RESUMEN R√ÅPIDO -->
      <div class="flex items-center gap-4 text-sm">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
          <span class="text-gray-600">Total:</span>
          <span class="font-bold text-gray-900">{{formatearMoneda(totalVenta)}}</span>
        </div>
        
        <div *ngIf="montoPagado > 0" class="flex items-center gap-2">
          <div class="w-3 h-3 bg-green-500 rounded-full"></div>
          <span class="text-gray-600">Recibido:</span>
          <span class="font-bold text-gray-900">{{formatearMoneda(montoPagado)}}</span>
        </div>
      </div>
      
      <!-- BOTONES MEJORADOS -->
      <div class="flex gap-3">
        <p-button 
          label="Cancelar" 
          icon="pi pi-times" 
          severity="secondary"
          [outlined]="true"
          [disabled]="procesandoPago"
          (click)="cancelarPago()"
          styleClass="px-6 py-2 hover:scale-105 transition-transform"
        ></p-button>
        
        <p-button 
          [label]="procesandoPago ? 'Procesando...' : 'Confirmar Venta'" 
          [icon]="procesandoPago ? 'pi pi-spin pi-spinner' : 'pi pi-check'" 
          severity="success"
          [loading]="procesandoPago"
          [disabled]="!isPagoValid()"
          (click)="procesarVenta()"
          styleClass="px-8 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 hover:scale-105 transition-all duration-300 shadow-lg"
        ></p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- DI√ÅLOGO: COMPROBANTE FINAL -->
<p-dialog 
  [(visible)]="comprobanteDialog" 
  [header]="'Venta Completada'" 
  [modal]="true" 
  [style]="{width: '700px'}" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="border-0 shadow-2xl comprobante-dialog"
  [closable]="true"
  [blockScroll]="true"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg">
        <i class="pi pi-check-circle text-white text-xl"></i>
      </div>
      <div>
        <div class="text-sm text-gray-500">Venta #{{ventaParaComprobante?.numeroVenta}}</div>
        <div class="text-2xl font-bold text-gray-800">¬°Venta Completada!</div>
      </div>
    </div>
  </ng-template>
  
  <div class="p-5">
    <!-- Vista previa del comprobante -->
    <div class="comprobante-preview" *ngIf="ventaParaComprobante">
      <!-- Encabezado del comprobante -->
      <div class="text-center mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-1">{{getTipoComprobanteLabel(ventaParaComprobante.tipoComprobante)}}</h3>
        <div class="text-lg font-mono font-semibold text-blue-600">
          {{ventaParaComprobante.serieComprobante}}-{{ventaParaComprobante.numeroComprobante || 'PENDIENTE'}}
        </div>
        <div class="text-sm text-gray-600 mt-2">
          Fecha: {{ventaParaComprobante.fechaCreacion | date:'dd/MM/yyyy HH:mm'}}
        </div>
      </div>
      
      <!-- Informaci√≥n del cliente -->
      <div class="bg-blue-50/60 backdrop-blur-sm rounded-lg p-4 mb-4 border border-blue-100">
        <div class="flex items-start justify-between">
          <div>
            <h5 class="font-bold text-blue-800 mb-1">Datos del Cliente</h5>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-sm">
              <div><span class="text-gray-500">Nombre:</span> <span class="font-medium">{{ventaParaComprobante.cliente.nombres}} {{ventaParaComprobante.cliente.apellidos}}</span></div>
              <div><span class="text-gray-500">Documento:</span> <span class="font-medium">{{ventaParaComprobante.cliente.documento}}</span></div>
            </div>
          </div>
          
          <div class="text-right">
            <div class="bg-blue-100 rounded-lg py-1 px-3 text-blue-800 font-medium text-sm inline-block">
              <i class="pi pi-user-plus mr-1"></i>
              Cliente registrado
            </div>
          </div>
        </div>
      </div>
      
      <!-- Detalle de productos -->
      <div class="mb-4">
        <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
          <i class="pi pi-shopping-bag text-purple-600"></i>
          Detalle de Productos
        </h5>
        
        <div class="overflow-auto max-h-48">
          <table class="w-full">
            <thead>
              <tr class="bg-gray-50 text-left">
                <th class="p-2 border-b border-gray-200 text-gray-600 text-sm font-semibold">Producto</th>
                <th class="p-2 border-b border-gray-200 text-gray-600 text-sm font-semibold text-center">Cant.</th>
                <th class="p-2 border-b border-gray-200 text-gray-600 text-sm font-semibold text-right">P. Unit.</th>
                <th class="p-2 border-b border-gray-200 text-gray-600 text-sm font-semibold text-right">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let detalle of ventaParaComprobante.detalles" class="border-b border-gray-100">
                <td class="p-2">
                  <div class="font-medium text-gray-800">{{detalle.producto.nombre}}</div>
                  <div class="text-xs text-gray-500">
                    {{detalle.color.nombre}} - {{detalle.talla}} - {{detalle.producto.codigo}}
                  </div>
                </td>
                <td class="p-2 text-center font-medium">{{detalle.cantidad}}</td>
                <td class="p-2 text-right font-mono">{{formatearMoneda(detalle.precioUnitario)}}</td>
                <td class="p-2 text-right font-mono font-medium text-blue-700">{{formatearMoneda(detalle.subtotal)}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Totales -->
      <div class="bg-gray-50/60 backdrop-blur-sm rounded-lg p-4 border border-gray-200">
        <div class="grid grid-cols-2">
          <div>
            <div class="text-sm text-gray-500 mb-1">M√©todo de pago</div>
            <div class="flex items-center gap-2">
              <i class="pi pi-wallet text-blue-600"></i>
              <span class="font-medium">{{getMetodoPagoLabel(pagoActual.metodoPago)}}</span>
            </div>
          </div>
          
          <div>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-gray-500">Subtotal:</span>
                <span class="font-mono">{{formatearMoneda(ventaParaComprobante.subtotal)}}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-500">IGV (18%):</span>
                <span class="font-mono">{{formatearMoneda(ventaParaComprobante.igv)}}</span>
              </div>
              <div class="flex justify-between font-medium pt-2 border-t border-gray-300">
                <span class="text-gray-800">TOTAL:</span>
                <span class="font-mono text-xl text-emerald-600">{{formatearMoneda(ventaParaComprobante.total)}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Observaciones -->
      <div *ngIf="ventaParaComprobante.observaciones" class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-100">
        <h5 class="font-semibold text-yellow-800 mb-1 flex items-center gap-2">
          <i class="pi pi-comment"></i>
          Observaciones:
        </h5>
        <p class="text-sm text-yellow-700">{{ventaParaComprobante.observaciones}}</p>
      </div>
      
      <!-- Mensajes finales -->
      <div class="mt-6 text-center">
        <div class="text-gray-500 text-sm mb-2">Vendedor: {{ventaParaComprobante.usuario.nombre}}</div>
        <div class="text-gray-400 text-xs">¬°Gracias por su compra!</div>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center px-3">
      <div class="flex gap-2">
        <p-button 
          label="Imprimir" 
          icon="pi pi-print" 
          severity="secondary"
          [outlined]="true"
          (click)="imprimirComprobante(ventaParaComprobante!)"
        ></p-button>
        
        <p-button 
          label="Enviar" 
          icon="pi pi-envelope" 
          severity="info"
          [outlined]="true"
          (click)="enviarComprobantePorEmail(ventaParaComprobante!)"
        ></p-button>
        
        <p-button 
          label="Descargar PDF" 
          icon="pi pi-file-pdf" 
          severity="danger"
          [outlined]="true"
          (click)="descargarComprobantePDF(ventaParaComprobante!)"
        ></p-button>
      </div>
      
      <div class="flex gap-2">
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          severity="secondary"
          (click)="cerrarComprobante()"
        ></p-button>
        
        <p-button 
          label="Nueva Venta" 
          icon="pi pi-plus" 
          severity="success"
          (click)="nuevaVentaRapida()"
        ></p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>


<!-- DI√ÅLOGO: COMPROBANTE -->
<p-dialog 
  [(visible)]="comprobanteDialog" 
  [header]="'Comprobante de Venta'" 
  [modal]="true" 
  [style]="{width: '700px'}" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="border-0 shadow-2xl"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-3">
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-2 rounded-lg">
        <i class="pi pi-file text-white text-xl"></i>
      </div>
      <span class="font-bold text-xl">Comprobante de Venta</span>
    </div>
  </ng-template>
  
  <div *ngIf="ventaParaComprobante" class="p-5">
    <!-- Header del comprobante -->
    <div class="text-center mb-6 pb-4 border-b-2 border-slate-200">
      <h2 class="text-2xl font-bold text-neutral-800">{{ventaParaComprobante.tipoComprobante}}</h2>
      <div class="text-lg font-mono font-semibold text-blue-600">
        {{ventaParaComprobante.serieComprobante}}-{{ventaParaComprobante.numeroComprobante || 'PENDIENTE'}}
      </div>
      <div class="text-sm text-neutral-600 mt-2">
        Fecha: {{ventaParaComprobante.fechaCreacion | date:'dd/MM/yyyy HH:mm'}}
      </div>
    </div>
    
    <!-- Informaci√≥n del cliente -->
    <div class="bg-blue-50 rounded-lg p-4 mb-4">
      <h4 class="font-bold text-blue-800 mb-2 flex items-center gap-2">
        <i class="pi pi-user"></i>
        Datos del Cliente
      </h4>
      <div class="grid grid-cols-2 gap-2 text-sm">
        <div><strong>Nombre:</strong> {{ventaParaComprobante.cliente.nombres}} {{ventaParaComprobante.cliente.apellidos}}</div>
        <div><strong>Documento:</strong> {{ventaParaComprobante.cliente.documento}}</div>
      </div>
    </div>
    
    <!-- Detalle de productos -->
    <div class="mb-4">
      <h4 class="font-bold text-neutral-800 mb-3 flex items-center gap-2">
        <i class="pi pi-list text-emerald-600"></i>
        Detalle de Productos
      </h4>
      
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-100">
            <tr>
              <th class="text-left p-2 border">Producto</th>
              <th class="text-center p-2 border">Cant.</th>
              <th class="text-right p-2 border">Precio Unit.</th>
              <th class="text-right p-2 border">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let detalle of ventaParaComprobante.detalles" class="border-b">
              <td class="p-2 border">
                <div class="font-semibold">{{detalle.producto.nombre}}</div>
                <div class="text-xs text-neutral-600">
                  {{detalle.color.nombre}} - {{detalle.talla.numero}} - {{detalle.producto.codigo}}
                </div>
              </td>
              <td class="text-center p-2 border font-mono">{{detalle.cantidad}}</td>
              <td class="text-right p-2 border font-mono">{{formatearMoneda(detalle.precioUnitario)}}</td>
              <td class="text-right p-2 border font-mono font-semibold">{{formatearMoneda(detalle.subtotal)}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Totales -->
    <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
      <div class="space-y-2">
        <div class="flex justify-between text-sm">
          <span>Subtotal:</span>
          <span class="font-mono">{{formatearMoneda(ventaParaComprobante.subtotal)}}</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>IGV (18%):</span>
          <span class="font-mono">{{formatearMoneda(ventaParaComprobante.igv)}}</span>
        </div>
        <div class="flex justify-between text-lg font-bold pt-2 border-t border-slate-300">
          <span>TOTAL:</span>
          <span class="font-mono text-emerald-600">{{formatearMoneda(ventaParaComprobante.total)}}</span>
        </div>
      </div>
    </div>
    
    <!-- Observaciones -->
    <div *ngIf="ventaParaComprobante.observaciones" class="mt-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
      <h5 class="font-semibold text-amber-800 mb-1">Observaciones:</h5>
      <p class="text-sm text-amber-700">{{ventaParaComprobante.observaciones}}</p>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between gap-3 px-3">
      <div class="flex gap-2">
        <p-button 
          label="Imprimir" 
          icon="pi pi-print" 
          severity="secondary"
          [outlined]="true"
          (click)="imprimirComprobante(ventaParaComprobante!)"
        />
        <p-button 
          label="Enviar por Email" 
          icon="pi pi-envelope" 
          severity="info"
          [outlined]="true"
          (click)="enviarComprobantePorEmail(ventaParaComprobante!)"
        />
      </div>
      
      <div class="flex gap-2">
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          severity="secondary"
          [outlined]="true"
          (click)="comprobanteDialog = false"
        />
        <p-button 
          label="Nueva Venta" 
          icon="pi pi-plus" 
          styleClass="bg-gradient-to-r from-emerald-600 to-emerald-700"
          (click)="comprobanteDialog = false; activeTabIndex = 0"
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- DI√ÅLOGO: DEVOLUCIONES - SECCI√ìN CORREGIDA -->
<p-dialog 
  [(visible)]="devolucionDialog" 
  [header]="'Procesar Devoluci√≥n'" 
  [modal]="true" 
  [style]="{width: '800px'}" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="border-0 shadow-2xl"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-3">
      <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg">
        <i class="pi pi-refresh text-white text-xl"></i>
      </div>
      <span class="font-bold text-xl">Procesar Devoluci√≥n</span>
    </div>
  </ng-template>
  
  <div *ngIf="ventaDevolucion" class="p-5">
    <!-- Informaci√≥n de la venta -->
    <div class="bg-blue-50 rounded-lg p-4 mb-4 border border-blue-200">
      <h4 class="font-bold text-blue-800 mb-2">Informaci√≥n de la Venta</h4>
      <div class="grid grid-cols-2 gap-2 text-sm">
        <div><strong>N¬∞ Venta:</strong> {{ventaDevolucion.numeroVenta}}</div>
        <div><strong>Fecha:</strong> {{ventaDevolucion.fechaCreacion | date:'dd/MM/yyyy'}}</div>
        <div><strong>Cliente:</strong> {{ventaDevolucion.cliente.nombres}} {{ventaDevolucion.cliente.apellidos}}</div>
        <div><strong>Total:</strong> {{formatearMoneda(ventaDevolucion.total)}}</div>
      </div>
    </div>
    
    <!-- Productos a devolver -->
    <div class="mb-4">
      <h4 class="font-bold text-neutral-800 mb-3">Seleccionar Productos a Devolver</h4>
      
      <div class="space-y-3">
        <div *ngFor="let item of itemsDevolucion" 
             class="bg-slate-50 rounded-lg p-4 border border-slate-200">
          <div class="flex items-center gap-4">
            <!-- Checkbox de selecci√≥n -->
            <p-checkbox 
              [(ngModel)]="item.seleccionado" 
              [binary]="true"
            />
            
            <!-- Informaci√≥n del producto -->
            <div class="flex-1">
              <div class="font-semibold">{{item.producto.nombre}}</div>
              <div class="text-sm text-neutral-600">
                {{item.color?.nombre}} - {{item.talla?.numero}} - {{item.producto.codigo}}
              </div>
              <div class="text-sm">
                <span class="text-neutral-500">Cantidad vendida:</span> 
                <span class="font-mono font-semibold">{{item.cantidad}}</span>
              </div>
            </div>
            
            <!-- Cantidad a devolver -->
            <div class="w-32">
              <label class="text-xs text-neutral-600 block mb-1">Cant. a devolver</label>
              <p-inputNumber 
                [(ngModel)]="item.cantidadDevolver" 
                [min]="0" 
                [max]="item.cantidad"
                [disabled]="!item.seleccionado"
                styleClass="w-full"
                [showButtons]="true"
                buttonLayout="horizontal"
              />
            </div>
            
            <!-- Precio -->
            <div class="w-24 text-right">
              <div class="text-sm text-neutral-500">Precio Unit.</div>
              <div class="font-semibold">{{formatearMoneda(item.precioUnitario)}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Motivo de devoluci√≥n -->
    <div class="mb-4">
      <label class="flex text-sm font-medium text-neutral-700 mb-2">
        <i class="pi pi-comment text-orange-600 mr-2"></i>
        Motivo de la Devoluci√≥n
      </label>
      <textarea 
        pInputTextarea 
        [(ngModel)]="motivoDevolucion" 
        placeholder="Explique el motivo de la devoluci√≥n..."
        rows="3"
        class="w-full"
        required
      ></textarea>
    </div>
    
    <!-- Resumen de devoluci√≥n -->
    <div class="bg-orange-50 rounded-lg p-4 border border-orange-200">
      <h5 class="font-semibold text-orange-800 mb-2">Resumen de Devoluci√≥n</h5>
      <div class="text-sm space-y-1">
        <div class="flex justify-between">
          <span>Items seleccionados:</span>
          <span class="font-semibold">{{getItemsSeleccionados()}}</span>
        </div>
        <div class="flex justify-between">
          <span>Cantidad total a devolver:</span>
          <span class="font-semibold">{{getCantidadTotalDevolver()}}</span>
        </div>
        <div class="flex justify-between font-bold text-lg pt-2 border-t border-orange-300">
          <span>Monto a devolver:</span>
          <span class="text-orange-600">{{formatearMoneda(getMontoTotalDevolver())}}</span>
        </div>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between gap-3 px-3">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        severity="secondary"
        [outlined]="true"
        (click)="devolucionDialog = false"
      />
      
      <p-button 
        label="Procesar Devoluci√≥n" 
        icon="pi pi-check" 
        severity="danger"
        [disabled]="!isDevolucionValid()"
        (click)="procesarDevolucion()"
      />
    </div>
  </ng-template>
</p-dialog>

```
<!-- DIALOGO: DASHBOARD GERENCIAL  -->
<p-dialog 
  [(visible)]="showDashboard" 
  [modal]="true" 
  [closable]="true"
  [maximizable]="true"
  [style]="{width: '95vw', height: '90vh'}" 
  styleClass="dashboard-modal-empresarial"
  header="üìä Dashboard Gerencial - Sistema Empresarial POS">
  
  <div class="dashboard-content p-6 h-full overflow-auto">
    
    <!-- KPIs Principales usando tu interfaz -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      
      <div *ngFor="let metrica of metricas" 
           class="bg-gradient-to-br {{getColorMetrica(metrica.color)}} rounded-2xl p-6 text-white shadow-xl relative overflow-hidden">
        
        <!-- Loading overlay -->
        <div *ngIf="metrica.loading" 
             class="absolute inset-0 bg-black/20 flex items-center justify-center backdrop-blur-sm">
          <i class="pi pi-spin pi-spinner text-2xl"></i>
        </div>
        
        <!-- Header de la m√©trica -->
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
            <i class="pi {{metrica.icono}} text-2xl"></i>
          </div>
          
          <!-- Tendencia -->
          <div *ngIf="metrica.tendencia" class="text-right">
            <div class="text-xs opacity-80">{{metrica.tendencia.periodo}}</div>
            <div class="flex items-center gap-1 text-lg font-bold opacity-90">
              <i class="pi {{getIconoTendencia(metrica.tendencia)}} text-sm"></i>
              {{metrica.tendencia.porcentaje}}%
            </div>
          </div>
        </div>
        
        <!-- Valor principal -->
        <div class="text-3xl font-bold mb-2">
            <span *ngIf="typeof metrica.valor === 'number'">
            {{metrica.categoria === 'ventas' || metrica.categoria === 'financiero' ? 
                formatearMoneda(typeof metrica.valor === 'number' ? metrica.valor : +metrica.valor) : 
                metrica.valor}}
          </span>
          <span *ngIf="typeof metrica.valor === 'string'">{{metrica.valor}}</span>
        </div>
        
        <!-- T√≠tulo -->
        <div class="text-sm opacity-90 mb-2">{{metrica.titulo}}</div>
        
        <!-- Objetivo si existe -->
        <div *ngIf="metrica.objetivo" class="text-xs opacity-70">
          Meta: {{metrica.categoria === 'ventas' || metrica.categoria === 'financiero' ? formatearMoneda(metrica.objetivo.valor) : metrica.objetivo.valor}} 
          ({{metrica.objetivo.progreso.toFixed(1)}}%)
        </div>
        
        <!-- Alerta cr√≠tica -->
        <div *ngIf="metrica.alertaCritica?.activa" 
             class="mt-2 bg-red-500/30 border border-red-300 rounded-lg p-2">
          <div class="flex items-center gap-2 text-xs">
            <i class="pi pi-exclamation-triangle"></i>
            {{metrica.alertaCritica?.mensaje}}
          </div>
        </div>
        
        <!-- √öltima actualizaci√≥n -->
        <div class="absolute bottom-2 right-2 text-xs opacity-60">
          {{metrica.ultimaActualizacion | date:'HH:mm:ss'}}
        </div>
      </div>
    </div>
    
    <!-- Detalles expandidos -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      
      <!-- Desglose de Ventas -->
      <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-gray-800">üí∞ Desglose de Ventas</h3>
          <button class="text-sm text-blue-600 hover:text-blue-800" 
                  (click)="verDetalleVentas()">
            Ver detalle
          </button>
        </div>
        
        <div *ngFor="let item of metricas[0]?.desglose" 
             class="flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0">
          <div class="flex items-center gap-3">
            <div class="w-4 h-4 rounded-full" [style.background-color]="item.color"></div>
            <span class="font-medium text-gray-700">{{item.label}}</span>
          </div>
          <div class="text-right">
            <div class="font-bold text-gray-800">{{formatearMoneda(item.valor)}}</div>
            <div class="text-xs text-gray-500">{{item.porcentaje}}%</div>
          </div>
        </div>
        
        <!-- Gr√°fico placeholder -->
        <div class="mt-4 h-32 bg-gray-50 rounded-lg flex items-center justify-center">
          <span class="text-gray-400 text-sm">üìä Gr√°fico circular pr√≥ximamente</span>
        </div>
      </div>
      
      <!-- Productos por Categor√≠a -->
      <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-gray-800">üì¶ Productos por Categor√≠a</h3>
          <button class="text-sm text-blue-600 hover:text-blue-800" 
                  (click)="verStockCritico()">
            Stock cr√≠tico
          </button>
        </div>
        
        <div *ngFor="let item of metricas[3]?.desglose" 
             class="flex items-center justify-between py-3">
          <div class="flex items-center gap-3">
            <div class="w-4 h-4 rounded-full" [style.background-color]="item.color"></div>
            <span class="font-medium text-gray-700">{{item.label}}</span>
          </div>
          <div class="text-right">
            <div class="font-bold text-gray-800">{{item.valor}} uds</div>
            <div class="text-xs text-gray-500">{{item.porcentaje}}%</div>
          </div>
        </div>
        
        <!-- Barra de progreso total -->
        <div class="mt-4 bg-gray-200 rounded-full h-2">
          <div class="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full" 
               style="width: 87%"></div>
        </div>
        <div class="text-xs text-gray-500 mt-1 text-center">87% del objetivo diario</div>
      </div>
    </div>
    
    <!-- M√©tricas adicionales -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <div *ngFor="let metrica of metricas" class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center gap-2 mb-4">
          <div class="w-8 h-8 bg-{{metrica.color === 'success' ? 'green' : metrica.color === 'info' ? 'blue' : metrica.color === 'warning' ? 'orange' : 'purple'}}-500 rounded-lg flex items-center justify-center">
            <i class="pi {{metrica.icono}} text-white text-sm"></i>
          </div>
          <h4 class="font-bold text-gray-800">{{metrica.titulo}}</h4>
        </div>
        
        <div *ngIf="metrica.metricas" class="space-y-2">
          <div *ngFor="let submetrica of metrica.metricas" 
               class="flex justify-between items-center text-sm">
            <span class="text-gray-600 flex items-center gap-1">
              <i *ngIf="submetrica.icono" class="pi {{submetrica.icono}} text-xs"></i>
              {{submetrica.label}}
            </span>
            <span class="font-medium text-gray-800">{{submetrica.valor}}</span>
          </div>
        </div>
        
        <!-- Bot√≥n de acci√≥n -->
        <button *ngIf="metrica.accionPrincipal" 
                class="mt-4 w-full bg-blue-50 hover:bg-blue-100 text-blue-700 py-2 px-4 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2"
                [disabled]="metrica.accionPrincipal.disabled"
                (click)="metrica.accionPrincipal.callback()">
          <i class="pi {{metrica.accionPrincipal.icono}}"></i>
          {{metrica.accionPrincipal.label}}
        </button>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="flex items-center gap-2 text-sm text-gray-500">
        <i class="pi pi-refresh animate-spin"></i>
        Actualizando cada 30 segundos
      </div>
      <div class="flex gap-2">
        <p-button label="Exportar Reporte" icon="pi pi-download" [outlined]="true" 
                  (click)="exportarReporte('reporte')"></p-button>
        <p-button label="Actualizar" icon="pi pi-refresh" severity="info" [outlined]="true"
                  (click)="actualizarTodasLasMetricas()"></p-button>
        <p-button label="Cerrar" icon="pi pi-times" (click)="showDashboard = false"></p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>


<!-- Men√∫ contextual para ventas -->
<p-menu #menuAcciones [popup]="true" [model]="itemsMenuAcciones"></p-menu>

