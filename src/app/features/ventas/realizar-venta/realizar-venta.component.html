<!-- Toast y confirmaciones con animaciones mejoradas -->
<p-toast 
  position="top-right" 
  [life]="5000"
  styleClass="custom-toast-container">
</p-toast>
<p-confirmDialog 
  [style]="{width: '500px'}"
  styleClass="custom-confirm-dialog">
</p-confirmDialog>

<!-- Header Premium ULTRA Optimizado -->
<div class="relative -mx-4 -mt-4 mb-8 overflow-hidden">
  <!-- Container Principal con Colores S√≥lidos -->
  <div class="relative bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden group hover:shadow-3xl transition-all duration-300">
    
    <!-- Background Pattern Optimizado -->
    <div class="absolute inset-0 opacity-5">
      <div class="absolute inset-0 bg-blue-600" 
           style="background-image: 
                  radial-gradient(circle at 20px 20px, rgba(255,255,255,0.1) 2px, transparent 0),
                  radial-gradient(circle at 60px 60px, rgba(255,255,255,0.05) 1px, transparent 0); 
                  background-size: 80px 80px, 120px 120px;">
      </div>
    </div>
    
    <!-- Elementos Decorativos Optimizados -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <!-- C√≠rculo decorativo 1 -->
      <div class="absolute top-8 left-16 w-32 h-32 bg-blue-600 opacity-10 rounded-full blur-2xl animate-pulse-slow"></div>
      
      <!-- C√≠rculo decorativo 2 -->
      <div class="absolute top-20 right-20 w-24 h-24 bg-purple-600 opacity-8 rounded-full blur-xl animate-pulse-gentle"></div>
      
      <!-- C√≠rculo decorativo 3 -->
      <div class="absolute bottom-16 left-1/3 w-16 h-16 bg-green-600 opacity-12 rounded-full blur-lg animate-bounce-gentle"></div>
      
      <!-- C√≠rculo decorativo 4 -->
      <div class="absolute bottom-32 right-1/4 w-20 h-20 bg-yellow-600 opacity-8 rounded-full blur-xl animate-float"></div>
    </div>
    
    <!-- Borde Brillante Optimizado -->
    <div class="absolute inset-0 rounded-2xl border border-blue-500 opacity-0 group-hover:opacity-30 transition-opacity duration-500"></div>
    
    <div class="relative z-10 p-10">
      <!-- Header Principal Optimizado -->
      <div class="flex flex-col xl:flex-row xl:justify-between xl:items-start gap-10">
        
        <!-- Secci√≥n del T√≠tulo -->
        <div class="flex-1 space-y-8">
          <div class="flex items-center gap-8 mb-8">
            <!-- √çcono Principal Optimizado -->
            <div class="relative group/icon">
              <!-- √çcono Principal con Colores S√≥lidos -->
              <div class="w-24 h-24 bg-blue-600 rounded-3xl flex items-center justify-center shadow-2xl 
                          transform hover:scale-110 transition-all duration-300 ease-out">
                <i class="pi pi-shopping-cart text-white text-4xl"></i>
              </div>
              
              <!-- Anillo de Estado -->
              <div class="absolute -inset-2 rounded-3xl border-2 border-blue-400 opacity-60 animate-ping-slow"></div>
              
              <!-- Badge de Status Optimizado -->
              <div class="absolute -top-2 -right-2 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center shadow-lg">
                <i class="pi pi-check text-white text-sm font-bold"></i>
              </div>
            </div>
            
            <!-- T√≠tulos Optimizados -->
            <div class="space-y-4">
              <!-- T√≠tulo Principal -->
              <h1 class="text-5xl xl:text-6xl font-black leading-tight text-white">
                Gesti√≥n de Ventas
                <div class="text-3xl font-bold text-blue-300 mt-2">Sistema Empresarial</div>
              </h1>
              
              <!-- Subt√≠tulo -->
              <div class="flex items-center gap-3 text-xl font-semibold text-slate-300">
                <div class="w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></div>
                <span>Gesti√≥n empresarial avanzada</span>
                <span class="text-2xl">üöÄ</span>
              </div>
            </div>
          </div>
          


        </div>
        
        <!-- Panel de Control de Caja Unificado (Solo cuando caja est√° abierta) -->
        <div *ngIf="cajaAbierta" class="xl:w-80 space-y-6">
          <!-- Control de Caja Integral -->
          <div class="bg-gradient-to-br from-slate-700 to-slate-800 rounded-xl p-6 border border-slate-600 shadow-xl">
            <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
              <i class="pi pi-box text-emerald-500"></i>
              Control de Caja
            </h3>
            
            <!-- Totales del d√≠a destacados -->
            <div class="bg-gradient-to-r from-emerald-600 to-green-600 rounded-lg p-4 mb-6">
              <div class="text-center">
                <div class="text-2xl font-bold text-white mb-1">
                  S/ {{getTotalVentasDelDia() | number:'1.2-2'}}
                </div>
                <div class="text-emerald-100 text-sm mb-3">Total del d√≠a</div>
                <div class="grid grid-cols-2 gap-2 text-xs">
                  <div class="bg-emerald-500 bg-opacity-40 rounded px-2 py-1">
                    <span class="text-emerald-100">{{contarVentasDelDia()}} ventas</span>
                  </div>
                  <div class="bg-emerald-500 bg-opacity-40 rounded px-2 py-1">
                    <span class="text-emerald-100">S/ {{getPromedioVenta() | number:'1.0-0'}} prom.</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Acciones principales -->
            <div class="grid grid-cols-2 gap-3 mb-6">
              <button class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2"
                      (click)="irAPOS()"
                      [title]="'Ir directamente al punto de venta'">
                <i class="pi pi-shopping-cart"></i>
                Venta R√°pida
              </button>
              
              <button class="bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2"
                      (click)="imprimirReporteCaja()"
                      [title]="'Imprimir reporte de caja'">
                <i class="pi pi-print"></i>
                Imprimir
              </button>
              
              <button class="bg-orange-600 hover:bg-orange-700 text-white p-3 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2"
                      (click)="verTotalesDelDia()"
                      [title]="'Ver detalles del d√≠a'">
                <i class="pi pi-chart-line"></i>
                Detalles
              </button>
              
              <button class="bg-red-600 hover:bg-red-700 text-white p-3 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2"
                      (click)="cerrarCaja()"
                      [title]="'Cerrar caja y finalizar sesi√≥n'">
                <i class="pi pi-lock"></i>
                Cerrar Caja
              </button>
            </div>
            
            <!-- Estado del sistema compacto -->
            <div class="border-t border-slate-600 pt-4">
              <h4 class="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
                <i class="pi pi-circle text-green-500 text-xs"></i>
                Sistema Operativo
              </h4>
              
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div class="flex items-center justify-between bg-slate-600 rounded px-2 py-1">
                  <span class="text-slate-300">SUNAT</span>
                  <span class="text-green-400">‚óè</span>
                </div>
                <div class="flex items-center justify-between bg-slate-600 rounded px-2 py-1">
                  <span class="text-slate-300">Impresora</span>
                  <span class="text-green-400">‚óè</span>
                </div>
                <div class="flex items-center justify-between bg-slate-600 rounded px-2 py-1">
                  <span class="text-slate-300">Red</span>
                  <span class="text-green-400">‚óè</span>
                </div>
                <div class="flex items-center justify-between bg-slate-600 rounded px-2 py-1">
                  <span class="text-slate-300">Sesi√≥n</span>
                  <span class="text-emerald-400">{{getCurrentTime() | date:'HH:mm'}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Navegaci√≥n por pesta√±as -->
<div class="relative mb-8">
  <!-- Container de Pesta√±as con Glassmorphism -->
  <div class="bg-white/80 backdrop-blur-xl border border-white/30 rounded-2xl shadow-xl overflow-hidden">
    
    <!-- Indicador de Estado Global -->
    <div class="bg-gradient-to-r from-emerald-500/10 via-blue-500/10 to-purple-500/10 px-6 py-3 border-b border-white/20">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
            <span class="text-sm font-semibold text-gray-700">Sistema Activo</span>
          </div>
          
          <div class="h-4 w-px bg-gray-300"></div>
          
          <div class="flex items-center gap-2 text-sm text-gray-600">
            <i class="pi pi-users text-blue-500"></i>
            <span>{{clienteSeleccionado ? clienteSeleccionado.nombres + ' ' + clienteSeleccionado.apellidos : 'Sin cliente'}}</span>
          </div>
          
          <div class="h-4 w-px bg-gray-300"></div>
          
          <div class="flex items-center gap-2 text-sm text-gray-600">
            <i class="pi pi-shopping-cart text-emerald-500"></i>
            <span>{{carrito.length}} producto(s)</span>
          </div>
        </div>
        
        <!-- Informaci√≥n de Sesi√≥n -->
        <div class="flex items-center gap-4 text-sm text-gray-500">
          <div class="flex items-center gap-2">
            <i class="pi pi-clock text-blue-500"></i>
            <span>{{getCurrentTime() | date:'HH:mm:ss'}}</span>
          </div>
          <div class="flex items-center gap-2">
            <i class="pi pi-calendar text-purple-500"></i>
            <span>{{getCurrentTime() | date:'dd/MM/yyyy'}}</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Pantalla de Abrir Caja -->
    <div *ngIf="!cajaAbierta" class="flex flex-col items-center justify-center min-h-[500px] space-y-8">
      <!-- Contenedor principal -->
      <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-12 max-w-md w-full text-center border border-slate-200 dark:border-slate-700">
        
        <!-- Icono de caja -->
        <div class="relative mb-8">
          <div class="w-32 h-32 mx-auto bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg">
            <i class="pi pi-box text-6xl text-white"></i>
          </div>
          <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-red-500 rounded-full flex items-center justify-center shadow-lg">
            <i class="pi pi-lock text-white text-sm"></i>
          </div>
        </div>
        
        <!-- T√≠tulo y descripci√≥n -->
        <h2 class="text-3xl font-bold text-slate-800 dark:text-white mb-4">
          Caja Cerrada
        </h2>
        <p class="text-slate-600 dark:text-slate-300 mb-8 leading-relaxed">
          Para comenzar a realizar ventas, primero debe abrir la caja registradora. 
          Esto iniciar√° su sesi√≥n de trabajo.
        </p>
        
        <!-- Informaci√≥n de estado -->
        <div class="bg-slate-50 dark:bg-slate-700 rounded-xl p-6 mb-8">
          <div class="flex items-center justify-between mb-4">
            <span class="text-sm font-medium text-slate-600 dark:text-slate-300">Estado:</span>
            <span class="px-3 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded-full text-sm font-medium">
              Cerrada
            </span>
          </div>
          <div class="flex items-center justify-between mb-4">
            <span class="text-sm font-medium text-slate-600 dark:text-slate-300">Turno:</span>
            <span class="text-sm text-slate-800 dark:text-white">{{getCurrentTime() | date:'HH:mm'}}</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-slate-600 dark:text-slate-300">Fecha:</span>
            <span class="text-sm text-slate-800 dark:text-white">{{getCurrentTime() | date:'dd/MM/yyyy'}}</span>
          </div>
        </div>
        
        <!-- Bot√≥n de abrir caja -->
        <button 
          class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 
                 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 
                 transform hover:scale-105 hover:shadow-xl
                 flex items-center justify-center gap-3 text-lg"
          (click)="abrirCaja()">
          <i class="pi pi-unlock text-xl"></i>
          Abrir Caja Registradora
        </button>
        
        <!-- Informaci√≥n adicional -->
        <div class="mt-6 text-xs text-slate-500 dark:text-slate-400">
          <p>üí° Al abrir la caja podr√° acceder a todas las funciones de ventas</p>
        </div>
      </div>
    </div>
    
    <!-- TabView Premium (Solo se muestra cuando la caja est√° abierta) -->
    <div *ngIf="cajaAbierta">
    
    <!-- Header con informaci√≥n de caja abierta -->
    <div class="bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-700 rounded-xl p-4 mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 bg-emerald-500 rounded-full animate-pulse"></div>
          <span class="font-medium text-emerald-800 dark:text-emerald-200">Caja Abierta</span>
          <span class="text-sm text-emerald-600 dark:text-emerald-300">
            - Sesi√≥n iniciada a las {{getCurrentTime() | date:'HH:mm'}}
          </span>
        </div>
        <button 
          class="px-4 py-2 text-sm bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 
                 text-red-700 dark:text-red-200 rounded-lg transition-colors flex items-center gap-2"
          (click)="cerrarCaja()">
          <i class="pi pi-lock text-xs"></i>
          Cerrar Caja
        </button>
      </div>
    </div>

    <!-- TabView Premium -->
    <p-tabView 
      [(activeIndex)]="activeTabIndex" 
      styleClass="premium-tabview-custom"
      (onChange)="onTabChange($event)">
      
      <!-- PESTA√ëA 1: PUNTO DE VENTA -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-premium group">
            <!-- √çcono de la pesta√±a -->
            <div class="tab-icon-container">
              <div class="tab-icon-bg"></div>
              <i class="pi pi-shopping-cart text-xl relative z-10 
                        group-hover:scale-110 transition-transform duration-300"></i>
              
              <!-- Badge din√°mico -->
              <div *ngIf="carrito.length > 0" 
                   class="absolute -top-2 -right-2 bg-gradient-to-r from-emerald-500 to-green-600 
                          text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center 
                          justify-center shadow-lg animate-bounce">
                {{carrito.length}}
              </div>
              
              <!-- Pulse effect cuando est√° activo -->
              <div *ngIf="activeTabIndex === 0" 
                   class="absolute inset-0 bg-blue-400/30 rounded-full animate-ping"></div>
            </div>
            
            <!-- Contenido del header -->
            <div class="tab-content">
              <div class="tab-title">Punto de Venta</div>
              <div class="tab-subtitle">Nueva venta en tiempo real</div>
              
              <!-- Indicadores de estado -->
              <div class="tab-indicators">
                <div *ngIf="clienteSeleccionado" 
                     class="indicator success">
                  <i class="pi pi-check-circle"></i>
                  <span>Cliente</span>
                </div>
                
                <div *ngIf="carrito.length > 0" 
                     class="indicator info">
                  <i class="pi pi-shopping-bag"></i>
                  <span>{{carrito.length}} items</span>
                </div>
                
                <div *ngIf="totalVenta > 0" 
                     class="indicator warning">
                  <i class="pi pi-dollar"></i>
                  <span>{{formatearMoneda(totalVenta)}}</span>
                </div>
              </div>
            </div>
            
            <!-- Progress bar del proceso -->
            <div class="tab-progress">
              <div class="progress-track">
                <div class="progress-fill" 
                     [style.width.%]="getPasoProgress()"></div>
              </div>
              <div class="progress-label">
                Paso {{pasoActual + 1}} de 4
              </div>
            </div>
          </div>
        </ng-template>

        <!-- üî• AQU√ç VA EL COMPONENTE DE HISTORIAL -->
      <div class="tab-content-container historial-content">
        <app-pos-ventas></app-pos-ventas>
      </div>
       
      </p-tabPanel>

      <!-- PESTA√ëA 2: HISTORIAL DE VENTAS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-premium group">
            <div class="tab-icon-container">
              <div class="tab-icon-bg bg-gradient-to-r from-indigo-500 to-blue-600"></div>
              <i class="pi pi-history text-xl relative z-10 
                        group-hover:rotate-12 transition-transform duration-300"></i>
              
              <!-- Notification badge -->
              <div *ngIf="ventasPendientesCount > 0" 
                   class="absolute -top-2 -right-2 bg-gradient-to-r from-red-500 to-pink-600 
                          text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center 
                          justify-center shadow-lg animate-pulse">
                {{ventasPendientesCount}}
              </div>
            </div>
            
            <div class="tab-content">
              <div class="tab-title">Historial</div>
              <div class="tab-subtitle">Consultar ventas anteriores</div>
              
              <div class="tab-indicators">
                <div class="indicator info">
                  <i class="pi pi-list"></i>
                  <span>{{ventasFiltradas.length}} ventas</span>
                </div>
                
                <div *ngIf="ventasPendientesCount > 0" 
                     class="indicator danger">
                  <i class="pi pi-exclamation-triangle"></i>
                  <span>{{ventasPendientesCount}} pendientes</span>
                </div>
              </div>
            </div>
            
            <!-- Quick stats -->
            <div class="tab-stats">
              <div class="stat-item">
                <div class="stat-value">{{ventasHoyCount}}</div>
                <div class="stat-label">Hoy</div>
              </div>
              <div class="stat-divider"></div>
              <div class="stat-item">
                <div class="stat-value">{{formatearMoneda(montoTotalHoy)}}</div>
                <div class="stat-label">Total</div>
              </div>
            </div>
          </div>
        </ng-template>
      
        <!-- üî• AQU√ç VA EL COMPONENTE DE HISTORIAL -->
      <div class="tab-content-container historial-content">
        <app-historial-ventas></app-historial-ventas>
      </div>
 
      </p-tabPanel>
      
      <!-- PESTA√ëA 3: REPORTES Y AN√ÅLISIS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-premium group">
            <div class="tab-icon-container">
              <div class="tab-icon-bg bg-gradient-to-r from-emerald-500 to-teal-600"></div>
              <i class="pi pi-chart-bar text-xl relative z-10 
                        group-hover:scale-110 transition-transform duration-300"></i>
              
              <!-- Loading indicator cuando se cargan reportes -->
              <div *ngIf="loadingReportes" 
                   class="absolute -top-1 -right-1">
                <i class="pi pi-spin pi-spinner text-emerald-500 text-sm"></i>
              </div>
            </div>
            
            <div class="tab-content">
              <div class="tab-title">Reportes</div>
              <div class="tab-subtitle">An√°lisis y estad√≠sticas</div>
              
              <div class="tab-indicators">
                <div class="indicator success">
                  <i class="pi pi-trending-up"></i>
                  <span>Performance 96%</span>
                </div>
                
                <div class="indicator info">
                  <i class="pi pi-calendar"></i>
                  <span>Este mes</span>
                </div>
              </div>
            </div>
            
            <!-- Chart preview mini -->
            <div class="tab-chart-preview">
              <div class="chart-mini">
                <div class="chart-bar" style="height: 60%"></div>
                <div class="chart-bar" style="height: 80%"></div>
                <div class="chart-bar" style="height: 45%"></div>
                <div class="chart-bar" style="height: 90%"></div>
              </div>
            </div>
          </div>
        </ng-template>
        

         <!-- üî• COMPONENTE DE REPORTES INTEGRADO -->
    <div class="tab-content-container reportes-content">
      <app-reporte-ventas></app-reporte-ventas>
    </div>
      </p-tabPanel>
      
      <!-- PESTA√ëA 4: CONFIGURACI√ìN -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-premium group">
            <div class="tab-icon-container">
              <div class="tab-icon-bg bg-gradient-to-r from-purple-500 to-pink-600"></div>
              <i class="pi pi-cog text-xl relative z-10 
                        group-hover:rotate-90 transition-transform duration-500"></i>
              
              <!-- Badge de configuraciones pendientes -->
              <div *ngIf="configPendientes > 0" 
                   class="absolute -top-2 -right-2 bg-gradient-to-r from-orange-500 to-red-500 
                          text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center 
                          justify-center shadow-lg">
                {{configPendientes}}
              </div>
            </div>
            
            <div class="tab-content">
              <div class="tab-title">Configuraci√≥n</div>
              <div class="tab-subtitle">Ajustes del sistema</div>
              
              <div class="tab-indicators">
                <div class="indicator info">
                  <i class="pi pi-shield"></i>
                  <span>Seguro</span>
                </div>
                
                <div *ngIf="configPendientes > 0" 
                     class="indicator warning">
                  <i class="pi pi-exclamation-circle"></i>
                  <span>{{configPendientes}} pendientes</span>
                </div>
              </div>
            </div>
            
            <!-- Settings preview -->
            <div class="tab-settings-preview">
              <div class="settings-dots">
                <div class="dot active"></div>
                <div class="dot"></div>
                <div class="dot"></div>
              </div>
            </div>
          </div>
        </ng-template>
        
        <!-- üî• COMPONENTE DE CONFIGURACI√ìN INTEGRADO -->
        <div class="tab-content-container configuracion-content">
          <app-configuracion></app-configuracion>
        </div>
      </p-tabPanel>
    </p-tabView>
    
    </div> <!-- Fin del div condicional cajaAbierta -->
    
    <!-- Barra de Estado Inferior (Solo cuando caja est√° abierta) -->
    <div *ngIf="cajaAbierta" class="bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-3 border-t border-white/20">
      <div class="flex items-center justify-between">
        <!-- Estado de la pesta√±a actual -->
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
            <span class="text-sm font-medium text-gray-700">{{getTabStatus()}}</span>
          </div>
          
          <!-- Shortcuts de navegaci√≥n -->
          <div class="flex items-center gap-2 text-xs text-gray-500">
            <span class="bg-gray-200 px-2 py-1 rounded">Ctrl+1</span>
            <span>POS</span>
            <span class="bg-gray-200 px-2 py-1 rounded">Ctrl+2</span>
            <span>Historial</span>
            <span class="bg-gray-200 px-2 py-1 rounded">Ctrl+3</span>
            <span>Reportes</span>
          </div>
        </div>
        
        <!-- Acciones r√°pidas de pesta√±a -->
        <div class="flex items-center gap-2">
          <!-- Bot√≥n de refrescar -->
          <p-button 
            icon="pi pi-refresh" 
            [text]="true" 
            [rounded]="true" 
            size="small"
            severity="secondary"
            pTooltip="Refrescar datos (F5)"
            (click)="refrescarPestanaActual()">
          </p-button>
          
          <!-- Bot√≥n de ayuda -->
          <p-button 
            icon="pi pi-question-circle" 
            [text]="true" 
            [rounded]="true" 
            size="small"
            severity="help"
            pTooltip="Ayuda contextual (F1)"
            (click)="mostrarAyuda()">
          </p-button>
          
          <!-- Bot√≥n de fullscreen -->
          <p-button 
            [icon]="isFullscreen ? 'pi pi-window-minimize' : 'pi pi-window-maximize'" 
            [text]="true" 
            [rounded]="true" 
            size="small"
            severity="secondary"
            pTooltip="Pantalla completa (F11)"
            (click)="toggleFullscreen()">
          </p-button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Floating Tab Switcher (Para mobile) -->
  <div class="fixed bottom-4 left-1/2 transform -translate-x-1/2 lg:hidden z-50">
    <div class="bg-white/90 backdrop-blur-xl border border-white/30 rounded-2xl shadow-xl p-2">
      <div class="flex items-center gap-2">
        <button 
          *ngFor="let tab of tabsInfo; let i = index"
          (click)="activeTabIndex = i"
          [class]="'w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-300 ' + 
                   (activeTabIndex === i ? 'bg-blue-500 text-white shadow-lg' : 'text-gray-500 hover:bg-gray-100')">
          <i [class]="tab.icon"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- DI√ÅLOGO: PROCESAMIENTO DE PAGO -->
<p-dialog 
  [(visible)]="pagoDialog" 
  [modal]="true" 
  [style]="{width: '750px', maxHeight: '90vh'}" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="border-0 shadow-2xl pago-dialog-modern overflow-hidden"
  [closable]="!procesandoPago"
  [closeOnEscape]="!procesandoPago"
  [blockScroll]="true"
  (onHide)="onPagoDialogHide()"
>
  <!-- HEADER S√öPER MODERNO -->
  <ng-template pTemplate="header">
    <div class="flex items-center justify-between w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 text-white p-6 -mx-6 -mt-6 mb-6">
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg animate-pulse-subtle">
          <i class="pi pi-credit-card text-white text-2xl"></i>
        </div>
        <div>
          <div class="text-sm text-blue-100 font-medium">üí≥ Procesar Pago</div>
          <div class="text-3xl font-bold">{{formatearMoneda(totalVenta)}}</div>
        </div>
      </div>
      
      <!-- INDICADOR DE PROGRESO -->
      <div class="flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-4 py-2">
        <div class="w-2 h-2 bg-white rounded-full animate-bounce"></div>
        <div class="w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
        <div class="w-2 h-2 bg-white/30 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
      </div>
    </div>
  </ng-template>
  
  <div class="p-6 space-y-6 max-h-96 overflow-y-auto custom-scrollbar">
    
    <!-- RESUMEN COMPACTO Y ELEGANTE -->
    <div class="bg-gradient-to-br from-slate-50 to-blue-50 rounded-2xl p-5 border border-slate-200/50 shadow-sm">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
          <i class="pi pi-shopping-cart text-white text-sm"></i>
        </div>
        <h4 class="text-lg font-bold text-gray-900">Resumen de Venta</h4>
      </div>
      
      <div class="grid grid-cols-3 gap-4">
        <div class="text-center p-3 bg-white/70 backdrop-blur-sm rounded-xl border border-white/50">
          <div class="text-2xl font-bold text-blue-600">{{carrito.length}}</div>
          <div class="text-xs text-gray-600 font-medium">Productos</div>
        </div>
        
        <div class="text-center p-3 bg-white/70 backdrop-blur-sm rounded-xl border border-white/50">
          <div class="text-2xl font-bold text-green-600">{{getTotalItems()}}</div>
          <div class="text-xs text-gray-600 font-medium">Unidades</div>
        </div>
        
        <div class="text-center p-3 bg-white/70 backdrop-blur-sm rounded-xl border border-white/50">
          <div class="text-sm font-bold text-purple-600">{{getTipoComprobanteLabel(nuevaVenta.tipoComprobante)}}</div>
          <div class="text-xs text-gray-600 font-medium">{{nuevaVenta.serieComprobante}}</div>
        </div>
      </div>
      
      <!-- CLIENTE INFO COMPACTA -->
      <div class="mt-4 p-3 bg-white/70 backdrop-blur-sm rounded-xl border border-white/50">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
            {{clienteSeleccionado?.nombres?.charAt(0)}}{{clienteSeleccionado?.apellidos?.charAt(0)}}
          </div>
          <div class="flex-1">
            <div class="font-semibold text-gray-900 text-sm">{{clienteSeleccionado?.nombres}} {{clienteSeleccionado?.apellidos}}</div>
            <div class="text-xs text-gray-600">{{clienteSeleccionado?.dni || clienteSeleccionado?.ruc}}</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- M√âTODOS DE PAGO S√öPER MODERNOS -->
    <div class="space-y-4">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
          <i class="pi pi-wallet text-white text-sm"></i>
        </div>
        <h4 class="text-lg font-bold text-gray-900">M√©todo de Pago</h4>
      </div>
      
      <!-- BOTONES DE M√âTODOS MODERNOS -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
        <div *ngFor="let metodo of metodosPago"
             class="payment-method-card group cursor-pointer transition-all duration-300 transform hover:scale-105"
             [class.active]="pagoActual.metodoPago === metodo.value"
             (click)="seleccionarMetodoPago(metodo.value)"
             (keydown.enter)="seleccionarMetodoPago(metodo.value)"
             (keydown.space)="seleccionarMetodoPago(metodo.value)"
             tabindex="0"
             role="button"
             [attr.aria-label]="'Seleccionar m√©todo de pago: ' + metodo.label">
          <div class="p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-lg"
               [class]="pagoActual.metodoPago === metodo.value ? 
                       'border-blue-500 bg-blue-50 shadow-lg shadow-blue-200/50' : 
                       'border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50'">
            <div class="flex flex-col items-center gap-2">
              <!-- ICONOS DIN√ÅMICOS CON COLORES -->
              <div class="w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-300"
                   [class]="getMetodoPagoStyle(metodo.value)">
                <i [class]="getMetodoPagoIcon(metodo.value) + ' text-xl text-white'"></i>
              </div>
              <span class="text-sm font-semibold text-center"
                    [class]="pagoActual.metodoPago === metodo.value ? 'text-blue-700' : 'text-gray-700'">
                {{metodo.label}}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- FORMULARIO DE PAGO DIN√ÅMICO -->
    <div class="space-y-4 animate-fade-in">
      
      <!-- MONTO A PAGAR - SIEMPRE VISIBLE -->
      <div class="relative">
        <label for="montoPagado" class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
          <i class="pi pi-dollar text-green-500"></i>
          Monto Recibido
        </label>
        <div class="relative">
          <p-inputNumber 
            [(ngModel)]="montoPagado" 
            mode="currency" 
            currency="PEN" 
            locale="es-PE"
            [min]="0"
            placeholder="S/ 0.00"
            styleClass="w-full pago-input-modern"
            (onInput)="calcularVuelto()"
            [class.border-red-300]="montoPagado < totalVenta"
          ></p-inputNumber>
          
          <!-- VALIDACI√ìN VISUAL -->
          <div *ngIf="montoPagado < totalVenta" 
               class="absolute -bottom-6 left-0 flex items-center gap-1 text-red-500 text-xs animate-shake">
            <i class="pi pi-exclamation-triangle"></i>
            <span>Monto insuficiente</span>
          </div>
          
          <div *ngIf="montoPagado >= totalVenta" 
               class="absolute -bottom-6 left-0 flex items-center gap-1 text-green-500 text-xs">
            <i class="pi pi-check-circle"></i>
            <span>Monto v√°lido</span>
          </div>
        </div>
      </div>
      
      <!-- CAMPOS ESPEC√çFICOS POR M√âTODO -->
      <div class="mt-8">
        
        <!-- TARJETAS -->
        <div *ngIf="pagoActual.metodoPago === 'TARJETA_CREDITO' || pagoActual.metodoPago === 'TARJETA_DEBITO'"  
             class="space-y-4 animate-slide-down">
          
          <div class="bg-gradient-to-r from-gray-800 to-gray-900 rounded-2xl p-5 text-white shadow-xl">
            <div class="flex items-center gap-3 mb-4">
              <i class="pi pi-credit-card text-2xl"></i>
              <span class="font-bold">Informaci√≥n de Tarjeta</span>
            </div>
            
            <div class="space-y-4">
              <div>
                <label for="nombreTarjeta" class="text-sm text-gray-300 mb-1 block">Nombre del Titular</label>
                <input 
                  pInputText 
                  [(ngModel)]="pagoActual.nombreTarjeta" 
                  placeholder="JUAN P√âREZ GARC√çA"
                  class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-gray-400"
                />
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label for="ultimos4Digitos" class="text-sm text-gray-300 mb-1 block">√öltimos 4 d√≠gitos</label>
                  <p-inputMask 
                    [(ngModel)]="pagoActual.ultimos4Digitos" 
                    mask="9999" 
                    placeholder="****"
                    styleClass="w-full card-input"
                  ></p-inputMask>
                </div>
                
                <div>
                  <label for="numeroReferencia" class="text-sm text-gray-300 mb-1 block">N¬∞ Operaci√≥n</label>
                  <input 
                    pInputText 
                    [(ngModel)]="pagoActual.numeroReferencia" 
                    placeholder="123456789"
                    class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-gray-400"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- TRANSFERENCIAS DIGITALES -->
        <div *ngIf="pagoActual.metodoPago === 'TRANSFERENCIA' || 
                   pagoActual.metodoPago === 'YAPE' || 
                   pagoActual.metodoPago === 'PLIN'" 
             class="animate-slide-down">
          
          <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-5 border border-blue-200/50">
            <div class="flex items-center gap-3 mb-3">
              <div [class]="getMetodoPagoStyle(pagoActual.metodoPago)">
                <i [class]="getMetodoPagoIcon(pagoActual.metodoPago) + ' text-white'"></i>
              </div>
              <span class="font-bold text-gray-800">Referencia de {{getMetodoLabel(pagoActual.metodoPago)}}</span>
            </div>
            
            <div>
              <label for="numeroReferencia" class="text-sm font-medium text-gray-700 mb-2 block">N√∫mero de Operaci√≥n</label>
              <input 
                pInputText 
                [(ngModel)]="pagoActual.numeroReferencia" 
                placeholder="Ingresa el c√≥digo de operaci√≥n"
                class="w-full border-2 border-blue-200 rounded-lg px-4 py-3 focus:border-blue-500 transition-colors"
              />
            </div>
          </div>
        </div>
      </div>
      
      <!-- VUELTO DESTACADO -->
      <div *ngIf="pagoActual.metodoPago === 'EFECTIVO' && vuelto > 0" 
           class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-5 border-2 border-green-200 animate-bounce-gentle">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-green-500 rounded-2xl flex items-center justify-center animate-pulse">
              <i class="pi pi-money-bill text-white text-xl"></i>
            </div>
            <div>
              <div class="text-sm font-semibold text-green-700">üí∞ Vuelto para el Cliente</div>
              <div class="text-xs text-green-600">Cambio a entregar</div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-3xl font-bold text-green-600">{{formatearMoneda(vuelto)}}</div>
            <div class="text-xs text-green-500 font-medium">PEN</div>
          </div>
        </div>
      </div>
      
      <!-- OBSERVACIONES MEJORADAS -->
      <div class="space-y-2">
        <label for="observacionesPago" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-comment text-blue-500"></i>
          Observaciones del Pago
        </label>
        <textarea 
          pInputTextarea 
          [(ngModel)]="pagoActual.observaciones" 
          placeholder="Agregar notas o comentarios adicionales..."
          rows="2"
          class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-blue-500 transition-colors resize-none"
        ></textarea>
      </div>
    </div>
  </div>
  
  <!-- FOOTER MODERNO -->
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center p-6 bg-gray-50 -mx-6 -mb-6 mt-6 border-t border-gray-200">
      
      <!-- RESUMEN R√ÅPIDO -->
      <div class="flex items-center gap-4 text-sm">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
          <span class="text-gray-600">Total:</span>
          <span class="font-bold text-gray-900">{{formatearMoneda(totalVenta)}}</span>
        </div>
        
        <div *ngIf="montoPagado > 0" class="flex items-center gap-2">
          <div class="w-3 h-3 bg-green-500 rounded-full"></div>
          <span class="text-gray-600">Recibido:</span>
          <span class="font-bold text-gray-900">{{formatearMoneda(montoPagado)}}</span>
        </div>
      </div>
      
      <!-- BOTONES MEJORADOS -->
      <div class="flex gap-3">
        <p-button 
          label="Cancelar" 
          icon="pi pi-times" 
          severity="secondary"
          [outlined]="true"
          [disabled]="procesandoPago"
          (click)="cancelarPago()"
          styleClass="px-6 py-2 hover:scale-105 transition-transform"
        ></p-button>
        
        <p-button 
          [label]="procesandoPago ? 'Procesando...' : 'Confirmar Venta'" 
          [icon]="procesandoPago ? 'pi pi-spin pi-spinner' : 'pi pi-check'" 
          severity="success"
          [loading]="procesandoPago"
          [disabled]="!isPagoValid()"
          (click)="procesarVenta()"
          styleClass="px-8 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 hover:scale-105 transition-all duration-300 shadow-lg"
        ></p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- DI√ÅLOGO: COMPROBANTE FINAL -->
<p-dialog 
  [(visible)]="comprobanteDialog" 
  [header]="'Venta Completada'" 
  [modal]="true" 
  [style]="{width: '700px'}" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="border-0 shadow-2xl comprobante-dialog"
  [closable]="true"
  [blockScroll]="true"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg">
        <i class="pi pi-check-circle text-white text-xl"></i>
      </div>
      <div>
        <div class="text-sm text-gray-500">Venta #{{ventaParaComprobante?.numeroVenta}}</div>
        <div class="text-2xl font-bold text-gray-800">¬°Venta Completada!</div>
      </div>
    </div>
  </ng-template>
  
  <div class="p-5">
    <!-- Vista previa del comprobante -->
    <div class="comprobante-preview" *ngIf="ventaParaComprobante">
      <!-- Encabezado del comprobante -->
      <div class="text-center mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-1">{{getTipoComprobanteLabel(ventaParaComprobante.tipoComprobante)}}</h3>
        <div class="text-lg font-mono font-semibold text-blue-600">
          {{ventaParaComprobante.serieComprobante}}-{{ventaParaComprobante.numeroComprobante || 'PENDIENTE'}}
        </div>
        <div class="text-sm text-gray-600 mt-2">
          Fecha: {{ventaParaComprobante.fechaCreacion | date:'dd/MM/yyyy HH:mm'}}
        </div>
      </div>
      
      <!-- Informaci√≥n del cliente -->
      <div class="bg-blue-50/60 backdrop-blur-sm rounded-lg p-4 mb-4 border border-blue-100">
        <div class="flex items-start justify-between">
          <div>
            <h5 class="font-bold text-blue-800 mb-1">Datos del Cliente</h5>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-sm">
              <div><span class="text-gray-500">Nombre:</span> <span class="font-medium">{{ventaParaComprobante.cliente.nombres}} {{ventaParaComprobante.cliente.apellidos}}</span></div>
              <div><span class="text-gray-500">Documento:</span> <span class="font-medium">{{ventaParaComprobante.cliente.documento}}</span></div>
            </div>
          </div>
          
          <div class="text-right">
            <div class="bg-blue-100 rounded-lg py-1 px-3 text-blue-800 font-medium text-sm inline-block">
              <i class="pi pi-user-plus mr-1"></i>
              Cliente registrado
            </div>
          </div>
        </div>
      </div>
      
      <!-- Detalle de productos -->
      <div class="mb-4">
        <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
          <i class="pi pi-shopping-bag text-purple-600"></i>
          Detalle de Productos
        </h5>
        
        <div class="overflow-auto max-h-48">
          <table class="w-full">
            <thead>
              <tr class="bg-gray-50 text-left">
                <th class="p-2 border-b border-gray-200 text-gray-600 text-sm font-semibold">Producto</th>
                <th class="p-2 border-b border-gray-200 text-gray-600 text-sm font-semibold text-center">Cant.</th>
                <th class="p-2 border-b border-gray-200 text-gray-600 text-sm font-semibold text-right">P. Unit.</th>
                <th class="p-2 border-b border-gray-200 text-gray-600 text-sm font-semibold text-right">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let detalle of ventaParaComprobante.detalles" class="border-b border-gray-100">
                <td class="p-2">
                  <div class="font-medium text-gray-800">{{detalle.producto.nombre}}</div>
                  <div class="text-xs text-gray-500">
                    {{detalle.color.nombre}} - {{detalle.talla}} - {{detalle.producto.codigo}}
                  </div>
                </td>
                <td class="p-2 text-center font-medium">{{detalle.cantidad}}</td>
                <td class="p-2 text-right font-mono">{{formatearMoneda(detalle.precioUnitario)}}</td>
                <td class="p-2 text-right font-mono font-medium text-blue-700">{{formatearMoneda(detalle.subtotal)}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Totales -->
      <div class="bg-gray-50/60 backdrop-blur-sm rounded-lg p-4 border border-gray-200">
        <div class="grid grid-cols-2">
          <div>
            <div class="text-sm text-gray-500 mb-1">M√©todo de pago</div>
            <div class="flex items-center gap-2">
              <i class="pi pi-wallet text-blue-600"></i>
              <span class="font-medium">{{getMetodoPagoLabel(pagoActual.metodoPago)}}</span>
            </div>
          </div>
          
          <div>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-gray-500">Subtotal:</span>
                <span class="font-mono">{{formatearMoneda(ventaParaComprobante.subtotal)}}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-500">IGV (18%):</span>
                <span class="font-mono">{{formatearMoneda(ventaParaComprobante.igv)}}</span>
              </div>
              <div class="flex justify-between font-medium pt-2 border-t border-gray-300">
                <span class="text-gray-800">TOTAL:</span>
                <span class="font-mono text-xl text-emerald-600">{{formatearMoneda(ventaParaComprobante.total)}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Observaciones -->
      <div *ngIf="ventaParaComprobante.observaciones" class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-100">
        <h5 class="font-semibold text-yellow-800 mb-1 flex items-center gap-2">
          <i class="pi pi-comment"></i>
          Observaciones:
        </h5>
        <p class="text-sm text-yellow-700">{{ventaParaComprobante.observaciones}}</p>
      </div>
      
      <!-- Mensajes finales -->
      <div class="mt-6 text-center">
        <div class="text-gray-500 text-sm mb-2">Vendedor: {{ventaParaComprobante.usuario.nombre}}</div>
        <div class="text-gray-400 text-xs">¬°Gracias por su compra!</div>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center px-3">
      <div class="flex gap-2">
        <p-button 
          label="Imprimir" 
          icon="pi pi-print" 
          severity="secondary"
          [outlined]="true"
          (click)="imprimirComprobante(ventaParaComprobante!)"
        ></p-button>
        
        <p-button 
          label="Enviar" 
          icon="pi pi-envelope" 
          severity="info"
          [outlined]="true"
          (click)="enviarComprobantePorEmail(ventaParaComprobante!)"
        ></p-button>
        
        <p-button 
          label="Descargar PDF" 
          icon="pi pi-file-pdf" 
          severity="danger"
          [outlined]="true"
          (click)="descargarComprobantePDF(ventaParaComprobante!)"
        ></p-button>
      </div>
      
      <div class="flex gap-2">
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          severity="secondary"
          (click)="cerrarComprobante()"
        ></p-button>
        
        <p-button 
          label="Nueva Venta" 
          icon="pi pi-plus" 
          severity="success"
          (click)="nuevaVentaRapida()"
        ></p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>


<!-- DI√ÅLOGO: COMPROBANTE -->
<p-dialog 
  [(visible)]="comprobanteDialog" 
  [header]="'Comprobante de Venta'" 
  [modal]="true" 
  [style]="{width: '700px'}" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="border-0 shadow-2xl"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-3">
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-2 rounded-lg">
        <i class="pi pi-file text-white text-xl"></i>
      </div>
      <span class="font-bold text-xl">Comprobante de Venta</span>
    </div>
  </ng-template>
  
  <div *ngIf="ventaParaComprobante" class="p-5">
    <!-- Header del comprobante -->
    <div class="text-center mb-6 pb-4 border-b-2 border-slate-200">
      <h2 class="text-2xl font-bold text-neutral-800">{{ventaParaComprobante.tipoComprobante}}</h2>
      <div class="text-lg font-mono font-semibold text-blue-600">
        {{ventaParaComprobante.serieComprobante}}-{{ventaParaComprobante.numeroComprobante || 'PENDIENTE'}}
      </div>
      <div class="text-sm text-neutral-600 mt-2">
        Fecha: {{ventaParaComprobante.fechaCreacion | date:'dd/MM/yyyy HH:mm'}}
      </div>
    </div>
    
    <!-- Informaci√≥n del cliente -->
    <div class="bg-blue-50 rounded-lg p-4 mb-4">
      <h4 class="font-bold text-blue-800 mb-2 flex items-center gap-2">
        <i class="pi pi-user"></i>
        Datos del Cliente
      </h4>
      <div class="grid grid-cols-2 gap-2 text-sm">
        <div><strong>Nombre:</strong> {{ventaParaComprobante.cliente.nombres}} {{ventaParaComprobante.cliente.apellidos}}</div>
        <div><strong>Documento:</strong> {{ventaParaComprobante.cliente.documento}}</div>
      </div>
    </div>
    
    <!-- Detalle de productos -->
    <div class="mb-4">
      <h4 class="font-bold text-neutral-800 mb-3 flex items-center gap-2">
        <i class="pi pi-list text-emerald-600"></i>
        Detalle de Productos
      </h4>
      
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-100">
            <tr>
              <th class="text-left p-2 border">Producto</th>
              <th class="text-center p-2 border">Cant.</th>
              <th class="text-right p-2 border">Precio Unit.</th>
              <th class="text-right p-2 border">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let detalle of ventaParaComprobante.detalles" class="border-b">
              <td class="p-2 border">
                <div class="font-semibold">{{detalle.producto.nombre}}</div>
                <div class="text-xs text-neutral-600">
                  {{detalle.color.nombre}} - {{detalle.talla.numero}} - {{detalle.producto.codigo}}
                </div>
              </td>
              <td class="text-center p-2 border font-mono">{{detalle.cantidad}}</td>
              <td class="text-right p-2 border font-mono">{{formatearMoneda(detalle.precioUnitario)}}</td>
              <td class="text-right p-2 border font-mono font-semibold">{{formatearMoneda(detalle.subtotal)}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Totales -->
    <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
      <div class="space-y-2">
        <div class="flex justify-between text-sm">
          <span>Subtotal:</span>
          <span class="font-mono">{{formatearMoneda(ventaParaComprobante.subtotal)}}</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>IGV (18%):</span>
          <span class="font-mono">{{formatearMoneda(ventaParaComprobante.igv)}}</span>
        </div>
        <div class="flex justify-between text-lg font-bold pt-2 border-t border-slate-300">
          <span>TOTAL:</span>
          <span class="font-mono text-emerald-600">{{formatearMoneda(ventaParaComprobante.total)}}</span>
        </div>
      </div>
    </div>
    
    <!-- Observaciones -->
    <div *ngIf="ventaParaComprobante.observaciones" class="mt-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
      <h5 class="font-semibold text-amber-800 mb-1">Observaciones:</h5>
      <p class="text-sm text-amber-700">{{ventaParaComprobante.observaciones}}</p>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between gap-3 px-3">
      <div class="flex gap-2">
        <p-button 
          label="Imprimir" 
          icon="pi pi-print" 
          severity="secondary"
          [outlined]="true"
          (click)="imprimirComprobante(ventaParaComprobante!)"
        />
        <p-button 
          label="Enviar por Email" 
          icon="pi pi-envelope" 
          severity="info"
          [outlined]="true"
          (click)="enviarComprobantePorEmail(ventaParaComprobante!)"
        />
      </div>
      
      <div class="flex gap-2">
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          severity="secondary"
          [outlined]="true"
          (click)="comprobanteDialog = false"
        />
        <p-button 
          label="Nueva Venta" 
          icon="pi pi-plus" 
          styleClass="bg-gradient-to-r from-emerald-600 to-emerald-700"
          (click)="comprobanteDialog = false; activeTabIndex = 0"
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- DI√ÅLOGO: DEVOLUCIONES - SECCI√ìN CORREGIDA -->
<p-dialog 
  [(visible)]="devolucionDialog" 
  [header]="'Procesar Devoluci√≥n'" 
  [modal]="true" 
  [style]="{width: '800px'}" 
  [draggable]="false" 
  [resizable]="false"
  styleClass="border-0 shadow-2xl"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-3">
      <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg">
        <i class="pi pi-refresh text-white text-xl"></i>
      </div>
      <span class="font-bold text-xl">Procesar Devoluci√≥n</span>
    </div>
  </ng-template>
  
  <div *ngIf="ventaDevolucion" class="p-5">
    <!-- Informaci√≥n de la venta -->
    <div class="bg-blue-50 rounded-lg p-4 mb-4 border border-blue-200">
      <h4 class="font-bold text-blue-800 mb-2">Informaci√≥n de la Venta</h4>
      <div class="grid grid-cols-2 gap-2 text-sm">
        <div><strong>N¬∞ Venta:</strong> {{ventaDevolucion.numeroVenta}}</div>
        <div><strong>Fecha:</strong> {{ventaDevolucion.fechaCreacion | date:'dd/MM/yyyy'}}</div>
        <div><strong>Cliente:</strong> {{ventaDevolucion.cliente.nombres}} {{ventaDevolucion.cliente.apellidos}}</div>
        <div><strong>Total:</strong> {{formatearMoneda(ventaDevolucion.total)}}</div>
      </div>
    </div>
    
    <!-- Productos a devolver -->
    <div class="mb-4">
      <h4 class="font-bold text-neutral-800 mb-3">Seleccionar Productos a Devolver</h4>
      
      <div class="space-y-3">
        <div *ngFor="let item of itemsDevolucion" 
             class="bg-slate-50 rounded-lg p-4 border border-slate-200">
          <div class="flex items-center gap-4">
            <!-- Checkbox de selecci√≥n -->
            <p-checkbox 
              [(ngModel)]="item.seleccionado" 
              [binary]="true"
            />
            
            <!-- Informaci√≥n del producto -->
            <div class="flex-1">
              <div class="font-semibold">{{item.producto.nombre}}</div>
              <div class="text-sm text-neutral-600">
                {{item.color.nombre}} - {{item.talla.numero}} - {{item.producto.codigo}}
              </div>
              <div class="text-sm">
                <span class="text-neutral-500">Cantidad vendida:</span> 
                <span class="font-mono font-semibold">{{item.cantidad}}</span>
              </div>
            </div>
            
            <!-- Cantidad a devolver -->
            <div class="w-32">
              <label for="cantidadDevolver" class="text-xs text-neutral-600 block mb-1">Cant. a devolver</label>
              <p-inputNumber 
                [(ngModel)]="item.cantidadDevolver" 
                [min]="0" 
                [max]="item.cantidad"
                [disabled]="!item.seleccionado"
                styleClass="w-full"
                [showButtons]="true"
                buttonLayout="horizontal"
              />
            </div>
            
            <!-- Precio -->
            <div class="w-24 text-right">
              <div class="text-sm text-neutral-500">Precio Unit.</div>
              <div class="font-semibold">{{formatearMoneda(item.precioUnitario)}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Motivo de devoluci√≥n -->
    <div class="mb-4">
      <label for="motivoDevolucion" class="flex text-sm font-medium text-neutral-700 mb-2">
        <i class="pi pi-comment text-orange-600 mr-2"></i>
        Motivo de la Devoluci√≥n
      </label>
      <textarea 
        pInputTextarea 
        [(ngModel)]="motivoDevolucion" 
        placeholder="Explique el motivo de la devoluci√≥n..."
        rows="3"
        class="w-full"
        required
      ></textarea>
    </div>
    
    <!-- Resumen de devoluci√≥n -->
    <div class="bg-orange-50 rounded-lg p-4 border border-orange-200">
      <h5 class="font-semibold text-orange-800 mb-2">Resumen de Devoluci√≥n</h5>
      <div class="text-sm space-y-1">
        <div class="flex justify-between">
          <span>Items seleccionados:</span>
          <span class="font-semibold">{{getItemsSeleccionados()}}</span>
        </div>
        <div class="flex justify-between">
          <span>Cantidad total a devolver:</span>
          <span class="font-semibold">{{getCantidadTotalDevolver()}}</span>
        </div>
        <div class="flex justify-between font-bold text-lg pt-2 border-t border-orange-300">
          <span>Monto a devolver:</span>
          <span class="text-orange-600">{{formatearMoneda(getMontoTotalDevolver())}}</span>
        </div>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between gap-3 px-3">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        severity="secondary"
        [outlined]="true"
        (click)="devolucionDialog = false"
      />
      
      <p-button 
        label="Procesar Devoluci√≥n" 
        icon="pi pi-check" 
        severity="danger"
        [disabled]="!isDevolucionValid()"
        (click)="procesarDevolucion()"
      />
    </div>
  </ng-template>
</p-dialog>

<!-- DIALOGO: DASHBOARD GERENCIAL  -->
<p-dialog 
  [(visible)]="showDashboard" 
  [modal]="true" 
  [closable]="true"
  [maximizable]="true"
  [style]="{width: '95vw', height: '90vh'}" 
  styleClass="dashboard-modal-empresarial"
  header="üìä Dashboard Gerencial - Sistema Empresarial POS">
  
  <div class="dashboard-content p-6 h-full overflow-auto">
    
    <!-- KPIs Principales usando tu interfaz -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      
      <div *ngFor="let metrica of metricas" 
           class="bg-gradient-to-br {{getColorMetrica(metrica.color)}} rounded-2xl p-6 text-white shadow-xl relative overflow-hidden">
        
        <!-- Loading overlay -->
        <div *ngIf="metrica.loading" 
             class="absolute inset-0 bg-black/20 flex items-center justify-center backdrop-blur-sm">
          <i class="pi pi-spin pi-spinner text-2xl"></i>
        </div>
        
        <!-- Header de la m√©trica -->
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
            <i class="pi {{metrica.icono}} text-2xl"></i>
          </div>
          
          <!-- Tendencia -->
          <div *ngIf="metrica.tendencia" class="text-right">
            <div class="text-xs opacity-80">{{metrica.tendencia.periodo}}</div>
            <div class="flex items-center gap-1 text-lg font-bold opacity-90">
              <i class="pi {{getIconoTendencia(metrica.tendencia)}} text-sm"></i>
              {{metrica.tendencia.porcentaje}}%
            </div>
          </div>
        </div>
        
        <!-- Valor principal -->
        <div class="text-3xl font-bold mb-2">
            <span *ngIf="typeof metrica.valor === 'number'">
            {{metrica.categoria === 'ventas' || metrica.categoria === 'financiero' ? 
                formatearMoneda(typeof metrica.valor === 'number' ? metrica.valor : +metrica.valor) : 
                metrica.valor}}
          </span>
          <span *ngIf="typeof metrica.valor === 'string'">{{metrica.valor}}</span>
        </div>
        
        <!-- T√≠tulo -->
        <div class="text-sm opacity-90 mb-2">{{metrica.titulo}}</div>
        
        <!-- Objetivo si existe -->
        <div *ngIf="metrica.objetivo" class="text-xs opacity-70">
          Meta: {{metrica.categoria === 'ventas' || metrica.categoria === 'financiero' ? formatearMoneda(metrica.objetivo.valor) : metrica.objetivo.valor}} 
          ({{metrica.objetivo.progreso.toFixed(1)}}%)
        </div>
        
        <!-- Alerta cr√≠tica -->
        <div *ngIf="metrica.alertaCritica?.activa" 
             class="mt-2 bg-red-500/30 border border-red-300 rounded-lg p-2">
          <div class="flex items-center gap-2 text-xs">
            <i class="pi pi-exclamation-triangle"></i>
            {{metrica.alertaCritica?.mensaje}}
          </div>
        </div>
        
        <!-- √öltima actualizaci√≥n -->
        <div class="absolute bottom-2 right-2 text-xs opacity-60">
          {{metrica.ultimaActualizacion | date:'HH:mm:ss'}}
        </div>
      </div>
    </div>
    
    <!-- Detalles expandidos -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      
      <!-- Desglose de Ventas -->
      <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-gray-800">üí∞ Desglose de Ventas</h3>
          <button class="text-sm text-blue-600 hover:text-blue-800" 
                  (click)="verDetalleVentas()">
            Ver detalle
          </button>
        </div>
        
        <div *ngFor="let item of metricas[0]?.desglose" 
             class="flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0">
          <div class="flex items-center gap-3">
            <div class="w-4 h-4 rounded-full" [style.background-color]="item.color"></div>
            <span class="font-medium text-gray-700">{{item.label}}</span>
          </div>
          <div class="text-right">
            <div class="font-bold text-gray-800">{{formatearMoneda(item.valor)}}</div>
            <div class="text-xs text-gray-500">{{item.porcentaje}}%</div>
          </div>
        </div>
        
        <!-- Gr√°fico placeholder -->
        <div class="mt-4 h-32 bg-gray-50 rounded-lg flex items-center justify-center">
          <span class="text-gray-400 text-sm">üìä Gr√°fico circular pr√≥ximamente</span>
        </div>
      </div>
      
      <!-- Productos por Categor√≠a -->
      <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-gray-800">üì¶ Productos por Categor√≠a</h3>
          <button class="text-sm text-blue-600 hover:text-blue-800" 
                  (click)="verStockCritico()">
            Stock cr√≠tico
          </button>
        </div>
        
        <div *ngFor="let item of metricas[3]?.desglose" 
             class="flex items-center justify-between py-3">
          <div class="flex items-center gap-3">
            <div class="w-4 h-4 rounded-full" [style.background-color]="item.color"></div>
            <span class="font-medium text-gray-700">{{item.label}}</span>
          </div>
          <div class="text-right">
            <div class="font-bold text-gray-800">{{item.valor}} uds</div>
            <div class="text-xs text-gray-500">{{item.porcentaje}}%</div>
          </div>
        </div>
        
        <!-- Barra de progreso total -->
        <div class="mt-4 bg-gray-200 rounded-full h-2">
          <div class="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full" 
               style="width: 87%"></div>
        </div>
        <div class="text-xs text-gray-500 mt-1 text-center">87% del objetivo diario</div>
      </div>
    </div>
    
    <!-- M√©tricas adicionales -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <div *ngFor="let metrica of metricas" class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center gap-2 mb-4">
          <div class="w-8 h-8 bg-{{metrica.color === 'success' ? 'green' : metrica.color === 'info' ? 'blue' : metrica.color === 'warning' ? 'orange' : 'purple'}}-500 rounded-lg flex items-center justify-center">
            <i class="pi {{metrica.icono}} text-white text-sm"></i>
          </div>
          <h4 class="font-bold text-gray-800">{{metrica.titulo}}</h4>
        </div>
        
        <div *ngIf="metrica.metricas" class="space-y-2">
          <div *ngFor="let submetrica of metrica.metricas" 
               class="flex justify-between items-center text-sm">
            <span class="text-gray-600 flex items-center gap-1">
              <i *ngIf="submetrica.icono" class="pi {{submetrica.icono}} text-xs"></i>
              {{submetrica.label}}
            </span>
            <span class="font-medium text-gray-800">{{submetrica.valor}}</span>
          </div>
        </div>
        
        <!-- Bot√≥n de acci√≥n -->
        <button *ngIf="metrica.accionPrincipal" 
                class="mt-4 w-full bg-blue-50 hover:bg-blue-100 text-blue-700 py-2 px-4 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2"
                [disabled]="metrica.accionPrincipal.disabled"
                (click)="metrica.accionPrincipal.callback()">
          <i class="pi {{metrica.accionPrincipal.icono}}"></i>
          {{metrica.accionPrincipal.label}}
        </button>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="flex items-center gap-2 text-sm text-gray-500">
        <i class="pi pi-refresh animate-spin"></i>
        Actualizando cada 30 segundos
      </div>
      <div class="flex gap-2">
        <p-button label="Exportar Reporte" icon="pi pi-download" [outlined]="true" 
                  (click)="exportarReporte('reporte')"></p-button>
        <p-button label="Actualizar" icon="pi pi-refresh" severity="info" [outlined]="true"
                  (click)="actualizarTodasLasMetricas()"></p-button>
        <p-button label="Cerrar" icon="pi pi-times" (click)="showDashboard = false"></p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>  

<!-- Men√∫ contextual para ventas -->
<p-menu #menuAcciones [popup]="true" [model]="itemsMenuAcciones"></p-menu>

