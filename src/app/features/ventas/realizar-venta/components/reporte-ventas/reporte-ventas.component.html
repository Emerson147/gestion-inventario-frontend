<div class="reports-container min-h-screen bg-slate-50">

  <!-- HEADER EMPRESARIAL -->
  <div class="header-section bg-slate-900 text-white shadow-sm">
    <div class="container mx-auto p-6">
      <div class="flex justify-between items-center">
        
        <div class="flex items-center gap-6">
          <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center">
            <i class="pi pi-chart-bar text-xl text-white"></i>
          </div>
          <div>
            <h1 class="text-2xl font-semibold text-white mb-1">Centro de Reportes</h1>
            <p class="text-slate-300 text-sm">
              Sistema de Análisis de Datos - Usuario: <span class="text-blue-300 font-medium">{{currentUser}}</span>
            </p>
            <p class="text-slate-400 text-xs flex items-center gap-2 mt-1">
              <i class="pi pi-calendar"></i>
              {{currentDateTime}} UTC
            </p>
          </div>
        </div>
        
        <div class="bg-green-600 rounded-lg p-3">
          <div class="flex items-center gap-2 text-white">
            <i class="pi pi-check-circle"></i>
            <div class="text-sm">
              <div class="font-medium">Sistema</div>
              <div class="text-green-100 text-xs">ACTIVO</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DASHBOARD PRINCIPAL -->
  <div class="dashboard-main bg-white">
    <p-splitter [style]="{'height': '800px'}" styleClass="border-0">
      
      <!-- PANEL DE FILTROS -->
      <ng-template pTemplate="panel">
        <div class="filters-panel bg-white border-r border-slate-200 h-full overflow-y-auto">
          <p-panel header="Centro de Control" styleClass="border-0 h-full">
            
            <p-accordion [multiple]="true" [activeIndex]="[0, 1]">
              
              <!-- FILTROS DE TIEMPO -->
              <p-accordionTab header="Filtros de Tiempo">
                <div class="p-4 space-y-4 bg-slate-50">
                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-slate-700">Período:</label>
                    <p-dropdown 
                      [(ngModel)]="periodoSeleccionado"
                      [options]="periodos"
                      optionLabel="label"
                      optionValue="value"
                      placeholder="Seleccionar período"
                      styleClass="w-full">
                    </p-dropdown>
                  </div>
                  
                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-slate-700">Rango de Fechas:</label>
                    <p-calendar 
                      [(ngModel)]="rangoFechas"
                      selectionMode="range"
                      [readonlyInput]="true"
                      placeholder="Seleccionar rango"
                      dateFormat="dd/mm/yy"
                      [showIcon]="true"
                      styleClass="w-full">
                    </p-calendar>
                  </div>
                </div>
              </p-accordionTab>
              
              <!-- FILTROS DE DATOS -->
              <p-accordionTab header="Filtros de Datos">
                <div class="p-4 space-y-4 bg-slate-50">
                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-slate-700">Sucursales:</label>
                    <p-multiSelect 
                      [(ngModel)]="sucursalesSeleccionadas"
                      [options]="sucursales"
                      optionLabel="nombre"
                      optionValue="id"
                      placeholder="Seleccionar sucursales"
                      styleClass="w-full">
                    </p-multiSelect>
                  </div>
                  
                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-slate-700">Vendedores:</label>
                    <p-multiSelect 
                      [(ngModel)]="vendedoresSeleccionados"
                      [options]="vendedores"
                      optionLabel="nombre"
                      optionValue="id"
                      placeholder="Seleccionar vendedores"
                      styleClass="w-full">
                    </p-multiSelect>
                  </div>
                  
                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-slate-700">Categorías:</label>
                    <p-multiSelect 
                      [(ngModel)]="categoriasSeleccionadas"
                      [options]="categorias"
                      optionLabel="nombre"
                      optionValue="id"
                      placeholder="Seleccionar categorías"
                      styleClass="w-full">
                    </p-multiSelect>
                  </div>
                </div>
              </p-accordionTab>
              
              <!-- FILTROS AVANZADOS -->
              <p-accordionTab header="Filtros Avanzados">
                <div class="p-4 space-y-4 bg-slate-50">
                  <div class="space-y-3">
                    <label class="block text-sm font-medium text-slate-700">Rango de Montos:</label>
                    <div class="bg-white rounded-lg p-3 border border-slate-200">
                      <p-slider 
                        [(ngModel)]="rangoMontos"
                        [range]="true"
                        [min]="0"
                        [max]="100000"
                        [step]="1000"
                        styleClass="w-full">
                      </p-slider>
                      <div class="flex justify-between text-sm text-slate-600 mt-2">
                        <span class="bg-slate-100 px-2 py-1 rounded text-xs">S/ {{rangoMontos[0] | number}}</span>
                        <span class="bg-slate-100 px-2 py-1 rounded text-xs">S/ {{rangoMontos[1] | number}}</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-slate-700">Mínimo de Transacciones:</label>
                    <p-inputNumber 
                      [(ngModel)]="minimoTransacciones"
                      [min]="1"
                      [max]="1000"
                      [showButtons]="true"
                      buttonLayout="horizontal"
                      incrementButtonIcon="pi pi-plus"
                      decrementButtonIcon="pi pi-minus"
                      styleClass="w-full">
                    </p-inputNumber>
                  </div>
                </div>
              </p-accordionTab>
            </p-accordion>
            
            <!-- ACCIONES -->
            <div class="p-4 bg-slate-100 border-t border-slate-200">
              <div class="space-y-3">
                <p-button 
                  label="Aplicar Filtros"
                  icon="pi pi-search"
                  styleClass="p-button-success w-full"
                  [loading]="aplicandoFiltros"
                  (click)="aplicarFiltros()">
                </p-button>
                
                <p-button 
                  label="Limpiar Filtros"
                  icon="pi pi-refresh"
                  styleClass="p-button-secondary w-full"
                  [outlined]="true"
                  (click)="limpiarFiltros()">
                </p-button>
                
                <p-button 
                  label="Guardar Configuración"
                  icon="pi pi-save"
                  styleClass="p-button-outlined w-full"
                  (click)="guardarConfiguracion()">
                </p-button>
              </div>
            </div>
          </p-panel>
        </div>
      </ng-template>
      
      <!-- CONTENIDO PRINCIPAL -->
      <ng-template pTemplate="panel">
        <div class="content-main h-full overflow-y-auto">
          
          <p-tabView [(activeIndex)]="tabActivo" styleClass="reports-tabs h-full">
            
            <!-- DASHBOARD EJECUTIVO -->
            <p-tabPanel header="Dashboard Ejecutivo">
              
              <!-- KPIs PRINCIPALES -->
              <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  
                  <div class="bg-green-600 rounded-xl p-6 text-white shadow-sm">
                    <div class="flex items-center justify-between">
                      <div class="flex-1">
                        <div class="text-2xl font-bold mb-1">S/ {{kpis.ventasTotales | number:'1.0-0'}}</div>
                        <div class="text-green-100 text-sm mb-2">Ventas Totales</div>
                        <div class="flex items-center gap-1 text-sm bg-green-700 rounded-lg px-2 py-1 w-fit">
                          <i class="pi pi-arrow-up text-xs"></i>
                          <span>{{kpis.crecimientoVentas}}%</span>
                        </div>
                      </div>
                      <div class="w-10 h-10 bg-green-700 rounded-lg flex items-center justify-center">
                        <i class="pi pi-dollar"></i>
                      </div>
                    </div>
                  </div>
                  
                  <div class="bg-blue-600 rounded-xl p-6 text-white shadow-sm">
                    <div class="flex items-center justify-between">
                      <div class="flex-1">
                        <div class="text-2xl font-bold mb-1">{{kpis.numeroTransacciones | number}}</div>
                        <div class="text-blue-100 text-sm mb-2">Transacciones</div>
                        <div class="flex items-center gap-1 text-sm bg-blue-700 rounded-lg px-2 py-1 w-fit">
                          <i class="pi pi-arrow-up text-xs"></i>
                          <span>{{kpis.crecimientoTransacciones}}%</span>
                        </div>
                      </div>
                      <div class="w-10 h-10 bg-blue-700 rounded-lg flex items-center justify-center">
                        <i class="pi pi-shopping-cart"></i>
                      </div>
                    </div>
                  </div>
                  
                  <div class="bg-orange-600 rounded-xl p-6 text-white shadow-sm">
                    <div class="flex items-center justify-between">
                      <div class="flex-1">
                        <div class="text-2xl font-bold mb-1">{{kpis.clientesUnicos | number}}</div>
                        <div class="text-orange-100 text-sm mb-2">Clientes Únicos</div>
                        <div class="flex items-center gap-1 text-sm bg-orange-700 rounded-lg px-2 py-1 w-fit">
                          <i class="pi pi-arrow-up text-xs"></i>
                          <span>{{kpis.crecimientoClientes}}%</span>
                        </div>
                      </div>
                      <div class="w-10 h-10 bg-orange-700 rounded-lg flex items-center justify-center">
                        <i class="pi pi-users"></i>
                      </div>
                    </div>
                  </div>
                  
                  <div class="bg-purple-600 rounded-xl p-6 text-white shadow-sm">
                    <div class="flex items-center justify-between">
                      <div class="flex-1">
                        <div class="text-2xl font-bold mb-1">S/ {{kpis.ticketPromedio | number:'1.0-0'}}</div>
                        <div class="text-purple-100 text-sm mb-2">Ticket Promedio</div>
                        <div class="flex items-center gap-1 text-sm bg-purple-700 rounded-lg px-2 py-1 w-fit">
                          <i class="pi pi-arrow-up text-xs"></i>
                          <span>{{kpis.crecimientoTicket}}%</span>
                        </div>
                      </div>
                      <div class="w-10 h-10 bg-purple-700 rounded-lg flex items-center justify-center">
                        <i class="pi pi-receipt"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- PROGRESO DE META -->
              <div class="px-6 pb-6">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                  <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                      <i class="pi pi-target text-slate-600"></i>
                      Progreso de Meta Mensual
                    </h3>
                    <div class="text-right">
                      <div class="text-xl font-bold text-green-600">S/ {{kpis.ventasTotales | number:'1.0-0'}}</div>
                      <div class="text-sm text-slate-500">Meta: S/ {{kpis.metaMensual | number:'1.0-0'}}</div>
                    </div>
                  </div>
                  <p-progressBar 
                    [value]="progresoMeta"
                    [style]="{'height': '16px'}"
                    [showValue]="true"
                    unit="%">
                  </p-progressBar>
                </div>
              </div>
              
              <!-- GRÁFICOS PRINCIPALES -->
              <div class="px-6 pb-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                  
                  <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                      <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                          <i class="pi pi-chart-line text-slate-600"></i>
                          Evolución de Ventas
                        </h3>
                        <p-selectButton 
                          [(ngModel)]="tipoGraficoVentas"
                          [options]="tiposGrafico"
                          optionLabel="label"
                          optionValue="value"
                          (onChange)="cambiarTipoGrafico()"
                          size="small">
                        </p-selectButton>
                      </div>
                      <p-chart 
                        type="line"
                        [data]="datosGraficoVentas"
                        [options]="opcionesGraficoVentas"
                        height="350">
                      </p-chart>
                    </div>
                  </div>
                  
                  <div>
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                      <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="pi pi-credit-card text-slate-600"></i>
                        Métodos de Pago
                      </h3>
                      <p-chart 
                        type="doughnut"
                        [data]="datosGraficoMetodosPago"
                        [options]="opcionesGraficoCircular"
                        height="280">
                      </p-chart>
                      
                      <div class="mt-4 space-y-2">
                        <div *ngFor="let metodo of resumenMetodosPago" 
                             class="flex items-center justify-between p-2 bg-slate-50 rounded-lg">
                          <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full" [style.background]="metodo.color"></div>
                            <span class="text-sm font-medium text-slate-700">{{metodo.nombre}}</span>
                          </div>
                          <span class="text-sm font-semibold text-slate-800">{{metodo.porcentaje}}%</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
            </p-tabPanel>
            
            <!-- TOP PERFORMANCE -->
            <p-tabPanel header="Top Performance">
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-6">
                
                <div>
                  <div class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="p-6 border-b border-slate-200 bg-slate-50">
                      <h3 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                        <i class="pi pi-star text-slate-600"></i>
                        Top 10 Productos
                      </h3>
                    </div>
                    <div class="p-6">
                      <p-table 
                        [value]="topProductos"
                        styleClass="p-datatable-sm"
                        [paginator]="false"
                        [rows]="10">
                        
                        <ng-template pTemplate="header">
                          <tr>
                            <th class="w-16">Rank</th>
                            <th>Producto</th>
                            <th class="text-right">Ventas</th>
                            <th class="text-center">Cantidad</th>
                          </tr>
                        </ng-template>
                        
                        <ng-template pTemplate="body" let-producto let-rowIndex="rowIndex">
                          <tr class="hover:bg-slate-50 transition-colors">
                            <td>
                              <p-badge 
                                [value]="(rowIndex + 1).toString()"
                                [severity]="getRankSeverity(rowIndex)"
                                styleClass="font-medium">
                              </p-badge>
                            </td>
                            <td>
                              <div>
                                <div class="font-medium text-slate-800">{{producto.nombre}}</div>
                                <div class="text-sm text-slate-500">{{producto.categoria}}</div>
                              </div>
                            </td>
                            <td class="text-right">
                              <div class="font-semibold text-green-600">S/ {{producto.totalVentas | number:'1.0-0'}}</div>
                            </td>
                            <td class="text-center">
                              <p-chip 
                                [label]="producto.cantidadVendida.toString()"
                                styleClass="bg-slate-100 text-slate-700">
                              </p-chip>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </div>
                
                <div>
                  <div class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="p-6 border-b border-slate-200 bg-slate-50">
                      <h3 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                        <i class="pi pi-users text-slate-600"></i>
                        Top 10 Vendedores
                      </h3>
                    </div>
                    <div class="p-6">
                      <p-table 
                        [value]="topVendedores"
                        styleClass="p-datatable-sm"
                        [paginator]="false"
                        [rows]="10">
                        
                        <ng-template pTemplate="header">
                          <tr>
                            <th class="w-16">Rank</th>
                            <th>Vendedor</th>
                            <th class="text-right">Ventas</th>
                            <th class="text-right">Comisión</th>
                          </tr>
                        </ng-template>
                        
                        <ng-template pTemplate="body" let-vendedor let-rowIndex="rowIndex">
                          <tr class="hover:bg-slate-50 transition-colors">
                            <td>
                              <p-badge 
                                [value]="(rowIndex + 1).toString()"
                                [severity]="getRankSeverity(rowIndex)"
                                styleClass="font-medium">
                              </p-badge>
                            </td>
                            <td>
                              <div class="flex items-center gap-3">
                                <p-avatar 
                                  [label]="vendedor.iniciales"
                                  size="normal"
                                  shape="circle"
                                  styleClass="bg-slate-600 text-white">
                                </p-avatar>
                                <div>
                                  <div class="font-medium text-slate-800">{{vendedor.nombre}}</div>
                                  <div class="text-sm text-slate-500">{{vendedor.sucursal}}</div>
                                </div>
                              </div>
                            </td>
                            <td class="text-right">
                              <div class="space-y-1">
                                <div class="font-semibold text-green-600">S/ {{vendedor.totalVentas | number:'1.0-0'}}</div>
                                <div class="text-xs">
                                  <p-progressBar 
                                    [value]="vendedor.porcentajeMeta"
                                    [style]="{'height': '4px'}"
                                    [showValue]="false">
                                  </p-progressBar>
                                  <span class="text-slate-500">{{vendedor.porcentajeMeta}}% meta</span>
                                </div>
                              </div>
                            </td>
                            <td class="text-right">
                              <p-chip 
                                [label]="'S/ ' + (vendedor.comision | number:'1.0-0')"
                                styleClass="bg-green-100 text-green-700">
                              </p-chip>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="px-6 pb-6">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                  <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="pi pi-chart-bar text-slate-600"></i>
                    Comparativo de Vendedores
                  </h3>
                  <p-chart 
                    type="bar"
                    [data]="datosGraficoVendedores"
                    [options]="opcionesGraficoBarras"
                    height="400">
                  </p-chart>
                </div>
              </div>
              
            </p-tabPanel>
            
            <!-- ANÁLISIS DE CLIENTES -->
            <p-tabPanel header="Análisis de Clientes">
              
              <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 p-6">
                
                <div>
                  <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                      <i class="pi pi-chart-pie text-slate-600"></i>
                      Segmentación
                    </h3>
                    <p-chart 
                      type="pie"
                      [data]="datosSegmentosClientes"
                      [options]="opcionesGraficoCircular"
                      height="250">
                    </p-chart>
                    
                    <div class="mt-4 space-y-2">
                      <div class="flex items-center justify-between p-2 bg-yellow-50 rounded-lg border border-yellow-200">
                        <div class="flex items-center gap-2">
                          <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                          <span class="text-sm font-medium text-slate-700">Premium VIP</span>
                        </div>
                        <span class="text-sm font-semibold text-slate-800">127</span>
                      </div>
                      <div class="flex items-center justify-between p-2 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="flex items-center gap-2">
                          <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                          <span class="text-sm font-medium text-slate-700">Frecuentes</span>
                        </div>
                        <span class="text-sm font-semibold text-slate-800">245</span>
                      </div>
                      <div class="flex items-center justify-between p-2 bg-slate-50 rounded-lg border border-slate-200">
                        <div class="flex items-center gap-2">
                          <div class="w-3 h-3 bg-slate-500 rounded-full"></div>
                          <span class="text-sm font-medium text-slate-700">Ocasionales</span>
                        </div>
                        <span class="text-sm font-semibold text-slate-800">195</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="lg:col-span-3">
                  <div class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="p-6 border-b border-slate-200 bg-slate-50">
                      <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                          <i class="pi pi-users text-slate-600"></i>
                          Top 15 Clientes
                        </h3>
                        <div class="relative">
                          <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                          <input 
                            type="text" 
                            placeholder="Buscar clientes..."
                            class="pl-10 pr-4 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                            (input)="filtrarClientes($event)">
                        </div>
                      </div>
                    </div>
                    <div class="p-6">
                      <p-table 
                        [value]="topClientes"
                        styleClass="p-datatable-sm"
                        [paginator]="true"
                        [rows]="15">
                        
                        <ng-template pTemplate="header">
                          <tr>
                            <th>Cliente</th>
                            <th>Segmento</th>
                            <th class="text-right">Total Compras</th>
                            <th>Última Compra</th>
                            <th class="text-center">Acciones</th>
                          </tr>
                        </ng-template>
                        
                        <ng-template pTemplate="body" let-cliente>
                          <tr class="hover:bg-slate-50 transition-colors">
                            <td>
                              <div class="flex items-center gap-3">
                                <p-avatar 
                                  [label]="getClienteInitials(cliente)"
                                  size="normal"
                                  shape="circle"
                                  styleClass="bg-slate-600 text-white">
                                </p-avatar>
                                <div>
                                  <div class="font-medium text-slate-800">{{cliente.nombres}} {{cliente.apellidos}}</div>
                                  <div class="text-sm text-slate-500">{{cliente.email}}</div>
                                </div>
                              </div>
                            </td>
                            <td>
                              <p-chip 
                                [label]="cliente.segmento"
                                [styleClass]="getSegmentoClass(cliente.segmento)">
                              </p-chip>
                            </td>
                            <td class="text-right">
                              <div>
                                <div class="font-semibold text-green-600">S/ {{cliente.totalCompras | number:'1.0-0'}}</div>
                                <div class="text-sm text-slate-500">{{cliente.numeroCompras}} compras</div>
                              </div>
                            </td>
                            <td>
                              <div class="text-sm text-slate-700">{{cliente.ultimaCompra | date:'dd/MM/yyyy'}}</div>
                            </td>
                            <td class="text-center">
                              <div class="flex justify-center gap-1">
                                <p-button 
                                  icon="pi pi-eye"
                                  styleClass="p-button-rounded p-button-text p-button-sm"
                                  pTooltip="Ver detalles"
                                  (click)="verDetalleCliente(cliente)">
                                </p-button>
                                <p-button 
                                  icon="pi pi-envelope"
                                  styleClass="p-button-rounded p-button-text p-button-sm"
                                  pTooltip="Enviar email"
                                  (click)="enviarEmailCliente(cliente)">
                                </p-button>
                              </div>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </div>
              </div>
              
            </p-tabPanel>
            
            <!-- GENERAR REPORTES -->
            <p-tabPanel header="Generar Reportes">
              
              <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  
                  <div *ngFor="let tipo of tiposReportes" 
                       class="bg-white rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                    <div class="p-6">
                      <div class="text-center mb-4">
                        <div class="w-12 h-12 mx-auto rounded-xl flex items-center justify-center mb-3 bg-slate-100">
                          <i [class]="tipo.icono + ' text-xl text-slate-600'"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-slate-800">{{tipo.titulo}}</h4>
                        <p class="text-sm text-slate-600 mt-1">{{tipo.descripcion}}</p>
                      </div>
                      
                      <p-button 
                        [label]="'Generar ' + tipo.formato"
                        [icon]="tipo.iconoAccion"
                        styleClass="p-button-outlined w-full"
                        [loading]="tipo.generando"
                        (click)="generarReporte(tipo.tipo)">
                      </p-button>
                      
                      <div *ngIf="tipo.generando" class="mt-3">
                        <p-progressBar 
                          [value]="tipo.progreso"
                          [style]="{'height': '6px'}"
                          [showValue]="false">
                        </p-progressBar>
                        <div class="text-xs text-slate-500 mt-1 text-center">
                          Generando... {{tipo.progreso}}%
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="px-6 pb-6">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200">
                  <div class="p-6 border-b border-slate-200 bg-slate-50">
                    <h3 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                      <i class="pi pi-history text-slate-600"></i>
                      Historial de Reportes Generados
                    </h3>
                  </div>
                  <div class="p-6">
                    <p-table 
                      [value]="historialReportes"
                      styleClass="p-datatable-sm"
                      [paginator]="true"
                      [rows]="10"
                      [loading]="cargandoHistorial">
                      
                      <ng-template pTemplate="header">
                        <tr>
                          <th>Reporte</th>
                          <th>Fecha Generación</th>
                          <th>Tipo</th>
                          <th>Estado</th>
                          <th>Archivo</th>
                          <th class="text-center">Acciones</th>
                        </tr>
                      </ng-template>
                      
                      <ng-template pTemplate="body" let-reporte>
                        <tr class="hover:bg-slate-50 transition-colors">
                          <td>
                            <div class="flex items-center gap-2">
                              <i [class]="reporte.icon + ' text-slate-600'"></i>
                              <span class="font-medium text-slate-800">{{reporte.tipo}}</span>
                            </div>
                          </td>
                          <td class="text-slate-700">{{reporte.fecha | date:'dd/MM/yyyy HH:mm'}}</td>
                          <td>
                            <p-chip [label]="reporte.tipo" styleClass="bg-slate-100 text-slate-700"></p-chip>
                          </td>
                          <td>
                            <p-tag 
                              [value]="reporte.estado"
                              [severity]="getEstadoReporteSeverity(reporte.estado)"
                              [icon]="getEstadoReporteIcon(reporte.estado)">
                            </p-tag>
                          </td>
                          <td>
                            <div>
                              <div class="font-medium text-sm text-slate-800">{{reporte.archivo}}</div>
                              <div class="text-xs text-slate-500">{{reporte.tamano | number:'1.1-1'}} MB</div>
                            </div>
                          </td>
                          <td class="text-center">
                            <div class="flex justify-center gap-1">
                              <p-button 
                                icon="pi pi-download"
                                styleClass="p-button-rounded p-button-text p-button-sm"
                                pTooltip="Descargar"
                                [disabled]="reporte.estado !== 'COMPLETADO'"
                                (click)="descargarReporte(reporte)">
                              </p-button>
                              <p-button 
                                icon="pi pi-eye"
                                styleClass="p-button-rounded p-button-text p-button-sm"
                                pTooltip="Vista previa"
                                [disabled]="reporte.estado !== 'COMPLETADO'"
                                (click)="vistaPrevia(reporte)">
                              </p-button>
                              <p-button 
                                icon="pi pi-trash"
                                styleClass="p-button-rounded p-button-text p-button-sm p-button-danger"
                                pTooltip="Eliminar"
                                (click)="eliminarReporte(reporte)">
                              </p-button>
                            </div>
                          </td>
                        </tr>
                      </ng-template>
                      
                      <ng-template pTemplate="emptymessage">
                        <tr>
                          <td colspan="6" class="text-center py-8">
                            <div class="text-center">
                              <i class="pi pi-file-o text-4xl text-slate-300 mb-4"></i>
                              <h4 class="text-lg font-medium text-slate-600 mb-2">No hay reportes generados</h4>
                              <p class="text-slate-500 mb-4">Comienza generando tu primer reporte</p>
                              <p-button 
                                label="Generar Primer Reporte"
                                icon="pi pi-plus"
                                styleClass="p-button-outlined"
                                (click)="tabActivo = 0">
                              </p-button>
                            </div>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
              
            </p-tabPanel>
            
            <!-- IA & PREDICCIONES -->
            <p-tabPanel header="IA y Predicciones">
              
              <div class="p-6">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                  <h3 class="text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2">
                    <i class="pi pi-cog text-slate-600"></i>
                    Configuración de Inteligencia Artificial
                  </h3>
                  
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="space-y-2">
                      <label class="block text-sm font-medium text-slate-700">Algoritmo de IA:</label>
                      <p-dropdown 
                        [(ngModel)]="algoritmoIA"
                        [options]="algoritmosIA"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Seleccionar algoritmo"
                        styleClass="w-full">
                      </p-dropdown>
                    </div>
                    
                    <div class="space-y-2">
                      <label class="block text-sm font-medium text-slate-700">Ventana de Tiempo:</label>
                      <p-dropdown 
                        [(ngModel)]="ventanaTiempo"
                        [options]="ventanasTiempo"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Seleccionar ventana"
                        styleClass="w-full">
                      </p-dropdown>
                    </div>
                    
                    <div class="space-y-2">
                      <label class="block text-sm font-medium text-slate-700">Variables Predictivas:</label>
                      <p-multiSelect 
                        [(ngModel)]="variablesPredictivas"
                        [options]="variablesDisponibles"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Seleccionar variables"
                        styleClass="w-full">
                      </p-multiSelect>
                    </div>
                  </div>
                  
                  <div class="flex flex-wrap gap-3">
                    <p-button 
                      label="Entrenar Modelo"
                      icon="pi pi-cog"
                      styleClass="p-button-success"
                      [loading]="entrenandoModelo"
                      (click)="entrenarModelo()">
                    </p-button>
                    
                    <p-button 
                      label="Generar Predicción"
                      icon="pi pi-chart-line"
                      styleClass="p-button-info"
                      [loading]="generandoPrediccion"
                      (click)="generarPrediccion()">
                    </p-button>
                    
                    <p-button 
                      label="Exportar Modelo"
                      icon="pi pi-download"
                      styleClass="p-button-outlined"
                      (click)="exportarModelo()">
                    </p-button>
                  </div>
                </div>
              </div>
              
              <div class="px-6 pb-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                  
                  <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                      <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="pi pi-chart-line text-slate-600"></i>
                        Predicciones de Ventas
                      </h3>
                      <p-chart 
                        type="line"
                        [data]="datosPredicciones"
                        [options]="opcionesGraficoPredicciones"
                        height="400">
                      </p-chart>
                      
                      <div class="mt-4 p-4 bg-slate-50 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                          <span class="font-medium text-slate-700">Precisión del Modelo:</span>
                          <span class="font-semibold text-green-600">{{predicciones.confianza}}%</span>
                        </div>
                        <p-progressBar 
                          [value]="predicciones.confianza"
                          [style]="{'height': '10px'}"
                          [showValue]="false">
                        </p-progressBar>
                      </div>
                    </div>
                  </div>
                  
                  <div>
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                      <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="pi pi-lightbulb text-slate-600"></i>
                        Insights de IA
                      </h3>
                      
                      <div class="space-y-4">
                        <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                          <div class="flex items-center gap-3">
                            <i class="pi pi-arrow-up text-green-600"></i>
                            <div>
                              <div class="font-medium text-green-900">Crecimiento Esperado</div>
                              <div class="text-xl font-bold text-green-600">+{{predicciones.proximaSemana}}%</div>
                              <div class="text-sm text-green-700">próxima semana</div>
                            </div>
                          </div>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                          <div class="flex items-center gap-3">
                            <i class="pi pi-chart-line text-blue-600"></i>
                            <div>
                              <div class="font-medium text-blue-900">Tendencia Mensual</div>
                              <div class="text-xl font-bold text-blue-600">+{{predicciones.proximoMes}}%</div>
                              <div class="text-sm text-blue-700">próximo mes</div>
                            </div>
                          </div>
                        </div>
                        
                        <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                          <div class="flex items-center gap-3">
                            <i class="pi pi-shield text-purple-600"></i>
                            <div>
                              <div class="font-medium text-purple-900">Confianza</div>
                              <div class="text-xl font-bold text-purple-600">{{predicciones.confianza}}%</div>
                              <div class="text-sm text-purple-700">precisión del modelo</div>
                            </div>
                          </div>
                        </div>
                        
                        <div class="bg-orange-50 rounded-lg p-4 border border-orange-200">
                          <div class="flex items-center gap-3">
                            <i class="pi pi-trending-up text-orange-600"></i>
                            <div>
                              <div class="font-medium text-orange-900">Tendencia</div>
                              <div class="text-xl font-bold text-orange-600">{{predicciones.tendencia | titlecase}}</div>
                              <div class="text-sm text-orange-700">dirección general</div>
                            </div>
                          </div>
                        </div>
                      </div>
                      
                      <div class="mt-6">
                        <h5 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                          <i class="pi pi-lightbulb text-slate-600"></i>
                          Recomendaciones
                        </h5>
                        <div class="space-y-2">
                          <div class="flex items-start gap-2 text-sm text-slate-700">
                            <i class="pi pi-check text-green-500 mt-0.5"></i>
                            <span>Incrementar stock en productos de alta rotación</span>
                          </div>
                          <div class="flex items-start gap-2 text-sm text-slate-700">
                            <i class="pi pi-check text-green-500 mt-0.5"></i>
                            <span>Enfocar marketing en segmento premium</span>
                          </div>
                          <div class="flex items-start gap-2 text-sm text-slate-700">
                            <i class="pi pi-check text-green-500 mt-0.5"></i>
                            <span>Optimizar horarios de personal</span>
                          </div>
                          <div class="flex items-start gap-2 text-sm text-slate-700">
                            <i class="pi pi-check text-green-500 mt-0.5"></i>
                            <span>Implementar promociones específicas</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
            </p-tabPanel>
          </p-tabView>
        </div>
      </ng-template>
    </p-splitter>
  </div>

  <!-- FLOATING ACTION BUTTON -->
  <div class="fixed bottom-6 right-6 z-50">
    <p-speedDial 
      [model]="menuFlotante"
      [radius]="80"
      type="quarter-circle"
      direction="up-left"
      [transitionDelay]="80"
      showIcon="pi pi-plus"
      hideIcon="pi pi-times"
      buttonClassName="p-button-help p-button-lg shadow-lg">
    </p-speedDial>
  </div>
</div>

<!-- DIÁLOGOS -->
<p-confirmDialog styleClass="confirm-dialog"></p-confirmDialog>
<p-toast position="top-right" styleClass="custom-toast"></p-toast>

<!-- DIALOG PARA DETALLES -->
<p-dialog 
  [(visible)]="mostrarDetalles"
  [header]="tituloDetalle"
  [modal]="true"
  [style]="{width: '85vw', height: '85vh'}"
  [closable]="true"
  styleClass="detail-dialog">
  
  <div class="h-full overflow-y-auto">
    <div [ngSwitch]="tipoDetalle">
      
      <div *ngSwitchCase="'cliente'" class="cliente-detail">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" *ngIf="clienteSeleccionado">
          <div>
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 text-center">
              <h4 class="text-lg font-semibold text-slate-800 mb-4">Información Personal</h4>
              <p-avatar 
                [label]="getClienteInitials(clienteSeleccionado)"
                size="xlarge"
                shape="circle"
                styleClass="mb-4 bg-slate-600 text-white">
              </p-avatar>
              <h5 class="text-xl font-semibold text-slate-800 mb-2">
                {{clienteSeleccionado.nombres}} {{clienteSeleccionado.apellidos}}
              </h5>
              <p class="text-slate-600 mb-4">{{clienteSeleccionado.email}}</p>
              <p-chip 
                [label]="clienteSeleccionado.segmento"
                [styleClass]="getSegmentoClass(clienteSeleccionado.segmento)">
              </p-chip>
            </div>
          </div>
          
          <div class="lg:col-span-2">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
              <h4 class="text-lg font-semibold text-slate-800 mb-4">Historial de Compras</h4>
              <p-table 
                [value]="historialComprasCliente"
                styleClass="p-datatable-sm"
                [paginator]="true"
                [rows]="10">
                
                <ng-template pTemplate="header">
                  <tr>
                    <th>Fecha</th>
                    <th>Producto</th>
                    <th class="text-center">Cantidad</th>
                    <th class="text-right">Total</th>
                  </tr>
                </ng-template>
                
                <ng-template pTemplate="body" let-compra>
                  <tr class="hover:bg-slate-50 transition-colors">
                    <td class="text-slate-700">{{compra.fecha | date:'dd/MM/yyyy'}}</td>
                    <td class="font-medium text-slate-800">{{compra.producto}}</td>
                    <td class="text-center text-slate-700">{{compra.cantidad}}</td>
                    <td class="text-right font-semibold text-green-600">S/ {{compra.total | number:'1.0-0'}}</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</p-dialog>