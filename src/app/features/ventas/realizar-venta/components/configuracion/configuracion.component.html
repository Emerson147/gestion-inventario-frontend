<!-- CONTENIDO PARA LA PESTA√ëA DE CONFIGURACI√ìN -->
<div class="configuracion-layout">
  
  <!-- üõ°Ô∏è HEADER PRINCIPAL DE ADMINISTRACI√ìN -->
  <div class="configuracion-header mb-8">
    <div class="header-content">
      <div class="flex items-center justify-between">
        <div class="header-info">
          <div class="flex items-center gap-4">
            <div class="header-icon">
              <i class="pi pi-cog text-3xl text-indigo-600"></i>
              <div class="icon-glow"></div>
            </div>
            <div>
              <h2 class="text-3xl font-bold text-gray-900">Panel de Administraci√≥n</h2>
              <p class="text-gray-600">Control total del sistema - Admin: {{currentUser}} | {{currentDateTime}}</p>
            </div>
          </div>
        </div>
        
        <!-- Estado del sistema -->
        <div class="sistema-estado">
          <div class="estado-card">
            <div class="estado-icon">
              <i class="pi pi-shield text-2xl text-green-500"></i>
            </div>
            <div class="estado-info">
              <div class="estado-label">Sistema</div>
              <div class="estado-value">ONLINE</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- üìã TABS DE CONFIGURACI√ìN -->
  <div class="configuracion-tabs" [attr.data-loading]="loading">
    <p-tabView [(activeIndex)]="seccionActiva" styleClass="admin-tabview">
      
      <!-- üë§ GESTI√ìN DE USUARIOS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-admin">
            <i class="pi pi-users text-lg"></i>
            <span>Usuarios</span>
            <p-chip 
              [label]="usuarios.length.toString()" 
              styleClass="ml-2"
              [style]="{'background': '#10b981', 'color': 'white'}">
            </p-chip>
          </div>
        </ng-template>
        
        <div class="seccion-content usuarios-section">
          <!-- Toolbar de usuarios -->
          <div class="usuarios-toolbar mb-6">
            <div class="flex justify-between items-center">
              <div class="toolbar-left">
                <h3 class="section-title">Gesti√≥n de Usuarios del Sistema</h3>
                <p class="section-subtitle">Administrar accesos y permisos - Responsable: {{currentUser}}</p>
              </div>
              <div class="toolbar-right">
                <p-button 
                  icon="pi pi-plus"
                  label="Nuevo Usuario"
                  severity="success"
                  (click)="mostrarNuevoUsuario()">
                </p-button>
              </div>
            </div>
          </div>
          
          <!-- Tabla de usuarios -->
          <div class="usuarios-table-container">
            <p-table 
              [value]="usuarios" 
              styleClass="p-datatable-sm admin-table"
              [paginator]="true"
              [rows]="10"
              [responsive]="true">
              
              <ng-template pTemplate="header">
                <tr>
                  <th>Usuario</th>
                  <th>Informaci√≥n</th>
                  <th>Rol</th>
                  <th>Estado</th>
                  <th>√öltimo Acceso</th>
                  <th>Acciones</th>
                </tr>
              </ng-template>
              
              <ng-template pTemplate="body" let-usuario>
                <tr>
                  <!-- Usuario -->
                  <td>
                    <div class="usuario-info">
                      <div class="usuario-avatar" [style.background]="'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'">
                        {{usuario.avatar || usuario.nombre.substring(0, 2).toUpperCase()}}
                      </div>
                      <div class="usuario-details">
                        <div class="usuario-nombre">{{usuario.nombre}}</div>
                        <div class="usuario-username">{{ '@' + usuario.username }}</div>
                      </div>
                    </div>
                  </td>
                  
                  <!-- Informaci√≥n -->
                  <td>
                    <div class="info-stack">
                      <div class="info-item">
                        <i class="pi pi-envelope text-xs text-gray-500"></i>
                        <span>{{usuario.email}}</span>
                      </div>
                      <div class="info-item" *ngIf="usuario.telefono">
                        <i class="pi pi-phone text-xs text-gray-500"></i>
                        <span>{{usuario.telefono}}</span>
                      </div>
                      <div class="info-item">
                        <i class="pi pi-building text-xs text-gray-500"></i>
                        <span>{{usuario.sucursal}}</span>
                      </div>
                    </div>
                  </td>
                  
                  <!-- Rol -->
                  <td>
                    <div class="rol-badge">
                      <i [class]="getRolIcon(usuario.rol)"></i>
                      <span>{{usuario.rol}}</span>
                    </div>
                  </td>
                  
                  <!-- Estado -->
                  <td>
                    <p-tag 
                      [value]="usuario.estado"
                      [severity]="getEstadoSeverity(usuario.estado)">
                    </p-tag>
                  </td>
                  
                  <!-- √öltimo acceso -->
                  <td>
                    <div class="ultimo-acceso">
                      <div class="acceso-fecha">{{formatearFechaUltimoAcceso(usuario.ultimoAcceso)}}</div>
                      <div class="acceso-hora">{{usuario.ultimoAcceso | date:'dd/MM/yy HH:mm'}}</div>
                    </div>
                  </td>
                  
                  <!-- Acciones -->
                  <td>
                    <div class="acciones-usuario">
                      <p-button 
                        icon="pi pi-pencil"
                        [text]="true"
                        [rounded]="true"
                        size="small"
                        pTooltip="Editar usuario"
                        (click)="editarUsuario(usuario)">
                      </p-button>
                      <p-button 
                        icon="pi pi-trash"
                        [text]="true"
                        [rounded]="true"
                        size="small"
                        severity="danger"
                        pTooltip="Eliminar usuario"
                        (click)="eliminarUsuario(usuario)"
                        [disabled]="usuario.username === currentUser.toLowerCase()">
                      </p-button>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üè™ CONFIGURACI√ìN DEL NEGOCIO -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-admin">
            <i class="pi pi-building text-lg"></i>
            <span>Negocio</span>
          </div>
        </ng-template>
        
        <div class="seccion-content negocio-section">
          <div class="negocio-header mb-6">
            <h3 class="section-title">Configuraci√≥n del Negocio</h3>
            <p class="section-subtitle">Datos de la empresa y configuraci√≥n general - {{currentUser}}</p>
          </div>
          
          <div class="negocio-form">
            <p-accordion>
              
              <!-- Informaci√≥n B√°sica -->
              <p-accordionTab header="Informaci√≥n B√°sica de la Empresa" [selected]="true">
                <div class="form-grid grid grid-cols-1 md:grid-cols-2 gap-6">
                  
                  <div class="form-group">
                    <label for="nombreEmpresa" class="form-label">
                      <i class="pi pi-building text-blue-500"></i>
                      <span>Nombre de la Empresa</span>
                    </label>
                    <input 
                      id="nombreEmpresa"
                      type="text"
                      pInputText
                      [(ngModel)]="configNegocio.nombre"
                      placeholder="Nombre completo de la empresa"
                      class="w-full" />
                  </div>
                  
                  <div class="form-group">
                    <label for="rucEmpresa" class="form-label">
                      <i class="pi pi-id-card text-green-500"></i>
                      <span>RUC</span>
                    </label>
                    <input 
                      id="rucEmpresa"
                      type="text"
                      pInputText
                      [(ngModel)]="configNegocio.ruc"
                      placeholder="20123456789"
                      maxlength="11"
                      class="w-full" />
                  </div>
                  
                  <div class="form-group md:col-span-2">
                    <label for="direccionEmpresa" class="form-label">
                      <i class="pi pi-map-marker text-purple-500"></i>
                      <span>Direcci√≥n</span>
                    </label>
                    <textarea 
                      id="direccionEmpresa"
                      pInputTextarea
                      [(ngModel)]="configNegocio.direccion"
                      placeholder="Direcci√≥n completa de la empresa"
                      rows="3"
                      class="w-full">
                    </textarea>
                  </div>
                  
                  <div class="form-group">
                    <label for="telefonoEmpresa" class="form-label">
                      <i class="pi pi-phone text-orange-500"></i>
                      <span>Tel√©fono</span>
                    </label>
                    <input 
                      id="telefonoEmpresa"
                      type="text"
                      pInputText
                      [(ngModel)]="configNegocio.telefono"
                      placeholder="+51 987 654 321"
                      class="w-full" />
                  </div>
                  
                  <div class="form-group">
                    <label for="emailEmpresa" class="form-label">
                      <i class="pi pi-envelope text-red-500"></i>
                      <span>Email</span>
                    </label>
                    <input 
                      id="emailEmpresa"
                      type="email"
                      pInputText
                      [(ngModel)]="configNegocio.email"
                      placeholder="contacto@empresa.com"
                      class="w-full" />
                  </div>
                  
                  <div class="form-group">
                    <label for="websiteEmpresa" class="form-label">
                      <i class="pi pi-globe text-blue-500"></i>
                      <span>Sitio Web</span>
                    </label>
                    <input 
                      id="websiteEmpresa"
                      type="url"
                      pInputText
                      [(ngModel)]="configNegocio.website"
                      placeholder="www.empresa.com"
                      class="w-full" />
                  </div>
                  
                  <div class="form-group">
                    <label for="sloganEmpresa" class="form-label">
                      <i class="pi pi-comment text-pink-500"></i>
                      <span>Slogan</span>
                    </label>
                    <input 
                      id="sloganEmpresa"
                      type="text"
                      pInputText
                      [(ngModel)]="configNegocio.slogan"
                      placeholder="Tu slogan empresarial"
                      class="w-full" />
                  </div>
                </div>
              </p-accordionTab>
              
              <!-- Configuraci√≥n Operativa -->
              <p-accordionTab header="Configuraci√≥n Operativa">
                <div class="form-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  
                  <div class="form-group">
                    <label for="horarioApertura" class="form-label">
                      <i class="pi pi-clock text-green-500"></i>
                      <span>Hora de Apertura</span>
                    </label>
                    <input 
                      type="time"
                      pInputText
                      [(ngModel)]="configNegocio.horarioApertura"
                      class="w-full" />
                  </div>
                  
                  <div class="form-group">
                    <label for="horarioCierre" class="form-label">
                      <i class="pi pi-clock text-red-500"></i>
                      <span>Hora de Cierre</span>
                    </label>
                    <input 
                      type="time"
                      pInputText
                      [(ngModel)]="configNegocio.horarioCierre"
                      class="w-full" />
                  </div>
                  
                  <div class="form-group">
                    <label for="monedaPrincipal" class="form-label">
                      <i class="pi pi-money-bill text-yellow-500"></i>
                      <span>Moneda Principal</span>
                    </label>
                    <p-dropdown 
                      id="monedaPrincipal"
                      [(ngModel)]="configNegocio.moneda"
                      [options]="opcionesMoneda"
                      optionLabel="label"
                      optionValue="value"
                      placeholder="Seleccionar moneda"
                      class="w-full">
                    </p-dropdown>
                  </div>
                  
                  <!-- D√≠as laborales -->
                  <div class="form-group md:col-span-2 lg:col-span-3">
                    <label for="diasLaborales" class="form-label">
                      <i class="pi pi-calendar text-indigo-500"></i>
                      <span>D√≠as Laborales</span>
                    </label>
                    <div class="dias-laborales">
                      <div *ngFor="let dia of diasSemana; let i = index" class="dia-checkbox">
                        <p-checkbox 
                          [inputId]="'dia-' + i"
                          [binary]="true"
                          [ngModel]="configNegocio.diasLaborales.includes(dia.value)"
                          (onChange)="onDiaLaboralChange(dia, $event)">
                        </p-checkbox>
                        <label [for]="'dia-' + i">{{dia.label}}</label>
                      </div>
                    </div>
                  </div>
                </div>
              </p-accordionTab>
              
              <!-- Logo y Branding -->
              <p-accordionTab header="Logo y Branding">
                <div class="branding-section">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- Upload Logo -->
                    <div class="logo-upload-section">
                      <h4 class="subsection-title">Logo de la Empresa</h4>
                      <div class="logo-preview" *ngIf="configNegocio.logo">
                        <img [src]="configNegocio.logo" alt="Logo empresa" class="logo-image" />
                      </div>
                      <p-fileUpload 
                        mode="basic"
                        accept="image/*"
                        maxFileSize="1000000"
                        chooseLabel="Seleccionar Logo"
                        (onSelect)="onUploadLogo($event)"
                        styleClass="upload-logo">
                      </p-fileUpload>
                      <p class="upload-help">Formato: JPG, PNG | M√°ximo: 1MB | Recomendado: 200x200px</p>
                    </div>
                    
                    <!-- Vista previa -->
                    <div class="preview-section">
                      <h4 class="subsection-title">Vista Previa</h4>
                      <div class="business-card-preview">
                        <div class="card-header">
                          <img *ngIf="configNegocio.logo" [src]="configNegocio.logo" alt="Logo" class="card-logo" />
                          <div class="card-info">
                            <h5>{{ configNegocio.nombre || 'Nombre de la Empresa' }}</h5>
                            <p>{{configNegocio.slogan || 'Tu slogan aqu√≠'}}</p>
                          </div>
                        </div>
                        <div class="card-details">
                          <div class="detail-item">
                            <i class="pi pi-map-marker"></i>
                            <span>{{configNegocio.direccion || 'Direcci√≥n de la empresa'}}</span>
                          </div>
                          <div class="detail-item">
                            <i class="pi pi-phone"></i>
                            <span>{{configNegocio.telefono || 'Tel√©fono'}}</span>
                          </div>
                          <div class="detail-item">
                            <i class="pi pi-envelope"></i>
                            <span>{{configNegocio.email || 'Email'}}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </p-accordionTab>
            </p-accordion>
            
            <!-- Bot√≥n guardar configuraci√≥n -->
            <div class="form-actions mt-8">
              <div class="flex justify-end gap-4">
                <p-button 
                  icon="pi pi-save"
                  label="Guardar Configuraci√≥n"
                  [loading]="guardando"
                  (click)="guardarConfiguracionNegocio()">
                </p-button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üñ®Ô∏è IMPRESORAS Y DISPOSITIVOS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-admin">
            <i class="pi pi-print text-lg"></i>
            <span>Impresoras</span>
            <p-chip 
              [label]="impresoras.length.toString()" 
              styleClass="ml-2"
              [style]="{'background': '#8b5cf6', 'color': 'white'}">
            </p-chip>
          </div>
        </ng-template>
        
        <div class="seccion-content impresoras-section">
          <div class="impresoras-header mb-6">
            <h3 class="section-title">Gesti√≥n de Impresoras y Dispositivos</h3>
            <p class="section-subtitle">Configuraci√≥n de hardware del sistema - Admin: {{currentUser}}</p>
          </div>
          
          <!-- Grid de impresoras -->
          <div class="impresoras-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div *ngFor="let impresora of impresoras" class="impresora-card">
              
              <!-- Header de la impresora -->
              <div class="impresora-header">
                <div class="impresora-info">
                  <div class="impresora-icon" [class]="'tipo-' + impresora.tipo.toLowerCase()">
                    <i class="pi pi-print"></i>
                  </div>
                  <div class="impresora-details">
                    <h4 class="impresora-nombre">{{impresora.nombre}}</h4>
                    <p class="impresora-ubicacion">{{impresora.ubicacion}}</p>
                  </div>
                </div>
                <div class="impresora-estado">
                  <p-tag 
                    [value]="impresora.estado"
                    [severity]="getEstadoImpresoraSeverity(impresora.estado)">
                  </p-tag>
                  <div *ngIf="impresora.esDefault" class="default-badge">
                    <i class="pi pi-star"></i>
                    <span>Principal</span>
                  </div>
                </div>
              </div>
              
              <!-- Informaci√≥n t√©cnica -->
              <div class="impresora-specs">
                <div class="spec-item">
                  <span class="spec-label">Tipo:</span>
                  <span class="spec-value">{{impresora.tipo}}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Papel:</span>
                  <span class="spec-value">{{impresora.tamanoPapel}}</span>
                </div>
                <div class="spec-item" *ngIf="impresora.ip">
                  <span class="spec-label">IP:</span>
                  <span class="spec-value">{{impresora.ip}}:{{impresora.puerto}}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Driver:</span>
                  <span class="spec-value">{{impresora.driver}}</span>
                </div>
              </div>
              
              <!-- Acciones de la impresora -->
              <div class="impresora-actions">
                <p-button 
                  icon="pi pi-wifi"
                  label="Test Conexi√≥n"
                  [outlined]="true"
                  size="small"
                  [loading]="testConexionImpresora"
                  (click)="testearConexionImpresora(impresora)"
                  styleClass="w-full mb-2">
                </p-button>
                
                <div class="flex gap-2">
                  <p-button 
                    icon="pi pi-star"
                    [outlined]="!impresora.esDefault"
                    [disabled]="impresora.esDefault"
                    size="small"
                    pTooltip="Establecer como principal"
                    (click)="establecerImpresoraDefault(impresora)"
                    styleClass="flex-1">
                  </p-button>
                  
                  <p-button 
                    icon="pi pi-cog"
                    [outlined]="true"
                    size="small"
                    pTooltip="Configurar"
                    styleClass="flex-1">
                  </p-button>
                </div>
              </div>
            </div>
            
            <!-- Card agregar impresora -->
            <div class="impresora-card add-impresora-card">
              <div class="add-impresora-content">
                <div class="add-icon">
                  <i class="pi pi-plus"></i>
                </div>
                <h4>Agregar Impresora</h4>
                <p>Configurar nueva impresora</p>
                <p-button 
                  icon="pi pi-plus"
                  label="Agregar"
                  (click)="mostrarFormularioImpresora = true">
                </p-button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üí∞ CONFIGURACI√ìN FISCAL -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-admin">
            <i class="pi pi-calculator text-lg"></i>
            <span>Fiscal</span>
          </div>
        </ng-template>
        
        <div class="seccion-content fiscal-section">
          <div class="fiscal-header mb-6">
            <h3 class="section-title">Configuraci√≥n Fiscal - SUNAT</h3>
            <p class="section-subtitle">Par√°metros de facturaci√≥n electr√≥nica - Responsable: {{currentUser}}</p>
          </div>
          
          <div class="fiscal-form">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              
              <!-- Configuraci√≥n SUNAT -->
              <div class="sunat-config">
                <h4 class="subsection-title">Configuraci√≥n SUNAT</h4>
                
                <div class="form-group mb-4">
                  <label for="entornoSunat" class="form-label">
                    <i class="pi pi-globe text-blue-500"></i>
                    <span>Entorno SUNAT</span>
                  </label>
                  <div class="entorno-selector">
                    <p-radioButton 
                      inputId="beta"
                      name="entorno"
                      value="BETA"
                      [(ngModel)]="configFiscal.entornoSunat">
                    </p-radioButton>
                    <label for="beta" class="radio-label beta">BETA (Pruebas)</label>
                    
                    <p-radioButton 
                      inputId="produccion"
                      name="entorno"
                      value="PRODUCCION"
                      [(ngModel)]="configFiscal.entornoSunat">
                    </p-radioButton>
                    <label for="produccion" class="radio-label produccion">PRODUCCI√ìN</label>
                  </div>
                </div>
                
                <div class="form-group mb-4">
                  <label for="usuarioSol" class="form-label">
                    <i class="pi pi-user text-green-500"></i>
                    <span>Usuario SOL</span>
                  </label>
                  <input 
                    type="text"
                    pInputText
                    [(ngModel)]="configFiscal.usuarioSol"
                    placeholder="Usuario SUNAT"
                    class="w-full" />
                </div>
                
                <div class="form-group mb-4">
                  <label for="claveSol" class="form-label">
                    <i class="pi pi-lock text-red-500"></i>
                    <span>Clave SOL</span>
                  </label>
                  <p-password 
                    [(ngModel)]="configFiscal.claveSol"
                    placeholder="Clave SUNAT"
                    styleClass="w-full"
                    [feedback]="false">
                  </p-password>
                </div>
                
                <div class="form-group">
                  <div class="switch-group">
                    <p-inputSwitch 
                      inputId="emisorElectronico"
                      [(ngModel)]="configFiscal.emisorElectronico">
                    </p-inputSwitch>
                    <label for="emisorElectronico" class="switch-label">
                      <span>Emisor Electr√≥nico</span>
                      <small>Habilitar facturaci√≥n electr√≥nica</small>
                    </label>
                  </div>
                </div>
              </div>
              
              <!-- Configuraci√≥n de Comprobantes -->
              <div class="comprobantes-config">
                <h4 class="subsection-title">Series de Comprobantes</h4>
                
                <div class="form-group mb-4">
                  <label for="serieFactura" class="form-label">
                    <i class="pi pi-file text-blue-500"></i>
                    <span>Serie Facturas</span>
                  </label>
                  <input 
                    type="text"
                    pInputText
                    [(ngModel)]="configFiscal.serieFactura"
                    placeholder="F001"
                    maxlength="4"
                    class="w-full" />
                </div>
                
                <div class="form-group mb-4">
                  <label for="serieBoleta" class="form-label">
                    <i class="pi pi-receipt text-green-500"></i>
                    <span>Serie Boletas</span>
                  </label>
                  <input 
                    type="text"
                    pInputText
                    [(ngModel)]="configFiscal.serieBoleta"
                    placeholder="B001"
                    maxlength="4"
                    class="w-full" />
                </div>
                
                <div class="form-group mb-4">
                  <label for="serieNota" class="form-label">
                    <i class="pi pi-bookmark text-purple-500"></i>
                    <span>Serie Notas</span>
                  </label>
                  <input 
                    type="text"
                    pInputText
                    [(ngModel)]="configFiscal.serieNota"
                    placeholder="N001"
                    maxlength="4"
                    class="w-full" />
                </div>
                
                <div class="form-group">
                  <label for="igv" class="form-label">
                    <i class="pi pi-percentage text-orange-500"></i>
                    <span>IGV (%)</span>
                  </label>
                  <p-inputNumber 
                    [(ngModel)]="configFiscal.igv"
                    mode="decimal"
                    min="0"
                    max="30"
                    suffix="%"
                    styleClass="w-full">
                  </p-inputNumber>
                </div>
              </div>
            </div>
            
            <!-- Estado de certificados -->
            <div class="certificados-section mt-8">
              <h4 class="subsection-title">Estado de Certificados</h4>
              <div class="certificados-grid grid grid-cols-1 md:grid-cols-3 gap-4">
                
                <div class="certificado-card">
                  <div class="certificado-icon valid">
                    <i class="pi pi-shield"></i>
                  </div>
                  <div class="certificado-info">
                    <h5>Certificado Digital</h5>
                    <p class="certificado-estado valid">V√°lido hasta 15/12/2025</p>
                  </div>
                </div>
                
                <div class="certificado-card">
                  <div class="certificado-icon valid">
                    <i class="pi pi-wifi"></i>
                  </div>
                  <div class="certificado-info">
                    <h5>Conexi√≥n SUNAT</h5>
                    <p class="certificado-estado valid">Activa</p>
                  </div>
                </div>
                
                <div class="certificado-card">
                  <div class="certificado-icon warning">
                    <i class="pi pi-clock"></i>
                  </div>
                  <div class="certificado-info">
                    <h5>√öltima Sincronizaci√≥n</h5>
                    <p class="certificado-estado warning">Hace 2 horas</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Bot√≥n guardar fiscal -->
            <div class="form-actions mt-8">
              <div class="flex justify-end gap-4">
                <p-button 
                  icon="pi pi-save"
                  label="Guardar Configuraci√≥n Fiscal"
                  [loading]="guardando"
                  (click)="guardarConfiguracionFiscal()">
                </p-button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üé® PERSONALIZACI√ìN -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-admin">
            <i class="pi pi-palette text-lg"></i>
            <span>Personalizaci√≥n</span>
          </div>
        </ng-template>
        
        <div class="seccion-content personalizacion-section">
          <div class="personalizacion-header mb-6">
            <h3 class="section-title">Personalizaci√≥n del Sistema</h3>
            <p class="section-subtitle">Themes, colores y apariencia - Designer: {{currentUser}}</p>
          </div>
          
          <div class="personalizacion-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              
              <!-- Panel de colores -->
              <div class="colores-panel">
                <h4 class="subsection-title">Esquema de Colores</h4>
                
                <div class="color-groups">
                  <div class="color-group">
                    <label for="colorPrimario" class="color-label">Color Primario</label>
                    <div class="color-input-group">
                      <p-colorPicker 
                        inputId="colorPrimario"
                        [(ngModel)]="temaActual.colorPrimario"
                        format="hex">
                      </p-colorPicker>
                      <input 
                        id="colorPrimarioHex"
                        type="text"
                        pInputText
                        [(ngModel)]="temaActual.colorPrimario"
                        class="color-hex-input" />
                    </div>
                  </div>
                  
                  <div class="color-group">
                    <label for="colorSecundario" class="color-label">Color Secundario</label>
                    <div class="color-input-group">
                      <p-colorPicker 
                        [(ngModel)]="temaActual.colorSecundario"
                        format="hex">
                      </p-colorPicker>
                      <input 
                        type="text"
                        pInputText
                        [(ngModel)]="temaActual.colorSecundario"
                        class="color-hex-input" />
                    </div>
                  </div>
                  
                  <div class="color-group">
                    <label for="colorAcento" class="color-label">Color de Acento</label>
                    <div class="color-input-group">
                      <p-colorPicker 
                        [(ngModel)]="temaActual.colorAcento"
                        format="hex">
                      </p-colorPicker>
                      <input 
                        type="text"
                        pInputText
                        [(ngModel)]="temaActual.colorAcento"
                        class="color-hex-input" />
                    </div>
                  </div>
                  
                  <div class="color-group">
                    <label for="colorFondo" class="color-label">Color de Fondo</label>
                    <div class="color-input-group">
                      <p-colorPicker 
                        [(ngModel)]="temaActual.colorFondo"
                        format="hex">
                      </p-colorPicker>
                      <input 
                        type="text"
                        pInputText
                        [(ngModel)]="temaActual.colorFondo"
                        class="color-hex-input" />
                    </div>
                  </div>
                </div>
                
                <!-- Opciones adicionales -->
                <div class="opciones-tema mt-6">
                  <div class="opcion-grupo">
                    <p-inputSwitch 
                      [(ngModel)]="temaActual.esOscuro">
                    </p-inputSwitch>
                    <label for="esOscuro" class="switch-label">
                      <span>Modo Oscuro</span>
                      <small>Activar tema oscuro del sistema</small>
                    </label>
                  </div>
                </div>
              </div>
              
              <!-- Vista previa del tema -->
              <div class="preview-panel">
                <h4 class="subsection-title">Vista Previa</h4>
                
                <div class="tema-preview" [style.background]="temaActual.colorFondo">
                  <div class="preview-header" [style.background]="temaActual.colorPrimario">
                    <h5 style="color: white; margin: 0;">Sistema POS Emerson147</h5>
                  </div>
                  
                  <div class="preview-content">
                    <div class="preview-button" [style.background]="temaActual.colorPrimario">
                      Bot√≥n Primario
                    </div>
                    <div class="preview-button secondary" [style.background]="temaActual.colorSecundario">
                      Bot√≥n Secundario
                    </div>
                    <div class="preview-button accent" [style.background]="temaActual.colorAcento">
                      Bot√≥n Acento
                    </div>
                  </div>
                  
                  <div class="preview-cards">
                    <div class="preview-card" [style.border-left-color]="temaActual.colorPrimario">
                      <h6>Tarjeta de Ejemplo</h6>
                      <p>Contenido de la tarjeta con el tema seleccionado</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Acciones del tema -->
            <div class="tema-actions mt-8">
              <div class="flex justify-between">
                <div class="flex gap-4">
                  <p-button 
                    icon="pi pi-refresh"
                    label="Resetear"
                    [outlined]="true"
                    (click)="resetearTema()">
                  </p-button>
                </div>
                <div class="flex gap-4">
                  <p-button 
                    icon="pi pi-eye"
                    label="Vista Previa"
                    [outlined]="true"
                    (click)="aplicarTema()">
                  </p-button>
                  <p-button 
                    icon="pi pi-check"
                    label="Aplicar Tema"
                    [loading]="guardando"
                    (click)="aplicarTema()">
                  </p-button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üíæ BACKUP Y SINCRONIZACI√ìN -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="tab-header-admin">
            <i class="pi pi-database text-lg"></i>
            <span>Backup</span>
          </div>
        </ng-template>
        
        <div class="seccion-content backup-section">
          <div class="backup-header mb-6">
            <h3 class="section-title">Backup y Sincronizaci√≥n</h3>
            <p class="section-subtitle">Respaldo de datos y configuraci√≥n - Admin: {{currentUser}}</p>
          </div>
          
          <div class="backup-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              
              <!-- Configuraci√≥n de backup -->
              <div class="backup-config">
                <h4 class="subsection-title">Configuraci√≥n de Backup</h4>
                
                <div class="form-group mb-4">
                  <div class="switch-group">
                    <p-inputSwitch 
                      [(ngModel)]="configBackup.backupAutomatico">
                    </p-inputSwitch>
                    <label for="backupAutomatico" class="switch-label">
                      <span>Backup Autom√°tico</span>
                      <small>Realizar respaldos autom√°ticos</small>
                    </label>
                  </div>
                </div>
                
                <div class="form-group mb-4" *ngIf="configBackup.backupAutomatico">
                  <label for="frecuenciaBackup" class="form-label">
                    <i class="pi pi-clock text-blue-500"></i>
                    <span>Frecuencia</span>
                  </label>
                  <p-dropdown 
                    [(ngModel)]="configBackup.frecuenciaBackup"
                    [options]="opcionesFrecuenciaBackup"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Seleccionar frecuencia"
                    class="w-full">
                  </p-dropdown>
                </div>
                
                <div class="form-group mb-4" *ngIf="configBackup.backupAutomatico">
                  <label for="retencionDias" class="form-label">
                    <i class="pi pi-calendar-times text-green-500"></i>
                    <span>Hora de Backup</span>
                  </label>
                  <input 
                    type="time"
                    pInputText
                    [(ngModel)]="configBackup.horaBackup"
                    class="w-full" />
                </div>
                
                <div class="form-group mb-4">
                  <label for="ubicacionBackup" class="form-label">
                    <i class="pi pi-folder text-orange-500"></i>
                    <span>Ubicaci√≥n de Backup</span>
                  </label>
                  <input 
                    type="text"
                    pInputText
                    [(ngModel)]="configBackup.ubicacionBackup"
                    placeholder="/ruta/backup"
                    class="w-full" />
                </div>
                
                <div class="form-group">
                  <label for="retencionDias" class="form-label">
                    <i class="pi pi-history text-purple-500"></i>
                    <span>Retenci√≥n (d√≠as)</span>
                  </label>
                  <p-inputNumber 
                    [(ngModel)]="configBackup.retencionDias"
                    min="1"
                    max="365"
                    suffix=" d√≠as"
                    styleClass="w-full">
                  </p-inputNumber>
                </div>
              </div>
              
              <!-- Estado y acciones -->
              <div class="backup-status">
                <h4 class="subsection-title">Estado del Sistema</h4>
                
                <!-- √öltimo backup -->
                <div class="status-card mb-4">
                  <div class="status-icon success">
                    <i class="pi pi-check-circle"></i>
                  </div>
                  <div class="status-info">
                    <h5>√öltimo Backup</h5>
                    <p>02/06/2025 02:00:15</p>
                    <small>Backup autom√°tico completado exitosamente</small>
                  </div>
                </div>
                
                <!-- Tama√±o de base de datos -->
                <div class="status-card mb-4">
                  <div class="status-icon info">
                    <i class="pi pi-database"></i>
                  </div>
                  <div class="status-info">
                    <h5>Tama√±o de BD</h5>
                    <p>127.5 MB</p>
                    <small>2,847 registros de ventas</small>
                  </div>
                </div>
                
                <!-- Espacio disponible -->
                <div class="status-card mb-6">
                  <div class="status-icon warning">
                    <i class="pi pi-server"></i>
                  </div>
                  <div class="status-info">
                    <h5>Espacio Disponible</h5>
                    <p>4.2 GB / 10 GB</p>
                    <div class="espacio-progress">
                      <p-progressBar 
                        [value]="42"
                        [style]="{'height': '8px'}">
                      </p-progressBar>
                    </div>
                  </div>
                </div>
                
                <!-- Acciones de backup -->
                <div class="backup-actions">
                  <p-button 
                    icon="pi pi-download"
                    label="Backup Manual"
                    [loading]="backupEnProgreso"
                    (click)="ejecutarBackupManual()"
                    styleClass="w-full mb-3">
                  </p-button>
                  
                  <p-button 
                    icon="pi pi-upload"
                    label="Restaurar Backup"
                    [outlined]="true"
                    styleClass="w-full mb-3">
                  </p-button>
                  
                  <p-button 
                    icon="pi pi-trash"
                    label="Limpiar Backups Antiguos"
                    severity="danger"
                    [outlined]="true"
                    styleClass="w-full">
                  </p-button>
                </div>
              </div>
            </div>
            
            <!-- Progreso de backup -->
            <div *ngIf="backupEnProgreso" class="backup-progress mt-6">
              <div class="progress-card">
                <div class="progress-header">
                  <h5>Realizando Backup...</h5>
                  <span>{{progresBackup.toFixed(0)}}%</span>
                </div>
                <p-progressBar 
                  [value]="progresBackup"
                  [style]="{'height': '12px', 'margin-top': '8px'}">
                </p-progressBar>
                <p class="progress-text">Respaldando datos del sistema de {{currentUser}}</p>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
  
  <!-- üîÑ LOADING OVERLAY -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-content">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
      </div>
      <p class="loading-text">Cargando configuraci√≥n para {{currentUser}}...</p>
    </div>
  </div>
</div>

<!-- üó®Ô∏è DI√ÅLOGOS -->
<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>

<!-- üë§ DI√ÅLOGO USUARIO -->
<p-dialog 
  [(visible)]="mostrarFormularioUsuario"
  header="{{usuarioSeleccionado ? 'Editar Usuario' : 'Nuevo Usuario'}}"
  [modal]="true"
  [style]="{width: '600px'}"
  [closable]="true">
  
  <div class="usuario-form">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      
      <div class="form-group">
        <label for="nombre" class="form-label">Nombre Completo</label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevoUsuario.nombre"
          placeholder="Nombre completo"
          class="w-full" />
      </div>
      
      <div class="form-group">
        <label for="username" class="form-label">Username</label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevoUsuario.username"
          placeholder="usuario123"
          class="w-full" />
      </div>
      
      <div class="form-group">
        <label for="email" class="form-label">Email</label>
        <input 
          type="email"
          pInputText
          [(ngModel)]="nuevoUsuario.email"
          placeholder="usuario@empresa.com"
          class="w-full" />
      </div>
      
      <div class="form-group">
        <label for="telefono" class="form-label">Tel√©fono</label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevoUsuario.telefono"
          placeholder="+51 987 654 321"
          class="w-full" />
      </div>
      
      <div class="form-group">
        <label for="rol" class="form-label">Rol</label>
        <p-dropdown 
          [(ngModel)]="nuevoUsuario.rol"
          [options]="opcionesRol"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar rol"
          class="w-full">
        </p-dropdown>
      </div>
      
      <div class="form-group">
        <label for="estado" class="form-label">Estado</label>
        <p-dropdown 
          [(ngModel)]="nuevoUsuario.estado"
          [options]="opcionesEstado"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar estado"
          class="w-full">
        </p-dropdown>
      </div>
      
      <div class="form-group md:col-span-2">
        <label for="sucursal" class="form-label">Sucursal</label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevoUsuario.sucursal"
          placeholder="Principal"
          class="w-full" />
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-4">
      <p-button 
        icon="pi pi-times"
        label="Cancelar"
        [outlined]="true"
        (click)="mostrarFormularioUsuario = false">
      </p-button>
      <p-button 
        icon="pi pi-check"
        [label]="usuarioSeleccionado ? 'Actualizar' : 'Crear'"
        [loading]="guardando"
        (click)="guardarUsuario()">
      </p-button>
    </div>
  </ng-template>
</p-dialog>