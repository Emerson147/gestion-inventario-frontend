<div class="configuracion-layout min-h-screen bg-gray-50">
  
  <!-- üõ°Ô∏è HEADER PRINCIPAL OPTIMIZADO -->
  <div class="configuracion-header bg-slate-800 text-white shadow-xl mb-8">
    <div class="header-content p-6">
      <div class="flex items-center justify-between">
        <div class="header-info">
          <div class="flex items-center gap-6">
            <div class="header-icon relative">
              <div class="w-16 h-16 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg">
                <i class="pi pi-cog text-3xl text-white"></i>
              </div>
            </div>
            <div>
              <h2 class="text-3xl font-bold text-white mb-2">Panel de Administraci√≥n</h2>
              <p class="text-slate-300">
                Control total del sistema - Admin: 
                <span class="text-blue-300 font-semibold">{{currentUser}}</span> | 
                <span class="text-green-300">{{currentDateTime}}</span>
              </p>
            </div>
          </div>
        </div>
        
        <!-- Estado del sistema optimizado -->
        <div class="sistema-estado">
          <div class="bg-green-600 rounded-xl p-4 shadow-lg border border-green-500">
            <div class="flex items-center gap-3 text-white">
              <i class="pi pi-shield text-2xl"></i>
              <div>
                <div class="font-bold">Sistema</div>
                <div class="text-green-100 text-sm">ONLINE</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- üìã TABS DE CONFIGURACI√ìN OPTIMIZADOS -->
  <div class="configuracion-tabs px-6">
    <p-tabView [(activeIndex)]="seccionActiva" 
               styleClass="admin-tabview bg-white rounded-xl shadow-lg"
               >
      
      <!-- üë§ GESTI√ìN DE USUARIOS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="flex items-center gap-3 px-4 py-2">
            <i class="pi pi-users text-lg text-blue-600"></i>
            <span class="font-semibold">Usuarios</span>
            <div class="bg-green-600 text-white rounded-full px-2 py-1 text-xs font-bold min-w-[24px] text-center">
              {{usuarios.length}}
            </div>
          </div>
        </ng-template>
        
        <div class="seccion-content usuarios-section p-6">
          <!-- Toolbar de usuarios optimizado -->
          <div class="usuarios-toolbar mb-6 bg-blue-50 rounded-xl p-6">
            <div class="flex justify-between items-center">
              <div class="toolbar-left">
                <h3 class="text-xl font-bold text-gray-900 mb-2">Gesti√≥n de Usuarios del Sistema</h3>
                <p class="text-gray-600">
                  Administrar accesos y permisos - Responsable: 
                  <span class="text-blue-600 font-semibold">{{currentUser}}</span>
                </p>
              </div>
              <div class="toolbar-right">
                <p-button 
                  icon="pi pi-plus"
                  label="Nuevo Usuario"
                  severity="success"
                  styleClass="shadow-lg hover:shadow-xl transition-all duration-300"
                  (click)="mostrarNuevoUsuario()">
                </p-button>
              </div>
            </div>
          </div>
          
          <!-- Tabla de usuarios optimizada -->
          <div class="usuarios-table-container bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <p-table 
              [value]="usuarios" 
              styleClass="p-datatable-sm"
              [paginator]="true"
              [rows]="10"
              [responsive]="true"
              [lazy]="true"
              (onLazyLoad)="cargarUsuariosLazy($event)">
              
              <ng-template pTemplate="header">
                <tr class="bg-gray-50">
                  <th class="text-gray-700 font-semibold">Usuario</th>
                  <th class="text-gray-700 font-semibold">Informaci√≥n</th>
                  <th class="text-gray-700 font-semibold">Rol</th>
                  <th class="text-gray-700 font-semibold">Estado</th>
                  <th class="text-gray-700 font-semibold">√öltimo Acceso</th>
                  <th class="text-gray-700 font-semibold text-center">Acciones</th>
                </tr>
              </ng-template>
              
              <ng-template pTemplate="body" let-usuario>
                <tr class="hover:bg-blue-50 transition-colors duration-200">
                  <!-- Usuario -->
                  <td>
                    <div class="flex items-center gap-3">
                      <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold shadow-md">
                        {{usuario.avatar || usuario.nombre.substring(0, 2).toUpperCase()}}
                      </div>
                      <div>
                        <div class="font-semibold text-gray-900">{{usuario.nombre}}</div>
                        <div class="text-sm text-gray-500">{{usuario.username}}</div>
                      </div>
                    </div>
                  </td>
                  
                  <!-- Informaci√≥n -->
                  <td>
                    <div class="space-y-1">
                      <div class="flex items-center gap-2 text-sm">
                        <i class="pi pi-envelope text-blue-500 text-xs"></i>
                        <span class="text-gray-700">{{usuario.email}}</span>
                      </div>
                      <div class="flex items-center gap-2 text-sm" *ngIf="usuario.telefono">
                        <i class="pi pi-phone text-green-500 text-xs"></i>
                        <span class="text-gray-700">{{usuario.telefono}}</span>
                      </div>
                      <div class="flex items-center gap-2 text-sm">
                        <i class="pi pi-building text-purple-500 text-xs"></i>
                        <span class="text-gray-700">{{usuario.sucursal}}</span>
                      </div>
                    </div>
                  </td>
                  
                  <!-- Rol -->
                  <td>
                    <div class="flex items-center gap-2 px-3 py-1 rounded-full" 
                         [class]="getRolClasses(usuario.rol)">
                      <i [class]="getRolIcon(usuario.rol)"></i>
                      <span class="text-sm font-medium">{{usuario.rol}}</span>
                    </div>
                  </td>
                  
                  <!-- Estado -->
                  <td>
                    <p-tag 
                      [value]="usuario.estado"
                      [severity]="getEstadoSeverity(usuario.estado)"
                      styleClass="font-medium">
                    </p-tag>
                  </td>
                  
                  <!-- √öltimo acceso -->
                  <td>
                    <div class="text-sm">
                      <div class="font-medium text-gray-900">{{formatearFechaUltimoAcceso(usuario.ultimoAcceso)}}</div>
                      <div class="text-gray-500">{{usuario.ultimoAcceso | date:'dd/MM/yy HH:mm'}}</div>
                    </div>
                  </td>
                  
                  <!-- Acciones -->
                  <td class="text-center">
                    <div class="flex justify-center gap-2">
                      <p-button 
                        icon="pi pi-pencil"
                        [text]="true"
                        [rounded]="true"
                        size="small"
                        severity="info"
                        pTooltip="Editar usuario"
                        styleClass="hover:bg-blue-100 transition-colors"
                        (click)="editarUsuario(usuario)">
                      </p-button>
                      <p-button 
                        icon="pi pi-trash"
                        [text]="true"
                        [rounded]="true"
                        size="small"
                        severity="danger"
                        pTooltip="Eliminar usuario"
                        styleClass="hover:bg-red-100 transition-colors"
                        (click)="eliminarUsuario(usuario)"
                        [disabled]="usuario.username === currentUser.toLowerCase()">
                      </p-button>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üè™ CONFIGURACI√ìN DEL NEGOCIO -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="flex items-center gap-3 px-4 py-2">
            <i class="pi pi-building text-lg text-green-600"></i>
            <span class="font-semibold">Negocio</span>
          </div>
        </ng-template>
        
        <div class="seccion-content negocio-section p-6">
          <div class="negocio-header mb-6 bg-green-50 rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">Configuraci√≥n del Negocio</h3>
            <p class="text-gray-600">
              Datos de la empresa y configuraci√≥n general - 
              <span class="text-green-600 font-semibold">{{currentUser}}</span>
            </p>
          </div>
          
          <div class="negocio-form">
            <p-accordion [multiple]="true" [activeIndex]="[0]">
              
              <!-- Informaci√≥n B√°sica -->
              <p-accordionTab header="Informaci√≥n B√°sica de la Empresa" [selected]="true">
                <div class="p-6 bg-blue-50">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div class="space-y-2">
                      <label for="nombreEmpresa" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-building text-blue-600"></i>
                        <span>Nombre de la Empresa</span>
                      </label>
                      <input 
                        id="nombreEmpresa"
                        type="text"
                        pInputText
                        [(ngModel)]="configNegocio.nombre"
                        placeholder="Nombre completo de la empresa"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" />
                    </div>
                    
                    <div class="space-y-2">
                      <label for="rucEmpresa" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-id-card text-green-600"></i>
                        <span>RUC</span>
                      </label>
                      <input 
                        id="rucEmpresa"
                        type="text"
                        pInputText
                        [(ngModel)]="configNegocio.ruc"
                        placeholder="20123456789"
                        maxlength="11"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" />
                    </div>
                    
                    <div class="md:col-span-2 space-y-2">
                      <label for="direccionEmpresa" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-map-marker text-purple-600"></i>
                        <span>Direcci√≥n</span>
                      </label>
                      <textarea 
                        id="direccionEmpresa"
                        pInputTextarea
                        [(ngModel)]="configNegocio.direccion"
                        placeholder="Direcci√≥n completa de la empresa"
                        rows="3"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                      </textarea>
                    </div>
                    
                    <div class="space-y-2">
                      <label for="telefonoEmpresa" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-phone text-orange-600"></i>
                        <span>Tel√©fono</span>
                      </label>
                      <input 
                        id="telefonoEmpresa"
                        type="text"
                        pInputText
                        [(ngModel)]="configNegocio.telefono"
                        placeholder="+51 987 654 321"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all" />
                    </div>
                    
                    <div class="space-y-2">
                      <label for="emailEmpresa" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-envelope text-red-600"></i>
                        <span>Email</span>
                      </label>
                      <input 
                        id="emailEmpresa"
                        type="email"
                        pInputText
                        [(ngModel)]="configNegocio.email"
                        placeholder="contacto@empresa.com"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all" />
                    </div>
                    
                    <div class="space-y-2">
                      <label for="websiteEmpresa" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-globe text-blue-600"></i>
                        <span>Sitio Web</span>
                      </label>
                      <input 
                        id="websiteEmpresa"
                        type="url"
                        pInputText
                        [(ngModel)]="configNegocio.website"
                        placeholder="www.empresa.com"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" />
                    </div>
                    
                    <div class="space-y-2">
                      <label for="sloganEmpresa" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-comment text-pink-600"></i>
                        <span>Slogan</span>
                      </label>
                      <input 
                        id="sloganEmpresa"
                        type="text"
                        pInputText
                        [(ngModel)]="configNegocio.slogan"
                        placeholder="Tu slogan empresarial"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-pink-500 focus:ring-2 focus:ring-pink-200 transition-all" />
                    </div>
                  </div>
                </div>
              </p-accordionTab>
              
              <!-- Configuraci√≥n Operativa -->
              <p-accordionTab header="Configuraci√≥n Operativa">
                <div class="p-6 bg-purple-50">
                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    
                    <div class="space-y-2">
                      <label for="horarioApertura" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-clock text-green-600"></i>
                        <span>Hora de Apertura</span>
                      </label>
                      <input 
                        type="time"
                        pInputText
                        [(ngModel)]="configNegocio.horarioApertura"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" />
                    </div>
                    
                    <div class="space-y-2">
                      <label for="horarioCierre" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-clock text-red-600"></i>
                        <span>Hora de Cierre</span>
                      </label>
                      <input 
                        type="time"
                        pInputText
                        [(ngModel)]="configNegocio.horarioCierre"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all" />
                    </div>
                    
                    <div class="space-y-2">
                      <label for="monedaPrincipal" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-money-bill text-yellow-600"></i>
                        <span>Moneda Principal</span>
                      </label>
                      <p-dropdown 
                        id="monedaPrincipal"
                        [(ngModel)]="configNegocio.moneda"
                        [options]="opcionesMoneda"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Seleccionar moneda"
                        styleClass="w-full">
                      </p-dropdown>
                    </div>
                    
                    <!-- D√≠as laborales optimizado -->
                    <div class="lg:col-span-3 space-y-3">
                      <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                        <i class="pi pi-calendar text-indigo-600"></i>
                        <span>D√≠as Laborales</span>
                      </label>
                      <div class="flex flex-wrap gap-4">
                        <div *ngFor="let dia of diasSemana; let i = index; trackBy: trackByDiaId" 
                             class="flex items-center gap-2 bg-white p-3 rounded-lg border border-gray-200 hover:border-indigo-300 transition-colors">
                          <p-checkbox 
                            [inputId]="'dia-' + i"
                            [binary]="true"
                            [ngModel]="configNegocio.diasLaborales.includes(dia.value)"
                            (onChange)="onDiaLaboralChange(dia, $event)">
                          </p-checkbox>
                          <label [for]="'dia-' + i" class="text-sm font-medium text-gray-700 cursor-pointer">
                            {{dia.label}}
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </p-accordionTab>
              
              <!-- Logo y Branding optimizado -->
              <p-accordionTab header="Logo y Branding">
                <div class="p-6 bg-green-50">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- Upload Logo -->
                    <div class="space-y-4">
                      <h4 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                        <i class="pi pi-image text-blue-600"></i>
                        Logo de la Empresa
                      </h4>
                      
                      <div *ngIf="configNegocio.logo" 
                           class="w-32 h-32 bg-white rounded-xl shadow-lg border border-gray-200 p-4 flex items-center justify-center">
                        <img [src]="configNegocio.logo" alt="Logo empresa" class="max-w-full max-h-full object-contain" />
                      </div>
                      
                      <div class="space-y-2">
                        <p-fileUpload 
                          mode="basic"
                          accept="image/*"
                          maxFileSize="1000000"
                          chooseLabel="Seleccionar Logo"
                          (onSelect)="onUploadLogo($event)"
                          styleClass="w-full">
                        </p-fileUpload>
                        <p class="text-xs text-gray-500">
                          Formato: JPG, PNG | M√°ximo: 1MB | Recomendado: 200x200px
                        </p>
                      </div>
                    </div>
                    
                    <!-- Vista previa optimizada -->
                    <div class="space-y-4">
                      <h4 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                        <i class="pi pi-eye text-purple-600"></i>
                        Vista Previa
                      </h4>
                      
                      <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                        <div class="flex items-center gap-4 mb-4 pb-4 border-b border-gray-200">
                          <div *ngIf="configNegocio.logo" class="w-16 h-16 bg-gray-100 rounded-lg p-2">
                            <img [src]="configNegocio.logo" alt="Logo" class="w-full h-full object-contain" />
                          </div>
                          <div class="flex-1">
                            <h5 class="text-lg font-bold text-gray-900">
                              {{configNegocio.nombre || 'Nombre de la Empresa'}}
                            </h5>
                            <p class="text-gray-600">{{configNegocio.slogan || 'Tu slogan aqu√≠'}}</p>
                          </div>
                        </div>
                        
                        <div class="space-y-3">
                          <div class="flex items-center gap-3 text-sm">
                            <i class="pi pi-map-marker text-purple-600"></i>
                            <span class="text-gray-700">{{configNegocio.direccion || 'Direcci√≥n de la empresa'}}</span>
                          </div>
                          <div class="flex items-center gap-3 text-sm">
                            <i class="pi pi-phone text-green-600"></i>
                            <span class="text-gray-700">{{configNegocio.telefono || 'Tel√©fono'}}</span>
                          </div>
                          <div class="flex items-center gap-3 text-sm">
                            <i class="pi pi-envelope text-blue-600"></i>
                            <span class="text-gray-700">{{configNegocio.email || 'Email'}}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </p-accordionTab>
            </p-accordion>
            
            <!-- Bot√≥n guardar optimizado -->
            <div class="form-actions mt-8 bg-white rounded-xl p-6 shadow-lg border border-gray-200">
              <div class="flex justify-end">
                <p-button 
                  icon="pi pi-save"
                  label="Guardar Configuraci√≥n"
                  severity="success"
                  styleClass="shadow-lg hover:shadow-xl transition-all duration-300 px-6 py-3"
                  [loading]="guardando"
                  (click)="guardarConfiguracionNegocio()">
                </p-button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üñ®Ô∏è IMPRESORAS Y DISPOSITIVOS -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="flex items-center gap-3 px-4 py-2">
            <i class="pi pi-print text-lg text-purple-600"></i>
            <span class="font-semibold">Impresoras</span>
            <div class="bg-purple-600 text-white rounded-full px-2 py-1 text-xs font-bold min-w-[24px] text-center">
              {{impresoras.length}}
            </div>
          </div>
        </ng-template>
        
        <div class="seccion-content impresoras-section p-6">
          <div class="impresoras-header mb-6 bg-purple-50 rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">Gesti√≥n de Impresoras y Dispositivos</h3>
            <p class="text-gray-600">
              Configuraci√≥n de hardware del sistema - Admin: 
              <span class="text-purple-600 font-semibold">{{currentUser}}</span>
            </p>
          </div>
          
          <!-- Grid de impresoras optimizado -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div *ngFor="let impresora of impresoras; trackBy: trackByImpresoraId" 
                 class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-all duration-300">
              
              <!-- Header de la impresora -->
              <div class="p-6 border-b border-gray-200 bg-gray-50">
                <div class="flex justify-between items-start mb-4">
                  <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-lg flex items-center justify-center"
                         [class]="getImpresoraTipoClasses(impresora.tipo)">
                      <i class="pi pi-print text-xl text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-bold text-gray-900">{{impresora.nombre}}</h4>
                      <p class="text-sm text-gray-600">{{impresora.ubicacion}}</p>
                    </div>
                  </div>
                </div>
                
                <div class="flex items-center justify-between">
                  <p-tag 
                    [value]="impresora.estado"
                    [severity]="getEstadoImpresoraSeverity(impresora.estado)"
                    styleClass="font-medium">
                  </p-tag>
                  <div *ngIf="impresora.esDefault" 
                       class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1">
                    <i class="pi pi-star"></i>
                    <span>Principal</span>
                  </div>
                </div>
              </div>
              
              <!-- Informaci√≥n t√©cnica -->
              <div class="p-6 space-y-3">
                <div class="flex justify-between">
                  <span class="text-sm text-gray-600">Tipo:</span>
                  <span class="text-sm font-medium text-gray-900">{{impresora.tipo}}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm text-gray-600">Papel:</span>
                  <span class="text-sm font-medium text-gray-900">{{impresora.tamanoPapel}}</span>
                </div>
                <div class="flex justify-between" *ngIf="impresora.ip">
                  <span class="text-sm text-gray-600">IP:</span>
                  <span class="text-sm font-medium text-gray-900">{{impresora.ip}}:{{impresora.puerto}}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm text-gray-600">Driver:</span>
                  <span class="text-sm font-medium text-gray-900">{{impresora.driver}}</span>
                </div>
              </div>
              
              <!-- Acciones de la impresora -->
              <div class="p-6 bg-gray-50 border-t border-gray-200 space-y-3">
                <p-button 
                  icon="pi pi-wifi"
                  label="Test Conexi√≥n"
                  [outlined]="true"
                  size="small"
                  [loading]="testConexionImpresora"
                  (click)="testearConexionImpresora(impresora)"
                  styleClass="w-full">
                </p-button>
                
                <div class="flex gap-2">
                  <p-button 
                    icon="pi pi-star"
                    [outlined]="!impresora.esDefault"
                    [disabled]="impresora.esDefault"
                    size="small"
                    severity="danger"
                    pTooltip="Establecer como principal"
                    (click)="establecerImpresoraDefault(impresora)"
                    styleClass="flex-1">
                  </p-button>
                  
                  <p-button 
                    icon="pi pi-cog"
                    [outlined]="true"
                    size="small"
                    severity="info"
                    pTooltip="Configurar"
                    styleClass="flex-1">
                  </p-button>
                </div>
              </div>
            </div>
            
            <!-- Card agregar impresora optimizada -->
            <div class="bg-white rounded-xl shadow-lg border-2 border-dashed border-gray-300 hover:border-purple-400 transition-all duration-300 flex items-center justify-center p-8">
              <div class="text-center">
                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="pi pi-plus text-2xl text-purple-600"></i>
                </div>
                <h4 class="text-lg font-bold text-gray-900 mb-2">Agregar Impresora</h4>
                <p class="text-gray-600 mb-4">Configurar nueva impresora</p>
                <p-button 
                  icon="pi pi-plus"
                  label="Agregar"
                  severity="success"
                  (click)="mostrarFormularioImpresora = true">
                </p-button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üí∞ CONFIGURACI√ìN FISCAL -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="flex items-center gap-3 px-4 py-2">
            <i class="pi pi-calculator text-lg text-orange-600"></i>
            <span class="font-semibold">Fiscal</span>
          </div>
        </ng-template>
        
        <div class="seccion-content fiscal-section p-6">
          <div class="fiscal-header mb-6 bg-orange-50 rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">Configuraci√≥n Fiscal - SUNAT</h3>
            <p class="text-gray-600">
              Par√°metros de facturaci√≥n electr√≥nica - Responsable: 
              <span class="text-orange-600 font-semibold">{{currentUser}}</span>
            </p>
          </div>
          
          <div class="fiscal-form">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              
              <!-- Configuraci√≥n SUNAT -->
              <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                <h4 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                  <i class="pi pi-globe text-blue-600"></i>
                  Configuraci√≥n SUNAT
                </h4>
                
                <div class="space-y-6">
                  <div class="space-y-3">
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-globe text-blue-600"></i>
                      <span>Entorno SUNAT</span>
                    </label>
                    <div class="flex gap-4">
                      <div class="flex items-center gap-2 bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                        <p-radioButton 
                          inputId="beta"
                          name="entorno"
                          value="BETA"
                          [(ngModel)]="configFiscal.entornoSunat">
                        </p-radioButton>
                        <label for="beta" class="text-sm font-medium text-yellow-800 cursor-pointer">
                          BETA (Pruebas)
                        </label>
                      </div>
                      
                      <div class="flex items-center gap-2 bg-green-50 p-3 rounded-lg border border-green-200">
                        <p-radioButton 
                          inputId="produccion"
                          name="entorno"
                          value="PRODUCCION"
                          [(ngModel)]="configFiscal.entornoSunat">
                        </p-radioButton>
                        <label for="produccion" class="text-sm font-medium text-green-800 cursor-pointer">
                          PRODUCCI√ìN
                        </label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="space-y-2">
                    <label for="usuarioSol" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-user text-green-600"></i>
                      <span>Usuario SOL</span>
                    </label>
                    <input 
                      type="text"
                      pInputText
                      [(ngModel)]="configFiscal.usuarioSol"
                      placeholder="Usuario SUNAT"
                      class="w-full p-3 border border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" />
                  </div>
                  
                  <div class="space-y-2">
                    <label for="claveSol" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-lock text-red-600"></i>
                      <span>Clave SOL</span>
                    </label>
                    <p-password 
                      [(ngModel)]="configFiscal.claveSol"
                      placeholder="Clave SUNAT"
                      styleClass="w-full"
                      [feedback]="false"
                      inputStyleClass="p-3">
                    </p-password>
                  </div>
                  
                  <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="flex items-center gap-3">
                      <p-inputSwitch 
                        inputId="emisorElectronico"
                        [(ngModel)]="configFiscal.emisorElectronico">
                      </p-inputSwitch>
                      <div>
                        <label for="emisorElectronico" class="text-sm font-semibold text-blue-900 cursor-pointer">
                          Emisor Electr√≥nico
                        </label>
                        <p class="text-xs text-blue-700">Habilitar facturaci√≥n electr√≥nica</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Configuraci√≥n de Comprobantes -->
              <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                <h4 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                  <i class="pi pi-file text-purple-600"></i>
                  Series de Comprobantes
                </h4>
                
                <div class="space-y-6">
                  <div class="space-y-2">
                    <label for="serieFactura" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-file text-blue-600"></i>
                      <span>Serie Facturas</span>
                    </label>
                    <input 
                      type="text"
                      pInputText
                      [(ngModel)]="configFiscal.serieFactura"
                      placeholder="F001"
                      maxlength="4"
                      class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" />
                  </div>
                  
                  <div class="space-y-2">
                    <label for="serieBoleta" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-receipt text-green-600"></i>
                      <span>Serie Boletas</span>
                    </label>
                    <input 
                      type="text"
                      pInputText
                      [(ngModel)]="configFiscal.serieBoleta"
                      placeholder="B001"
                      maxlength="4"
                      class="w-full p-3 border border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" />
                  </div>
                  
                  <div class="space-y-2">
                    <label for="serieNota" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-bookmark text-purple-600"></i>
                      <span>Serie Notas</span>
                    </label>
                    <input 
                      type="text"
                      pInputText
                      [(ngModel)]="configFiscal.serieNota"
                      placeholder="N001"
                      maxlength="4"
                      class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" />
                  </div>
                  

                </div>
              </div>
            </div>
            
            <!-- Estado de certificados optimizado -->
            <div class="certificados-section mt-8">
              <h4 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                <i class="pi pi-shield text-green-600"></i>
                Estado de Certificados
              </h4>
              
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 flex items-center gap-4">
                  <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                    <i class="pi pi-shield text-green-600 text-xl"></i>
                  </div>
                  <div>
                    <h5 class="font-bold text-gray-900">Certificado Digital</h5>
                    <p class="text-sm text-green-600 font-medium">V√°lido hasta 15/12/2025</p>
                  </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 flex items-center gap-4">
                  <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                    <i class="pi pi-wifi text-blue-600 text-xl"></i>
                  </div>
                  <div>
                    <h5 class="font-bold text-gray-900">Conexi√≥n SUNAT</h5>
                    <p class="text-sm text-blue-600 font-medium">Activa</p>
                  </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 flex items-center gap-4">
                  <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                    <i class="pi pi-clock text-yellow-600 text-xl"></i>
                  </div>
                  <div>
                    <h5 class="font-bold text-gray-900">√öltima Sincronizaci√≥n</h5>
                    <p class="text-sm text-yellow-600 font-medium">Hace 2 horas</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Bot√≥n guardar fiscal -->
            <div class="form-actions mt-8 bg-white rounded-xl p-6 shadow-lg border border-gray-200">
              <div class="flex justify-end">
                <p-button 
                  icon="pi pi-save"
                  label="Guardar Configuraci√≥n Fiscal"
                  severity="success"
                  styleClass="shadow-lg hover:shadow-xl transition-all duration-300 px-6 py-3"
                  [loading]="guardando"
                  (click)="guardarConfiguracionFiscal()">
                </p-button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üé® PERSONALIZACI√ìN -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="flex items-center gap-3 px-4 py-2">
            <i class="pi pi-palette text-lg text-pink-600"></i>
            <span class="font-semibold">Personalizaci√≥n</span>
          </div>
        </ng-template>
        
        <div class="seccion-content personalizacion-section p-6">
          <div class="personalizacion-header mb-6 bg-pink-50 rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">Personalizaci√≥n del Sistema</h3>
            <p class="text-gray-600">
              Themes, colores y apariencia - Designer: 
              <span class="text-pink-600 font-semibold">{{currentUser}}</span>
            </p>
          </div>
          
          <div class="personalizacion-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              
              <!-- Panel de colores -->
              <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                <h4 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                  <i class="pi pi-palette text-purple-600"></i>
                  Esquema de Colores
                </h4>
                
                <div class="space-y-6">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                      <label for="colorPrimario" class="text-sm font-semibold text-gray-700">Color Primario</label>
                      <div class="flex gap-2">
                        <p-colorPicker 
                          inputId="colorPrimario"
                          [(ngModel)]="temaActual.colorPrimario"
                          format="hex">
                        </p-colorPicker>
                        <input 
                          type="text"
                          pInputText
                          [(ngModel)]="temaActual.colorPrimario"
                          class="flex-1 p-2 border border-gray-300 rounded text-sm" />
                      </div>
                    </div>
                    
                    <div class="space-y-2">
                      <label for="colorSecundario" class="text-sm font-semibold text-gray-700">Color Secundario</label>
                      <div class="flex gap-2">
                        <p-colorPicker 
                          [(ngModel)]="temaActual.colorSecundario"
                          format="hex">
                        </p-colorPicker>
                        <input 
                          type="text"
                          pInputText
                          [(ngModel)]="temaActual.colorSecundario"
                          class="flex-1 p-2 border border-gray-300 rounded text-sm" />
                      </div>
                    </div>
                    
                    <div class="space-y-2">
                      <label for="colorAcento" class="text-sm font-semibold text-gray-700">Color de Acento</label>
                      <div class="flex gap-2">
                        <p-colorPicker 
                          [(ngModel)]="temaActual.colorAcento"
                          format="hex">
                        </p-colorPicker>
                        <input 
                          type="text"
                          pInputText
                          [(ngModel)]="temaActual.colorAcento"
                          class="flex-1 p-2 border border-gray-300 rounded text-sm" />
                      </div>
                    </div>
                    
                    <div class="space-y-2">
                      <label for="colorFondo" class="text-sm font-semibold text-gray-700">Color de Fondo</label>
                      <div class="flex gap-2">
                        <p-colorPicker 
                          [(ngModel)]="temaActual.colorFondo"
                          format="hex">
                        </p-colorPicker>
                        <input 
                          type="text"
                          pInputText
                          [(ngModel)]="temaActual.colorFondo"
                          class="flex-1 p-2 border border-gray-300 rounded text-sm" />
                      </div>
                    </div>
                  </div>
                  
                  <!-- Opciones adicionales -->
                  <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <div class="flex items-center gap-3">
                      <p-inputSwitch 
                        [(ngModel)]="temaActual.esOscuro">
                      </p-inputSwitch>
                      <div>
                        <label for="esOscuro" class="text-sm font-semibold text-gray-700 cursor-pointer">
                          Modo Oscuro
                        </label>
                        <p class="text-xs text-gray-500">Activar tema oscuro del sistema</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Vista previa del tema -->
              <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                <h4 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                  <i class="pi pi-eye text-blue-600"></i>
                  Vista Previa
                </h4>
                
                <div class="rounded-lg overflow-hidden border border-gray-300" 
                     [style.background]="temaActual.colorFondo">
                  <div class="p-4 text-white" [style.background]="temaActual.colorPrimario">
                    <h5 class="font-bold m-0">Sistema POS Emerson147</h5>
                  </div>
                  
                  <div class="p-4 space-y-3">
                    <div class="flex gap-2">
                      <div class="px-4 py-2 rounded text-white text-sm font-medium" 
                           [style.background]="temaActual.colorPrimario">
                        Bot√≥n Primario
                      </div>
                      <div class="px-4 py-2 rounded text-white text-sm font-medium" 
                           [style.background]="temaActual.colorSecundario">
                        Bot√≥n Secundario
                      </div>
                      <div class="px-4 py-2 rounded text-white text-sm font-medium" 
                           [style.background]="temaActual.colorAcento">
                        Bot√≥n Acento
                      </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded border-l-4" 
                         [style.border-left-color]="temaActual.colorPrimario">
                      <h6 class="font-semibold text-gray-900 mb-2">Tarjeta de Ejemplo</h6>
                      <p class="text-gray-600 text-sm">Contenido de la tarjeta con el tema seleccionado</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Acciones del tema -->
            <div class="tema-actions mt-8 bg-white rounded-xl p-6 shadow-lg border border-gray-200">
              <div class="flex justify-between">
                <p-button 
                  icon="pi pi-refresh"
                  label="Resetear"
                  [outlined]="true"
                  severity="secondary"
                  (click)="resetearTema()">
                </p-button>
                <div class="flex gap-4">
                  <p-button 
                    icon="pi pi-eye"
                    label="Vista Previa"
                    [outlined]="true"
                    severity="info"
                    (click)="aplicarTemaPreview()">
                  </p-button>
                  <p-button 
                    icon="pi pi-check"
                    label="Aplicar Tema"
                    severity="success"
                    styleClass="shadow-lg hover:shadow-xl transition-all duration-300"
                    [loading]="guardando"
                    (click)="aplicarTema()">
                  </p-button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- üíæ BACKUP Y SINCRONIZACI√ìN -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="flex items-center gap-3 px-4 py-2">
            <i class="pi pi-database text-lg text-indigo-600"></i>
            <span class="font-semibold">Backup</span>
          </div>
        </ng-template>
        
        <div class="seccion-content backup-section p-6">
          <div class="backup-header mb-6 bg-indigo-50 rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">Backup y Sincronizaci√≥n</h3>
            <p class="text-gray-600">
              Respaldo de datos y configuraci√≥n - Admin: 
              <span class="text-indigo-600 font-semibold">{{currentUser}}</span>
            </p>
          </div>
          
          <div class="backup-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              
              <!-- Configuraci√≥n de backup -->
              <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                <h4 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                  <i class="pi pi-cog text-blue-600"></i>
                  Configuraci√≥n de Backup
                </h4>
                
                <div class="space-y-6">
                  <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="flex items-center gap-3">
                      <p-inputSwitch 
                        [(ngModel)]="configBackup.backupAutomatico">
                      </p-inputSwitch>
                      <div>
                        <label class="text-sm font-semibold text-blue-900 cursor-pointer">
                          Backup Autom√°tico
                        </label>
                        <p class="text-xs text-blue-700">Realizar respaldos autom√°ticos</p>
                      </div>
                    </div>
                  </div>
                  
                  <div *ngIf="configBackup.backupAutomatico" class="space-y-2">
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-clock text-green-600"></i>
                      <span>Frecuencia</span>
                    </label>
                    <p-dropdown 
                      [(ngModel)]="configBackup.frecuenciaBackup"
                      [options]="opcionesFrecuenciaBackup"
                      optionLabel="label"
                      optionValue="value"
                      placeholder="Seleccionar frecuencia"
                      styleClass="w-full">
                    </p-dropdown>
                  </div>
                  
                  <div *ngIf="configBackup.backupAutomatico" class="space-y-2">
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-calendar-times text-purple-600"></i>
                      <span>Hora de Backup</span>
                    </label>
                    <input 
                      type="time"
                      pInputText
                      [(ngModel)]="configBackup.horaBackup"
                      class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" />
                  </div>
                  
                  <div class="space-y-2">
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-folder text-orange-600"></i>
                      <span>Ubicaci√≥n de Backup</span>
                    </label>
                    <input 
                      type="text"
                      pInputText
                      [(ngModel)]="configBackup.ubicacionBackup"
                      placeholder="/ruta/backup"
                      class="w-full p-3 border border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all" />
                  </div>
                  
                  <div class="space-y-2">
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                      <i class="pi pi-history text-red-600"></i>
                      <span>Retenci√≥n (d√≠as)</span>
                    </label>
                    <p-inputNumber 
                      [(ngModel)]="configBackup.retencionDias"
                      min="1"
                      max="365"
                      suffix=" d√≠as"
                      inputStyleClass="p-3"
                      styleClass="w-full">
                    </p-inputNumber>
                  </div>
                </div>
              </div>
              
              <!-- Estado y acciones -->
              <div class="space-y-6">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                  <h4 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i class="pi pi-info-circle text-purple-600"></i>
                    Estado del Sistema
                  </h4>
                  
                  <div class="space-y-4">
                    <!-- √öltimo backup -->
                    <div class="flex items-center gap-4 p-4 bg-green-50 rounded-lg border border-green-200">
                      <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center">
                        <i class="pi pi-check-circle text-white text-xl"></i>
                      </div>
                      <div>
                        <h5 class="font-bold text-green-900">√öltimo Backup</h5>
                        <p class="text-sm text-green-700 font-medium">02/06/2025 02:00:15</p>
                        <p class="text-xs text-green-600">Backup autom√°tico completado exitosamente</p>
                      </div>
                    </div>
                    
                    <!-- Tama√±o de base de datos -->
                    <div class="flex items-center gap-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                      <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center">
                        <i class="pi pi-database text-white text-xl"></i>
                      </div>
                      <div>
                        <h5 class="font-bold text-blue-900">Tama√±o de BD</h5>
                        <p class="text-sm text-blue-700 font-medium">127.5 MB</p>
                        <p class="text-xs text-blue-600">2,847 registros de ventas</p>
                      </div>
                    </div>
                    
                    <!-- Espacio disponible -->
                    <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                      <div class="flex items-center gap-4 mb-3">
                        <div class="w-12 h-12 bg-yellow-600 rounded-full flex items-center justify-center">
                          <i class="pi pi-server text-white text-xl"></i>
                        </div>
                        <div>
                          <h5 class="font-bold text-yellow-900">Espacio Disponible</h5>
                          <p class="text-sm text-yellow-700 font-medium">4.2 GB / 10 GB</p>
                        </div>
                      </div>
                      <p-progressBar 
                        [value]="42"
                        [style]="{'height': '8px'}"
                        [showValue]="false">
                      </p-progressBar>
                    </div>
                  </div>
                </div>
                
                <!-- Acciones de backup -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                  <h4 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i class="pi pi-cog text-indigo-600"></i>
                    Acciones de Backup
                  </h4>
                  
                  <div class="space-y-3">
                    <p-button 
                      icon="pi pi-download"
                      label="Backup Manual"
                      severity="success"
                      [loading]="backupEnProgreso"
                      (click)="ejecutarBackupManual()"
                      styleClass="w-full shadow-lg hover:shadow-xl transition-all duration-300">
                    </p-button>
                    
                    <p-button 
                      icon="pi pi-upload"
                      label="Restaurar Backup"
                      severity="info"
                      [outlined]="true"
                      styleClass="w-full">
                    </p-button>
                    
                    <p-button 
                      icon="pi pi-trash"
                      label="Limpiar Backups Antiguos"
                      severity="danger"
                      [outlined]="true"
                      styleClass="w-full">
                    </p-button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Progreso de backup optimizado -->
            <div *ngIf="backupEnProgreso" class="backup-progress mt-8">
              <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                  <h5 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                    <i class="pi pi-spin pi-spinner text-blue-600"></i>
                    Realizando Backup...
                  </h5>
                  <span class="text-2xl font-bold text-blue-600">{{progresBackup.toFixed(0)}}%</span>
                </div>
                <p-progressBar 
                  [value]="progresBackup"
                  [style]="{'height': '12px'}"
                  [showValue]="false"
                  styleClass="mb-3">
                </p-progressBar>
                <p class="text-gray-600">
                  Respaldando datos del sistema de 
                  <span class="font-semibold text-indigo-600">{{currentUser}}</span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
  
  <!-- üîÑ LOADING OVERLAY OPTIMIZADO -->
  <div *ngIf="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 shadow-2xl text-center max-w-sm">
      <div class="relative w-16 h-16 mx-auto mb-6">
        <div class="absolute inset-0 border-4 border-blue-200 rounded-full"></div>
        <div class="absolute inset-0 border-4 border-blue-600 rounded-full border-t-transparent animate-spin"></div>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Cargando configuraci√≥n</h3>
      <p class="text-gray-600">
        Para <span class="font-semibold text-blue-600">{{currentUser}}</span>...
      </p>
    </div>
  </div>
</div>

<!-- üó®Ô∏è DI√ÅLOGOS OPTIMIZADOS -->
<p-confirmDialog styleClass="confirm-dialog-custom"></p-confirmDialog>
<p-toast position="top-right" styleClass="custom-toast"></p-toast>

<!-- üë§ DI√ÅLOGO USUARIO OPTIMIZADO -->
<p-dialog 
  [(visible)]="mostrarFormularioUsuario"
  [header]="(usuarioSeleccionado ? 'Editar Usuario' : 'Nuevo Usuario') + ' - ' + currentUser"
  [modal]="true"
  [style]="{width: '700px'}"
  [closable]="true"
  styleClass="usuario-dialog">
  
  <div class="usuario-form">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <div class="space-y-2">
        <label for="nombre" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-user text-blue-600"></i>
          <span>Nombre Completo</span>
        </label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevoUsuario.nombre"
          placeholder="Nombre completo"
          class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" />
      </div>
      
      <div class="space-y-2">
        <label for="username" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-at text-purple-600"></i>
          <span>Username</span>
        </label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevoUsuario.username"
          placeholder="usuario123"
          class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" />
      </div>
      
      <div class="space-y-2">
        <label for="email" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-envelope text-green-600"></i>
          <span>Email</span>
        </label>
        <input 
          type="email"
          pInputText
          [(ngModel)]="nuevoUsuario.email"
          placeholder="usuario@empresa.com"
          class="w-full p-3 border border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" />
      </div>
      
      <div class="space-y-2">
        <label for="telefono" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-phone text-orange-600"></i>
          <span>Tel√©fono</span>
        </label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevoUsuario.telefono"
          placeholder="+51 987 654 321"
          class="w-full p-3 border border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all" />
      </div>
      
      <div class="space-y-2">
        <label for="rol" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-users text-indigo-600"></i>
          <span>Rol</span>
        </label>
        <p-dropdown 
          [(ngModel)]="nuevoUsuario.rol"
          [options]="opcionesRol"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar rol"
          styleClass="w-full">
        </p-dropdown>
      </div>
      
      <div class="space-y-2">
        <label for="estado" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-circle text-red-600"></i>
          <span>Estado</span>
        </label>
        <p-dropdown 
          [(ngModel)]="nuevoUsuario.estado"
          [options]="opcionesEstado"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar estado"
          styleClass="w-full">
        </p-dropdown>
      </div>
      
      <div class="md:col-span-2 space-y-2">
        <label for="sucursal" class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-building text-teal-600"></i>
          <span>Sucursal</span>
        </label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevoUsuario.sucursal"
          placeholder="Principal"
          class="w-full p-3 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all" />
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-4 pt-4 border-t border-gray-200">
      <p-button 
        icon="pi pi-times"
        label="Cancelar"
        [outlined]="true"
        severity="secondary"
        styleClass="px-6"
        (click)="mostrarFormularioUsuario = false">
      </p-button>
      <p-button 
        icon="pi pi-check"
        [label]="usuarioSeleccionado ? 'Actualizar Usuario' : 'Crear Usuario'"
        severity="success"
        styleClass="px-6 shadow-lg hover:shadow-xl transition-all duration-300"
        [loading]="guardando"
        (click)="guardarUsuario()">
      </p-button>
    </div>
  </ng-template>
</p-dialog>

<!-- üñ®Ô∏è DI√ÅLOGO IMPRESORA OPTIMIZADO -->
<p-dialog 
  [(visible)]="mostrarFormularioImpresora"
  header="Configurar Nueva Impresora"
  [modal]="true"
  [style]="{width: '600px'}"
  [closable]="true"
  styleClass="impresora-dialog">
  
  <div class="impresora-form">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <div class="space-y-2">
        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-print text-purple-600"></i>
          <span>Nombre de la Impresora</span>
        </label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevaImpresora.nombre"
          placeholder="Impresora Principal"
          class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" />
      </div>
      
      <div class="space-y-2">
        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-map-marker text-green-600"></i>
          <span>Ubicaci√≥n</span>
        </label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevaImpresora.ubicacion"
          placeholder="Caja Principal"
          class="w-full p-3 border border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" />
      </div>
      
      <div class="space-y-2">
        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-cog text-blue-600"></i>
          <span>Tipo de Impresora</span>
        </label>
        <p-dropdown 
          [(ngModel)]="nuevaImpresora.tipo"
          [options]="tiposImpresora"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar tipo"
          styleClass="w-full">
        </p-dropdown>
      </div>
      
      <div class="space-y-2">
        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-file text-orange-600"></i>
          <span>Tama√±o de Papel</span>
        </label>
        <p-dropdown 
          [(ngModel)]="nuevaImpresora.tamanoPapel"
          [options]="tamanosPapel"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar tama√±o"
          styleClass="w-full">
        </p-dropdown>
      </div>
      
      <div class="space-y-2" *ngIf="nuevaImpresora.tipo === 'TERMICA'">
        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-wifi text-indigo-600"></i>
          <span>Direcci√≥n IP</span>
        </label>
        <input 
          type="text"
          pInputText
          [(ngModel)]="nuevaImpresora.ip"
          placeholder="192.168.1.100"
          class="w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all" />
      </div>
      
      <div class="space-y-2" *ngIf="nuevaImpresora.tipo === 'TERMICA'">
        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
          <i class="pi pi-server text-teal-600"></i>
          <span>Puerto</span>
        </label>
        <p-inputNumber 
          [(ngModel)]="nuevaImpresora.puerto"
          min="1"
          max="65535"
          placeholder="9100"
          inputStyleClass="p-3"
          styleClass="w-full">
        </p-inputNumber>
      </div>
    </div>
    
    <div class="mt-6 space-y-3">
      <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
        <div class="flex items-center gap-3">
          <p-inputSwitch 
            [(ngModel)]="nuevaImpresora.esDefault">
          </p-inputSwitch>
          <div>
            <label class="text-sm font-semibold text-blue-900 cursor-pointer">
              Establecer como impresora principal
            </label>
            <p class="text-xs text-blue-700">Esta impresora se usar√° por defecto</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-4 pt-4 border-t border-gray-200">
      <p-button 
        icon="pi pi-times"
        label="Cancelar"
        [outlined]="true"
        severity="secondary"
        (click)="mostrarFormularioImpresora = false">
      </p-button>
      <p-button 
        icon="pi pi-wifi"
        label="Probar Conexi√≥n"
        [outlined]="true"
        severity="info"
        [loading]="probandoConexion"
        (click)="probarConexionImpresora()">
      </p-button>
      <p-button 
        icon="pi pi-plus"
        label="Agregar Impresora"
        severity="success"
        styleClass="shadow-lg hover:shadow-xl transition-all duration-300"
        [loading]="guardando"
        (click)="guardarImpresora()">
      </p-button>
    </div>
  </ng-template>
</p-dialog>