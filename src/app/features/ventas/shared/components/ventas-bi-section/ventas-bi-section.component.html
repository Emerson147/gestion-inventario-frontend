<!-- SECTION 4: BUSINESS INTELLIGENCE (TOP CLIENTS & TICKETS) -->
<div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
  <!-- TOP CLIENTES & SEGMENTACIÓN -->
  <div
    class="bg-white dark:bg-surface-900 rounded-[2rem] p-6 lg:p-8 border border-surface-200 dark:border-surface-800 shadow-sm transition-all hover:shadow-md h-full flex flex-col"
  >
    <div class="flex items-center justify-between mb-6">
      <div>
        <h3
          class="text-lg font-bold text-surface-900 dark:text-surface-0 flex items-center gap-2"
        >
          <div
            class="w-8 h-8 rounded-lg bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center text-purple-600 dark:text-purple-400"
          >
            <i class="pi pi-briefcase text-sm"></i>
          </div>
          Mejores Clientes
        </h3>
        <p class="text-sm text-surface-500 dark:text-surface-400 ml-10 mt-1">
          Análisis RFM (Recencia, Frecuencia, Monto)
        </p>
      </div>
    </div>

    <div class="flex-1 overflow-auto">
      <p-table
        [value]="topClientes"
        [rows]="5"
        styleClass="p-datatable-sm zen-table-clean"
      >
        <ng-template pTemplate="header">
          <tr>
            <th
              class="w-12 pl-4 text-[10px] font-bold text-surface-400 uppercase tracking-wider text-center bg-transparent border-b border-surface-100 dark:border-surface-800"
            >
              #
            </th>
            <th
              class="text-[10px] font-bold text-surface-400 uppercase tracking-wider bg-transparent border-b border-surface-100 dark:border-surface-800"
            >
              Cliente
            </th>
            <th
              class="text-center text-[10px] font-bold text-surface-400 uppercase tracking-wider bg-transparent border-b border-surface-100 dark:border-surface-800"
            >
              Segmento
            </th>
            <th
              class="text-right pr-4 text-[10px] font-bold text-surface-400 uppercase tracking-wider bg-transparent border-b border-surface-100 dark:border-surface-800"
            >
              Total
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-cliente let-i="rowIndex">
          <tr
            class="hover:bg-surface-50 dark:hover:bg-surface-800/50 transition-colors border-b border-surface-50 dark:border-surface-800/50 last:border-0"
          >
            <td class="pl-4 py-3 text-center">
              <span class="text-xs font-bold text-surface-400">{{
                i + 1
              }}</span>
            </td>
            <td class="py-3">
              <div class="flex flex-col">
                <span
                  class="font-bold text-sm text-surface-900 dark:text-surface-0 leading-tight mb-0.5"
                >
                  {{ cliente.nombres }} {{ cliente.apellidos }}
                </span>
                <span
                  class="text-xs text-surface-500 dark:text-surface-400 font-medium"
                  >{{ cliente.email }}</span
                >
              </div>
            </td>
            <td class="text-center py-3">
              <span
                class="px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider border"
                [ngClass]="{
                  'bg-purple-50 text-purple-700 border-purple-100 dark:bg-purple-900/20 dark:text-purple-300 dark:border-purple-800/30':
                    cliente.segmento === 'premium',
                  'bg-blue-50 text-blue-700 border-blue-100 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-800/30':
                    cliente.segmento === 'frecuente',
                  'bg-surface-50 text-surface-600 border-surface-100 dark:bg-surface-800 dark:text-surface-300 dark:border-surface-700':
                    cliente.segmento === 'ocasional',
                }"
              >
                {{ cliente.segmento }}
              </span>
            </td>
            <td class="text-right pr-4 py-3">
              <div class="flex flex-col items-end gap-1">
                <span
                  class="font-bold text-sm text-surface-900 dark:text-surface-0 font-mono tracking-tight"
                >
                  S/ {{ cliente.totalCompras | number: "1.0-0" }}
                </span>
                <span
                  class="text-[10px] text-surface-500 bg-surface-100 dark:bg-surface-800 px-1.5 py-0.5 rounded-md"
                >
                  {{ cliente.numeroCompras }} compras
                </span>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- DISTRIBUCIÓN DE TICKETS -->
  <div
    class="bg-white dark:bg-surface-900 rounded-[2rem] p-6 lg:p-8 border border-surface-200 dark:border-surface-800 shadow-sm transition-all hover:shadow-md flex flex-col h-full"
  >
    <div class="mb-6">
      <h3
        class="text-lg font-bold text-surface-900 dark:text-surface-0 flex items-center gap-2"
      >
        <div
          class="w-8 h-8 rounded-lg bg-cyan-50 dark:bg-cyan-900/20 flex items-center justify-center text-cyan-600 dark:text-cyan-400"
        >
          <i class="pi pi-ticket text-sm"></i>
        </div>
        Distribución de Tickets
      </h3>
      <p class="text-sm text-surface-500 dark:text-surface-400 ml-10 mt-1">
        Frecuencia por rango de consumo
      </p>
    </div>

    <div class="flex-1 min-h-[300px] relative w-full">
      <p-chart
        type="bar"
        [data]="datosDistribucionTickets"
        [options]="opcionesGraficoBarras"
        height="100%"
        width="100%"
      ></p-chart>
    </div>
  </div>
</div>
