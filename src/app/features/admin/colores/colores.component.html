<p-toast position="top-right" [life]="4000" />
<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>

<div
  class="bg-white dark:bg-surface-900 rounded-[2.5rem] p-8 mb-6 shadow-sm border border-surface-200 dark:border-surface-800 relative overflow-hidden"
>
  <div
    class="absolute top-0 right-0 w-64 h-64 bg-surface-100 dark:bg-surface-900 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 opacity-60 pointer-events-none"
  ></div>

  <div
    class="flex flex-col xl:flex-row justify-between items-start xl:items-center gap-8 relative z-10"
  >
    <div class="flex items-center gap-5">
      <div
        class="w-16 h-16 rounded-2xl bg-surface-50 dark:bg-surface-800 flex items-center justify-center text-primary-600 dark:text-primary-400 border border-surface-100 dark:border-surface-700 shadow-sm"
      >
        <i class="pi pi-palette text-3xl"></i>
      </div>
      <div>
        <h1
          class="text-3xl font-bold text-surface-900 dark:text-surface-0 m-0 tracking-tight"
        >
          Gestión de Variantes
        </h1>
        <p
          class="text-sm text-surface-500 dark:text-surface-400 mt-1 mb-0 flex items-center gap-2"
        >
          <span>Configuración de colores y tallas</span>
          <span
            class="w-1 h-1 rounded-full bg-surface-300 dark:bg-surface-600"
          ></span>
          <span class="font-medium text-primary-600 dark:text-primary-400"
            >Inventario Maestro</span
          >
        </p>
      </div>
    </div>

    <div
      class="flex items-center gap-8 bg-surface-50 dark:bg-surface-800/50 px-8 py-4 rounded-2xl border border-surface-100 dark:border-surface-700/50"
      *ngIf="coloresFiltrados?.length"
    >
      <div class="flex flex-col items-center">
        <span
          class="text-[10px] font-bold text-surface-400 uppercase tracking-widest mb-1"
          >Colores</span
        >
        <span
          class="text-2xl font-bold text-surface-900 dark:text-surface-0 leading-none"
          >{{ calcularEstadisticas().totalColores }}</span
        >
      </div>

      <div class="w-px h-8 bg-surface-200 dark:bg-surface-700"></div>

      <div class="flex flex-col items-center">
        <span
          class="text-[10px] font-bold text-surface-400 uppercase tracking-widest mb-1"
          >Tallas</span
        >
        <span
          class="text-2xl font-bold text-surface-900 dark:text-surface-0 leading-none"
          >{{ calcularEstadisticas().totalTallas }}</span
        >
      </div>

      <div class="w-px h-8 bg-surface-200 dark:bg-surface-700"></div>

      <div class="flex flex-col items-center">
        <span
          class="text-[10px] font-bold text-surface-400 uppercase tracking-widest mb-1"
          >SKUs</span
        >
        <span
          class="text-2xl font-bold text-primary-600 dark:text-primary-400 leading-none"
          >{{ calcularEstadisticas().combinaciones }}</span
        >
      </div>
    </div>
  </div>
</div>

<div class="sticky top-4 z-40 mb-8 px-2">
  <div
    class="bg-white/80 dark:bg-surface-900/80 backdrop-blur-xl rounded-2xl p-3 shadow-lg border border-white/20 dark:border-surface-700/50 flex flex-col sm:flex-row items-center justify-between gap-4 transition-all duration-300"
  >
    <div class="flex items-center gap-2 w-full sm:w-auto">
      <button
        *appHasPermission="{
          module: 'colores',
          permission: permissionTypes.CREATE,
        }"
        (click)="openNew()"
        class="group relative px-6 py-3 bg-surface-900 dark:bg-surface-0 hover:bg-black dark:hover:bg-surface-200 text-white dark:text-surface-900 rounded-xl font-bold transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 active:scale-95 flex items-center gap-3 overflow-hidden"
      >
        <div
          class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"
        ></div>
        <i class="pi pi-plus text-sm"></i>
        <span>Nuevo Color</span>
      </button>

      <div
        *ngIf="selectedColores?.length"
        class="animate-fade-in flex items-center ml-2"
      >
        <button
          *appHasPermission="{
            module: 'colores',
            permission: permissionTypes.DELETE,
          }"
          (click)="eliminarColoresSeleccionados()"
          class="px-5 py-3 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 rounded-xl font-bold transition-all duration-200 flex items-center gap-2 border border-red-100 dark:border-red-900/50"
        >
          <i class="pi pi-trash text-sm"></i>
          <span>Eliminar ({{ selectedColores.length }})</span>
        </button>
      </div>
    </div>

    <div
      class="flex items-center gap-2 bg-surface-50 dark:bg-surface-800 p-1.5 rounded-xl border border-surface-100 dark:border-surface-700"
    >
      <div
        class="flex bg-white dark:bg-surface-900 rounded-lg p-1 shadow-sm border border-surface-100 dark:border-surface-700"
      >
        <button
          *ngFor="let option of viewOptions"
          (click)="currentView = option.value"
          class="w-9 h-9 flex items-center justify-center rounded-md transition-all duration-200"
          [ngClass]="
            currentView === option.value
              ? 'bg-surface-900 dark:bg-surface-0 text-white dark:text-surface-900 shadow-md scale-105'
              : 'text-surface-400 hover:text-surface-600 dark:hover:text-surface-300 hover:bg-surface-50 dark:hover:bg-surface-800'
          "
        >
          <i [class]="option.icon"></i>
        </button>
      </div>

      <div class="w-px h-6 bg-surface-200 dark:bg-surface-700 mx-1"></div>

      <button
        (click)="cargarColoresPorProducto()"
        class="w-10 h-10 flex items-center justify-center rounded-lg text-surface-500 hover:text-surface-900 dark:hover:text-surface-0 hover:bg-white dark:hover:bg-surface-700 transition-all tooltip-target"
        pTooltip="Actualizar datos"
      >
        <i class="pi pi-refresh" [class.animate-spin]="loading"></i>
      </button>

      <button
        (click)="mostrarEstadisticas()"
        class="w-10 h-10 flex items-center justify-center rounded-lg text-surface-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all tooltip-target"
        pTooltip="Ver Análisis"
      >
        <i class="pi pi-chart-pie"></i>
      </button>

      <button
        (click)="exportarExcel()"
        [disabled]="!coloresFiltrados.length"
        class="w-10 h-10 flex items-center justify-center rounded-lg text-surface-500 hover:text-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-all disabled:opacity-30 disabled:hover:bg-transparent"
        pTooltip="Exportar Excel"
      >
        <i class="pi pi-file-excel"></i>
      </button>
    </div>
  </div>
</div>

<!-- Filtros -->
<div class="mb-8 relative z-20">
  <div
    class="bg-white dark:bg-surface-900 rounded-[2rem] p-6 shadow-sm border border-surface-100 dark:border-surface-800 transition-all duration-300 hover:shadow-lg"
  >
    <div class="flex justify-between items-center mb-6">
      <div class="flex items-center gap-3">
        <div
          class="w-10 h-10 rounded-full bg-surface-50 dark:bg-surface-800 flex items-center justify-center text-surface-400 dark:text-surface-500"
        >
          <i class="pi pi-filter text-lg"></i>
        </div>
        <div>
          <h3
            class="text-base font-bold text-surface-900 dark:text-surface-0 m-0"
          >
            Explorador
          </h3>
          <p class="text-xs text-surface-500 dark:text-surface-400">
            Filtrar inventario
          </p>
        </div>
      </div>

      <div *ngIf="getTotalFiltrosActivos() > 0" class="animate-scale-in">
        <span
          class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-primary-50 dark:bg-primary-900/20 border border-primary-100 dark:border-primary-900/50 text-primary-600 dark:text-primary-400 text-xs font-bold shadow-sm"
        >
          <span
            class="w-2 h-2 rounded-full bg-primary-500 animate-pulse"
          ></span>
          {{ getTotalFiltrosActivos() }} activos
          <i
            class="pi pi-times ml-1 cursor-pointer hover:text-primary-800"
            (click)="limpiarFiltros()"
            pTooltip="Limpiar todo"
          ></i>
        </span>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-12 gap-5">
      <div class="md:col-span-5 flex flex-col gap-2 group">
        <label
          class="text-xs font-bold text-surface-400 dark:text-surface-500 uppercase tracking-wider ml-1 group-focus-within:text-primary-500 transition-colors"
        >
          Producto Base
        </label>
        <p-select
          inputId="productoSelect"
          [options]="productos"
          [(ngModel)]="productoSeleccionadoFiltro"
          optionLabel="codigo"
          placeholder="Todos los productos"
          [filter]="true"
          filterBy="nombre,codigo"
          [showClear]="true"
          styleClass="w-full border-0 bg-surface-50 dark:bg-surface-800 text-surface-900 dark:text-surface-0 rounded-2xl px-3 py-2 shadow-inner transition-all duration-200 focus-within:ring-2 focus-within:ring-primary-100 dark:focus-within:ring-primary-900 focus-within:bg-white dark:focus-within:bg-surface-900"
          (onChange)="cargarColoresPorProducto()"
        >
          <ng-template pTemplate="selectedItem">
            <div
              *ngIf="productoSeleccionadoFiltro"
              class="flex items-center gap-2"
            >
              <div
                class="w-6 h-6 rounded bg-surface-200 dark:bg-surface-700 flex items-center justify-center text-surface-500 text-xs"
              >
                <i class="pi pi-box"></i>
              </div>
              <span
                class="font-semibold text-surface-900 dark:text-surface-0"
                >{{ productoSeleccionadoFiltro.codigo }}</span
              >
              <span
                class="text-surface-400 dark:text-surface-500 text-sm truncate"
                >- {{ productoSeleccionadoFiltro.nombre }}</span
              >
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex flex-col py-1">
              <span class="font-bold text-surface-800 dark:text-surface-100">{{
                item.codigo
              }}</span>
              <div class="flex justify-between items-center">
                <span class="text-xs text-surface-500">{{ item.nombre }}</span>
                <span
                  class="text-xs font-mono bg-surface-100 dark:bg-surface-700 px-1.5 rounded text-surface-600"
                  >S/. {{ item.precioVenta }}</span
                >
              </div>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="md:col-span-4 flex flex-col gap-2 group">
        <label
          class="text-xs font-bold text-surface-400 dark:text-surface-500 uppercase tracking-wider ml-1 group-focus-within:text-purple-500 transition-colors"
        >
          Buscar Color
        </label>
        <div
          class="relative transition-transform duration-200 focus-within:scale-[1.01]"
        >
          <i
            class="pi pi-search absolute left-4 top-1/2 -translate-y-1/2 text-surface-400 group-focus-within:text-purple-500 transition-colors"
          ></i>
          <input
            id="buscarColorInput"
            pInputText
            [(ngModel)]="filtroTexto"
            (input)="aplicarFiltrosTexto()"
            placeholder="Nombre, código..."
            class="w-full pl-10 h-[46px] bg-surface-50 dark:bg-surface-800 border-none rounded-2xl text-surface-900 dark:text-surface-0 focus:ring-2 focus:ring-purple-100 dark:focus:ring-purple-900 focus:bg-white dark:focus:bg-surface-900 transition-all shadow-inner"
          />
        </div>
      </div>

      <div class="md:col-span-3 flex flex-col gap-2 group">
        <label
          class="text-xs font-bold text-surface-400 dark:text-surface-500 uppercase tracking-wider ml-1 group-focus-within:text-orange-500 transition-colors"
        >
          Talla Específica
        </label>
        <div
          class="relative transition-transform duration-200 focus-within:scale-[1.01]"
        >
          <i
            class="pi pi-tag absolute left-4 top-1/2 -translate-y-1/2 text-surface-400 group-focus-within:text-orange-500 transition-colors"
          ></i>
          <input
            id="filtroTallaInput"
            pInputText
            [(ngModel)]="filtroTalla"
            (input)="aplicarFiltrosTexto()"
            placeholder="Ej: XL, 42..."
            class="w-full pl-10 h-[46px] bg-surface-50 dark:bg-surface-800 border-none rounded-2xl text-surface-900 dark:text-surface-0 focus:ring-2 focus:ring-orange-100 dark:focus:ring-orange-900 focus:bg-white dark:focus:bg-surface-900 transition-all shadow-inner"
          />
        </div>
      </div>
    </div>

    <div *ngIf="productoSeleccionadoFiltro" class="mt-6 animate-fade-in">
      <div
        class="relative overflow-hidden bg-gradient-to-r from-surface-50 to-white dark:from-surface-800 dark:to-surface-900 rounded-2xl p-4 border border-surface-200 dark:border-surface-700 flex items-center justify-between group"
      >
        <div
          class="absolute -left-4 -top-4 w-20 h-20 bg-primary-100 dark:bg-primary-900/30 rounded-full blur-2xl opacity-50"
        ></div>

        <div class="flex items-center gap-4 relative z-10">
          <div
            class="w-12 h-12 bg-white dark:bg-surface-800 rounded-xl flex items-center justify-center shadow-sm text-primary-600 dark:text-primary-400 border border-surface-100 dark:border-surface-700"
          >
            <i class="pi pi-box text-xl"></i>
          </div>
          <div>
            <div class="flex items-center gap-2">
              <span
                class="text-xs font-bold text-primary-600 dark:text-primary-400 uppercase tracking-wider"
                >Filtro Activo</span
              >
              <span
                class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"
              ></span>
            </div>
            <h4
              class="font-bold text-surface-900 dark:text-surface-0 m-0 text-lg"
            >
              {{ productoSeleccionadoFiltro.codigo }}
              <span class="font-normal text-surface-500 text-sm ml-1">{{
                productoSeleccionadoFiltro.nombre
              }}</span>
            </h4>
          </div>
        </div>

        <div class="flex items-center gap-4 relative z-10">
          <div class="text-right hidden sm:block">
            <span class="block text-xs text-surface-400">Precio Venta</span>
            <span
              class="font-mono font-bold text-surface-700 dark:text-surface-200"
              >S/.
              {{
                productoSeleccionadoFiltro.precioVenta | number: "1.2-2"
              }}</span
            >
          </div>
          <button
            (click)="limpiarFiltros()"
            class="w-8 h-8 rounded-full bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 text-surface-400 hover:text-red-500 hover:border-red-200 hover:bg-red-50 transition-all flex items-center justify-center shadow-sm"
            pTooltip="Quitar este filtro"
          >
            <i class="pi pi-times text-xs"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Vista de Paleta -->
<div *ngIf="currentView === 'palette'" class="mb-8 animate-fade-in">
  <div
    class="bg-white dark:bg-surface-900 rounded-[2.5rem] p-8 shadow-sm border border-surface-100 dark:border-surface-800 relative overflow-hidden transition-colors duration-300"
  >
    <div
      class="absolute top-0 right-0 w-96 h-96 bg-surface-100 dark:bg-surface-800/50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 opacity-50 pointer-events-none"
    ></div>

    <div
      class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 relative z-10"
    >
      <div class="flex items-start gap-4">
        <div
          class="w-14 h-14 rounded-2xl bg-surface-50 dark:bg-surface-800 flex items-center justify-center text-primary-500 shadow-sm border border-surface-100 dark:border-surface-700"
        >
          <i class="pi pi-palette text-2xl"></i>
        </div>

        <div class="flex flex-col">
          <h3
            class="text-2xl font-bold text-surface-900 dark:text-surface-0 m-0 tracking-tight"
          >
            Catálogo Visual
          </h3>
          <div
            class="flex items-center gap-2 text-surface-500 dark:text-surface-400 text-sm mt-1"
          >
            <span>Inventario de colores y texturas</span>
            <span
              class="w-1 h-1 rounded-full bg-surface-300 dark:bg-surface-600"
            ></span>
            <span class="font-semibold text-primary-600 dark:text-primary-400">
              {{ coloresFiltrados.length || 0 }} variantes
            </span>
          </div>
        </div>
      </div>

      <div class="mt-4 md:mt-0" *ngIf="coloresFiltrados?.length">
        <button
          *appHasPermission="{
            module: 'colores',
            permission: permissionTypes.CREATE,
          }"
          (click)="openNew()"
          class="hidden md:flex items-center gap-2 px-5 py-2.5 rounded-xl bg-surface-900 dark:bg-surface-0 text-white dark:text-surface-900 font-bold text-sm hover:shadow-lg hover:-translate-y-0.5 transition-all"
        >
          <i class="pi pi-plus"></i>
          <span>Nuevo</span>
        </button>
      </div>
    </div>

    <div class="relative z-10">
      <div
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
        *ngIf="coloresFiltrados?.length; else emptyPalette"
      >
        <div
          *appHasPermission="{
            module: 'colores',
            permission: permissionTypes.CREATE,
          }"
          (click)="openNew()"
          class="group relative h-[320px] rounded-3xl border-2 border-dashed border-surface-200 dark:border-surface-700 hover:border-primary-400 dark:hover:border-primary-500/50 bg-surface-50/50 dark:bg-surface-800/20 hover:bg-white dark:hover:bg-surface-800 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center gap-4 overflow-hidden md:hidden lg:flex"
        >
          <div
            class="w-16 h-16 rounded-full bg-white dark:bg-surface-800 shadow-sm group-hover:shadow-md group-hover:scale-110 transition-all duration-300 flex items-center justify-center text-surface-400 group-hover:text-primary-500"
          >
            <i class="pi pi-plus text-2xl"></i>
          </div>
          <div class="text-center z-10">
            <h4
              class="font-bold text-surface-600 dark:text-surface-300 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors"
            >
              Nuevo Color
            </h4>
            <span class="text-xs text-surface-400 dark:text-surface-500"
              >Añadir variante</span
            >
          </div>
        </div>

        <div
          *ngFor="
            let color of coloresFiltrados;
            trackBy: trackByColor;
            let i = index
          "
          class="group relative bg-surface-0 dark:bg-surface-900 rounded-3xl border border-surface-200 dark:border-surface-700 hover:border-primary-200 dark:hover:border-primary-800 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col overflow-hidden h-[320px]"
          style="
            animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) backwards;
          "
          [style.animation-delay]="i * 50 + 'ms'"
        >
          <div
            class="absolute top-4 left-4 z-20 opacity-0 group-hover:opacity-100 transition-opacity duration-200"
            [class.opacity-100]="selectedColores.includes(color)"
          >
            <p-checkbox
              [(ngModel)]="selectedColores"
              [value]="color"
              styleClass="scale-90 shadow-sm"
            ></p-checkbox>
          </div>

          <div
            class="absolute top-3 right-3 z-20 flex gap-1 opacity-0 group-hover:opacity-100 transition-all duration-200 translate-x-2 group-hover:translate-x-0"
          >
            <button
              (click)="editColor(color)"
              class="w-8 h-8 rounded-full bg-white/90 dark:bg-surface-800/90 backdrop-blur shadow text-surface-500 hover:text-surface-900 transition-colors"
            >
              <i class="pi pi-pencil text-xs"></i>
            </button>
            <button
              (click)="eliminarColor(color)"
              class="w-8 h-8 rounded-full bg-white/90 dark:bg-surface-800/90 backdrop-blur shadow text-surface-500 hover:text-red-500 transition-colors"
            >
              <i class="pi pi-trash text-xs"></i>
            </button>
          </div>

          <div
            class="relative h-1/2 flex items-center justify-center bg-surface-50 dark:bg-surface-800/50 overflow-hidden cursor-pointer"
            (click)="verDetallesColor(color)"
          >
            <div
              class="absolute inset-0 opacity-20 dark:opacity-30 blur-2xl group-hover:opacity-40 transition-opacity duration-500"
              [style.background-color]="color.codigoHex"
            ></div>
            <div
              class="w-24 h-24 rounded-full shadow-lg border-4 border-white dark:border-surface-900 relative z-10 transition-transform duration-500 group-hover:scale-110"
              [style.background-color]="color.codigoHex || 'transparent'"
            >
              <div
                class="absolute top-0 right-0 w-full h-full bg-gradient-to-tr from-transparent via-white/20 to-transparent opacity-50"
              ></div>
            </div>
            <div
              class="absolute bottom-3 left-1/2 -translate-x-1/2 bg-white/90 dark:bg-surface-900/90 backdrop-blur px-3 py-1 rounded-full text-[10px] font-mono font-bold text-surface-600 dark:text-surface-300 shadow-sm border border-surface-100 dark:border-surface-700 opacity-0 group-hover:opacity-100 transition-all duration-300 translate-y-2 group-hover:translate-y-0"
            >
              {{ color.codigoHex || "N/A" }}
            </div>
          </div>

          <div
            class="flex-1 p-5 flex flex-col justify-between bg-white dark:bg-surface-900 relative"
          >
            <div class="text-center mb-3">
              <h4
                class="text-base font-bold text-surface-900 dark:text-surface-0 m-0 truncate px-2"
                title="{{ color.nombre }}"
              >
                {{ color.nombre }}
              </h4>
              <p class="text-xs text-surface-400 dark:text-surface-500 mt-1">
                {{ color.tallas?.length || 0 }} tallas
              </p>
            </div>

            <div
              class="flex flex-wrap justify-center gap-1.5 content-start h-16 overflow-hidden relative"
            >
              <ng-container *ngIf="color.tallas?.length; else noSizes">
                <span
                  *ngFor="let talla of (color.tallas || []).slice(0, 6)"
                  class="px-2 py-1 text-[10px] font-bold bg-surface-100 dark:bg-surface-800 text-surface-600 dark:text-surface-300 rounded border border-surface-200 dark:border-surface-700"
                  >{{ talla.numero }}</span
                >
                <span
                  *ngIf="(color.tallas?.length || 0) > 6"
                  class="px-2 py-1 text-[10px] font-bold bg-surface-50 dark:bg-surface-800 text-surface-400 rounded border border-dashed border-surface-200 dark:border-surface-700"
                  >+{{ (color.tallas?.length || 0) - 6 }}</span
                >
              </ng-container>
              <ng-template #noSizes>
                <div
                  class="w-full flex flex-col items-center justify-center text-surface-300 dark:text-surface-600 mt-2"
                >
                  <i class="pi pi-box text-lg mb-1"></i
                  ><span class="text-[10px]">Sin stock</span>
                </div>
              </ng-template>
            </div>

            <button
              (click)="verDetallesColor(color)"
              class="w-full py-2 mt-2 rounded-xl bg-surface-50 dark:bg-surface-800 text-xs font-bold text-surface-600 dark:text-surface-300 hover:bg-surface-900 hover:text-white dark:hover:bg-surface-0 dark:hover:text-surface-900 transition-colors opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 duration-200 delay-75"
            >
              Ver Detalles
            </button>
          </div>
        </div>
      </div>

      <ng-template #emptyPalette>
        <div class="flex flex-col items-center justify-center py-24">
          <div
            class="w-24 h-24 bg-surface-50 dark:bg-surface-800 rounded-full flex items-center justify-center mb-6 shadow-sm animate-pulse"
          >
            <i
              class="pi pi-palette text-4xl text-surface-300 dark:text-surface-600"
            ></i>
          </div>
          <h3
            class="text-xl font-bold text-surface-900 dark:text-surface-0 mb-2"
          >
            Lienzo en blanco
          </h3>
          <p
            class="text-surface-500 dark:text-surface-400 max-w-sm text-center mb-8"
          >
            {{
              productoSeleccionadoFiltro
                ? "El producto seleccionado no tiene variantes de color."
                : "No hay colores registrados en el sistema."
            }}
          </p>
          <button
            *appHasPermission="{
              module: 'colores',
              permission: permissionTypes.CREATE,
            }"
            (click)="openNew()"
            class="px-6 py-3 bg-surface-900 dark:bg-surface-0 text-white dark:text-surface-900 rounded-xl font-bold hover:shadow-lg hover:-translate-y-1 transition-all duration-300 flex items-center gap-2"
          >
            <i class="pi pi-plus"></i>
            Crear Primera Variante
          </button>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!-- Vista de Tabla -->
<div *ngIf="currentView === 'table'" class="mb-8 animate-fade-in">
  <div
    class="bg-white dark:bg-surface-900 border border-surface-200 dark:border-surface-800 rounded-[2rem] overflow-hidden shadow-sm"
  >
    <p-table
      #dt
      [value]="coloresFiltrados"
      [rows]="10"
      [paginator]="true"
      [totalRecords]="coloresFiltrados.length"
      [globalFilterFields]="['nombre', 'codigoHex']"
      [(selection)]="selectedColores"
      [rowHover]="true"
      dataKey="id"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="{first} - {last} de {totalRecords}"
      [rowsPerPageOptions]="[5, 10, 20]"
      [loading]="loading"
      [tableStyle]="{ 'min-width': '75rem' }"
      styleClass="p-datatable-lg p-datatable-gridlines-none"
    >
      <ng-template pTemplate="caption">
        <div
          class="flex flex-col md:flex-row md:items-center justify-between gap-4 px-6 py-5 bg-white dark:bg-surface-900 border-b border-surface-100 dark:border-surface-800"
        >
          <div class="flex items-center gap-3">
            <div
              class="w-10 h-10 rounded-full bg-surface-50 dark:bg-surface-800 flex items-center justify-center text-surface-400"
            >
              <i class="pi pi-list"></i>
            </div>
            <div>
              <h3
                class="text-base font-bold text-surface-900 dark:text-surface-0 m-0"
              >
                Listado Maestro
              </h3>
              <p class="text-xs text-surface-500 dark:text-surface-400">
                Gestión detallada
              </p>
            </div>
          </div>

          <div class="relative group">
            <i
              class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-surface-400 group-focus-within:text-primary-500 transition-colors"
            ></i>
            <input
              pInputText
              type="text"
              (input)="onGlobalFilter(dt, $event)"
              placeholder="Buscar en la lista..."
              class="pl-10 pr-4 py-2 w-full sm:w-64 bg-surface-50 dark:bg-surface-800 border-none rounded-xl text-sm focus:ring-2 focus:ring-primary-100 dark:focus:ring-primary-900 transition-all shadow-inner"
            />
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr
          class="bg-surface-50/50 dark:bg-surface-900 border-b border-surface-100 dark:border-surface-800"
        >
          <th style="width: 3rem" class="text-center py-4 rounded-tl-2xl">
            <p-tableHeaderCheckbox />
          </th>
          <th
            style="width: 8rem"
            class="text-center py-4 text-xs font-bold text-surface-500 uppercase tracking-wider"
          >
            Muestra
          </th>
          <th
            pSortableColumn="nombre"
            class="py-4 text-xs font-bold text-surface-500 uppercase tracking-wider cursor-pointer hover:text-primary-600 transition-colors"
          >
            <div class="flex items-center gap-2">
              Identidad
              <p-sortIcon field="nombre" />
            </div>
          </th>
          <th
            pSortableColumn="codigoHex"
            class="py-4 text-xs font-bold text-surface-500 uppercase tracking-wider cursor-pointer hover:text-primary-600 transition-colors"
          >
            <div class="flex items-center gap-2">
              Código Visual
              <p-sortIcon field="codigoHex" />
            </div>
          </th>
          <th
            class="py-4 text-xs font-bold text-surface-500 uppercase tracking-wider text-center"
          >
            Inventario
          </th>
          <th
            class="py-4 text-xs font-bold text-surface-500 uppercase tracking-wider text-center"
          >
            Estado
          </th>
          <th
            style="width: 10rem"
            class="py-4 text-center rounded-tr-2xl text-xs font-bold text-surface-500 uppercase tracking-wider"
          >
            Acciones
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-color>
        <tr
          class="group border-b border-surface-50 dark:border-surface-800 hover:bg-surface-50 dark:hover:bg-surface-800/50 transition-all duration-200"
        >
          <td class="text-center py-4">
            <p-tableCheckbox [value]="color" />
          </td>

          <td class="text-center py-4">
            <div
              class="relative inline-block cursor-pointer"
              (click)="verDetallesColor(color)"
            >
              <div
                class="w-10 h-10 rounded-full shadow-sm border border-surface-100 dark:border-surface-700 transition-transform group-hover:scale-110 relative z-10"
                [style.background-color]="color.codigoHex || 'transparent'"
              ></div>
              <div
                class="absolute inset-0 rounded-full blur-md opacity-0 group-hover:opacity-40 transition-opacity duration-300"
                [style.background-color]="color.codigoHex"
              ></div>
            </div>
          </td>

          <td class="py-4">
            <div class="flex flex-col">
              <span
                class="font-bold text-surface-900 dark:text-surface-0 text-sm group-hover:text-primary-600 transition-colors cursor-pointer"
                (click)="verDetallesColor(color)"
              >
                {{ color.nombre }}
              </span>
              <span class="text-[10px] text-surface-400 font-mono mt-0.5"
                >ID: #{{ color.id }}</span
              >
            </div>
          </td>

          <td class="py-4">
            <div
              class="flex items-center gap-2 group/code cursor-pointer"
              (click)="copiarHex(color.codigoHex)"
            >
              <span
                class="font-mono text-xs font-medium text-surface-600 dark:text-surface-300 bg-surface-100 dark:bg-surface-800 px-2 py-1 rounded-md border border-transparent group-hover/code:border-surface-200 dark:group-hover/code:border-surface-700 transition-all"
              >
                {{ color.codigoHex || "---" }}
              </span>
              <i
                class="pi pi-copy text-[10px] text-surface-300 opacity-0 group-hover/code:opacity-100 transition-opacity"
              ></i>
            </div>
          </td>

          <td class="py-4">
            <div
              class="flex flex-wrap gap-1 justify-center"
              *ngIf="color.tallas?.length; else sinTallas"
            >
              <span
                *ngFor="let talla of color.tallas.slice(0, 4)"
                class="inline-flex items-center justify-center px-2 py-0.5 text-[10px] font-bold bg-white dark:bg-surface-700 text-surface-600 dark:text-surface-200 border border-surface-200 dark:border-surface-600 rounded"
              >
                {{ talla.numero }}
              </span>
              <span
                *ngIf="color.tallas.length > 4"
                class="inline-flex items-center justify-center px-2 py-0.5 text-[10px] font-bold bg-surface-100 dark:bg-surface-800 text-surface-500 rounded border border-transparent"
              >
                +{{ color.tallas.length - 4 }}
              </span>
            </div>
            <ng-template #sinTallas>
              <div class="flex justify-center">
                <span class="text-[10px] text-surface-400 italic"
                  >-- Vacío --</span
                >
              </div>
            </ng-template>
          </td>

          <td class="text-center py-4">
            <div
              class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full border"
              [ngClass]="
                color.tallas?.length > 0
                  ? 'bg-emerald-50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-900/30 text-emerald-600 dark:text-emerald-400'
                  : 'bg-surface-50 dark:bg-surface-800 border-surface-200 dark:border-surface-700 text-surface-400'
              "
            >
              <span
                class="w-1.5 h-1.5 rounded-full"
                [ngClass]="
                  color.tallas?.length > 0 ? 'bg-emerald-500' : 'bg-surface-400'
                "
              ></span>
              <span class="text-[10px] font-bold"
                >{{ color.tallas?.length || 0 }} u.</span
              >
            </div>
          </td>

          <td class="py-4 text-center">
            <div
              class="flex gap-1 justify-center opacity-40 group-hover:opacity-100 transition-opacity duration-200"
            >
              <button
                (click)="verDetallesColor(color)"
                class="w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all"
                pTooltip="Ver"
                tooltipPosition="top"
              >
                <i class="pi pi-eye text-sm"></i>
              </button>

              <button
                *appHasPermission="{
                  module: 'colores',
                  permission: permissionTypes.EDIT,
                }"
                (click)="editColor(color)"
                class="w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:text-surface-900 dark:hover:text-surface-0 hover:bg-surface-100 dark:hover:bg-surface-700 transition-all"
                pTooltip="Editar"
                tooltipPosition="top"
              >
                <i class="pi pi-pencil text-sm"></i>
              </button>

              <button
                *appHasPermission="{
                  module: 'colores',
                  permission: permissionTypes.DELETE,
                }"
                (click)="eliminarColor(color)"
                class="w-8 h-8 flex items-center justify-center rounded-lg text-surface-400 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 transition-all"
                pTooltip="Eliminar"
                tooltipPosition="top"
              >
                <i class="pi pi-trash text-sm"></i>
              </button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center py-24">
            <div class="flex flex-col items-center justify-center">
              <div
                class="w-16 h-16 bg-surface-50 dark:bg-surface-800 rounded-full flex items-center justify-center mb-4"
              >
                <i
                  class="pi pi-filter-slash text-2xl text-surface-300 dark:text-surface-600"
                ></i>
              </div>
              <h4
                class="text-lg font-bold text-surface-900 dark:text-surface-0 mb-1"
              >
                Sin resultados
              </h4>
              <p class="text-surface-500 text-sm">
                No encontramos colores con los filtros actuales.
              </p>
              <button
                *ngIf="productoSeleccionadoFiltro"
                (click)="limpiarFiltros()"
                class="mt-4 text-primary-600 hover:text-primary-700 text-sm font-bold hover:underline"
              >
                Limpiar filtros
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Diálogo premium para crear/editar color -->
<p-dialog
  [(visible)]="visible"
  [style]="{
    width: '1100px',
    maxWidth: '95vw',
    height: 'auto',
    maxHeight: '90vh',
  }"
  [modal]="true"
  (onHide)="hideDialog()"
  [contentStyle]="{
    padding: '0',
    'border-radius': '1.5rem',
    overflow: 'hidden',
  }"
  [draggable]="false"
  [resizable]="false"
  [showHeader]="false"
  [dismissableMask]="true"
  styleClass="app-dialog-zen"
>
  <div
    class="flex justify-between items-center px-8 py-5 bg-white dark:bg-surface-900 border-b border-surface-100 dark:border-surface-800 transition-colors duration-300 sticky top-0 z-50"
  >
    <div class="flex flex-col">
      <h2
        class="text-2xl font-bold text-surface-900 dark:text-surface-0 m-0 tracking-tight flex items-center gap-3"
      >
        {{ editMode ? "Editar Variante" : "Crear Variante" }}
        <span
          class="px-2 py-0.5 rounded-md bg-surface-100 dark:bg-surface-800 text-xs font-mono text-surface-500 font-normal border border-surface-200 dark:border-surface-700"
          *ngIf="color.codigoHex"
        >
          {{ color.codigoHex }}
        </span>
      </h2>
      <span class="text-surface-500 dark:text-surface-400 text-sm mt-0.5">
        Configuración estética y de inventario.
      </span>
    </div>

    <div class="flex items-center gap-2">
      <button
        (click)="hideDialog()"
        class="group w-9 h-9 flex items-center justify-center rounded-full bg-surface-50 dark:bg-surface-800 text-surface-400 hover:bg-surface-100 dark:hover:bg-surface-700 hover:text-surface-900 dark:hover:text-surface-0 transition-all duration-300"
      >
        <i
          class="pi pi-times transition-transform duration-300 group-hover:rotate-90"
        ></i>
      </button>
    </div>
  </div>

  <div
    class="flex flex-col lg:flex-row h-[75vh] bg-surface-0 dark:bg-surface-900 transition-colors duration-300"
  >
    <div
      class="w-full lg:w-5/12 relative bg-surface-50 dark:bg-surface-800/50 p-8 flex flex-col items-center justify-center border-r border-surface-100 dark:border-surface-800 overflow-hidden"
    >
      <div
        class="absolute inset-0 opacity-[0.03] dark:opacity-[0.05] pointer-events-none"
        style="
          background-image: radial-gradient(#6366f1 1px, transparent 1px);
          background-size: 24px 24px;
        "
      ></div>

      <div class="relative group cursor-pointer z-10 mb-8">
        <div
          class="absolute inset-0 rounded-full blur-[60px] opacity-40 transition-all duration-700 ease-in-out group-hover:opacity-60 group-hover:blur-[80px]"
          [style.background-color]="color.codigoHex || 'var(--p-surface-300)'"
        ></div>

        <div
          class="w-56 h-56 rounded-full border-[10px] border-white dark:border-surface-900 shadow-2xl transition-transform duration-500 ease-out transform group-hover:scale-105 flex items-center justify-center relative overflow-hidden"
          [style.background-color]="
            color.codigoHex ? color.codigoHex : 'var(--p-surface-0)'
          "
        >
          <div
            *ngIf="!color.codigoHex"
            class="flex flex-col items-center text-surface-300 dark:text-surface-600 animate-pulse z-20"
          >
            <i class="pi pi-palette text-3xl mb-2"></i>
            <span class="text-xs font-medium">Sin Color</span>
          </div>

          <div
            class="absolute top-0 right-0 w-full h-full bg-gradient-to-tr from-transparent via-white/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none z-10"
          ></div>
        </div>

        <button
          (click)="generarColorAleatorio()"
          class="absolute bottom-2 right-2 w-10 h-10 rounded-full bg-white dark:bg-surface-800 shadow-lg border border-surface-100 dark:border-surface-700 flex items-center justify-center text-surface-500 hover:text-primary-600 transition-all hover:scale-110 z-30 tooltip-target"
          pTooltip="Color Aleatorio"
          tooltipPosition="bottom"
        >
          <i class="pi pi-sparkles"></i>
        </button>
      </div>

      <div class="text-center z-10 space-y-2">
        <h3
          class="text-2xl font-bold text-surface-900 dark:text-surface-0 tracking-tight"
        >
          {{ color.nombre || "Nombre del Color" }}
        </h3>

        <div class="flex items-center justify-center gap-2">
          <span
            class="px-3 py-1 rounded-full bg-white dark:bg-surface-900 border border-surface-200 dark:border-surface-700 text-xs font-mono font-medium text-surface-500"
          >
            {{ color.codigoHex || "#??????" }}
          </span>
          <span class="w-1 h-1 rounded-full bg-surface-300"></span>
          <span class="text-sm text-surface-500">
            {{ tallas.length }} tallas activas
          </span>
        </div>
      </div>

      <div class="mt-8 flex gap-3" *ngIf="!editMode">
        <button
          *ngFor="let preset of coloresPreset.slice(0, 5); let i = index"
          class="w-8 h-8 rounded-full border-2 border-white dark:border-surface-800 shadow-sm transition-all duration-300 hover:-translate-y-1 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2"
          [style.background-color]="preset.hex"
          [title]="preset.nombre"
          (click)="aplicarColorPreset(preset)"
        ></button>
      </div>
    </div>

    <div
      class="w-full lg:w-7/12 p-10 h-full overflow-y-auto custom-scrollbar relative"
    >
      <section class="mb-12" *ngIf="!editMode">
        <h4
          class="text-xs font-bold text-surface-400 uppercase tracking-widest mb-4 flex items-center gap-2"
        >
          <i class="pi pi-box"></i> Producto Base
        </h4>

        <div *ngIf="!productoSeleccionadoFiltro">
          <p-select
            [options]="productos"
            [(ngModel)]="productoSeleccionado"
            optionLabel="codigo"
            placeholder="Buscar por nombre o código..."
            [filter]="true"
            filterBy="nombre,codigo"
            [showClear]="true"
            styleClass="w-full border-0 bg-surface-50 dark:bg-surface-800 text-surface-900 dark:text-surface-0 rounded-xl px-4 py-3 shadow-sm hover:bg-surface-100 transition-colors text-lg"
            appendTo="body"
          >
            <ng-template pTemplate="selectedItem">
              <div *ngIf="productoSeleccionado" class="flex items-center gap-3">
                <div
                  class="w-8 h-8 bg-surface-200 rounded-md flex items-center justify-center text-surface-600"
                >
                  <i class="pi pi-tag"></i>
                </div>
                <div class="flex flex-col">
                  <span
                    class="font-bold text-surface-900 dark:text-surface-0 leading-none"
                    >{{ productoSeleccionado.codigo }}</span
                  >
                  <span class="text-xs text-surface-500">{{
                    productoSeleccionado.nombre
                  }}</span>
                </div>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex flex-col py-1">
                <span
                  class="font-bold text-surface-800 dark:text-surface-100"
                  >{{ item.codigo }}</span
                >
                <span class="text-xs text-surface-500 dark:text-surface-400">{{
                  item.nombre
                }}</span>
              </div>
            </ng-template>
          </p-select>
        </div>

        <div
          *ngIf="productoSeleccionadoFiltro"
          class="bg-surface-50 dark:bg-surface-800 rounded-2xl p-5 border border-surface-100 dark:border-surface-700 flex items-center gap-5"
        >
          <div
            class="w-12 h-12 bg-white dark:bg-surface-700 rounded-xl flex items-center justify-center text-primary-600 dark:text-primary-400 shadow-sm text-xl"
          >
            <i class="pi pi-box"></i>
          </div>
          <div>
            <h5
              class="font-bold text-surface-900 dark:text-surface-0 text-lg m-0"
            >
              {{ productoSeleccionadoFiltro.codigo }}
            </h5>
            <p class="text-sm text-surface-500 dark:text-surface-400 m-0">
              {{ productoSeleccionadoFiltro.nombre }}
            </p>
          </div>
        </div>
      </section>

      <section class="mb-12">
        <h4
          class="text-xs font-bold text-surface-400 uppercase tracking-widest mb-6 flex items-center gap-2"
        >
          <i class="pi pi-palette"></i> Definición
        </h4>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="flex flex-col gap-3 group">
            <label
              class="text-sm font-medium text-surface-700 dark:text-surface-300"
              >Nombre Comercial</label
            >
            <input
              type="text"
              pInputText
              [(ngModel)]="color.nombre"
              placeholder="Ej. Azul Marino Profundo"
              class="w-full h-12 bg-surface-0 dark:bg-surface-900 border border-surface-200 dark:border-surface-700 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 text-surface-900 dark:text-surface-0 rounded-xl px-4 transition-all"
            />
            <button
              *ngIf="color.codigoHex && !color.nombre"
              (click)="color.nombre = getNombreColorSugerido(color.codigoHex)"
              class="text-xs text-primary-600 dark:text-primary-400 text-left hover:underline flex items-center gap-1 ml-1"
            >
              <i class="pi pi-bolt text-[10px]"></i> Autocompletar nombre
            </button>
          </div>

          <div class="flex flex-col gap-3">
            <label
              class="text-sm font-medium text-surface-700 dark:text-surface-300"
              >Código Visual</label
            >
            <div class="flex items-center gap-3">
              <p-colorPicker
                [(ngModel)]="color.codigoHex"
                appendTo="body"
                styleClass="color-picker-premium"
              ></p-colorPicker>

              <div class="relative flex-1">
                <span
                  class="absolute left-3 top-1/2 -translate-y-1/2 text-surface-400 font-mono"
                  >#</span
                >
                <input
                  type="text"
                  pInputText
                  [(ngModel)]="color.codigoHex"
                  class="w-full h-12 bg-surface-0 dark:bg-surface-900 border border-surface-200 dark:border-surface-700 focus:border-primary-500 text-surface-900 dark:text-surface-0 font-mono rounded-xl pl-7"
                  maxlength="7"
                />
              </div>
            </div>
          </div>
        </div>
      </section>

      <section>
        <div class="flex justify-between items-end mb-5">
          <h4
            class="text-xs font-bold text-surface-400 uppercase tracking-widest flex items-center gap-2"
          >
            <i class="pi pi-tags"></i> Tallas
          </h4>
        </div>

        <div class="relative mb-6">
          <input
            type="text"
            pInputText
            [(ngModel)]="nuevaTalla"
            placeholder="Escribe talla y presiona Enter..."
            (keyup.enter)="agregarTalla()"
            class="w-full h-14 bg-surface-50 dark:bg-surface-800 border-none hover:bg-surface-100 dark:hover:bg-surface-700 focus:bg-white dark:focus:bg-surface-900 focus:ring-2 focus:ring-primary-500/20 text-lg rounded-2xl px-5 transition-all shadow-inner"
          />
          <button
            (click)="agregarTalla()"
            [disabled]="!nuevaTalla"
            class="absolute right-2 top-2 h-10 w-10 bg-surface-900 dark:bg-surface-0 text-white dark:text-surface-900 rounded-xl flex items-center justify-center hover:scale-105 active:scale-95 disabled:opacity-0 transition-all duration-300 shadow-lg"
          >
            <i class="pi pi-plus font-bold"></i>
          </button>
        </div>

        <div class="mb-8 flex gap-2 overflow-x-auto pb-2 custom-scrollbar">
          <button
            *ngFor="let cat of tallaCategories"
            (click)="agregarTallasCategoria(cat)"
            class="flex-shrink-0 px-4 py-2 rounded-xl border border-surface-200 dark:border-surface-700 bg-white dark:bg-surface-900 text-xs font-bold text-surface-600 dark:text-surface-300 hover:border-primary-500 hover:text-primary-600 transition-all flex items-center gap-2 group"
          >
            <i
              [class]="cat.icon"
              class="text-surface-400 group-hover:text-primary-500 transition-colors"
            ></i>
            {{ cat.label }}
          </button>
        </div>

        <div
          class="bg-surface-50 dark:bg-surface-800/50 rounded-3xl p-6 min-h-[120px] border border-dashed border-surface-200 dark:border-surface-700"
        >
          <div
            *ngIf="tallas.length === 0"
            class="h-full flex flex-col items-center justify-center text-surface-400 gap-3 py-6"
          >
            <div
              class="w-16 h-16 bg-surface-100 dark:bg-surface-800 rounded-full flex items-center justify-center"
            >
              <i class="pi pi-inbox text-2xl opacity-40"></i>
            </div>
            <span class="text-sm font-medium"
              >No hay tallas configuradas aún</span
            >
          </div>

          <div class="flex flex-wrap gap-3">
            <div
              *ngFor="let talla of tallas; let i = index"
              class="group relative flex items-center justify-center min-w-[3.5rem] px-4 py-3 bg-white dark:bg-surface-900 border border-surface-100 dark:border-surface-700 rounded-2xl shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 cursor-default select-none animate-scale-in"
            >
              <span
                class="font-bold text-surface-800 dark:text-surface-100 text-lg"
                >{{ talla.numero }}</span
              >

              <button
                (click)="eliminarTalla(i)"
                class="absolute -top-2 -right-2 w-6 h-6 rounded-full bg-red-500 text-white shadow-md flex items-center justify-center opacity-0 group-hover:opacity-100 scale-50 group-hover:scale-100 transition-all duration-200 hover:bg-red-600 z-10"
              >
                <i class="pi pi-times text-[10px] font-bold"></i>
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div
      class="px-8 py-6 bg-white dark:bg-surface-900 border-t border-surface-100 dark:border-surface-800 flex justify-end items-center gap-4 sticky bottom-0 z-50"
    >
      <button
        pButton
        label="Cancelar"
        class="p-button-text text-surface-500 hover:text-surface-900 dark:text-surface-400 dark:hover:text-surface-0 px-6"
        (click)="hideDialog()"
      ></button>
      <button
        pButton
        [label]="editMode ? 'Guardar Cambios' : 'Confirmar Variante'"
        icon="pi pi-check"
        class="bg-surface-900 dark:bg-surface-0 text-white dark:text-surface-900 hover:bg-black dark:hover:bg-surface-200 border-none px-8 py-3 rounded-xl font-bold shadow-xl shadow-surface-200 dark:shadow-none transition-all hover:shadow-2xl hover:-translate-y-0.5 active:translate-y-0"
        (click)="guardarColor()"
        [loading]="loading"
        [disabled]="!color.nombre || tallas.length === 0"
      ></button>
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Detalles del Color -->
<p-dialog
  [(visible)]="detalleColorDialog"
  [style]="{ width: '700px', maxWidth: '95vw' }"
  [modal]="true"
  (onHide)="hideDetalleColorDialog()"
  [contentStyle]="{
    padding: '0',
    'border-radius': '1.5rem',
    overflow: 'hidden',
  }"
  [draggable]="false"
  [resizable]="false"
  [showHeader]="false"
  [dismissableMask]="true"
  styleClass="app-dialog-zen"
>
  <div
    class="relative bg-surface-0 dark:bg-surface-900 px-6 py-4 flex justify-between items-center border-b border-transparent"
  >
    <div class="flex items-center gap-3">
      <span
        class="w-1.5 h-6 rounded-full bg-surface-900 dark:bg-surface-0"
      ></span>
      <div>
        <h2
          class="text-lg font-bold text-surface-900 dark:text-surface-0 m-0 leading-none"
        >
          Detalle de Variante
        </h2>
        <span
          class="text-[10px] text-surface-400 dark:text-surface-500 font-mono mt-1 block uppercase tracking-widest"
          *ngIf="colorDetalle"
        >
          ID: {{ colorDetalle.id }}
        </span>
      </div>
    </div>
    <button
      (click)="hideDetalleColorDialog()"
      class="w-8 h-8 flex items-center justify-center rounded-full text-surface-400 hover:text-surface-900 dark:hover:text-surface-0 hover:bg-surface-100 dark:hover:bg-surface-800 transition-colors"
    >
      <i class="pi pi-times"></i>
    </button>
  </div>

  <div
    *ngIf="loading"
    class="flex flex-col md:flex-row h-[400px] bg-surface-0 dark:bg-surface-900 p-8 gap-8 animate-pulse"
  >
    <div
      class="w-full md:w-5/12 flex flex-col items-center justify-center gap-6"
    >
      <div
        class="w-48 h-48 rounded-full bg-surface-100 dark:bg-surface-800"
      ></div>
      <div class="w-32 h-6 rounded bg-surface-100 dark:bg-surface-800"></div>
      <div class="flex gap-4 mt-2">
        <div class="w-8 h-8 rounded bg-surface-100 dark:bg-surface-800"></div>
        <div class="w-8 h-8 rounded bg-surface-100 dark:bg-surface-800"></div>
        <div class="w-8 h-8 rounded bg-surface-100 dark:bg-surface-800"></div>
      </div>
    </div>
    <div class="w-full md:w-7/12 space-y-6 pt-4">
      <div class="w-40 h-5 rounded bg-surface-100 dark:bg-surface-800"></div>
      <div class="flex gap-2">
        <div class="w-12 h-8 rounded bg-surface-100 dark:bg-surface-800"></div>
        <div class="w-12 h-8 rounded bg-surface-100 dark:bg-surface-800"></div>
        <div class="w-12 h-8 rounded bg-surface-100 dark:bg-surface-800"></div>
      </div>
      <div
        class="w-40 h-5 rounded bg-surface-100 dark:bg-surface-800 mt-8"
      ></div>
      <div class="space-y-2">
        <div
          class="w-full h-12 rounded bg-surface-100 dark:bg-surface-800"
        ></div>
        <div
          class="w-full h-12 rounded bg-surface-100 dark:bg-surface-800"
        ></div>
      </div>
    </div>
  </div>

  <div
    *ngIf="!loading && colorDetalle"
    class="flex flex-col md:flex-row h-full bg-surface-0 dark:bg-surface-900"
  >
    <div
      class="w-full md:w-5/12 bg-surface-50 dark:bg-surface-800 p-8 flex flex-col items-center justify-center relative border-r border-surface-100 dark:border-surface-700/50"
    >
      <div
        class="relative mb-8 group cursor-pointer"
        (click)="copiarHex(colorDetalle.codigoHex ?? '')"
      >
        <div
          class="absolute inset-0 rounded-full blur-3xl opacity-30 group-hover:opacity-50 transition-all duration-500"
          [style.background-color]="
            colorDetalle.codigoHex || 'var(--p-surface-400)'
          "
        ></div>

        <div
          class="w-48 h-48 rounded-full shadow-2xl border-8 border-surface-0 dark:border-surface-900 relative z-10 flex items-center justify-center overflow-hidden transition-transform duration-300 group-hover:scale-105"
          [style.background-color]="colorDetalle.codigoHex || 'transparent'"
        >
          <span *ngIf="!colorDetalle.codigoHex" class="text-xs text-surface-400"
            >N/A</span
          >

          <div
            class="absolute inset-0 bg-black/20 flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 backdrop-blur-[1px]"
          >
            <i
              class="pi text-white text-2xl drop-shadow-md mb-1"
              [class]="textoCopiado ? 'pi-check text-emerald-400' : 'pi-copy'"
            ></i>
            <span
              class="text-white text-xs font-bold shadow-black drop-shadow-md"
            >
              {{ textoCopiado ? "¡Copiado!" : "Copiar HEX" }}
            </span>
          </div>
        </div>

        <div
          class="absolute -bottom-5 left-1/2 transform -translate-x-1/2 z-20"
        >
          <div
            class="bg-surface-0 dark:bg-surface-900 px-4 py-1.5 rounded-full shadow-lg border border-surface-100 dark:border-surface-700 flex items-center gap-2 group-hover:border-primary-200 transition-colors"
          >
            <div
              class="w-3 h-3 rounded-full border border-surface-200"
              [style.background-color]="colorDetalle.codigoHex"
            ></div>
            <span
              class="font-mono text-sm font-bold text-surface-700 dark:text-surface-200 transition-all duration-300"
              [class.text-emerald-500]="textoCopiado"
            >
              {{ textoCopiado ? "Copiado!" : colorDetalle.codigoHex || "---" }}
            </span>
          </div>
        </div>
      </div>

      <h3
        class="text-xl font-bold text-surface-900 dark:text-surface-0 text-center mt-2 mb-1"
      >
        {{ colorDetalle.nombre }}
      </h3>

      <div
        class="mt-4 flex gap-4 text-xs font-mono text-surface-500 dark:text-surface-400"
        *ngIf="colorDetalle.codigoHex && hexToRgb(colorDetalle.codigoHex)"
      >
        <div class="flex flex-col items-center gap-1">
          <span
            class="font-bold text-surface-900 dark:text-surface-200 text-sm"
            >{{ hexToRgb(colorDetalle.codigoHex)?.r }}</span
          >
          <span class="text-[10px] text-surface-400">R</span>
        </div>
        <div class="w-px h-8 bg-surface-200 dark:bg-surface-700"></div>
        <div class="flex flex-col items-center gap-1">
          <span
            class="font-bold text-surface-900 dark:text-surface-200 text-sm"
            >{{ hexToRgb(colorDetalle.codigoHex)?.g }}</span
          >
          <span class="text-[10px] text-surface-400">G</span>
        </div>
        <div class="w-px h-8 bg-surface-200 dark:bg-surface-700"></div>
        <div class="flex flex-col items-center gap-1">
          <span
            class="font-bold text-surface-900 dark:text-surface-200 text-sm"
            >{{ hexToRgb(colorDetalle.codigoHex)?.b }}</span
          >
          <span class="text-[10px] text-surface-400">B</span>
        </div>
      </div>
    </div>

    <div class="w-full md:w-7/12 p-8 overflow-y-auto">
      <div class="mb-8">
        <div
          class="flex items-center justify-between mb-4 border-b border-surface-100 dark:border-surface-800 pb-2"
        >
          <h4
            class="text-xs font-bold text-surface-400 dark:text-surface-500 uppercase tracking-wider flex items-center gap-2"
          >
            <i class="pi pi-th-large text-primary-500"></i> Inventario de Tallas
          </h4>
          <span
            class="text-xs font-medium bg-surface-100 dark:bg-surface-800 text-surface-600 dark:text-surface-300 px-2 py-0.5 rounded"
          >
            {{ colorDetalle.tallas?.length || 0 }} u.
          </span>
        </div>

        <div
          *ngIf="colorDetalle.tallas?.length; else sinTallas"
          class="flex flex-wrap gap-2"
        >
          <span
            *ngFor="let talla of colorDetalle.tallas"
            class="inline-flex items-center justify-center min-w-[3.5rem] px-3 py-2 rounded-lg border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-800 text-sm font-bold text-surface-700 dark:text-surface-200 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200 cursor-default select-none"
          >
            {{ talla.numero }}
          </span>
        </div>

        <ng-template #sinTallas>
          <div
            class="flex flex-col items-center justify-center py-8 border-2 border-dashed border-surface-100 dark:border-surface-800 rounded-xl bg-surface-50/50 dark:bg-surface-900/50"
          >
            <i
              class="pi pi-box text-surface-300 dark:text-surface-600 text-2xl mb-2"
            ></i>
            <span
              class="text-sm text-surface-400 dark:text-surface-500 font-medium"
              >No hay tallas configuradas</span
            >
          </div>
        </ng-template>
      </div>

      <div *ngIf="getColoresSimilares(colorDetalle).length > 0">
        <h4
          class="text-xs font-bold text-surface-400 dark:text-surface-500 uppercase tracking-wider mb-3 flex items-center gap-2"
        >
          <i class="pi pi-palette text-surface-400"></i> Variantes Similares
        </h4>
        <div class="flex flex-col gap-2">
          <div
            *ngFor="let similar of getColoresSimilares(colorDetalle)"
            class="flex items-center gap-3 p-3 rounded-xl border border-transparent hover:border-surface-200 dark:hover:border-surface-700 hover:bg-surface-50 dark:hover:bg-surface-800 transition-all cursor-pointer group"
          >
            <div
              class="w-8 h-8 rounded-lg shadow-sm border border-surface-100 dark:border-surface-700"
              [style.background-color]="similar.codigoHex"
            ></div>
            <div class="flex flex-col">
              <span
                class="text-sm font-bold text-surface-700 dark:text-surface-200 group-hover:text-surface-900 dark:group-hover:text-surface-0"
              >
                {{ similar.nombre }}
              </span>
              <span class="text-[10px] text-surface-400 font-mono">{{
                similar.codigoHex
              }}</span>
            </div>
            <i
              class="pi pi-arrow-right ml-auto text-xs text-surface-300 dark:text-surface-600 group-hover:translate-x-1 transition-transform"
            ></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div
      class="px-6 py-4 bg-surface-0 dark:bg-surface-900 border-t border-surface-100 dark:border-surface-800 flex justify-end gap-3 transition-colors duration-300"
    >
      <p-button
        pButton
        label="Cerrar"
        class="p-button-text text-surface-500 hover:text-surface-900 dark:text-surface-400 dark:hover:text-surface-0 font-medium"
        (click)="hideDetalleColorDialog()"
      />
      <p-button
        *appHasPermission="{
          module: 'colores',
          permission: permissionTypes.EDIT,
        }"
        pButton
        label="Editar Variante"
        icon="pi pi-pencil"
        class="bg-surface-900 dark:bg-surface-0 text-surface-0 dark:text-surface-900 hover:bg-black dark:hover:bg-surface-200 border-none px-5 py-2.5 rounded-lg font-bold text-sm shadow-lg transition-all duration-200 transform active:scale-95"
        (click)="editColor(colorDetalle!); hideDetalleColorDialog()"
      />
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Estadísticas -->
<p-dialog
  [(visible)]="estadisticasDialog"
  [style]="{ width: '1100px', maxWidth: '95vw', height: '85vh' }"
  [modal]="true"
  (onHide)="hideEstadisticasDialog()"
  [contentStyle]="{
    padding: '0',
    'border-radius': '1.5rem',
    overflow: 'hidden',
  }"
  [draggable]="false"
  [resizable]="false"
  [showHeader]="false"
  [dismissableMask]="true"
  styleClass="app-dialog-zen"
>
  <div
    class="flex justify-between items-center px-8 py-5 bg-surface-0 dark:bg-surface-900 border-b border-surface-100 dark:border-surface-800 transition-colors duration-300 sticky top-0 z-50"
  >
    <div class="flex items-center gap-4">
      <div
        class="w-10 h-10 rounded-full bg-surface-50 dark:bg-surface-800 flex items-center justify-center text-primary-500"
      >
        <i class="pi pi-chart-pie text-xl"></i>
      </div>
      <div class="flex flex-col">
        <h2
          class="text-xl font-bold text-surface-900 dark:text-surface-0 m-0 tracking-tight"
        >
          Análisis de Inventario
        </h2>
        <span class="text-surface-500 dark:text-surface-400 text-sm mt-0.5">
          Métricas de colores y tallas en tiempo real.
        </span>
      </div>
    </div>

    <button
      (click)="hideEstadisticasDialog()"
      class="group w-9 h-9 flex items-center justify-center rounded-full bg-surface-50 dark:bg-surface-800 text-surface-400 hover:bg-surface-100 dark:hover:bg-surface-700 hover:text-surface-900 dark:hover:text-surface-0 transition-all duration-300"
    >
      <i
        class="pi pi-times transition-transform duration-300 group-hover:rotate-90"
      ></i>
    </button>
  </div>

  <div
    class="h-full bg-surface-50 dark:bg-surface-900/50 overflow-y-auto custom-scrollbar p-8 transition-colors duration-300"
  >
    <div *ngIf="coloresFiltrados?.length; else noEstadisticas">
      <p-tabView styleClass="zen-tabs">
        <p-tabPanel header="Panorama">
          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 mt-2"
          >
            <div
              class="bg-surface-0 dark:bg-surface-900 p-6 rounded-3xl border border-surface-100 dark:border-surface-800 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-default"
            >
              <div class="flex justify-between items-start mb-4">
                <span
                  class="text-xs font-bold text-surface-400 uppercase tracking-widest"
                  >Colores</span
                >
                <i
                  class="pi pi-palette text-purple-500 bg-purple-50 dark:bg-purple-900/20 p-2 rounded-lg group-hover:scale-110 transition-transform"
                ></i>
              </div>
              <div class="flex items-baseline gap-2">
                <span
                  class="text-4xl font-bold text-surface-900 dark:text-surface-0"
                  >{{ calcularEstadisticas().totalColores }}</span
                >
                <span class="text-xs text-surface-500 font-medium"
                  >variantes</span
                >
              </div>
            </div>

            <div
              class="bg-surface-0 dark:bg-surface-900 p-6 rounded-3xl border border-surface-100 dark:border-surface-800 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-default"
            >
              <div class="flex justify-between items-start mb-4">
                <span
                  class="text-xs font-bold text-surface-400 uppercase tracking-widest"
                  >Tallas Únicas</span
                >
                <i
                  class="pi pi-tags text-orange-500 bg-orange-50 dark:bg-orange-900/20 p-2 rounded-lg group-hover:scale-110 transition-transform"
                ></i>
              </div>
              <div class="flex items-baseline gap-2">
                <span
                  class="text-4xl font-bold text-surface-900 dark:text-surface-0"
                  >{{ calcularEstadisticas().totalTallas }}</span
                >
                <span class="text-xs text-surface-500 font-medium">tipos</span>
              </div>
            </div>

            <div
              class="bg-surface-0 dark:bg-surface-900 p-6 rounded-3xl border border-surface-100 dark:border-surface-800 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-default"
            >
              <div class="flex justify-between items-start mb-4">
                <span
                  class="text-xs font-bold text-surface-400 uppercase tracking-widest"
                  >Stock Total</span
                >
                <i
                  class="pi pi-box text-blue-500 bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg group-hover:scale-110 transition-transform"
                ></i>
              </div>
              <div class="flex items-baseline gap-2">
                <span
                  class="text-4xl font-bold text-surface-900 dark:text-surface-0"
                  >{{ calcularEstadisticas().combinaciones }}</span
                >
                <span class="text-xs text-surface-500 font-medium">SKUs</span>
              </div>
            </div>

            <div
              class="bg-surface-0 dark:bg-surface-900 p-6 rounded-3xl border border-surface-100 dark:border-surface-800 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-default"
            >
              <div class="flex justify-between items-start mb-4">
                <span
                  class="text-xs font-bold text-surface-400 uppercase tracking-widest"
                  >Densidad</span
                >
                <i
                  class="pi pi-chart-line text-emerald-500 bg-emerald-50 dark:bg-emerald-900/20 p-2 rounded-lg group-hover:scale-110 transition-transform"
                ></i>
              </div>
              <div class="flex items-baseline gap-2">
                <span
                  class="text-4xl font-bold text-surface-900 dark:text-surface-0"
                  >{{
                    calcularEstadisticas().combinaciones /
                      calcularEstadisticas().totalColores | number: "1.1-1"
                  }}</span
                >
                <span class="text-xs text-surface-500 font-medium"
                  >tallas / color</span
                >
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div
              class="bg-surface-0 dark:bg-surface-900 rounded-3xl p-6 border border-surface-100 dark:border-surface-800 shadow-sm h-full"
            >
              <h4
                class="text-sm font-bold text-surface-900 dark:text-surface-0 mb-6 flex items-center gap-2"
              >
                <span class="w-1.5 h-6 rounded-full bg-purple-500"></span>
                Top Variantes (Inventario)
              </h4>

              <div class="space-y-4">
                <div
                  *ngFor="
                    let item of calcularEstadisticas().coloresPopulares.slice(
                      0,
                      5
                    );
                    let i = index
                  "
                  class="flex items-center justify-between group hover:bg-surface-50 dark:hover:bg-surface-800 p-2 rounded-xl transition-colors"
                >
                  <div class="flex items-center gap-4">
                    <span class="text-xs font-bold text-surface-400 w-4">{{
                      i + 1
                    }}</span>
                    <div
                      class="w-10 h-10 rounded-full shadow-sm border border-surface-100 dark:border-surface-700 transition-transform group-hover:scale-110"
                      [style.background-color]="item.color.codigoHex"
                    ></div>
                    <div>
                      <div
                        class="font-bold text-surface-900 dark:text-surface-0 text-sm"
                      >
                        {{ item.color.nombre }}
                      </div>
                      <div class="text-[10px] text-surface-400 font-mono">
                        {{ item.color.codigoHex }}
                      </div>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span
                      class="font-bold text-surface-900 dark:text-surface-0"
                      >{{ item.count }}</span
                    >
                    <span class="text-xs text-surface-400">tallas</span>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="bg-surface-0 dark:bg-surface-900 rounded-3xl p-6 border border-surface-100 dark:border-surface-800 shadow-sm h-full"
            >
              <h4
                class="text-sm font-bold text-surface-900 dark:text-surface-0 mb-6 flex items-center gap-2"
              >
                <span class="w-1.5 h-6 rounded-full bg-orange-500"></span>
                Tallas más Frecuentes
              </h4>

              <div class="space-y-4">
                <div
                  *ngFor="
                    let item of calcularEstadisticas().tallasPopulares.slice(
                      0,
                      5
                    );
                    let i = index
                  "
                  class="flex items-center justify-between group hover:bg-surface-50 dark:hover:bg-surface-800 p-2 rounded-xl transition-colors"
                >
                  <div class="flex items-center gap-4">
                    <span class="text-xs font-bold text-surface-400 w-4">{{
                      i + 1
                    }}</span>
                    <div
                      class="w-10 h-10 rounded-lg bg-surface-50 dark:bg-surface-800 border border-surface-200 dark:border-surface-700 flex items-center justify-center font-bold text-surface-700 dark:text-surface-200 shadow-sm group-hover:shadow-md transition-all"
                    >
                      {{ item.talla }}
                    </div>
                    <span
                      class="text-sm font-medium text-surface-600 dark:text-surface-300"
                      >Talla Estándar</span
                    >
                  </div>

                  <div class="flex items-center gap-3 flex-1 justify-end">
                    <div
                      class="w-24 h-1.5 bg-surface-100 dark:bg-surface-800 rounded-full overflow-hidden"
                    >
                      <div
                        class="h-full bg-orange-500 rounded-full"
                        [style.width.%]="
                          (item.count / calcularEstadisticas().totalColores) *
                          100
                        "
                      ></div>
                    </div>
                    <span
                      class="text-xs font-bold text-surface-900 dark:text-surface-0 w-8 text-right"
                      >{{ item.count }}</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </p-tabPanel>

        <p-tabPanel header="Segmentación">
          <div
            class="bg-surface-0 dark:bg-surface-900 rounded-3xl p-8 border border-surface-100 dark:border-surface-800 shadow-sm mt-2"
          >
            <h3
              class="text-lg font-bold text-surface-900 dark:text-surface-0 mb-6"
            >
              Distribución por Categorías
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <div
                *ngFor="let dist of calcularEstadisticas().distribucionTallas"
                class="relative p-6 rounded-2xl bg-surface-50 dark:bg-surface-800/50 hover:bg-white dark:hover:bg-surface-800 border border-transparent hover:border-surface-200 dark:hover:border-surface-700 hover:shadow-lg transition-all duration-300 group"
              >
                <div class="flex justify-between items-start mb-4">
                  <div
                    class="w-10 h-10 rounded-full bg-primary-50 dark:bg-primary-900/20 flex items-center justify-center text-primary-600 dark:text-primary-400"
                  >
                    <i
                      class="pi"
                      [ngClass]="
                        dist.categoria.includes('XS') ? 'pi-users' : 'pi-tag'
                      "
                    ></i>
                  </div>
                  <span
                    class="text-2xl font-bold text-surface-900 dark:text-surface-0"
                    >{{ dist.count }}</span
                  >
                </div>

                <div class="mb-3">
                  <div
                    class="text-sm font-bold text-surface-700 dark:text-surface-200"
                  >
                    {{ dist.categoria }}
                  </div>
                  <div class="text-xs text-surface-500">Tallas registradas</div>
                </div>

                <div
                  class="w-full bg-surface-200 dark:bg-surface-700 rounded-full h-1.5 overflow-hidden"
                >
                  <div
                    class="h-full bg-primary-500 rounded-full transition-all duration-1000 ease-out group-hover:bg-primary-400"
                    [style.width.%]="
                      (dist.count / calcularEstadisticas().totalTallas) * 100
                    "
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </p-tabPanel>

        <p-tabPanel header="ADN Visual">
          <div
            class="bg-surface-0 dark:bg-surface-900 rounded-3xl p-8 border border-surface-100 dark:border-surface-800 shadow-sm mt-2"
          >
            <div class="flex justify-between items-center mb-8">
              <h3
                class="text-lg font-bold text-surface-900 dark:text-surface-0"
              >
                Mapa de Colores
              </h3>
              <span
                class="text-xs text-surface-500 bg-surface-100 dark:bg-surface-800 px-3 py-1 rounded-full"
              >
                {{ coloresFiltrados.length }} tonos únicos
              </span>
            </div>

            <div class="flex flex-wrap gap-6 justify-center">
              <div
                *ngFor="let color of coloresFiltrados"
                class="group flex flex-col items-center"
              >
                <div class="relative mb-3">
                  <div
                    class="w-16 h-16 rounded-full shadow-md border-4 border-surface-0 dark:border-surface-900 cursor-pointer transition-transform duration-300 group-hover:scale-110 group-hover:shadow-xl z-10 relative"
                    [style.background-color]="color.codigoHex || '#ccc'"
                    pTooltip="{{ color.nombre }} ({{
                      color.tallas?.length
                    }} tallas)"
                    tooltipPosition="top"
                  >
                    <div
                      class="absolute inset-0 rounded-full bg-black/10 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"
                    >
                      <span class="text-[10px] text-white font-bold">{{
                        color.tallas?.length
                      }}</span>
                    </div>
                  </div>

                  <div
                    class="absolute inset-0 rounded-full blur-xl opacity-0 group-hover:opacity-40 transition-opacity duration-300"
                    [style.background-color]="color.codigoHex"
                  ></div>
                </div>

                <span
                  class="text-xs font-bold text-surface-700 dark:text-surface-200 max-w-[80px] truncate text-center block group-hover:text-primary-600 transition-colors"
                >
                  {{ color.nombre }}
                </span>
                <span
                  class="text-[10px] text-surface-400 font-mono opacity-0 group-hover:opacity-100 transition-opacity -mt-1"
                >
                  {{ color.codigoHex }}
                </span>
              </div>
            </div>
          </div>
        </p-tabPanel>
      </p-tabView>
    </div>

    <ng-template #noEstadisticas>
      <div class="h-full flex flex-col items-center justify-center py-12">
        <div
          class="w-32 h-32 bg-surface-100 dark:bg-surface-800 rounded-full flex items-center justify-center mb-6 animate-pulse"
        >
          <i
            class="pi pi-chart-bar text-5xl text-surface-300 dark:text-surface-600"
          ></i>
        </div>
        <h3
          class="text-2xl font-bold text-surface-900 dark:text-surface-0 mb-2"
        >
          Sin datos de análisis
        </h3>
        <p
          class="text-surface-500 dark:text-surface-400 max-w-md text-center mb-8"
        >
          El sistema generará estadísticas automáticamente cuando agregues
          colores y configures tallas a tus productos.
        </p>
        <button
          pButton
          label="Crear Primera Variante"
          icon="pi pi-plus"
          class="bg-surface-900 dark:bg-surface-0 text-white dark:text-surface-900 border-none rounded-xl px-6 py-3 font-bold"
        ></button>
      </div>
    </ng-template>
  </div>

  <ng-template pTemplate="footer">
    <div
      class="flex justify-between items-center px-8 py-5 bg-surface-0 dark:bg-surface-900 border-t border-surface-100 dark:border-surface-800 sticky bottom-0 z-50"
    >
      <span class="text-xs text-surface-400 font-mono">
        Ult. Actualización: Hoy
      </span>
      <div class="flex gap-3">
        <p-button
          label="Cerrar"
          class="p-button-text text-surface-500 hover:text-surface-900 dark:text-surface-400 dark:hover:text-surface-0"
          (click)="hideEstadisticasDialog()"
        />
        <p-button
          label="Exportar Informe"
          icon="pi pi-download"
          class="bg-surface-900 dark:bg-surface-0 text-white dark:text-surface-900 border-none rounded-xl font-bold shadow-lg hover:shadow-xl transition-all active:scale-95"
          (click)="exportarEstadisticas()"
        />
      </div>
    </div>
  </ng-template>
</p-dialog>
