<p-toast position="top-right" [life]="4000" />
<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>

<!-- Header premium con dashboard metrics -->
<div class="mb-6">
  <!-- Header principal con gradiente y métricas -->
  <div class="bg-gradient-to-r from-white via-green-50 to-white rounded-xl p-6 shadow-sm border border-gray-100">
    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4">
      <!-- Título principal -->
      <div>
        <div class="flex items-center gap-3 mb-2">
          <div class="bg-green-600 p-3 rounded-lg shadow-lg">
            <i class="pi pi-box text-white text-xl"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900 m-0">Gestión de Inventarios</h1>
            <p class="text-gray-600 mt-1 mb-0">Control inteligente de stock y movimientos</p>
          </div>
        </div>
      </div>
      
      <!-- Dashboard metrics avanzado -->
      <div class="flex flex-wrap gap-4">
        <!-- Valor total inventario -->
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 min-w-[140px] inventory-entrance">
          <div class="flex items-center gap-3">
            <div class="bg-green-100 p-2 rounded-lg">
              <i class="pi pi-dollar text-green-600"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-green-600">${{calcularEstadisticas().valorTotalInventario | number:'1.0-0'}}</div>
              <div class="text-sm text-gray-600 font-medium">Valor Total</div>
            </div>
          </div>
        </div>
        
        <!-- Total productos -->
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 min-w-[120px] inventory-entrance">
          <div class="flex items-center gap-3">
            <div class="bg-blue-100 p-2 rounded-lg">
              <i class="pi pi-box text-blue-600"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-blue-600">{{ calcularEstadisticas().totalProductos }}</div>
              <div class="text-sm text-gray-600 font-medium">Productos</div>
            </div>
          </div>
        </div>
        
        <!-- Stock crítico -->
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 min-w-[120px] inventory-entrance" 
             [class.pulse-value]="calcularEstadisticas().stockCritico > 0">
          <div class="flex items-center gap-3">
            <div class="bg-orange-100 p-2 rounded-lg">
              <i class="pi pi-exclamation-triangle text-orange-600"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-orange-600">{{ calcularEstadisticas().stockCritico }}</div>
              <div class="text-sm text-gray-600 font-medium">Stock Crítico</div>
            </div>
          </div>
        </div>
        
        <!-- Productos agotados -->
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 min-w-[120px] inventory-entrance"
             [class.pulse-value]="calcularEstadisticas().productosAgotados > 0">
          <div class="flex items-center gap-3">
            <div class="bg-red-100 p-2 rounded-lg">
              <i class="pi pi-times-circle text-red-600"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-red-600">{{ calcularEstadisticas().productosAgotados }}</div>
              <div class="text-sm text-gray-600 font-medium">Agotados</div>
            </div>
          </div>
        </div>
        
        <!-- Eficiencia de stock -->
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 min-w-[120px] inventory-entrance">
          <div class="flex items-center gap-3">
            <div class="bg-purple-100 p-2 rounded-lg">
              <i class="pi pi-chart-line text-purple-600"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-purple-600">{{calcularEstadisticas().eficienciaStock | number:'1.0-0'}}%</div>
              <div class="text-sm text-gray-600 font-medium">Eficiencia</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toolbar moderno con controles avanzados -->
<div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6">
  <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4">
    <!-- Acciones principales -->
    <div class="flex flex-wrap gap-3">
      <p-button 
        *appHasPermission="{module: 'inventario', permission: permissionTypes.CREATE}"
        label="Nuevo Inventario" 
        icon="pi pi-plus" 
        size="large"
        class="shadow-sm hover:shadow-md transition-all duration-300" 
        (click)="openNew()"
        pTooltip="Crear nuevo registro de inventario"
      />
      <p-button 
        *appHasPermission="{module: 'inventario', permission: permissionTypes.DELETE}"
        [label]="'Eliminar (' + (selectedInventarios.length || 0) + ')'" 
        icon="pi pi-trash" 
        severity="danger"
        [outlined]="true"
        size="large"
        class="shadow-sm hover:shadow-md transition-all duration-300" 
        (click)="deleteSelectedInventarios()" 
        [disabled]="!selectedInventarios.length || !productoSeleccionadoFiltro"
        pTooltip="Eliminar registros seleccionados"
      />
      <p-button 
        label="Análisis ABC" 
        icon="pi pi-sort-amount-down" 
        severity="info"
        [outlined]="true"
        size="large"
        class="shadow-sm hover:shadow-md transition-all duration-300" 
        (click)="mostrarAnalisisAbc()"
        pTooltip="Análisis ABC de inventarios"
      />
      <p-button 
        label="Movimientos" 
        icon="pi pi-history" 
        severity="secondary"
        [outlined]="true"
        size="large"
        class="shadow-sm hover:shadow-md transition-all duration-300" 
        (click)="mostrarMovimientos()"
        pTooltip="Historial de movimientos"
      />
      <p-button 
        label="Alertas" 
        icon="pi pi-bell" 
        severity="danger"
        [outlined]="true"
        size="large"
        class="shadow-sm hover:shadow-md transition-all duration-300" 
        [badge]="calcularEstadisticas().alertasCriticas.length.toString()"
        badgeClass="p-badge-danger"
        (click)="mostrarAlertas()"
        pTooltip="Ver alertas críticas"
      />
    </div>

    <!-- Controles de vista y utilidades -->
    <div class="flex flex-wrap items-center gap-3">
      <!-- Selector de vista -->
      <div class="flex items-center gap-2">
        <span class="text-sm font-medium text-gray-700">Vista:</span>
        <p-selectButton 
          [(ngModel)]="currentView" 
          [options]="viewOptions" 
          optionLabel="label" 
          optionValue="value"
          size="small"
          class="shadow-sm"
        >
          <ng-template let-option pTemplate="option">
            <i [class]="option.icon" class="mr-2"></i>
            {{option.label}}
          </ng-template>
        </p-selectButton>
      </div>

      <!-- Utilidades -->
      <div class="flex gap-2">
        <p-button 
          icon="pi pi-chart-bar" 
          severity="info" 
          [outlined]="true"
          [rounded]="true"
          size="large"
          pTooltip="Ver estadísticas"
          class="shadow-sm hover:shadow-md transition-all duration-300"
          (click)="mostrarEstadisticas()"
        />
        <p-button 
          icon="pi pi-filter" 
          severity="secondary" 
          [outlined]="true"
          [rounded]="true"
          size="large"
          pTooltip="Filtros avanzados"
          class="shadow-sm hover:shadow-md transition-all duration-300"
          (click)="mostrarFiltros()"
        />
        <p-button 
          icon="pi pi-download" 
          severity="success" 
          [outlined]="true"
          [rounded]="true"
          size="large"
          pTooltip="Exportar a Excel"
          class="shadow-sm hover:shadow-md transition-all duration-300"
          (click)="exportarExcel()"
          [disabled]="!inventariosFiltrados.length"
        />
        <p-button 
          icon="pi pi-refresh" 
          severity="secondary" 
          [outlined]="true"
          [rounded]="true"
          size="large"
          pTooltip="Actualizar datos"
          class="shadow-sm hover:shadow-md transition-all duration-300"
          (click)="filtrarInventarioPorProducto()" 
        />
      </div>
    </div>
  </div>
</div>

<!-- Vista Dashboard (Principal) -->
<div *ngIf="currentView === 'dashboard'" class="mb-6">
  <!-- Filtro por producto mejorado -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="bg-blue-100 p-2 rounded-lg">
        <i class="pi pi-filter text-blue-600"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-800 m-0">Filtrar por Producto</h3>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div>
        <p-select 
          [options]="productos" 
          [(ngModel)]="productoSeleccionadoFiltro" 
          optionLabel="codigo"
          placeholder="Seleccione un producto para ver su inventario"
          [filter]="true"
          filterBy="nombre,codigo"
          [style]="{'width':'100%'}"
          (onChange)="filtrarInventarioPorProducto()"
          [showClear]="true"
          styleClass="h-12"
        >
          <ng-template pTemplate="selectedItem">
            <div *ngIf="productoSeleccionadoFiltro" class="flex items-center gap-3">
              <div class="bg-blue-100 p-2 rounded-lg">
                <i class="pi pi-tag text-blue-600"></i>
              </div>
              <div>
                <div class="font-medium">{{productoSeleccionadoFiltro.codigo}} - {{productoSeleccionadoFiltro.nombre}}</div>
                <small class="text-gray-500">{{productoSeleccionadoFiltro.nombre}} - Precio: S/. {{productoSeleccionadoFiltro.precioVenta}}</small>
              </div>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex items-center gap-3 p-2">
              <div class="bg-gray-100 p-2 rounded">
                <i class="pi pi-tag text-gray-600 text-sm"></i>
              </div>
              <div>
                <div class="font-medium">{{item.codigo}} - {{item.nombre}}</div>
                <small class="text-gray-500">{{item.categoria.nombre}} - Precio: S/. {{item.precioVenta}}</small>
              </div>
            </div>
          </ng-template>
        </p-select>
        
        <div class="mt-3">
          <small *ngIf="productoSeleccionadoFiltro" class="text-blue-600 font-medium">
            <i class="pi pi-info-circle mr-1"></i>
            Mostrando inventarios para: <strong>{{productoSeleccionadoFiltro.codigo}} - {{productoSeleccionadoFiltro.nombre}}</strong>
          </small>
          <small *ngIf="!productoSeleccionadoFiltro" class="text-gray-500">
            <i class="pi pi-search mr-1"></i>
            Seleccione un producto para ver su inventario detallado
          </small>
        </div>
      </div>
      
      <!-- Controles adicionales -->
      <div class="flex flex-col justify-center gap-3">
        <p-button 
          label="Limpiar Filtros" 
          icon="pi pi-filter-slash" 
          severity="secondary" 
          [outlined]="true"
          (click)="limpiarFiltros()"
          [disabled]="!productoSeleccionadoFiltro"
          class="w-full"
        />
        <div class="text-center text-sm text-gray-600" *ngIf="inventariosFiltrados?.length">
          <i class="pi pi-info-circle mr-1"></i>
          {{inventariosFiltrados.length}} registros encontrados
        </div>
      </div>
    </div>
  </div>

  <!-- Contenido principal del dashboard -->
  <div *ngIf="inventariosFiltrados?.length; else noDashboardData">
    <!-- Resumen de inventario del producto seleccionado -->
    <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-xl p-6 mb-6 border border-gray-200">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
        <i class="pi pi-chart-pie text-blue-600"></i>
        Resumen de Inventario: {{productoSeleccionadoFiltro?.nombre}}
      </h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center bg-white rounded-xl p-4 shadow-sm">
          <div class="text-3xl font-bold text-blue-600 mb-1">{{totalUnidades | number}}</div>
          <div class="text-sm text-gray-600 font-medium">Total Unidades</div>
        </div>
        <div class="text-center bg-white rounded-xl p-4 shadow-sm">
          <div class="text-3xl font-bold text-green-600 mb-1">{{totalVariantes | number}}</div>
          <div class="text-sm text-gray-600 font-medium">Variantes</div>
        </div>
        <div class="text-center bg-white rounded-xl p-4 shadow-sm">
          <div class="text-3xl font-bold text-orange-600 mb-1">{{stockBajoCount | number}}</div>
          <div class="text-sm text-gray-600 font-medium">Stock Bajo</div>
        </div>
        <div class="text-center bg-white rounded-xl p-4 shadow-sm">
          <div class="text-3xl font-bold text-red-600 mb-1">{{agotadosCount | number}}</div>
          <div class="text-sm text-gray-600 font-medium">Agotados</div>
        </div>
      </div>
    </div>

    <!-- Grid de inventarios en cards premium -->
    <div class="inventory-grid">
      <div 
        *ngFor="let inventario of inventariosFiltrados; trackBy: trackByInventario" 
        class="inventory-card bg-white rounded-2xl overflow-hidden border border-gray-200 hover:shadow-xl transition-all duration-300 inventory-entrance"
        (click)="mostrarDetalle(inventario)"
      >
        <!-- Header del inventario -->
        <div 
          class="p-4 text-white relative"
          [ngClass]="getStockClass(inventario)"
        >
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-3">
              <div class="bg-white bg-opacity-20 p-2 rounded-lg">
                <i class="pi pi-box text-white"></i>
              </div>
              <div>
                <h4 class="font-bold text-sm m-0">{{inventario.serie}}</h4>
                <p class="text-xs opacity-90 mt-1">{{inventario.producto?.codigo}}</p>
              </div>
            </div>
            
            <!-- Estado del inventario -->
            <div class="text-right">
              <p-tag 
                [value]="inventario.estado"
                [severity]="getEstadoSeverity(inventario.estado)"
                [icon]="getEstadoIcon(inventario.estado)"
                styleClass="text-xs font-medium"
              />
            </div>
          </div>
          
          <!-- Información de variante -->
          <div class="grid grid-cols-2 gap-2 text-center">
            <div class="bg-white bg-opacity-10 rounded-lg p-2">
              <div class="flex items-center justify-center gap-1 mb-1">
                <div 
                  class="w-3 h-3 rounded-full border border-white" 
                  [style.background-color]="inventario.color?.codigoHex || '#ccc'"
                ></div>
                <div class="text-xs font-medium">{{inventario.color?.nombre}}</div>
              </div>
            </div>
            <div class="bg-white bg-opacity-10 rounded-lg p-2">
              <div class="text-xs font-medium">Talla {{inventario.talla?.numero}}</div>
            </div>
          </div>
        </div>
        
        <!-- Contenido del inventario -->
        <div class="p-4">
          <!-- Cantidad principal -->
          <div class="text-center mb-4">
            <div class="text-4xl font-bold mb-1" 
                 [ngClass]="{
                   'text-red-600': inventario.cantidad === 0,
                   'text-orange-600': inventario.cantidad > 0 && inventario.cantidad <= 10,
                   'text-green-600': inventario.cantidad > 10
                 }">
              {{inventario.cantidad}}
            </div>
            <div class="text-sm text-gray-600 font-medium">Unidades disponibles</div>
            
            <!-- Barra de stock visual -->
            <div class="mt-3" *ngIf="inventario.stockMaximo">
              <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                <div 
                  class="h-2 rounded-full transition-all duration-500"
                  [ngClass]="{
                    'bg-gradient-to-r from-red-400 to-red-600': inventario.cantidad === 0,
                    'bg-gradient-to-r from-orange-400 to-orange-600': inventario.cantidad > 0 && inventario.cantidad <= 10,
                    'bg-gradient-to-r from-green-400 to-green-600': inventario.cantidad > 10
                  }"
                  [style.width.%]="calculateWidthPercentage(inventario.cantidad, inventario.stockMaximo || 100)"
                ></div>
              </div>
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>0</span>
                <span>{{inventario.stockMaximo}}</span>
              </div>
            </div>
          </div>
          
          <!-- Información del almacén -->
          <div class="mb-4">
            <div class="flex items-center gap-2 mb-2">
              <i class="pi pi-building text-blue-600"></i>
              <span class="font-medium text-gray-800 text-sm">Almacén</span>
            </div>
            <div class="text-gray-700 text-sm">{{inventario.almacen?.nombre}}</div>
            <div class="text-gray-500 text-xs">{{inventario.almacen?.ubicacion}}</div>
          </div>
          
          <!-- Métricas adicionales -->
          <div class="grid grid-cols-2 gap-3 mb-4" *ngIf="inventario.valorUnitario">
            <div class="text-center bg-gray-50 rounded-lg p-2">
              <div class="font-bold text-blue-600">${{inventario.valorUnitario | number:'1.0-0'}}</div>
              <div class="text-xs text-gray-600">Valor Unit.</div>
            </div>
            <div class="text-center bg-gray-50 rounded-lg p-2">
              <div class="font-bold text-green-600">${{inventario.valorTotal | number:'1.0-0'}}</div>
              <div class="text-xs text-gray-600">Valor Total</div>
            </div>
          </div>
          
          <!-- Categoría ABC y tendencia -->
          <div class="flex items-center justify-between mb-4" *ngIf="inventario.categoriaABC">
            <p-chip 
              [label]="'ABC: ' + inventario.categoriaABC"
              [styleClass]="'abc-' + inventario.categoriaABC.toLowerCase()"
              size="small"
            />
            <div class="flex items-center gap-1" *ngIf="inventario.tendencia">
              <i [class]="getTendenciaIcon(inventario.tendencia)" [style.color]="getTendenciaColor(inventario.tendencia)"></i>
              <span class="text-xs text-gray-600">{{inventario.tendencia}}</span>
            </div>
          </div>
          
          <!-- Ubicación en almacén -->
          <div class="mb-4" *ngIf="inventario.ubicacionAlmacen">
            <div class="flex items-center gap-2 mb-1">
              <i class="pi pi-map-marker text-purple-600 text-sm"></i>
              <span class="font-medium text-gray-800 text-sm">Ubicación</span>
            </div>
            <div class="text-gray-600 text-xs">{{inventario.ubicacionAlmacen}}</div>
          </div>
          
          <!-- Fecha de última actualización -->
          <div class="text-xs text-gray-500 mb-4">
            <i class="pi pi-clock mr-1"></i>
            Actualizado: {{inventario.fechaActualizacion | date:'dd/MM/yyyy HH:mm'}}
          </div>
          
          <!-- Acciones del inventario -->
          <div class="flex gap-2">
            <p-button 
              label="Detalle" 
              icon="pi pi-eye" 
              size="small"
              [outlined]="true"
              class="flex-1"
              (click)="mostrarDetalle(inventario); $event.stopPropagation()"
            />
            <p-button 
              icon="pi pi-history" 
              size="small"
              severity="info"
              [outlined]="true"
              pTooltip="Ver movimientos"
              (click)="mostrarMovimientos(inventario); $event.stopPropagation()"
            />
            <p-button 
              *appHasPermission="{module: 'inventario', permission: permissionTypes.EDIT}"
              icon="pi pi-pencil" 
              size="small"
              pTooltip="Editar"
              (click)="editInventario(inventario); $event.stopPropagation()"
            />
            <p-button 
              *appHasPermission="{module: 'inventario', permission: permissionTypes.DELETE}"
              icon="pi pi-trash" 
              severity="danger" 
              size="small"
              [outlined]="true"
              pTooltip="Eliminar"
              (click)="eliminarInventario(inventario); $event.stopPropagation()"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <ng-template #noDashboardData>
    <div class="text-center py-20">
      <div *ngIf="productoSeleccionadoFiltro; else sinProductoSeleccionado">
        <div class="bg-blue-100 p-12 rounded-full inline-block mb-6 float-animation">
          <i class="pi pi-inbox text-6xl text-blue-600"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-700 mb-3">No hay inventarios disponibles</h3>
        <p class="text-gray-500 mb-6 max-w-md mx-auto">
          No se encontraron registros de inventario para este producto. Cree el primer registro para comenzar.
        </p>
        <p-button 
          *appHasPermission="{module: 'inventario', permission: permissionTypes.CREATE}"
          label="Crear Primer Inventario" 
          icon="pi pi-plus" 
          size="large"
          class="shadow-lg hover:shadow-xl transition-all duration-300" 
          (click)="openNew()"
        />
      </div>
      
      <ng-template #sinProductoSeleccionado>
        <div class="bg-gray-100 p-12 rounded-full inline-block mb-6">
          <i class="pi pi-filter text-6xl text-gray-500"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-700 mb-3">Seleccione un producto</h3>
        <p class="text-gray-500 max-w-md mx-auto">
          Elija un producto del filtro superior para ver su inventario disponible en todos los almacenes.
        </p>
      </ng-template>
    </div>
  </ng-template>
</div>

<!-- Vista Cards (Alternativa al dashboard) -->
<div *ngIf="currentView === 'cards'" class="mb-6">
  <div *ngIf="inventariosFiltrados?.length; else noCardsData">
    <div class="inventory-grid">
      <div 
        *ngFor="let inventario of inventariosFiltrados; trackBy: trackByInventario" 
        class="inventory-card bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-all duration-300"
      >
        <!-- Header compacto -->
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="p-2 rounded-lg" [ngClass]="getStockClass(inventario) + ' bg-opacity-20'">
              <i class="pi pi-box text-lg"></i>
            </div>
            <div>
              <h4 class="font-bold text-gray-900 m-0">{{inventario.serie}}</h4>
              <p class="text-sm text-gray-600 mt-1">{{inventario.producto?.nombre}}</p>
            </div>
          </div>
          <p-tag 
            [value]="inventario.estado"
            [severity]="getEstadoSeverity(inventario.estado)"
            size="small"
          />
        </div>
        
        <!-- Información de variante -->
        <div class="grid grid-cols-2 gap-3 mb-4">
          <div class="flex items-center gap-2">
            <div 
              class="w-4 h-4 rounded-full border" 
              [style.background-color]="inventario.color?.codigoHex || '#ccc'"
            ></div>
            <span class="text-sm font-medium">{{inventario.color?.nombre}}</span>
          </div>
          <div class="text-sm">
            <span class="font-medium">Talla: </span>{{inventario.talla?.numero}}
          </div>
        </div>
        
        <!-- Cantidad y almacén -->
        <div class="grid grid-cols-2 gap-3 mb-4">
          <div class="text-center bg-gray-50 rounded-lg p-3">
            <div class="text-2xl font-bold" [ngClass]="{
              'text-red-600': inventario.cantidad === 0,
              'text-orange-600': inventario.cantidad > 0 && inventario.cantidad <= 10,
              'text-green-600': inventario.cantidad > 10
            }">{{inventario.cantidad}}</div>
            <div class="text-xs text-gray-600">Stock</div>
          </div>
          <div class="bg-gray-50 rounded-lg p-3">
            <div class="font-medium text-sm text-gray-800">{{inventario.almacen?.nombre}}</div>
            <div class="text-xs text-gray-600">{{inventario.almacen?.ubicacion}}</div>
          </div>
        </div>
        
        <!-- Acciones -->
        <div class="flex gap-2">
          <p-button 
            icon="pi pi-eye" 
            size="small"
            [outlined]="true"
            class="flex-1"
            (click)="mostrarDetalle(inventario)"
          />
          <p-button 
            *appHasPermission="{module: 'inventario', permission: permissionTypes.EDIT}"
            icon="pi pi-pencil" 
            size="small"
            (click)="editInventario(inventario)"
          />
          <p-button 
            *appHasPermission="{module: 'inventario', permission: permissionTypes.DELETE}"
            icon="pi pi-trash" 
            severity="danger" 
            size="small"
            [outlined]="true"
            (click)="eliminarInventario(inventario)"
          />
        </div>
      </div>
    </div>
  </div>
  
  <ng-template #noCardsData>
    <div class="text-center py-16">
      <div class="bg-gray-100 p-8 rounded-full inline-block mb-4">
        <i class="pi pi-th-large text-4xl text-gray-500"></i>
      </div>
      <h3 class="text-xl font-bold text-gray-700 mb-2">Sin datos para mostrar</h3>
      <p class="text-gray-500">Seleccione un producto para ver el inventario en formato de tarjetas</p>
    </div>
  </ng-template>
</div>

<!-- Vista de Tabla (Modernizada) -->
<div *ngIf="currentView === 'table'" class="mb-6">
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <p-table
      #dt
      [value]="inventariosFiltrados"
      [rows]="10"
      [paginator]="true"
      [totalRecords]="inventariosFiltrados.length"
      [globalFilterFields]="['serie', 'color.nombre', 'talla.numero', 'almacen.nombre', 'estado']"
      [tableStyle]="{'min-width': '75rem'}"
      [(selection)]="selectedInventarios"
      [rowHover]="true"
      dataKey="id"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
      [rowsPerPageOptions]="[5, 10, 20, 30, 50]"
      [loading]="loading"
      [alwaysShowPaginator]="true"
      styleClass="p-datatable-gridlines p-datatable-striped"
    >
      <!-- Caption modernizado -->
      <ng-template pTemplate="caption">
        <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 border-b border-gray-200">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div class="flex items-center gap-3">
              <div class="bg-green-600 p-2 rounded-lg">
                <i class="pi pi-list text-white"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-gray-800 m-0">Lista Detallada de Inventarios</h3>
                <p class="text-sm text-gray-600 mt-1" *ngIf="inventariosFiltrados?.length">
                  {{inventariosFiltrados.length}} registros encontrados
                  <span *ngIf="productoSeleccionadoFiltro"> para {{productoSeleccionadoFiltro.nombre}}</span>
                </p>
              </div>
            </div>
            <div class="flex gap-3">
              <p-iconfield>
                <p-inputicon styleClass="pi pi-search" />
                <input 
                  pInputText 
                  type="text" 
                  (input)="onGlobalFilter(dt, $event)" 
                  placeholder="Búsqueda rápida..." 
                  class="w-80 h-10 rounded-lg"
                />
              </p-iconfield>
            </div>
          </div>
        </div>
      </ng-template>

      <!-- Header modernizado -->
      <ng-template pTemplate="header">
        <tr class="bg-gray-50">
          <th style="width: 3rem" class="text-center border-b-2 border-gray-200">
            <p-tableHeaderCheckbox />
          </th>
          <th pSortableColumn="serie" style="min-width:12rem" class="border-b-2 border-gray-200">
            <div class="flex items-center gap-2 font-bold text-gray-700">
              <i class="pi pi-tag text-blue-600"></i>
              Serie
              <p-sortIcon field="serie" />
            </div>
          </th>
          <th pSortableColumn="color.nombre" style="min-width:10rem" class="border-b-2 border-gray-200">
            <div class="flex items-center gap-2 font-bold text-gray-700">
              <i class="pi pi-palette text-green-600"></i>
              Color
              <p-sortIcon field="color.nombre" />
            </div>
          </th>
          <th pSortableColumn="talla.numero" style="min-width:8rem" class="text-center border-b-2 border-gray-200">
            <div class="flex items-center justify-center gap-2 font-bold text-gray-700">
              <i class="pi pi-tag text-purple-600"></i>
              Talla
              <p-sortIcon field="talla.numero" />
            </div>
          </th>
          <th pSortableColumn="almacen.nombre" style="min-width:12rem" class="border-b-2 border-gray-200">
            <div class="flex items-center gap-2 font-bold text-gray-700">
              <i class="pi pi-building text-indigo-600"></i>
              Almacén
              <p-sortIcon field="almacen.nombre" />
            </div>
          </th>
          <th pSortableColumn="cantidad" style="min-width:8rem" class="text-center border-b-2 border-gray-200">
            <div class="flex items-center justify-center gap-2 font-bold text-gray-700">
              <i class="pi pi-box text-orange-600"></i>
              Cantidad
              <p-sortIcon field="cantidad" />
            </div>
          </th>
          <th pSortableColumn="estado" style="min-width:10rem" class="text-center border-b-2 border-gray-200">
            <div class="flex items-center justify-center gap-2 font-bold text-gray-700">
              <i class="pi pi-bookmark text-red-600"></i>
              Estado
              <p-sortIcon field="estado" />
            </div>
          </th>
          <th style="min-width:10rem" class="text-center border-b-2 border-gray-200">
            <div class="flex items-center justify-center gap-2 font-bold text-gray-700">
              <i class="pi pi-dollar text-green-600"></i>
              Valor
            </div>
          </th>
          <th pSortableColumn="fechaActualizacion" style="min-width:12rem" class="text-center border-b-2 border-gray-200">
            <div class="flex items-center justify-center gap-2 font-bold text-gray-700">
              <i class="pi pi-calendar text-gray-600"></i>
              Actualización
              <p-sortIcon field="fechaActualizacion" />
            </div>
          </th>
          <th style="min-width:12rem" class="text-center border-b-2 border-gray-200">
            <div class="flex items-center justify-center gap-2 font-bold text-gray-700">
              <i class="pi pi-cog text-gray-600"></i>
              Acciones
            </div>
          </th>
        </tr>
      </ng-template>

      <!-- Body de la tabla modernizado -->
      <ng-template pTemplate="body" let-inventario let-rowIndex="rowIndex">
        <tr class="hover:bg-green-50 transition-colors duration-200" [class.bg-gray-25]="rowIndex % 2 === 0">
          <td class="text-center">
            <p-tableCheckbox [value]="inventario" />
          </td>
          
          <!-- Serie -->
          <td>
            <div class="flex items-center gap-3">
              <div class="bg-blue-100 p-2 rounded-lg">
                <i class="pi pi-tag text-blue-600"></i>
              </div>
              <div>
                <div class="font-bold text-gray-900">{{inventario.serie}}</div>
                <div class="text-sm text-gray-500">{{inventario.producto?.codigo}}</div>
              </div>
            </div>
          </td>
          
          <!-- Color -->
          <td>
            <div class="flex items-center gap-2">
              <div 
                class="w-6 h-6 rounded-full border-2 border-white shadow-sm" 
                [style.background-color]="inventario.color?.codigoHex || '#ccc'"
                [title]="inventario.color?.nombre"
              ></div>
              <span class="font-medium text-gray-800">{{inventario.color?.nombre}}</span>
            </div>
          </td>
          
          <!-- Talla -->
          <td class="text-center">
            <p-tag 
              [value]="'Talla ' + inventario.talla?.numero" 
              severity="secondary"
              [style]="{'font-weight': 'bold'}"
            />
          </td>
          
          <!-- Almacén -->
          <td>
            <div class="flex items-center gap-2">
              <i class="pi pi-building text-indigo-600"></i>
              <div>
                <div class="font-medium text-gray-800">{{inventario.almacen?.nombre}}</div>
                <div class="text-sm text-gray-500">{{inventario.almacen?.ubicacion}}</div>
              </div>
            </div>
          </td>
          
          <!-- Cantidad -->
          <td class="text-center">
            <div class="flex flex-col items-center gap-1">
              <div class="flex items-center gap-2">
                <span class="font-bold text-xl" 
                      [ngClass]="{
                        'text-red-600': inventario.cantidad === 0,
                        'text-orange-600': inventario.cantidad > 0 && inventario.cantidad <= 10,
                        'text-green-600': inventario.cantidad > 10
                      }">
                  {{inventario.cantidad}}
                </span>
                <i class="pi pi-box text-gray-400"></i>
              </div>
              <div class="w-full max-w-16" *ngIf="inventario.stockMaximo">
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    class="h-2 rounded-full transition-all duration-500"
                    [ngClass]="{
                      'bg-red-500': inventario.cantidad === 0,
                      'bg-orange-500': inventario.cantidad > 0 && inventario.cantidad <= 10,
                      'bg-green-500': inventario.cantidad > 10
                    }"
                    [style.width.%]="calculateWidthPercentage(inventario.cantidad, inventario.stockMaximo || 100)"
                  ></div>
                </div>
              </div>
            </div>
          </td>
          
          <!-- Estado -->
          <td class="text-center">
            <p-tag 
              [value]="inventario.estado"
              [severity]="getEstadoSeverity(inventario.estado)"
              [icon]="getEstadoIcon(inventario.estado)"
              class="shadow-sm font-medium status-indicator"
              [ngClass]="'status-' + inventario.estado.toLowerCase().replace('_', '-')"
            />
          </td>
          
          <!-- Valor -->
          <td class="text-center">
            <div *ngIf="inventario.valorUnitario; else sinValor">
              <div class="font-bold text-green-600">${{inventario.valorTotal | number:'1.0-0'}}</div>
              <div class="text-xs text-gray-500">${{inventario.valorUnitario | number:'1.0-0'}} c/u</div>
            </div>
            <ng-template #sinValor>
              <span class="text-gray-400 italic">Sin valor</span>
            </ng-template>
          </td>
          
          <!-- Fecha de actualización -->
          <td class="text-center">
            <div class="text-sm">
              <div class="font-medium text-gray-800">{{inventario.fechaActualizacion | date:'dd/MM/yyyy'}}</div>
              <div class="text-xs text-gray-500">{{inventario.fechaActualizacion | date:'HH:mm'}}</div>
            </div>
          </td>
          
          <!-- Acciones -->
          <td>
            <div class="flex gap-2 justify-center">
              <!-- Botón Ver Detalles -->
              <p-button 
                icon="pi pi-eye" 
                [rounded]="true" 
                [outlined]="true"
                severity="info"
                size="small"
                pTooltip="Ver detalles"
                class="hover:shadow-md transition-all duration-300"
                (click)="mostrarDetalle(inventario)"
              />
              <!-- Botón Movimientos -->
              <p-button 
                icon="pi pi-history" 
                [rounded]="true" 
                [outlined]="true"
                severity="secondary"
                size="small"
                pTooltip="Ver movimientos"
                class="hover:shadow-md transition-all duration-300"
                (click)="mostrarMovimientos(inventario)"
              />
              <!-- Botón Editar -->
              <p-button 
                *appHasPermission="{module: 'inventario', permission: permissionTypes.EDIT}"
                icon="pi pi-pencil" 
                [rounded]="true" 
                [outlined]="true"
                size="small"
                pTooltip="Editar"
                class="hover:shadow-md transition-all duration-300"
                (click)="editInventario(inventario)"
              />
              <!-- Botón Eliminar -->
              <p-button 
                *appHasPermission="{module: 'inventario', permission: permissionTypes.DELETE}"
                icon="pi pi-trash" 
                severity="danger" 
                [rounded]="true" 
                [outlined]="true"
                size="small"
                pTooltip="Eliminar"
                class="hover:shadow-md transition-all duration-300"
                (click)="eliminarInventario(inventario)"
              />
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Empty message modernizado -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="10" class="text-center py-12">
            <div *ngIf="productoSeleccionadoFiltro; else sinProductoEnTabla">
              <div class="bg-blue-100 p-8 rounded-full inline-block mb-4">
                <i class="pi pi-inbox text-6xl text-blue-600"></i>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-gray-700 mb-2">No hay inventarios disponibles</div>
                <div class="text-gray-500 mb-6">No se encontraron registros para este producto</div>
                <p-button 
                  *appHasPermission="{module: 'inventario', permission: permissionTypes.CREATE}"
                  label="Crear Primer Inventario" 
                  icon="pi pi-plus" 
                  size="large"
                  class="shadow-lg hover:shadow-xl transition-all duration-300" 
                  (click)="openNew()"
                />
              </div>
            </div>
            
            <ng-template #sinProductoEnTabla>
              <div class="bg-gray-100 p-8 rounded-full inline-block mb-4">
                <i class="pi pi-filter text-6xl text-gray-500"></i>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-gray-700 mb-2">Seleccione un producto</div>
                <div class="text-gray-500">Elija un producto para ver su inventario en formato tabla</div>
              </div>
            </ng-template>
          </td>
        </tr>
      </ng-template>

      <!-- Loading template -->
      <ng-template pTemplate="loadingbody">
        <tr>
          <td colspan="10">
            <div class="flex items-center justify-center py-8">
              <div class="flex items-center gap-3">
                <i class="pi pi-spin pi-spinner text-green-600 text-2xl"></i>
                <span class="text-lg font-medium text-gray-600">Cargando inventarios...</span>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Vista de Analytics -->
<div *ngIf="currentView === 'analytics'" class="mb-6">
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <!-- Header de analytics -->
    <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-green-600 p-3 rounded-lg shadow-lg">
            <i class="pi pi-chart-bar text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-gray-800 m-0">Analytics de Inventarios</h3>
            <p class="text-gray-600 mt-1">Análisis avanzado de stock, rotación y valorización</p>
          </div>
        </div>
        <div class="flex gap-2">
          <p-button 
            label="Actualizar Datos" 
            icon="pi pi-refresh" 
            severity="secondary"
            [outlined]="true"
            (click)="generarDatosSimulados(); updateChartData()"
          />
          <p-button 
            label="Exportar Reporte" 
            icon="pi pi-download" 
            severity="info"
            (click)="exportarExcel()"
          />
        </div>
      </div>
    </div>

    <div class="p-6" *ngIf="inventariosFiltrados?.length; else noAnalyticsData">
      <!-- KPIs principales -->
      <div class="analytics-grid mb-8">
        <!-- ROI y Valor -->
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-dollar text-green-600"></i>
            Valorización del Inventario
          </h4>
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center">
              <div class="text-3xl font-bold text-green-600 mb-2">${{calcularEstadisticas().valorTotalInventario | number:'1.0-0'}}</div>
              <div class="text-sm text-gray-600">Valor Total</div>
            </div>
            <div class="text-center">
              <div class="text-3xl font-bold text-blue-600 mb-2">${{calcularEstadisticas().valorEnRiesgo | number:'1.0-0'}}</div>
              <div class="text-sm text-gray-600">Valor en Riesgo</div>
            </div>
          </div>
          <div class="mt-4">
            <div class="w-full bg-gray-200 rounded-full h-3">
              <div class="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-500" 
                   [style.width.%]="85"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-600 mt-1">
              <span>ROI: 18.5%</span>
              <span>Eficiencia: 85%</span>
            </div>
          </div>
        </div>

        <!-- Rotación de stock -->
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-refresh text-blue-600"></i>
            Rotación de Inventario
          </h4>
          <div class="text-center mb-4">
            <p-knob 
              [(ngModel)]="calcularEstadisticas().rotacionPromedio" 
              [size]="120"
              [readonly]="true"
              valueTemplate="{value}x/año"
              strokeWidth="8"
              fill="#3b82f6"
              textColor="#374151"
            />
          </div>
          <div class="text-center text-sm text-gray-600">
            <div class="font-medium">Promedio de rotación anual</div>
            <div class="text-green-600 font-bold">+15% vs. año anterior</div>
          </div>
        </div>

        <!-- Stock crítico y alertas -->
        <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6 border border-orange-200">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-exclamation-triangle text-orange-600"></i>
            Estados de Stock
          </h4>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-2 bg-red-100 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="pi pi-times-circle text-red-600"></i>
                <span class="text-sm font-medium">Agotados</span>
              </div>
              <span class="font-bold text-red-600">{{calcularEstadisticas().productosAgotados}}</span>
            </div>
            <div class="flex items-center justify-between p-2 bg-orange-100 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="pi pi-exclamation-triangle text-orange-600"></i>
                <span class="text-sm font-medium">Stock Crítico</span>
              </div>
              <span class="font-bold text-orange-600">{{calcularEstadisticas().stockCritico}}</span>
            </div>
            <div class="flex items-center justify-between p-2 bg-green-100 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="pi pi-check-circle text-green-600"></i>
                <span class="text-sm font-medium">Disponibles</span>
              </div>
              <span class="font-bold text-green-600">{{getDisponiblesCount()}}</span>
            </div>
          </div>
        </div>

        <!-- Gráfico de distribución por estado -->
        <div class="bg-white rounded-xl p-6 border border-gray-200">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-chart-pie text-purple-600"></i>
            Distribución por Estado
          </h4>
          <div class="chart-container">
            <p-chart 
              type="doughnut" 
              [data]="chartData" 
              [options]="chartOptions"
              width="300"
              height="300"
            />
          </div>
        </div>

        <!-- Tendencias de movimientos -->
        <div class="bg-white rounded-xl p-6 border border-gray-200 col-span-2">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-chart-line text-green-600"></i>
            Tendencias de Movimientos
          </h4>
          <div class="chart-container">
            <p-chart 
              type="line" 
              [data]="trendData" 
              [options]="chartOptions"
              height="250"
            />
          </div>
        </div>

        <!-- Análisis de demanda por zonas -->
        <div class="bg-white rounded-xl p-6 border border-gray-200">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-map text-indigo-600"></i>
            Demanda por Zonas
          </h4>
          <div class="space-y-3">
            <div 
              *ngFor="let zona of calcularEstadisticas().zonasDemanda" 
              class="flex items-center justify-between p-3 rounded-lg border border-gray-100"
            >
              <div class="flex items-center gap-2">
                <div 
                  class="w-3 h-3 rounded-full"
                  [style.background-color]="zona.color"
                ></div>
                <span class="font-medium text-gray-800">{{zona.zona}}</span>
              </div>
              <div class="text-right">
                <div class="font-bold" [style.color]="zona.color">{{zona.demanda}}%</div>
                <div class="w-16 bg-gray-200 rounded-full h-2 mt-1">
                  <div 
                    class="h-2 rounded-full transition-all duration-500"
                    [style.background-color]="zona.color"
                    [style.width.%]="zona.demanda"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Métricas adicionales -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Top productos por valor -->
        <div class="bg-white rounded-xl p-6 border border-gray-200">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-star text-yellow-600"></i>
            Top Productos por Valor
          </h4>
          <div class="space-y-3">
            <div 
              *ngFor="let inventario of inventariosFiltrados.slice(0, 5); let i = index" 
              class="flex items-center justify-between p-2 rounded-lg hover:bg-gray-50"
            >
              <div class="flex items-center gap-2">
                <div 
                  class="w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold"
                  [ngClass]="{
                    'bg-yellow-500': i === 0,
                    'bg-gray-400': i === 1,
                    'bg-orange-600': i === 2,
                    'bg-blue-500': i > 2
                  }"
                >
                  {{i + 1}}
                </div>
                <div>
                  <div class="font-medium text-sm">{{inventario.producto?.nombre}}</div>
                  <div class="text-xs text-gray-500">{{inventario.color?.nombre}} - Talla {{inventario.talla?.numero}}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-bold text-green-600">${{inventario.valorTotal | number:'1.0-0'}}</div>
                <div class="text-xs text-gray-500">{{inventario.cantidad}} uds</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Predicciones y recomendaciones -->
        <div class="bg-white rounded-xl p-6 border border-gray-200">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-lightbulb text-purple-600"></i>
            Recomendaciones IA
          </h4>
          <div class="space-y-3">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
              <div class="flex items-start gap-2">
                <i class="pi pi-info-circle text-blue-600 mt-1"></i>
                <div>
                  <div class="font-medium text-blue-800 text-sm">Optimización de Stock</div>
                  <div class="text-sm text-blue-700">Reducir inventario de productos categoría C en 15%</div>
                </div>
              </div>
            </div>
            
            <div class="bg-green-50 border border-green-200 rounded-lg p-3">
              <div class="flex items-start gap-2">
                <i class="pi pi-arrow-up text-green-600 mt-1"></i>
                <div>
                  <div class="font-medium text-green-800 text-sm">Reposición Urgente</div>
                  <div class="text-sm text-green-700">5 productos requieren reposición inmediata</div>
                </div>
              </div>
            </div>
            
            <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
              <div class="flex items-start gap-2">
                <i class="pi pi-exclamation-triangle text-orange-600 mt-1"></i>
                <div>
                  <div class="font-medium text-orange-800 text-sm">Riesgo de Obsolescencia</div>
                  <div class="text-sm text-orange-700">3 productos sin movimiento en 90+ días</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Eficiencia operacional -->
        <div class="bg-white rounded-xl p-6 border border-gray-200">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-cog text-gray-600"></i>
            Eficiencia Operacional
          </h4>
          <div class="space-y-4">
            <div>
              <div class="flex justify-between text-sm text-gray-600 mb-1">
                <span>Precisión de Inventario</span>
                <span>94%</span>
              </div>
              <p-progressBar [value]="94" styleClass="h-2" />
            </div>
            
            <div>
              <div class="flex justify-between text-sm text-gray-600 mb-1">
                <span>Tiempo de Reposición</span>
                <span>78%</span>
              </div>
              <p-progressBar [value]="78" styleClass="h-2" />
            </div>
            
            <div>
              <div class="flex justify-between text-sm text-gray-600 mb-1">
                <span>Disponibilidad de Stock</span>
                <span>{{calcularEstadisticas().eficienciaStock | number:'1.0-0'}}%</span>
              </div>
              <p-progressBar [value]="calcularEstadisticas().eficienciaStock" styleClass="h-2" />
            </div>
            
            <div class="mt-4 pt-3 border-t border-gray-200">
              <div class="text-center">
                <div class="text-2xl font-bold text-indigo-600">A+</div>
                <div class="text-sm text-gray-600">Calificación General</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noAnalyticsData>
      <div class="text-center py-16">
        <div class="bg-green-100 p-12 rounded-full inline-block mb-6">
          <i class="pi pi-chart-bar text-6xl text-green-600"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-700 mb-3">No hay datos para analizar</h3>
        <p class="text-gray-500 mb-6">Seleccione un producto para ver análisis detallados</p>
        <p-button 
          label="Ir al Dashboard" 
          icon="pi pi-chart-pie" 
          (click)="currentView = 'dashboard'"
        />
      </div>
    </ng-template>
  </div>
</div>

<!-- Vista de Movimientos -->
<div *ngIf="currentView === 'movements'" class="mb-6">
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <!-- Header de movimientos -->
    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-indigo-600 p-3 rounded-lg shadow-lg">
            <i class="pi pi-history text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-gray-800 m-0">Movimientos de Inventario</h3>
            <p class="text-gray-600 mt-1">Historial completo de entradas, salidas y ajustes</p>
          </div>
        </div>
        <div class="flex gap-2">
          <p-button 
            label="Nuevo Movimiento" 
            icon="pi pi-plus" 
            severity="info"
            (click)="mostrarMovimientos()"
          />
          <p-button 
            label="Filtrar por Fechas" 
            icon="pi pi-calendar" 
            severity="secondary"
            [outlined]="true"
          />
        </div>
      </div>
    </div>

    <div class="p-6" *ngIf="inventariosFiltrados?.length; else noMovementsData">
      <!-- Estadísticas de movimientos -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-green-50 rounded-xl p-4 border border-green-200">
          <div class="flex items-center gap-3">
            <div class="bg-green-600 p-2 rounded-lg">
              <i class="pi pi-arrow-down text-white"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-green-600">{{calcularEstadisticas().movimientosDelMes}}</div>
              <div class="text-sm text-gray-600">Entradas del Mes</div>
            </div>
          </div>
        </div>
        
        <div class="bg-red-50 rounded-xl p-4 border border-red-200">
          <div class="flex items-center gap-3">
            <div class="bg-red-600 p-2 rounded-lg">
              <i class="pi pi-arrow-up text-white"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-red-600">890</div>
              <div class="text-sm text-gray-600">Salidas del Mes</div>
            </div>
          </div>
        </div>
        
        <div class="bg-orange-50 rounded-xl p-4 border border-orange-200">
          <div class="flex items-center gap-3">
            <div class="bg-orange-600 p-2 rounded-lg">
              <i class="pi pi-wrench text-white"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-orange-600">45</div>
              <div class="text-sm text-gray-600">Ajustes del Mes</div>
            </div>
          </div>
        </div>
        
        <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
          <div class="flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-lg">
              <i class="pi pi-arrows-h text-white"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-blue-600">120</div>
              <div class="text-sm text-gray-600">Transferencias del Mes</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Timeline de movimientos -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Timeline principal -->
        <div class="lg:col-span-2">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-clock text-indigo-600"></i>
            Timeline de Movimientos Recientes
          </h4>
          
          <div class="movement-timeline">
            <div 
              *ngFor="let inventario of inventariosFiltrados.slice(0, 10); let i = index" 
              class="movement-item bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-all duration-300"
            >
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                  <div 
                    class="p-2 rounded-lg"
                    [ngClass]="{
                      'bg-green-100': i % 4 === 0,
                      'bg-red-100': i % 4 === 1,
                      'bg-orange-100': i % 4 === 2,
                      'bg-blue-100': i % 4 === 3
                    }"
                  >
                    <i 
                      [ngClass]="{
                        'pi pi-arrow-down text-green-600': i % 4 === 0,
                        'pi pi-arrow-up text-red-600': i % 4 === 1,
                        'pi pi-wrench text-orange-600': i % 4 === 2,
                        'pi pi-arrows-h text-blue-600': i % 4 === 3
                      }"
                    ></i>
                  </div>
                  <div>
                    <div class="font-medium text-gray-800">
                      {{['Entrada', 'Salida', 'Ajuste', 'Transferencia'][i % 4]}} - {{inventario.producto?.nombre}}
                    </div>
                    <div class="text-sm text-gray-600">
                      {{inventario.color?.nombre}} - Talla {{inventario.talla?.numero}}
                    </div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-bold text-lg" 
                       [ngClass]="{
                         'text-green-600': i % 4 === 0,
                         'text-red-600': i % 4 === 1,
                         'text-orange-600': i % 4 === 2,
                         'text-blue-600': i % 4 === 3
                       }">
                    {{['+ ', '- ', '± ', '↔ '][i % 4]}}{{getRandomInt(5, 55)}}
                  </div>
                  <div class="text-sm text-gray-500">
                    {{inventario.fechaActualizacion | date:'dd/MM HH:mm'}}
                  </div>
                </div>
              </div>
              
              <div class="flex items-center justify-between text-sm">
                <div class="text-gray-600">
                  <i class="pi pi-building mr-1"></i>
                  {{inventario.almacen?.nombre}}
                </div>
                <div class="text-gray-600">
                  <i class="pi pi-user mr-1"></i>
                  {{'Usuario' + (i % 3 + 1)}}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Panel de filtros y resumen -->
        <div class="space-y-6">
          <!-- Filtros de movimientos -->
          <div class="bg-gray-50 rounded-xl p-4">
            <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
              <i class="pi pi-filter text-gray-600"></i>
              Filtros de Movimientos
            </h5>
            <div class="space-y-3">
              <div>
                <label class="text-sm font-medium text-gray-700 mb-1 block">Tipo de Movimiento</label>
                <p-select 
                  [options]="tiposMovimiento" 
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Todos los tipos"
                  [showClear]="true"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
              
              <div>
                <label class="text-sm font-medium text-gray-700 mb-1 block">Rango de Fechas</label>
                <p-calendar 
                  selectionMode="range" 
                  [readonlyInput]="true"
                  placeholder="Seleccionar fechas"
                  [showIcon]="true"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
              
              <div>
                <label class="text-sm font-medium text-gray-700 mb-1 block">Usuario</label>
                <input 
                  type="text" 
                  pInputText 
                  placeholder="Filtrar por usuario"
                  class="w-full h-10"
                />
              </div>
              
              <p-button 
                label="Aplicar Filtros" 
                icon="pi pi-check" 
                class="w-full"
                size="small"
              />
            </div>
          </div>

          <!-- Resumen de movimientos por tipo -->
          <div class="bg-white rounded-xl p-4 border border-gray-200">
            <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
              <i class="pi pi-chart-bar text-purple-600"></i>
              Resumen por Tipo
            </h5>
            <div class="space-y-3">
              <div 
                *ngFor="let tipo of tiposMovimiento" 
                class="flex items-center justify-between p-2 rounded-lg hover:bg-gray-50"
              >
                <div class="flex items-center gap-2">
                  <i [class]="tipo.icon" [style.color]="tipo.color"></i>
                  <span class="text-sm font-medium">{{tipo.label}}</span>
                </div>
                <div class="text-right">
                  <div class="font-bold" [style.color]="tipo.color">{{getRandomInt(100, 600)}}</div>
                  <div class="text-xs text-gray-500">movimientos</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Alertas de movimientos -->
          <div class="bg-orange-50 rounded-xl p-4 border border-orange-200">
            <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
              <i class="pi pi-exclamation-triangle text-orange-600"></i>
              Alertas de Movimientos
            </h5>
            <div class="space-y-2">
              <div class="bg-white rounded-lg p-3 border border-orange-200">
                <div class="font-medium text-orange-800 text-sm">Movimiento Inusual</div>
                <div class="text-sm text-orange-700">Salida de 500 unidades detectada</div>
                <div class="text-xs text-gray-500 mt-1">Hace 2 horas</div>
              </div>
              
              <div class="bg-white rounded-lg p-3 border border-red-200">
                <div class="font-medium text-red-800 text-sm">Stock Crítico Post-Movimiento</div>
                <div class="text-sm text-red-700">3 productos bajo mínimo tras última salida</div>
                <div class="text-xs text-gray-500 mt-1">Hace 4 horas</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noMovementsData>
      <div class="text-center py-16">
        <div class="bg-indigo-100 p-12 rounded-full inline-block mb-6">
          <i class="pi pi-history text-6xl text-indigo-600"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-700 mb-3">Sin movimientos registrados</h3>
        <p class="text-gray-500 mb-6">Seleccione un producto para ver su historial de movimientos</p>
        <p-button 
          label="Ver Dashboard" 
          icon="pi pi-chart-pie" 
          (click)="currentView = 'dashboard'"
        />
      </div>
    </ng-template>
  </div>
</div>

<!-- Vista de Análisis ABC -->
<div *ngIf="currentView === 'abc'" class="mb-6">
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <!-- Header de ABC -->
    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-purple-600 p-3 rounded-lg shadow-lg">
            <i class="pi pi-sort-amount-down text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-gray-800 m-0">Análisis ABC de Inventarios</h3>
            <p class="text-gray-600 mt-1">Clasificación por valor e importancia estratégica</p>
          </div>
        </div>
        <div class="flex gap-2">
          <p-button 
            label="Recalcular ABC" 
            icon="pi pi-refresh" 
            severity="secondary"
            [outlined]="true"
          />
          <p-button 
            label="Exportar Análisis" 
            icon="pi pi-download" 
            severity="info"
          />
        </div>
      </div>
    </div>

    <div class="p-6" *ngIf="inventariosFiltrados?.length; else noAbcData">
      <!-- Resumen ABC -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div 
          *ngFor="let categoria of categoriasABC" 
          class="rounded-xl p-6 text-white"
          [ngClass]="'abc-' + categoria.categoria.toLowerCase()"
        >
          <div class="flex items-center justify-between mb-4">
            <div>
              <h4 class="text-2xl font-bold m-0">{{categoria.label}}</h4>
              <p class="opacity-90 text-sm mt-1">{{categoria.descripcion}}</p>
            </div>
            <div class="text-right">
              <div class="text-3xl font-bold">{{getDatosCategoria(categoria).productos}}</div>
              <div class="opacity-90 text-sm">productos</div>
            </div>
          </div>
          <div class="space-y-2">
            <div class="flex justify-between text-sm">
              <span>Valor Total:</span>
              <span class="font-bold">${{getDatosCategoria(categoria).valor | number:'1.0-0'}}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span>% del Total:</span>
                <span class="font-bold">{{getDatosCategoria(categoria).porcentaje | number:'1.0-0'}}%</span>
              </div>
          </div>
        </div>
      </div>

      <!-- Gráfico ABC -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="bg-gray-50 rounded-xl p-6">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-chart-pie text-purple-600"></i>
            Distribución ABC por Valor
          </h4>
          <div class="chart-container">
            <p-chart 
              type="pie" 
              [data]="abcData" 
              [options]="chartOptions"
              width="350"
              height="350"
            />
          </div>
        </div>

        <div class="bg-gray-50 rounded-xl p-6">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-chart-bar text-blue-600"></i>
            Análisis Comparativo ABC
          </h4>
          <div class="space-y-4">
            <div 
              *ngFor="let analisis of calcularEstadisticas().analisisABC" 
              class="bg-white rounded-lg p-4 border border-gray-200"
            >
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <div 
                    class="w-4 h-4 rounded-full"
                    [ngClass]="'abc-' + analisis.categoria.toLowerCase()"
                  ></div>
                  <span class="font-bold">Categoría {{analisis.categoria}}</span>
                </div>
                <span class="font-bold text-lg">{{analisis.porcentaje | number:'1.0-0'}}%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div 
                  class="h-3 rounded-full transition-all duration-500"
                  [ngClass]="'abc-' + analisis.categoria.toLowerCase()"
                  [style.width.%]="analisis.porcentaje"
                ></div>
              </div>
              <div class="flex justify-between text-sm text-gray-600 mt-2">
                <span>{{analisis.productos}} productos</span>
                <span>${{analisis.valor | number:'1.0-0'}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista detallada por categoría -->
      <div class="space-y-6">
        <div *ngFor="let categoria of categoriasABC">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <div 
              class="w-4 h-4 rounded-full"
              [style.background-color]="categoria.color"
            ></div>
            Productos {{categoria.label}}
          </h4>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div 
                *ngFor="let inventario of getInventariosPorCategoria(categoria)" 
                class="bg-white rounded-lg p-4 border-l-4 hover:shadow-md transition-all duration-300"
                [style.border-left-color]="categoria.color"
              >
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                  <div 
                    class="w-3 h-3 rounded-full" 
                    [style.background-color]="inventario.color?.codigoHex || '#ccc'"
                  ></div>
                  <span class="font-medium text-sm">{{inventario.producto?.nombre}}</span>
                </div>
                <p-chip 
                  [label]="categoria.categoria"
                  [style]="{'background-color': categoria.color, 'color': 'white'}"
                  size="small"
                />
              </div>
              
              <div class="space-y-2">
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600">Stock:</span>
                  <span class="font-bold">{{inventario.cantidad}}</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600">Valor:</span>
                  <span class="font-bold text-green-600">${{inventario.valorTotal | number:'1.0-0'}}</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600">Rotación:</span>
                  <span class="font-bold">{{inventario.rotacion | number:'1.1-1'}}x</span>
                </div>
              </div>
              
              <div class="mt-3 pt-3 border-t border-gray-200">
                <div class="flex gap-2">
                  <p-button 
                    icon="pi pi-eye" 
                    size="small"
                    [outlined]="true"
                    class="flex-1"
                    (click)="mostrarDetalle(inventario)"
                  />
                  <p-button 
                    icon="pi pi-chart-line" 
                    size="small"
                    severity="info"
                    [outlined]="true"
                    pTooltip="Ver análisis"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noAbcData>
      <div class="text-center py-16">
        <div class="bg-purple-100 p-12 rounded-full inline-block mb-6">
          <i class="pi pi-sort-amount-down text-6xl text-purple-600"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-700 mb-3">Sin datos para análisis ABC</h3>
        <p class="text-gray-500 mb-6">Seleccione un producto para realizar el análisis ABC</p>
        <p-button 
          label="Ver Dashboard" 
          icon="pi pi-chart-pie" 
          (click)="currentView = 'dashboard'"
        />
      </div>
    </ng-template>
  </div>
</div>

<!-- Vista de Alertas -->
<div *ngIf="currentView === 'alerts'" class="mb-6">
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <!-- Header de alertas -->
    <div class="bg-gradient-to-r from-red-50 to-orange-50 p-6 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-red-600 p-3 rounded-lg shadow-lg">
            <i class="pi pi-exclamation-triangle text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-gray-800 m-0">Centro de Alertas</h3>
            <p class="text-gray-600 mt-1">Monitoreo inteligente de stock crítico y anomalías</p>
          </div>
        </div>
        <div class="flex gap-2">
          <p-button 
            label="Marcar Todas como Leídas" 
            icon="pi pi-check" 
            severity="secondary"
            [outlined]="true"
          />
          <p-button 
            label="Configurar Alertas" 
            icon="pi pi-cog" 
            severity="info"
          />
        </div>
      </div>
    </div>

    <div class="p-6">
      <!-- Resumen de alertas -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-red-50 rounded-xl p-4 border border-red-200">
          <div class="flex items-center gap-3">
            <div class="bg-red-600 p-2 rounded-lg">
              <i class="pi pi-times-circle text-white"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-red-600">{{getAlertasBySeverity('high')}}</div>
              <div class="text-sm text-gray-600">Críticas</div>
            </div>
          </div>
        </div>
        
        <div class="bg-orange-50 rounded-xl p-4 border border-orange-200">
          <div class="flex items-center gap-3">
            <div class="bg-orange-600 p-2 rounded-lg">
              <i class="pi pi-exclamation-triangle text-white"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-orange-600">{{getAlertasBySeverity('medium')}}</div>
              <div class="text-sm text-gray-600">Importantes</div>
            </div>
          </div>
        </div>
        
        <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
          <div class="flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-lg">
              <i class="pi pi-info-circle text-white"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-blue-600">{{getAlertasBySeverity('low')}}</div>
              <div class="text-sm text-gray-600">Informativas</div>
            </div>
          </div>
        </div>
        
        <div class="bg-green-50 rounded-xl p-4 border border-green-200">
          <div class="flex items-center gap-3">
            <div class="bg-green-600 p-2 rounded-lg">
              <i class="pi pi-check-circle text-white"></i>
            </div>
            <div>
              <div class="text-2xl font-bold text-green-600">{{inventariosFiltrados.length - calcularEstadisticas().alertasCriticas.length > 0 ? inventariosFiltrados.length - calcularEstadisticas().alertasCriticas.length : 0}}</div>
              <div class="text-sm text-gray-600">Sin Problemas</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de alertas -->
      <div class="space-y-4">
        <div 
          *ngFor="let alerta of calcularEstadisticas().alertasCriticas; trackBy: trackByInventario" 
          class="alert-card rounded-xl p-4 border hover:shadow-md transition-all duration-300"
          [ngClass]="'alert-' + alerta.severidad"
        >
          <div class="flex items-start justify-between">
            <div class="flex items-start gap-3">
              <div 
                class="p-2 rounded-lg"
                [ngClass]="{
                  'bg-red-100': alerta.severidad === 'high',
                  'bg-orange-100': alerta.severidad === 'medium',
                  'bg-blue-100': alerta.severidad === 'low'
                }"
              >
                <i 
                  [ngClass]="{
                    'pi pi-times-circle text-red-600': alerta.severidad === 'high',
                    'pi pi-exclamation-triangle text-orange-600': alerta.severidad === 'medium',
                    'pi pi-info-circle text-blue-600': alerta.severidad === 'low'
                  }"
                ></i>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <h4 
                    class="font-bold text-lg m-0"
                    [ngClass]="{
                      'text-red-800': alerta.severidad === 'high',
                      'text-orange-800': alerta.severidad === 'medium',
                      'text-blue-800': alerta.severidad === 'low'
                    }"
                  >
                    {{alerta.producto}}
                  </h4>
                  <p-tag 
                    [value]="alerta.tipo.replace('_', ' ')"
                    [severity]="alerta.severidad === 'high' ? 'danger' : alerta.severidad === 'medium' ? 'warning' : 'info'"
                    size="small"
                  />
                  <p-tag 
                    value="URGENTE"
                    severity="danger"
                    size="small"
                    *ngIf="alerta.urgente"
                  />
                </div>
                <p 
                  class="mb-2"
                  [ngClass]="{
                    'text-red-700': alerta.severidad === 'high',
                    'text-orange-700': alerta.severidad === 'medium',
                    'text-blue-700': alerta.severidad === 'low'
                  }"
                >
                  {{alerta.mensaje}}
                </p>
                <div class="flex items-center gap-4 text-sm text-gray-600">
                  <span>
                    <i class="pi pi-clock mr-1"></i>
                    {{alerta.fechaAlerta | date:'dd/MM/yyyy HH:mm'}}
                  </span>
                  <span>
                    <i class="pi pi-lightbulb mr-1"></i>
                    {{alerta.accionRecomendada}}
                  </span>
                </div>
              </div>
            </div>
            
            <div class="flex gap-2">
              <p-button 
                icon="pi pi-eye" 
                size="small"
                [outlined]="true"
                pTooltip="Ver detalle"
              />
              <p-button 
                icon="pi pi-check" 
                size="small"
                severity="success"
                [outlined]="true"
                pTooltip="Marcar como resuelto"
              />
              <p-button 
                icon="pi pi-times" 
                size="small"
                severity="secondary"
                [outlined]="true"
                pTooltip="Descartar"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Sin alertas -->
      <div *ngIf="!calcularEstadisticas().alertasCriticas.length" class="text-center py-16">
        <div class="bg-green-100 p-12 rounded-full inline-block mb-6">
          <i class="pi pi-check-circle text-6xl text-green-600"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-700 mb-3">¡Todo está bajo control!</h3>
        <p class="text-gray-500 mb-6">No hay alertas críticas en este momento</p>
        <p-button 
          label="Ver Dashboard" 
          icon="pi pi-chart-pie" 
          (click)="currentView = 'dashboard'"
        />
      </div>
    </div>
  </div>
</div>

<!-- Modal de Crear/Editar Inventario (Modernizado) -->
<p-dialog 
  [(visible)]="inventarioDialog" 
  [style]="{'width': '800px'}" 
  [header]="editMode ? 'Editar Inventario' : 'Nuevo Inventario'" 
  [modal]="true" 
  (onHide)="hideDialog()"
  [maximizable]="true"
>
  <div>
    <!-- Header del modal con información del producto -->
    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-6" *ngIf="productoSeleccionado">
      <div class="flex items-center gap-4">
        <div class="bg-green-600 p-3 rounded-lg shadow-lg">
          <i class="pi pi-box text-white text-xl"></i>
        </div>
        <div>
          <h3 class="text-xl font-bold text-gray-800 m-0">{{productoSeleccionado.codigo}} - {{productoSeleccionado.nombre}}</h3>
          <p class="text-gray-600 mt-1">{{productoSeleccionado.nombre}} | Precio: S/. {{productoSeleccionado.precioVenta}}</p>
        </div>
      </div>
    </div>

    <!-- Formulario en pestañas -->
    <p-tabView [(activeIndex)]="activeTab">
      <!-- Tab: Información Básica -->
      <p-tabPanel header="Información Básica" leftIcon="pi pi-info-circle">
        <div class="p-4">
          <!-- Selector de producto (solo en modo creación) -->
          <div class="mb-6" *ngIf="!editMode">
            <div class="flex items-center gap-2 mb-3">
              <i class="pi pi-tag text-blue-600"></i>
              <label for="producto" class="font-bold text-gray-700">Producto*</label>
            </div>
            <p-select 
              id="producto" 
              [options]="productos" 
              [(ngModel)]="productoSeleccionado" 
              optionLabel="codigo"
              placeholder="Seleccione un producto"
              [filter]="true"
              filterBy="nombre,codigo"
              [showClear]="true"
              [style]="{'width':'100%'}"
              [ngClass]="{'ng-invalid': submitted && !productoSeleccionado}"
              (onChange)="loadColoresPorProducto(productoSeleccionado?.id || 0)"
              styleClass="h-12"
            >
              <ng-template pTemplate="selectedItem">
                <div *ngIf="productoSeleccionado" class="flex items-center gap-3">
                  <div class="bg-blue-100 p-2 rounded-lg">
                    <i class="pi pi-tag text-blue-600"></i>
                  </div>
                  <div>
                    <div class="font-medium">{{productoSeleccionado.codigo}} - {{productoSeleccionado.nombre}}</div>
                    <small class="text-gray-500">{{productoSeleccionado.nombre}} - Precio: S/. {{productoSeleccionado.precioVenta}}</small>
                  </div>
                </div>
              </ng-template>
              <ng-template let-item pTemplate="item">
                <div class="flex items-center gap-3 p-2">
                  <div class="bg-gray-100 p-2 rounded">
                    <i class="pi pi-tag text-gray-600"></i>
                  </div>
                  <div>
                    <div class="font-medium">{{item.codigo}} - {{item.nombre}}</div>
                    <small class="text-gray-500">{{item.nombre}} - S/. {{item.precioVenta}}</small>
                  </div>
                </div>
              </ng-template>
            </p-select>
            <small class="text-red-500 block mt-2" *ngIf="submitted && !productoSeleccionado">
              <i class="pi pi-exclamation-triangle mr-1"></i>
              El producto es obligatorio.
            </small>
          </div>

          <!-- Información del producto en modo edición -->
          <div class="mb-6" *ngIf="editMode && productoSeleccionado">
            <div class="flex items-center gap-2 mb-3">
              <i class="pi pi-tag text-blue-600"></i>
              <label class="font-bold text-gray-700">Producto</label>
            </div>
            <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
              <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded-lg">
                  <i class="pi pi-tag text-white"></i>
                </div>
                <div>
                  <div class="font-bold text-gray-900">{{productoSeleccionado.codigo}} - {{productoSeleccionado.nombre}}</div>
                  <div class="text-sm text-gray-600">{{productoSeleccionado.nombre}} - {{productoSeleccionado.marca}} {{productoSeleccionado.modelo}}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Grid de variantes -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Selector de color -->
            <div>
              <div class="flex items-center gap-2 mb-3">
                <i class="pi pi-palette text-green-600"></i>
                <label class="font-bold text-gray-700" for="color">Color*</label>
              </div>
              
              <div *ngIf="!editMode">
                <p-select 
                  id="color" 
                  [options]="colores" 
                  [(ngModel)]="colorSeleccionado" 
                  optionLabel="nombre"
                  placeholder="Seleccione un color"
                  [filter]="true"
                  [showClear]="true"
                  [style]="{'width':'100%'}"
                  [disabled]="!productoSeleccionado"
                  [ngClass]="{'ng-invalid': submitted && !colorSeleccionado}"
                  (onChange)="loadTallasPorColor(colorSeleccionado?.id || 0)"
                  styleClass="h-12"
                >
                  <ng-template pTemplate="selectedItem">
                    <div *ngIf="colorSeleccionado" class="flex items-center gap-2">
                      <div 
                        class="w-6 h-6 rounded-full border-2 border-white shadow-sm" 
                        [style.background-color]="colorSeleccionado.codigoHex || '#ccc'"
                      ></div>
                      <span class="font-medium">{{colorSeleccionado.nombre}}</span>
                    </div>
                  </ng-template>
                  <ng-template let-item pTemplate="item">
                    <div class="flex items-center gap-2">
                      <div 
                        class="w-6 h-6 rounded-full border-2 border-white shadow-sm" 
                        [style.background-color]="item.codigoHex || '#ccc'"
                      ></div>
                      <span>{{item.nombre}}</span>
                    </div>
                  </ng-template>
                </p-select>
                <small class="text-red-500 block mt-2" *ngIf="submitted && !colorSeleccionado">
                  <i class="pi pi-exclamation-triangle mr-1"></i>
                  El color es obligatorio.
                </small>
                <small class="text-gray-500 block mt-2" *ngIf="!productoSeleccionado">
                  Primero seleccione un producto
                </small>
              </div>
              
              <!-- Color en modo edición -->
              <div *ngIf="editMode && colorSeleccionado" class="bg-green-50 rounded-xl p-4 border border-green-200">
                <div class="flex items-center gap-3">
                  <div 
                    class="w-8 h-8 rounded-full border-2 border-white shadow-sm" 
                    [style.background-color]="colorSeleccionado.codigoHex || '#ccc'"
                  ></div>
                  <span class="font-medium text-gray-800">{{colorSeleccionado.nombre}}</span>
                </div>
              </div>
            </div>

            <!-- Selector de talla -->
            <div>
              <div class="flex items-center gap-2 mb-3">
                <i class="pi pi-tag text-purple-600"></i>
                <label class="font-bold text-gray-700" for="talla">Talla*</label>
              </div>
              
              <div *ngIf="!editMode">
                <p-select 
                  id="talla" 
                  [options]="tallas" 
                  [(ngModel)]="tallaSeleccionada" 
                  optionLabel="numero"
                  placeholder="Seleccione una talla"
                  [filter]="true"
                  [style]="{'width':'100%'}"
                  [showClear]="true"
                  [disabled]="!colorSeleccionado"
                  [ngClass]="{'ng-invalid': submitted && !tallaSeleccionada}"
                  styleClass="h-12"
                >
                  <ng-template pTemplate="selectedItem">
                    <div *ngIf="tallaSeleccionada" class="flex items-center gap-2">
                      <div class="bg-purple-100 p-2 rounded-lg">
                        <i class="pi pi-tag text-purple-600"></i>
                      </div>
                      <span class="font-medium">Talla {{tallaSeleccionada.numero}}</span>
                    </div>
                  </ng-template>
                  <ng-template let-item pTemplate="item">
                    <div class="flex items-center gap-2">
                      <div class="bg-purple-100 p-1 rounded">
                        <i class="pi pi-tag text-purple-600 text-sm"></i>
                      </div>
                      <span>Talla {{item.numero}}</span>
                    </div>
                  </ng-template>
                </p-select>
                <small class="text-red-500 block mt-2" *ngIf="submitted && !tallaSeleccionada">
                  <i class="pi pi-exclamation-triangle mr-1"></i>
                  La talla es obligatoria.
                </small>
                <small class="text-gray-500 block mt-2" *ngIf="!colorSeleccionado">
                  Primero seleccione un color
                </small>
              </div>
              
              <!-- Talla en modo edición -->
              <div *ngIf="editMode && tallaSeleccionada" class="bg-purple-50 rounded-xl p-4 border border-purple-200">
                <div class="flex items-center gap-3">
                  <div class="bg-purple-600 p-2 rounded-lg">
                    <i class="pi pi-tag text-white"></i>
                  </div>
                  <span class="font-medium text-gray-800">Talla {{tallaSeleccionada.numero}}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Selector de Almacén -->
          <div class="mb-6">
            <div class="flex items-center gap-2 mb-3">
              <i class="pi pi-building text-indigo-600"></i>
              <label class="font-bold text-gray-700" for="almacen">Almacén*</label>
            </div>
            
            <div *ngIf="!editMode">
              <p-select 
                id="almacen" 
                [options]="almacenes" 
                [(ngModel)]="almacenSeleccionado" 
                optionLabel="nombre"
                placeholder="Seleccione un almacén"
                [filter]="true"
                [style]="{'width':'100%'}"
                [showClear]="true"
                [disabled]="!productoSeleccionado"
                [ngClass]="{'ng-invalid': submitted && !almacenSeleccionado}"
                styleClass="h-12"
              >
                <ng-template pTemplate="selectedItem">
                  <div *ngIf="almacenSeleccionado" class="flex items-center gap-3">
                    <div class="bg-indigo-100 p-2 rounded-lg">
                      <i class="pi pi-building text-indigo-600"></i>
                    </div>
                    <div>
                      <div class="font-medium">{{almacenSeleccionado.nombre}}</div>
                      <small class="text-gray-500">{{almacenSeleccionado.ubicacion}}</small>
                    </div>
                  </div>
                </ng-template>
                <ng-template let-item pTemplate="item">
                  <div class="flex items-center gap-3 p-2">
                    <div class="bg-indigo-100 p-2 rounded">
                      <i class="pi pi-building text-indigo-600"></i>
                    </div>
                    <div>
                      <div class="font-medium">{{item.nombre}}</div>
                      <small class="text-gray-500">{{item.ubicacion}}</small>
                    </div>
                  </div>
                </ng-template>
              </p-select>
              <small class="text-red-500 block mt-2" *ngIf="submitted && !almacenSeleccionado">
                <i class="pi pi-exclamation-triangle mr-1"></i>
                El almacén es obligatorio.
              </small>
            </div>
            
            <!-- Almacén en modo edición -->
            <div *ngIf="editMode && almacenSeleccionado" class="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
              <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-lg">
                  <i class="pi pi-building text-white"></i>
                </div>
                <div>
                  <div class="font-medium text-gray-800">{{almacenSeleccionado.nombre}}</div>
                  <small class="text-gray-500">{{almacenSeleccionado.ubicacion}}</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Cantidad y Estado -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Cantidad -->
            <div>
              <div class="flex items-center gap-2 mb-3">
                <i class="pi pi-box text-orange-600"></i>
                <label for="cantidad" class="font-bold text-gray-700">Cantidad*</label>
              </div>
              <div class="bg-orange-50 rounded-xl p-4 border border-orange-200">
                <p-inputNumber
                  id="cantidad"
                  [(ngModel)]="inventario.cantidad"
                  [showButtons]="true"
                  buttonLayout="horizontal"
                  [min]="0"
                  [max]="999999"
                  [step]="1"
                  decrementButtonClass="p-button-danger"
                  incrementButtonClass="p-button-success"
                  incrementButtonIcon="pi pi-plus"
                  decrementButtonIcon="pi pi-minus"
                  [style]="{'width':'100%'}"
                  [ngClass]="{'ng-invalid': submitted && inventario.cantidad < 0}"
                  styleClass="h-12"
                />
                <small class="text-red-500 block mt-2" *ngIf="submitted && inventario.cantidad < 0">
                  <i class="pi pi-exclamation-triangle mr-1"></i>
                  La cantidad debe ser mayor o igual a 0.
                </small>
              </div>
            </div>

            <!-- Estado -->
            <div>
              <div class="flex items-center gap-2 mb-3">
                <i class="pi pi-bookmark text-red-600"></i>
                <label for="estado" class="font-bold text-gray-700">Estado</label>
              </div>
              <div class="bg-red-50 rounded-xl p-4 border border-red-200">
                <p-select 
                  id="estado" 
                  [options]="estadosInventario" 
                  [(ngModel)]="inventario.estado" 
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Seleccione el estado"
                  [style]="{'width':'100%'}"
                  styleClass="h-12"
                >
                <ng-template pTemplate="selectedItem">
                  <div *ngIf="inventario.estado" class="flex items-center gap-2">
                    <i [class]="getEstadoIcon(inventario.estado)" [style.color]="getEstadoColor(inventario.estado)"></i>
                    <span>{{getEstadoLabel(inventario.estado)}}</span>
                  </div>
                </ng-template>
                  <ng-template let-item pTemplate="item">
                    <div class="flex items-center gap-2">
                      <i [class]="item.icon" [style.color]="item.color"></i>
                      <span>{{item.label}}</span>
                    </div>
                  </ng-template>
                </p-select>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>

      <!-- Tab: Configuración Avanzada -->
      <p-tabPanel header="Configuración Avanzada" leftIcon="pi pi-cog">
        <div class="p-4">
          <!-- Información de costos y valorización -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Costos -->
            <div class="bg-green-50 rounded-xl p-6 border border-green-200">
              <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="pi pi-dollar text-green-600"></i>
                Información de Costos
              </h4>
              <div class="space-y-4">
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Costo Unitario</label>
                  <p-inputNumber
                    [(ngModel)]="inventario.costo"
                    mode="currency"
                    currency="USD"
                    locale="en-US"
                    [min]="0"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Valor Unitario</label>
                  <p-inputNumber
                    [(ngModel)]="inventario.valorUnitario"
                    mode="currency"
                    currency="USD"
                    locale="en-US"
                    [min]="0"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Margen (%)</label>
                  <p-inputNumber
                    [(ngModel)]="inventario.margen"
                    suffix="%"
                    [min]="0"
                    [max]="100"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
              </div>
            </div>

            <!-- Stock de seguridad -->
            <div class="bg-blue-50 rounded-xl p-6 border border-blue-200">
              <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="pi pi-shield text-blue-600"></i>
                Niveles de Stock
              </h4>
              <div class="space-y-4">
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Stock Mínimo</label>
                  <p-inputNumber
                    [(ngModel)]="inventario.stockMinimo"
                    [showButtons]="true"
                    [min]="0"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Stock Máximo</label>
                  <p-inputNumber
                    [(ngModel)]="inventario.stockMaximo"
                    [showButtons]="true"
                    [min]="0"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Punto de Reorden</label>
                  <p-inputNumber
                    [(ngModel)]="inventario.puntoReorden"
                    [showButtons]="true"
                    [min]="0"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Información adicional -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Ubicación y lote -->
            <div class="bg-purple-50 rounded-xl p-6 border border-purple-200">
              <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="pi pi-map-marker text-purple-600"></i>
                Ubicación y Trazabilidad
              </h4>
              <div class="space-y-4">
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Ubicación en Almacén</label>
                  <input 
                    type="text" 
                    pInputText 
                    [(ngModel)]="inventario.ubicacionAlmacen"
                    placeholder="Ej: Pasillo A - Estante 3"
                    class="w-full h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Número de Lote</label>
                  <input 
                    type="text" 
                    pInputText 
                    [(ngModel)]="inventario.lote"
                    placeholder="Ej: LT001234"
                    class="w-full h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Fecha de Vencimiento</label>
                  <p-calendar 
                    [(ngModel)]="inventario.fechaVencimiento"
                    [showIcon]="true"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
              </div>
            </div>

            <!-- Análisis y categorización -->
            <div class="bg-orange-50 rounded-xl p-6 border border-orange-200">
              <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="pi pi-chart-bar text-orange-600"></i>
                Análisis y Categorización
              </h4>
              <div class="space-y-4">
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Categoría ABC</label>
                  <p-select 
                    [options]="categoriasABC" 
                    [(ngModel)]="inventario.categoriaABC" 
                    optionLabel="label"
                    optionValue="categoria"
                    placeholder="Categoría automática"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Rotación Anual (estimada)</label>
                  <p-inputNumber
                    [(ngModel)]="inventario.rotacion"
                    suffix="x/año"
                    [min]="0"
                    [style]="{'width':'100%'}"
                    styleClass="h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Proveedor Principal</label>
                  <input 
                    type="text" 
                    pInputText 
                    [(ngModel)]="inventario.proveedorPrincipal"
                    placeholder="Nombre del proveedor"
                    class="w-full h-10"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="text-sm text-gray-600" *ngIf="editMode">
        <i class="pi pi-info-circle mr-1"></i>
        Editando inventario ID: {{inventario.id}}
      </div>
      <div class="flex gap-3">
        <p-button 
          label="Cancelar" 
          icon="pi pi-times" 
          class="p-button-text" 
          (click)="hideDialog()"
          [disabled]="loading"
        />
        <p-button 
          label="Guardar como Borrador" 
          icon="pi pi-save" 
          severity="secondary"
          [outlined]="true"
          (click)="guardarInventario()"
          [loading]="loading"
          *ngIf="!editMode"
        />
        <p-button 
          [label]="editMode ? 'Actualizar Inventario' : 'Crear Inventario'" 
          icon="pi pi-check" 
          (click)="guardarInventario()"
          [loading]="loading"
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Detalle de Inventario -->
<p-dialog 
  [(visible)]="detalleInventarioDialog" 
  [style]="{width: '1000px'}" 
  [header]="'Detalle de Inventario: ' + (inventario.producto?.nombre || 'Producto')" 
  [modal]="true" 
  (onHide)="hideDetalleDialog()"
  [maximizable]="true"
>
  <div *ngIf="inventario.id">
    <!-- Header con información clave -->
    <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-xl p-6 mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="bg-blue-600 p-4 rounded-lg shadow-lg">
            <i class="pi pi-box text-white text-2xl"></i>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-gray-800 m-0">{{inventario.producto?.nombre}}</h2>
            <p class="text-gray-600 mt-1">Serie: {{inventario.serie}} | Código: {{inventario.producto?.codigo}}</p>
            <div class="flex items-center gap-3 mt-2">
              <div class="flex items-center gap-2">
                <div 
                  class="w-4 h-4 rounded-full border" 
                  [style.background-color]="inventario.color?.codigoHex || '#ccc'"
                ></div>
                <span class="text-sm font-medium">{{inventario.color?.nombre}}</span>
              </div>
              <p-tag 
                [value]="'Talla ' + inventario.talla?.numero"
                severity="secondary"
                size="small"
              />
              <p-tag 
                [value]="inventario.estado"
                [severity]="getEstadoSeverity(inventario.estado)"
                [icon]="getEstadoIcon(inventario.estado)"
                size="small"
              />
            </div>
          </div>
        </div>
        
        <!-- Métricas principales -->
        <div class="grid grid-cols-2 gap-4 text-center">
          <div class="bg-white rounded-xl p-4 shadow-sm">
            <div class="text-3xl font-bold" [ngClass]="getStockClass(inventario)">{{inventario.cantidad}}</div>
            <div class="text-sm text-gray-600">Stock Actual</div>
          </div>
          <div class="bg-white rounded-xl p-4 shadow-sm" *ngIf="inventario.valorTotal">
            <div class="text-3xl font-bold text-green-600">${{inventario.valorTotal | number:'1.0-0'}}</div>
            <div class="text-sm text-gray-600">Valor Total</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs de información detallada -->
    <p-tabView>
      <!-- Tab: Información General -->
      <p-tabPanel header="Información General" leftIcon="pi pi-info-circle">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Datos básicos -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-info text-blue-600"></i>
              Información Básica
            </h4>
            <div class="space-y-4">
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="font-medium text-gray-700">Serie:</span>
                <span class="text-gray-900 font-mono">{{inventario.serie}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="font-medium text-gray-700">Producto:</span>
                <span class="text-gray-900">{{inventario.producto?.nombre}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="font-medium text-gray-700">Código:</span>
                <span class="text-gray-900 font-mono">{{inventario.producto?.codigo}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="font-medium text-gray-700">Almacén:</span>
                <span class="text-gray-900">{{inventario.almacen?.nombre}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="font-medium text-gray-700">Ubicación:</span>
                <span class="text-gray-900">{{inventario.ubicacionAlmacen || 'No especificada'}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="font-medium text-gray-700">Lote:</span>
                <span class="text-gray-900 font-mono">{{inventario.lote || 'No asignado'}}</span>
              </div>
            </div>
          </div>
          
          <!-- Información de stock -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-chart-pie text-green-600"></i>
              Control de Stock
            </h4>
            
            <!-- Indicador visual de stock -->
            <div class="text-center mb-6">
              <div class="relative inline-block">
                <p-knob 
                [ngModel]="getStockPercentage(inventario)"
                [size]="120"
                [readonly]="true"
                valueTemplate="{value}%"
                strokeWidth="8"
                [rangeColor]="getStockLevel(inventario) === 'critical' ? '#ef4444' : 
                             getStockLevel(inventario) === 'low' ? '#f59e0b' : 
                             getStockLevel(inventario) === 'high' ? '#3b82f6' : '#10b981'"
                textColor="#374151"
              />
              </div>
              <div class="mt-3 text-sm font-medium" [ngClass]="getStockClass(inventario)">
                {{getStockLevel(inventario) === 'critical' ? 'Stock Crítico' :
                  getStockLevel(inventario) === 'low' ? 'Stock Bajo' :
                  getStockLevel(inventario) === 'high' ? 'Sobrestock' : 'Stock Normal'}}
              </div>
            </div>
            
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Stock Actual:</span>
                <span class="font-bold text-blue-600">{{inventario.cantidad}} unidades</span>
              </div>
              <div class="flex justify-between items-center" *ngIf="inventario.stockMinimo">
                <span class="text-gray-600">Stock Mínimo:</span>
                <span class="font-bold text-orange-600">{{inventario.stockMinimo}} unidades</span>
              </div>
              <div class="flex justify-between items-center" *ngIf="inventario.stockMaximo">
                <span class="text-gray-600">Stock Máximo:</span>
                <span class="font-bold text-purple-600">{{inventario.stockMaximo}} unidades</span>
              </div>
              <div class="flex justify-between items-center" *ngIf="inventario.puntoReorden">
                <span class="text-gray-600">Punto de Reorden:</span>
                <span class="font-bold text-indigo-600">{{inventario.puntoReorden}} unidades</span>
              </div>
            </div>
          </div>
          
          <!-- Información financiera -->
          <div class="bg-white rounded-xl p-6 border border-gray-200" *ngIf="inventario.valorUnitario">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-dollar text-green-600"></i>
              Información Financiera
            </h4>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Costo Unitario:</span>
                <span class="font-bold text-red-600">${{inventario.costo | number:'1.2-2'}}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Valor Unitario:</span>
                <span class="font-bold text-blue-600">${{inventario.valorUnitario | number:'1.2-2'}}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Valor Total:</span>
                <span class="font-bold text-green-600">${{inventario.valorTotal | number:'1.2-2'}}</span>
              </div>
              <div class="flex justify-between items-center" *ngIf="inventario.margen">
                <span class="text-gray-600">Margen:</span>
                <span class="font-bold text-purple-600">{{inventario.margen | number:'1.1-1'}}%</span>
              </div>
            </div>
            
            <!-- Gráfico de distribución de costos -->
            <div class="mt-4 pt-4 border-t border-gray-200" *ngIf="inventario.costo && inventario.valorUnitario">
              <div class="space-y-2">
                <div class="flex justify-between text-sm">
                  <span>Costo</span>
                  <span>{{(inventario.costo / inventario.valorUnitario) * 100 | number:'1.0-0'}}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div 
                    class="bg-red-500 h-3 rounded-l-full"
                    [style.width.%]="(inventario.costo / inventario.valorUnitario) * 100"
                  ></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Análisis y métricas -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-chart-line text-purple-600"></i>
              Análisis y Métricas
            </h4>
            <div class="space-y-4">
              <div class="flex justify-between items-center" *ngIf="inventario.categoriaABC">
                <span class="text-gray-600">Categoría ABC:</span>
                <p-chip 
                  [label]="inventario.categoriaABC"
                  [styleClass]="'abc-' + inventario.categoriaABC.toLowerCase()"
                  size="small"
                />
              </div>
              <div class="flex justify-between items-center" *ngIf="inventario.rotacion">
                <span class="text-gray-600">Rotación Anual:</span>
                <span class="font-bold text-blue-600">{{inventario.rotacion | number:'1.1-1'}}x</span>
              </div>
              <div class="flex justify-between items-center" *ngIf="inventario.tendencia">
                <span class="text-gray-600">Tendencia:</span>
                <div class="flex items-center gap-2">
                  <i [class]="getTendenciaIcon(inventario.tendencia)" [style.color]="getTendenciaColor(inventario.tendencia)"></i>
                  <span [style.color]="getTendenciaColor(inventario.tendencia)" class="font-medium">{{inventario.tendencia}}</span>
                </div>
              </div>
              <div class="flex justify-between items-center" *ngIf="inventario.diasSinMovimiento">
                <span class="text-gray-600">Días sin Movimiento:</span>
                <span class="font-bold" [ngClass]="inventario.diasSinMovimiento > 90 ? 'text-red-600' : inventario.diasSinMovimiento > 30 ? 'text-orange-600' : 'text-green-600'">
                  {{inventario.diasSinMovimiento}}
                </span>
              </div>
              <div class="flex justify-between items-center" *ngIf="inventario.prediccionDemanda">
                <span class="text-gray-600">Predicción Demanda:</span>
                <span class="font-bold text-indigo-600">{{inventario.prediccionDemanda}} uds/mes</span>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      
      <!-- Tab: Historial de Movimientos -->
      <p-tabPanel header="Movimientos" leftIcon="pi pi-history">
        <div *ngIf="inventario.movimientos?.length; else noMovimientos">
          <div class="mb-4 flex justify-between items-center">
            <h4 class="font-bold text-gray-800 flex items-center gap-2">
              <i class="pi pi-history text-indigo-600"></i>
              Historial de Movimientos ({{inventario.movimientos?.length}})
            </h4>
            <p-button 
              label="Ver Todos los Movimientos" 
              icon="pi pi-external-link" 
              severity="info"
              [outlined]="true"
              size="small"
              (click)="mostrarMovimientos(inventario)"
            />
          </div>
          
          <div class="movement-timeline">
            <div 
              *ngFor="let movimiento of inventario.movimientos?.slice(0, 10); trackBy: trackByMovimiento" 
              class="movement-item bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-all duration-300"
            >
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                  <div 
                    class="p-2 rounded-lg"
                    [ngClass]="{
                      'bg-green-100': movimiento.tipo === 'ENTRADA',
                      'bg-red-100': movimiento.tipo === 'SALIDA',
                      'bg-orange-100': movimiento.tipo === 'AJUSTE',
                      'bg-blue-100': movimiento.tipo === 'TRANSFERENCIA'
                    }"
                  >
                    <i 
                      [ngClass]="{
                        'pi pi-arrow-down text-green-600': movimiento.tipo === 'ENTRADA',
                        'pi pi-arrow-up text-red-600': movimiento.tipo === 'SALIDA',
                        'pi pi-wrench text-orange-600': movimiento.tipo === 'AJUSTE',
                        'pi pi-arrows-h text-blue-600': movimiento.tipo === 'TRANSFERENCIA'
                      }"
                    ></i>
                  </div>
                  <div>
                    <div class="font-medium text-gray-800">{{movimiento.tipo}} - {{movimiento.motivo}}</div>
                    <div class="text-sm text-gray-600">{{movimiento.referencia}}</div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-bold text-lg" 
                       [ngClass]="{
                         'text-green-600': movimiento.tipo === 'ENTRADA',
                         'text-red-600': movimiento.tipo === 'SALIDA',
                         'text-orange-600': movimiento.tipo === 'AJUSTE',
                         'text-blue-600': movimiento.tipo === 'TRANSFERENCIA'
                       }">
                    {{movimiento.tipo === 'ENTRADA' ? '+' : movimiento.tipo === 'SALIDA' ? '-' : '±'}}{{movimiento.cantidad}}
                  </div>
                  <div class="text-sm text-gray-500">
                    {{movimiento.fecha | date:'dd/MM/yyyy HH:mm'}}
                  </div>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span class="text-gray-600">Stock anterior:</span>
                  <span class="font-medium ml-2">{{movimiento.cantidadAnterior}}</span>
                </div>
                <div>
                  <span class="text-gray-600">Stock nuevo:</span>
                  <span class="font-medium ml-2">{{movimiento.cantidadNueva}}</span>
                </div>
                <div>
                  <span class="text-gray-600">Usuario:</span>
                  <span class="font-medium ml-2">{{movimiento.usuario}}</span>
                </div>
                <div *ngIf="movimiento.costo">
                  <span class="text-gray-600">Costo:</span>
                  <span class="font-medium ml-2">${{movimiento.costo | number:'1.2-2'}}</span>
                </div>
              </div>
              
              <div *ngIf="movimiento.observaciones" class="mt-3 pt-3 border-t border-gray-200 text-sm text-gray-600">
                <i class="pi pi-info-circle mr-1"></i>
                {{movimiento.observaciones}}
              </div>
            </div>
          </div>
        </div>
        
        <ng-template #noMovimientos>
          <div class="text-center py-12">
            <div class="bg-indigo-100 p-8 rounded-full inline-block mb-4">
              <i class="pi pi-history text-4xl text-indigo-600"></i>
            </div>
            <h4 class="text-xl font-bold text-gray-700 mb-2">Sin movimientos registrados</h4>
            <p class="text-gray-500">Este inventario no tiene movimientos en el historial</p>
          </div>
        </ng-template>
      </p-tabPanel>
      
      <!-- Tab: Fechas Importantes -->
      <p-tabPanel header="Fechas" leftIcon="pi pi-calendar">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Información de fechas -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-calendar text-blue-600"></i>
              Fechas de Registro
            </h4>
            <div class="space-y-4">
              <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                <span class="font-medium text-gray-700">Fecha de Creación:</span>
                <span class="text-blue-600 font-medium">{{inventario.fechaCreacion | date:'dd/MM/yyyy HH:mm'}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                <span class="font-medium text-gray-700">Última Actualización:</span>
                <span class="text-green-600 font-medium">{{inventario.fechaActualizacion | date:'dd/MM/yyyy HH:mm'}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg" *ngIf="inventario.fechaUltimoMovimiento">
                <span class="font-medium text-gray-700">Último Movimiento:</span>
                <span class="text-purple-600 font-medium">{{inventario.fechaUltimoMovimiento | date:'dd/MM/yyyy HH:mm'}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-orange-50 rounded-lg" *ngIf="inventario.fechaVencimiento">
                <span class="font-medium text-gray-700">Fecha de Vencimiento:</span>
                <span 
                class="font-medium"
                [ngClass]="getDateClass(inventario.fechaVencimiento)"
              >
                {{inventario.fechaVencimiento | date:'dd/MM/yyyy'}}
              </span>
              </div>
            </div>
          </div>

          <!-- Información del proveedor -->
          <div class="bg-white rounded-xl p-6 border border-gray-200" *ngIf="inventario.proveedorPrincipal">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-truck text-green-600"></i>
              Información del Proveedor
            </h4>
            <div class="space-y-4">
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="font-medium text-gray-700">Proveedor:</span>
                <span class="text-gray-900 font-medium">{{inventario.proveedorPrincipal}}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg" *ngIf="inventario.tiempoReposicion">
                <span class="font-medium text-gray-700">Tiempo de Reposición:</span>
                <span class="text-gray-900 font-medium">{{inventario.tiempoReposicion}} días</span>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="text-sm text-gray-600">
        <i class="pi pi-info-circle mr-1"></i>
        ID: {{inventario.id}} | Última actualización: {{inventario.fechaActualizacion | date:'dd/MM/yyyy HH:mm'}}
      </div>
      <div class="flex gap-3">
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          class="p-button-text" 
          (click)="hideDetalleDialog()" 
        />
        <p-button 
          label="Ver Movimientos" 
          icon="pi pi-history" 
          severity="info"
          [outlined]="true"
          (click)="mostrarMovimientos(inventario); hideDetalleDialog()" 
        />
        <p-button 
          *appHasPermission="{module: 'inventario', permission: permissionTypes.EDIT}"
          label="Editar" 
          icon="pi pi-pencil" 
          (click)="editInventario(inventario); hideDetalleDialog()" 
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Movimientos de Inventario -->
<p-dialog 
  [(visible)]="movimientosDialog" 
  [style]="{width: '1200px'}" 
  [header]="'Movimientos de Inventario' + (inventario.producto?.nombre ? ' - ' + inventario.producto?.nombre : '')" 
  [modal]="true" 
  (onHide)="hideMovimientosDialog()"
  [maximizable]="true"
>
  <div>
    <!-- Header con estadísticas de movimientos -->
    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-indigo-600 p-3 rounded-lg shadow-lg">
            <i class="pi pi-history text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-xl font-bold text-gray-800 m-0">Historial de Movimientos</h3>
            <p class="text-gray-600 mt-1">Trazabilidad completa de entradas, salidas y ajustes</p>
          </div>
        </div>
        <div class="flex gap-2">
          <p-button 
            label="Nuevo Movimiento" 
            icon="pi pi-plus" 
            severity="info"
            (click)="abrirNuevoMovimiento()"
          />
          <p-button 
            label="Exportar Movimientos" 
            icon="pi pi-download" 
            severity="secondary"
            [outlined]="true"
          />
        </div>
      </div>
    </div>

    <!-- Estadísticas de movimientos -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-green-50 rounded-xl p-4 border border-green-200">
        <div class="flex items-center gap-3">
          <div class="bg-green-600 p-2 rounded-lg">
            <i class="pi pi-arrow-down text-white"></i>
          </div>
          <div>
            <div class="text-2xl font-bold text-green-600">1,240</div>
            <div class="text-sm text-gray-600">Entradas Total</div>
          </div>
        </div>
      </div>
      
      <div class="bg-red-50 rounded-xl p-4 border border-red-200">
        <div class="flex items-center gap-3">
          <div class="bg-red-600 p-2 rounded-lg">
            <i class="pi pi-arrow-up text-white"></i>
          </div>
          <div>
            <div class="text-2xl font-bold text-red-600">890</div>
            <div class="text-sm text-gray-600">Salidas Total</div>
          </div>
        </div>
      </div>
      
      <div class="bg-orange-50 rounded-xl p-4 border border-orange-200">
        <div class="flex items-center gap-3">
          <div class="bg-orange-600 p-2 rounded-lg">
            <i class="pi pi-wrench text-white"></i>
          </div>
          <div>
            <div class="text-2xl font-bold text-orange-600">45</div>
            <div class="text-sm text-gray-600">Ajustes Total</div>
          </div>
        </div>
      </div>
      
      <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
        <div class="flex items-center gap-3">
          <div class="bg-blue-600 p-2 rounded-lg">
            <i class="pi pi-arrows-h text-white"></i>
          </div>
          <div>
            <div class="text-2xl font-bold text-blue-600">120</div>
            <div class="text-sm text-gray-600">Transferencias</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Splitter para vista dividida -->
    <p-splitter [style]="{'height': '600px'}" [panelSizes]="[70, 30]">
      <!-- Panel izquierdo: Timeline de movimientos -->
      <ng-template pTemplate="panel">
        <div class="p-4">
          <div class="flex items-center justify-between mb-4">
            <h4 class="font-bold text-gray-800 flex items-center gap-2">
              <i class="pi pi-clock text-indigo-600"></i>
              Timeline de Movimientos
            </h4>
            <div class="flex gap-2">
              <p-button 
                icon="pi pi-filter" 
                severity="secondary" 
                [outlined]="true"
                size="small"
                pTooltip="Filtrar movimientos"
              />
              <p-button 
                icon="pi pi-refresh" 
                severity="secondary" 
                [outlined]="true"
                size="small"
                pTooltip="Actualizar"
              />
            </div>
          </div>
          
          <div class="movement-timeline max-h-96 overflow-y-auto">
            <div 
              *ngFor="let movimiento of (inventario.movimientos || []); trackBy: trackByMovimiento; let i = index" 
              class="movement-item bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-all duration-300 mb-4"
            >
              <!-- Header del movimiento -->
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                  <div 
                    class="p-3 rounded-lg shadow-sm"
                    [ngClass]="{
                      'bg-green-100': movimiento.tipo === 'ENTRADA',
                      'bg-red-100': movimiento.tipo === 'SALIDA',
                      'bg-orange-100': movimiento.tipo === 'AJUSTE',
                      'bg-blue-100': movimiento.tipo === 'TRANSFERENCIA'
                    }"
                  >
                    <i 
                      [ngClass]="{
                        'pi pi-arrow-down text-green-600': movimiento.tipo === 'ENTRADA',
                        'pi pi-arrow-up text-red-600': movimiento.tipo === 'SALIDA',
                        'pi pi-wrench text-orange-600': movimiento.tipo === 'AJUSTE',
                        'pi pi-arrows-h text-blue-600': movimiento.tipo === 'TRANSFERENCIA'
                      }"
                      class="text-xl"
                    ></i>
                  </div>
                  <div>
                    <div class="font-bold text-gray-800 text-lg">{{movimiento.tipo}}</div>
                    <div class="text-sm text-gray-600">{{movimiento.motivo}}</div>
                    <div class="text-xs text-gray-500" *ngIf="movimiento.referencia">
                      Ref: {{movimiento.referencia}}
                    </div>
                  </div>
                </div>
                
                <div class="text-right">
                  <div class="font-bold text-2xl" 
                       [ngClass]="{
                         'text-green-600': movimiento.tipo === 'ENTRADA',
                         'text-red-600': movimiento.tipo === 'SALIDA',
                         'text-orange-600': movimiento.tipo === 'AJUSTE',
                         'text-blue-600': movimiento.tipo === 'TRANSFERENCIA'
                       }">
                    {{movimiento.tipo === 'ENTRADA' ? '+' : movimiento.tipo === 'SALIDA' ? '-' : '±'}}{{movimiento.cantidad}}
                  </div>
                  <div class="text-sm text-gray-500">
                    {{movimiento.fecha | date:'dd/MM/yyyy'}}
                  </div>
                  <div class="text-xs text-gray-400">
                    {{movimiento.fecha | date:'HH:mm'}}
                  </div>
                </div>
              </div>
              
              <!-- Detalles del movimiento -->
              <div class="bg-gray-50 rounded-lg p-3">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                  <div>
                    <span class="text-gray-600 font-medium">Stock Anterior:</span>
                    <div class="font-bold text-gray-800">{{movimiento.cantidadAnterior}} uds</div>
                  </div>
                  <div>
                    <span class="text-gray-600 font-medium">Stock Nuevo:</span>
                    <div class="font-bold text-gray-800">{{movimiento.cantidadNueva}} uds</div>
                  </div>
                  <div>
                    <span class="text-gray-600 font-medium">Usuario:</span>
                    <div class="font-bold text-gray-800">{{movimiento.usuario}}</div>
                  </div>
                  <div *ngIf="movimiento.costo">
                    <span class="text-gray-600 font-medium">Costo Total:</span>
                    <div class="font-bold text-green-600">${{movimiento.costo | number:'1.2-2'}}</div>
                  </div>
                  <div *ngIf="movimiento.almacenOrigen">
                    <span class="text-gray-600 font-medium">Origen:</span>
                    <div class="font-bold text-gray-800">{{movimiento.almacenOrigen.nombre}}</div>
                  </div>
                  <div *ngIf="movimiento.almacenDestino">
                    <span class="text-gray-600 font-medium">Destino:</span>
                    <div class="font-bold text-gray-800">{{movimiento.almacenDestino.nombre}}</div>
                  </div>
                </div>
                
                <div *ngIf="movimiento.observaciones" class="mt-3 pt-3 border-t border-gray-200">
                  <div class="text-gray-600 font-medium text-sm mb-1">Observaciones:</div>
                  <div class="text-gray-700 text-sm italic">{{movimiento.observaciones}}</div>
                </div>
              </div>
              
              <!-- Acciones del movimiento -->
              <div class="flex justify-end gap-2 mt-3">
                <p-button 
                  icon="pi pi-eye" 
                  size="small"
                  [outlined]="true"
                  pTooltip="Ver detalle completo"
                />
                <p-button 
                  icon="pi pi-print" 
                  size="small"
                  severity="secondary"
                  [outlined]="true"
                  pTooltip="Imprimir comprobante"
                />
                <p-button 
                  icon="pi pi-copy" 
                  size="small"
                  severity="info"
                  [outlined]="true"
                  pTooltip="Duplicar movimiento"
                />
              </div>
            </div>
          </div>
        </div>
      </ng-template>
      
      <!-- Panel derecho: Resumen y filtros -->
      <ng-template pTemplate="panel">
        <div class="p-4">
          <!-- Resumen de movimientos -->
          <div class="mb-6">
            <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
              <i class="pi pi-chart-bar text-purple-600"></i>
              Resumen por Tipo
            </h5>
            <div class="space-y-3">
              <div 
                *ngFor="let tipo of tiposMovimiento" 
                class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50"
              >
                <div class="flex items-center gap-2">
                  <i [class]="tipo.icon" [style.color]="tipo.color"></i>
                  <span class="text-sm font-medium">{{tipo.label}}</span>
                </div>
                <div class="text-right">
                  <div class="font-bold" [style.color]="tipo.color">{{getRandomInt(10, 110)}}</div>
                  <div class="text-xs text-gray-500">movimientos</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Filtros de movimientos -->
          <div class="mb-6">
            <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
              <i class="pi pi-filter text-blue-600"></i>
              Filtros
            </h5>
            <div class="space-y-3">
              <div>
                <label class="text-sm font-medium text-gray-700 mb-1 block">Tipo de Movimiento</label>
                <p-select 
                  [options]="tiposMovimiento" 
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Todos los tipos"
                  [showClear]="true"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
              
              <div>
                <label class="text-sm font-medium text-gray-700 mb-1 block">Rango de Fechas</label>
                <p-calendar 
                  selectionMode="range" 
                  [readonlyInput]="true"
                  placeholder="Seleccionar fechas"
                  [showIcon]="true"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
              
              <div>
                <label class="text-sm font-medium text-gray-700 mb-1 block">Usuario</label>
                <input 
                  type="text" 
                  pInputText 
                  placeholder="Filtrar por usuario"
                  class="w-full h-10"
                />
              </div>
              
              <div>
                <label class="text-sm font-medium text-gray-700 mb-1 block">Rango de Cantidad</label>
                <div class="grid grid-cols-2 gap-2">
                  <p-inputNumber
                    placeholder="Min"
                    [showButtons]="false"
                    class="w-full"
                    styleClass="h-10"
                  />
                  <p-inputNumber
                    placeholder="Max"
                    [showButtons]="false"
                    class="w-full"
                    styleClass="h-10"
                  />
                </div>
              </div>
              
              <p-button 
                label="Aplicar Filtros" 
                icon="pi pi-check" 
                class="w-full"
                size="small"
              />
              
              <p-button 
                label="Limpiar Filtros" 
                icon="pi pi-times" 
                severity="secondary"
                [outlined]="true"
                class="w-full"
                size="small"
              />
            </div>
          </div>

          <!-- Análisis de tendencias -->
          <div>
            <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
              <i class="pi pi-chart-line text-green-600"></i>
              Análisis de Tendencias
            </h5>
            <div class="bg-green-50 rounded-lg p-4">
              <div class="text-center mb-3">
                <div class="text-2xl font-bold text-green-600">+15%</div>
                <div class="text-sm text-gray-600">Crecimiento mensual</div>
              </div>
              <div class="space-y-2">
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600">Promedio diario:</span>
                  <span class="font-medium">42 movimientos</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600">Pico más alto:</span>
                  <span class="font-medium">158 movimientos</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600">Última actividad:</span>
                  <span class="font-medium">Hace 2 horas</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </p-splitter>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="text-sm text-gray-600">
        <i class="pi pi-info-circle mr-1"></i>
        Total de movimientos: {{inventario.movimientos?.length || 0}}
      </div>
      <div class="flex gap-3">
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          class="p-button-text" 
          (click)="hideMovimientosDialog()" 
        />
        <p-button 
          label="Nuevo Movimiento" 
          icon="pi pi-plus" 
          severity="info"
          (click)="abrirNuevoMovimiento()" 
        />
        <p-button 
          label="Exportar Historial" 
          icon="pi pi-download" 
          severity="secondary"
          (click)="exportarMovimientos()" 
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Estadísticas Avanzadas -->
<p-dialog 
  [(visible)]="estadisticasDialog" 
  [style]="{width: '1400px'}" 
  header="Estadísticas Avanzadas de Inventarios" 
  [modal]="true" 
  (onHide)="hideEstadisticasDialog()"
  [maximizable]="true"
>
  <div>
    <!-- Header con métricas principales -->
    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="text-center">
          <div class="text-3xl font-bold text-green-600 mb-2">${{calcularEstadisticas().valorTotalInventario | number:'1.0-0'}}</div>
          <div class="text-sm text-gray-600 font-medium">Valor Total Inventario</div>
          <div class="text-xs text-green-600 mt-1">↗ +12% vs mes anterior</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-blue-600 mb-2">{{calcularEstadisticas().totalProductos}}</div>
          <div class="text-sm text-gray-600 font-medium">Productos Únicos</div>
          <div class="text-xs text-blue-600 mt-1">↗ +5% vs mes anterior</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-purple-600 mb-2">{{calcularEstadisticas().rotacionPromedio | number:'1.1-1'}}x</div>
          <div class="text-sm text-gray-600 font-medium">Rotación Promedio</div>
          <div class="text-xs text-purple-600 mt-1">↗ +8% vs mes anterior</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-orange-600 mb-2">{{calcularEstadisticas().eficienciaStock | number:'1.0-0'}}%</div>
          <div class="text-sm text-gray-600 font-medium">Eficiencia de Stock</div>
          <div class="text-xs text-orange-600 mt-1">↗ +3% vs mes anterior</div>
        </div>
      </div>
    </div>

    <!-- Tabs de estadísticas -->
    <p-tabView>
      <!-- Tab: Resumen General -->
      <p-tabPanel header="Resumen General" leftIcon="pi pi-chart-pie">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Distribución por estado -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-chart-pie text-blue-600"></i>
              Distribución por Estado
            </h4>
            <div class="chart-container">
              <p-chart 
                type="doughnut" 
                [data]="chartData" 
                [options]="chartOptions"
                width="400"
                height="400"
              />
            </div>
          </div>

          <!-- Tendencias de movimientos -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-chart-line text-green-600"></i>
              Tendencias de Stock
            </h4>
            <div class="chart-container">
              <p-chart 
                type="line" 
                [data]="trendData" 
                [options]="chartOptions"
                height="350"
              />
            </div>
          </div>

          <!-- Top productos por valor -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-star text-yellow-600"></i>
              Top 10 Productos por Valor
            </h4>
            <div class="space-y-3 max-h-80 overflow-y-auto">
              <div 
                *ngFor="let inventario of inventariosFiltrados.slice(0, 10); let i = index" 
                class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 border border-gray-100"
              >
                <div class="flex items-center gap-3">
                  <div 
                    class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold"
                    [ngClass]="{
                      'bg-yellow-500': i === 0,
                      'bg-gray-400': i === 1,
                      'bg-orange-600': i === 2,
                      'bg-blue-500': i > 2
                    }"
                  >
                    {{i + 1}}
                  </div>
                  <div class="flex items-center gap-2">
                    <div 
                      class="w-4 h-4 rounded-full" 
                      [style.background-color]="inventario.color?.codigoHex || '#ccc'"
                    ></div>
                    <div>
                      <div class="font-medium text-sm">{{inventario.producto?.nombre}}</div>
                      <div class="text-xs text-gray-500">Talla {{inventario.talla?.numero}}</div>
                    </div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-bold text-green-600">${{inventario.valorTotal | number:'1.0-0'}}</div>
                  <div class="text-xs text-gray-500">{{inventario.cantidad}} uds</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Alertas y problemas -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-exclamation-triangle text-red-600"></i>
              Alertas y Problemas
            </h4>
            <div class="space-y-3">
              <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                <div class="flex items-center gap-2 mb-2">
                  <i class="pi pi-times-circle text-red-600"></i>
                  <span class="font-bold text-red-800">Productos Agotados</span>
                </div>
                <div class="text-2xl font-bold text-red-600">{{calcularEstadisticas().productosAgotados}}</div>
                <div class="text-sm text-red-700">Requieren reposición inmediata</div>
              </div>
              
              <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <div class="flex items-center gap-2 mb-2">
                  <i class="pi pi-exclamation-triangle text-orange-600"></i>
                  <span class="font-bold text-orange-800">Stock Crítico</span>
                </div>
                <div class="text-2xl font-bold text-orange-600">{{calcularEstadisticas().stockCritico}}</div>
                <div class="text-sm text-orange-700">Por debajo del mínimo</div>
              </div>
              
              <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                <div class="flex items-center gap-2 mb-2">
                  <i class="pi pi-info-circle text-blue-600"></i>
                  <span class="font-bold text-blue-800">Valor en Riesgo</span>
                </div>
                <div class="text-2xl font-bold text-blue-600">${{calcularEstadisticas().valorEnRiesgo | number:'1.0-0'}}</div>
                <div class="text-sm text-blue-700">Productos sin movimiento</div>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>

      <!-- Tab: Análisis ABC -->
      <p-tabPanel header="Análisis ABC" leftIcon="pi pi-sort-amount-down">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Gráfico ABC -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-chart-pie text-purple-600"></i>
              Distribución ABC por Valor
            </h4>
            <div class="chart-container">
              <p-chart 
                type="pie" 
                [data]="abcData" 
                [options]="chartOptions"
                width="400"
                height="400"
              />
            </div>
          </div>

          <!-- Tabla ABC detallada -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-table text-indigo-600"></i>
              Análisis Detallado ABC
            </h4>
            <div class="space-y-4">
              <div 
                *ngFor="let analisis of calcularEstadisticas().analisisABC" 
                class="rounded-lg p-4 border-l-4"
                [style.border-left-color]="getCategoriaColor(analisis.categoria)"
                [style.background-color]="getCategoriaBackgroundColor(analisis.categoria)"
              >
                <div class="flex items-center justify-between mb-3">
                  <div class="flex items-center gap-2">
                    <div 
                      class="w-6 h-6 rounded-full flex items-center justify-center text-white font-bold"
                      [style.color]="getCategoriaColor(analisis.categoria)"
                    >
                      {{analisis.categoria}}
                    </div>
                    <span class="font-bold text-gray-800">Categoría {{analisis.categoria}}</span>
                  </div>
                  <span class="font-bold text-2xl" [style.color]="getCategoriaColor(analisis.categoria)">
                    {{analisis.porcentaje | number:'1.0-0'}}%
                  </span>
                </div>
                
                <div class="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span class="text-gray-600">Productos:</span>
                    <div class="font-bold text-gray-800">{{analisis.productos}}</div>
                  </div>
                  <div>
                    <span class="text-gray-600">Valor Total:</span>
                    <div class="font-bold text-green-600">${{analisis.valor | number:'1.0-0'}}</div>
                  </div>
                </div>
                
                <div class="mt-3">
                  <div class="w-full bg-gray-200 rounded-full h-3">
                    <div 
                      class="h-3 rounded-full transition-all duration-500"
                      [style.background-color]="getCategoriaBackgroundColor(analisis.categoria)"
                      [style.width.%]="analisis.porcentaje"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recomendaciones ABC -->
        <div class="mt-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6">
          <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-lightbulb text-purple-600"></i>
            Recomendaciones Basadas en Análisis ABC
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white rounded-lg p-4">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-4 h-4 rounded-full bg-green-500"></div>
                <span class="font-bold text-green-800">Categoría A</span>
              </div>
              <ul class="text-sm text-gray-700 space-y-1">
                <li>• Control estricto de inventario</li>
                <li>• Revisión semanal de niveles</li>
                <li>• Proveedores confiables</li>
                <li>• Stock de seguridad optimizado</li>
              </ul>
            </div>
            
            <div class="bg-white rounded-lg p-4">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-4 h-4 rounded-full bg-yellow-500"></div>
                <span class="font-bold text-yellow-800">Categoría B</span>
              </div>
              <ul class="text-sm text-gray-700 space-y-1">
                <li>• Control moderado</li>
                <li>• Revisión quincenal</li>
                <li>• Múltiples proveedores</li>
                <li>• Stock balanceado</li>
              </ul>
            </div>
            
            <div class="bg-white rounded-lg p-4">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-4 h-4 rounded-full bg-red-500"></div>
                <span class="font-bold text-red-800">Categoría C</span>
              </div>
              <ul class="text-sm text-gray-700 space-y-1">
                <li>• Control básico</li>
                <li>• Revisión mensual</li>
                <li>• Proveedores económicos</li>
                <li>• Stock mínimo necesario</li>
              </ul>
            </div>
          </div>
        </div>
      </p-tabPanel>

      <!-- Tab: Análisis Financiero -->
      <p-tabPanel header="Análisis Financiero" leftIcon="pi pi-dollar">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Valorización del inventario -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-chart-bar text-green-600"></i>
              Valorización del Inventario
            </h4>
            <div class="space-y-4">
              <div class="bg-green-50 rounded-lg p-4">
                <div class="text-center">
                  <div class="text-3xl font-bold text-green-600 mb-2">${{calcularEstadisticas().valorTotalInventario | number:'1.0-0'}}</div>
                  <div class="text-sm text-gray-600">Valor Total del Inventario</div>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-4 text-sm">
                  <div class="text-center">
                    <div class="font-bold text-blue-600">${{(calcularEstadisticas().valorTotalInventario * 0.7) | number:'1.0-0'}}</div>
                    <div class="text-gray-600">Costo Total</div>
                  </div>
                  <div class="text-center">
                    <div class="font-bold text-purple-600">${{(calcularEstadisticas().valorTotalInventario * 0.3) | number:'1.0-0'}}</div>
                    <div class="text-gray-600">Margen Total</div>
                  </div>
                </div>
              </div>
              
              <!-- ROI y métricas financieras -->
              <div class="space-y-3">
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium text-gray-700">ROI Anual:</span>
                  <span class="font-bold text-green-600">18.5%</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium text-gray-700">Margen Promedio:</span>
                  <span class="font-bold text-blue-600">32.4%</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium text-gray-700">Rotación de Capital:</span>
                  <span class="font-bold text-purple-600">{{calcularEstadisticas().rotacionPromedio | number:'1.1-1'}}x</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium text-gray-700">Valor en Riesgo:</span>
                  <span class="font-bold text-red-600">${{calcularEstadisticas().valorEnRiesgo | number:'1.0-0'}}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Análisis de rentabilidad por producto -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-chart-line text-purple-600"></i>
              Rentabilidad por Producto
            </h4>
            <div class="space-y-3 max-h-80 overflow-y-auto">
              <div 
                *ngFor="let inventario of inventariosFiltrados.slice(0, 8)" 
                class="p-3 rounded-lg border border-gray-200 hover:shadow-sm transition-all duration-300"
              >
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center gap-2">
                    <div 
                      class="w-3 h-3 rounded-full" 
                      [style.background-color]="inventario.color?.codigoHex || '#ccc'"
                    ></div>
                    <span class="font-medium text-sm">{{inventario.producto?.nombre}}</span>
                  </div>
                  <span class="font-bold text-green-600 text-sm">${{inventario.valorTotal | number:'1.0-0'}}</span>
                </div>
                
                <div class="grid grid-cols-3 gap-2 text-xs">
                  <div class="text-center">
                    <div class="font-bold text-blue-600">{{inventario.cantidad}}</div>
                    <div class="text-gray-600">Stock</div>
                  </div>
                  <div class="text-center">
                    <div class="font-bold text-purple-600">${{inventario.valorUnitario | number:'1.0-0'}}</div>
                    <div class="text-gray-600">Valor Unit.</div>
                  </div>
                  <div class="text-center">
                    <div class="font-bold text-orange-600">{{inventario.margen || 25 | number:'1.0-0'}}%</div>
                    <div class="text-gray-600">Margen</div>
                  </div>
                </div>
                
                <!-- Barra de rentabilidad -->
                <div class="mt-2">
                  <div class="w-full bg-gray-200 rounded-full h-2">
                    <div 
                      class="h-2 rounded-full bg-gradient-to-r from-green-400 to-green-600"
                      [style.width.%]="calculateWidthPercentage(inventario.margen || 25, 100)"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Costos operacionales -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-calculator text-orange-600"></i>
              Costos Operacionales
            </h4>
            <div class="space-y-4">
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Costo de Almacenamiento:</span>
                  <span class="font-bold text-orange-600">$15,240</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-orange-500 h-2 rounded-full" style="width: 35%"></div>
                </div>
              </div>
              
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Costo de Manejo:</span>
                  <span class="font-bold text-blue-600">$8,950</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-blue-500 h-2 rounded-full" style="width: 20%"></div>
                </div>
              </div>
              
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Obsolescencia:</span>
                  <span class="font-bold text-red-600">$3,200</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-red-500 h-2 rounded-full" style="width: 8%"></div>
                </div>
              </div>
              
              <div class="pt-3 border-t border-gray-200">
                <div class="flex justify-between items-center font-bold">
                  <span class="text-gray-800">Total Costos:</span>
                  <span class="text-purple-600">$27,390</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Proyecciones financieras -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-trending-up text-indigo-600"></i>
              Proyecciones Financieras
            </h4>
            <div class="space-y-4">
              <div class="bg-indigo-50 rounded-lg p-4">
                <div class="text-center mb-3">
                  <div class="text-2xl font-bold text-indigo-600">+12.5%</div>
                  <div class="text-sm text-gray-600">Crecimiento Proyectado Anual</div>
                </div>
                
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span class="text-gray-600">Próximo Trimestre:</span>
                    <span class="font-bold text-green-600">+3.2%</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Próximo Semestre:</span>
                    <span class="font-bold text-blue-600">+6.8%</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Próximo Año:</span>
                    <span class="font-bold text-purple-600">+12.5%</span>
                  </div>
                </div>
              </div>
              
              <div class="bg-yellow-50 rounded-lg p-4">
                <div class="font-bold text-yellow-800 mb-2">Oportunidades de Optimización</div>
                <ul class="text-sm text-yellow-700 space-y-1">
                  <li>• Reducir stock categoría C (-15%)</li>
                  <li>• Aumentar rotación productos A (+20%)</li>
                  <li>• Optimizar niveles de seguridad</li>
                  <li>• Mejorar pronósticos de demanda</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>

      <!-- Tab: Reportes Personalizados -->
      <p-tabPanel header="Reportes" leftIcon="pi pi-file">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Generador de reportes -->
          <div class="lg:col-span-2 bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-file-plus text-blue-600"></i>
              Generador de Reportes Personalizados
            </h4>
            
            <div class="space-y-4">
              <!-- Tipo de reporte -->
              <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">Tipo de Reporte</label>
                <p-select 
                  [options]="[
                    {label: 'Resumen Ejecutivo', value: 'executive'},
                    {label: 'Análisis ABC Detallado', value: 'abc'},
                    {label: 'Movimientos por Período', value: 'movements'},
                    {label: 'Valorización Financiera', value: 'financial'},
                    {label: 'Alertas y Problemas', value: 'alerts'},
                    {label: 'Comparativo Mensual', value: 'comparative'}
                  ]" 
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Seleccionar tipo de reporte"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
              
              <!-- Período del reporte -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Fecha Inicio</label>
                  <p-calendar 
                    [showIcon]="true"
                    placeholder="Fecha inicio"
                    class="w-full"
                    styleClass="h-10"
                  />
                </div>
                <div>
                  <label class="text-sm font-medium text-gray-700 mb-2 block">Fecha Fin</label>
                  <p-calendar 
                    [showIcon]="true"
                    placeholder="Fecha fin"
                    class="w-full"
                    styleClass="h-10"
                  />
                </div>
              </div>
              
              <!-- Filtros adicionales -->
              <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">Filtros Adicionales</label>
                <div class="grid grid-cols-2 gap-4">
                  <p-select 
                    [options]="almacenes" 
                    optionLabel="nombre"
                    optionValue="id"
                    placeholder="Filtrar por almacén"
                    [showClear]="true"
                    class="w-full"
                    styleClass="h-10"
                  />
                  <p-select 
                    [options]="estadosInventario" 
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Filtrar por estado"
                    [showClear]="true"
                    class="w-full"
                    styleClass="h-10"
                  />
                </div>
              </div>
              
              <!-- Opciones de formato -->
              <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">Formato de Salida</label>
                <div class="flex gap-4">
                  <div class="flex items-center gap-2">
                    <p-checkbox 
                      [binary]="true"
                      inputId="pdf"
                    />
                    <label for="pdf" class="text-sm">PDF</label>
                  </div>
                  <div class="flex items-center gap-2">
                    <p-checkbox 
                      [binary]="true"
                      inputId="excel"
                    />
                    <label for="excel" class="text-sm">Excel</label>
                  </div>
                  <div class="flex items-center gap-2">
                    <p-checkbox 
                      [binary]="true"
                      inputId="csv"
                    />
                    <label for="csv" class="text-sm">CSV</label>
                  </div>
                </div>
              </div>
              
              <!-- Botones de acción -->
              <div class="flex gap-3 pt-4">
                <p-button 
                  label="Vista Previa" 
                  icon="pi pi-eye" 
                  severity="secondary"
                  [outlined]="true"
                  class="flex-1"
                />
                <p-button 
                  label="Generar Reporte" 
                  icon="pi pi-download" 
                  class="flex-1"
                />
              </div>
            </div>
          </div>

          <!-- Reportes predefinidos -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-folder text-purple-600"></i>
              Reportes Predefinidos
            </h4>
            
            <div class="space-y-3">
              <div class="border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-all duration-300">
                <div class="font-medium text-gray-800 mb-1">Resumen Diario</div>
                <div class="text-sm text-gray-600 mb-2">Estado general del inventario</div>
                <p-button 
                  label="Descargar" 
                  icon="pi pi-download" 
                  size="small"
                  class="w-full"
                />
              </div>
              
              <div class="border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-all duration-300">
                <div class="font-medium text-gray-800 mb-1">Análisis Semanal</div>
                <div class="text-sm text-gray-600 mb-2">Movimientos y tendencias</div>
                <p-button 
                  label="Descargar" 
                  icon="pi pi-download" 
                  size="small"
                  class="w-full"
                />
              </div>
              
              <div class="border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-all duration-300">
                <div class="font-medium text-gray-800 mb-1">Reporte Mensual</div>
                <div class="text-sm text-gray-600 mb-2">Análisis completo ABC</div>
                <p-button 
                  label="Descargar" 
                  icon="pi pi-download" 
                  size="small"
                  class="w-full"
                />
              </div>
              
              <div class="border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-all duration-300">
                <div class="font-medium text-gray-800 mb-1">Valorización</div>
                <div class="text-sm text-gray-600 mb-2">Análisis financiero detallado</div>
                <p-button 
                  label="Descargar" 
                  icon="pi pi-download" 
                  size="small"
                  class="w-full"
                />
              </div>
              
              <div class="border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-all duration-300">
                <div class="font-medium text-gray-800 mb-1">Stock Crítico</div>
                <div class="text-sm text-gray-600 mb-2">Alertas y recomendaciones</div>
                <p-button 
                  label="Descargar" 
                  icon="pi pi-download" 
                  size="small"
                  class="w-full"
                />
              </div>
            </div>
            
            <!-- Programación de reportes -->
            <div class="mt-6 pt-4 border-t border-gray-200">
              <h5 class="font-bold text-gray-800 mb-3">Programar Reportes</h5>
              <div class="space-y-2">
                <div class="flex items-center gap-2">
                  <p-checkbox 
                    [binary]="true"
                    inputId="daily"
                  />
                  <label for="daily" class="text-sm">Reporte diario automático</label>
                </div>
                <div class="flex items-center gap-2">
                  <p-checkbox 
                    [binary]="true"
                    inputId="weekly"
                  />
                  <label for="weekly" class="text-sm">Reporte semanal</label>
                </div>
                <div class="flex items-center gap-2">
                  <p-checkbox 
                    [binary]="true"
                    inputId="monthly"
                  />
                  <label for="monthly" class="text-sm">Reporte mensual</label>
                </div>
              </div>
              
              <p-button 
                label="Configurar" 
                icon="pi pi-cog" 
                severity="secondary"
                [outlined]="true"
                size="small"
                class="w-full mt-3"
              />
            </div>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="text-sm text-gray-600">
        <i class="pi pi-info-circle mr-1"></i>
        {{inventario.fechaActualizacion | date:'dd/MM/yyyy HH:mm'}}
      </div>
      <div class="flex gap-3">
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          class="p-button-text" 
          (click)="hideEstadisticasDialog()" 
        />
        <p-button 
          label="Actualizar Datos" 
          icon="pi pi-refresh" 
          severity="secondary"
          (click)="generarDatosSimulados(); updateChartData()" 
        />
        <p-button 
          label="Exportar Dashboard" 
          icon="pi pi-download" 
          severity="info"
          (click)="exportarExcel()" 
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Alertas del Sistema -->
<p-dialog 
  [(visible)]="alertasDialog" 
  [style]="{width: '1000px'}" 
  header="Centro de Alertas Inteligentes" 
  [modal]="true" 
  (onHide)="hideAlertasDialog()"
  [maximizable]="true"
>
  <div>
    <!-- Header con resumen de alertas -->
    <div class="bg-gradient-to-r from-red-50 to-orange-50 rounded-xl p-6 mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-red-600 p-3 rounded-lg shadow-lg animate-pulse">
            <i class="pi pi-bell text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-xl font-bold text-gray-800 m-0">Sistema de Alertas Inteligentes</h3>
            <p class="text-gray-600 mt-1">Monitoreo automático de anomalías y situaciones críticas</p>
          </div>
        </div>
        <div class="text-right">
          <div class="text-3xl font-bold text-red-600">{{calcularEstadisticas().alertasCriticas.length}}</div>
          <div class="text-sm text-gray-600">Alertas Activas</div>
        </div>
      </div>
    </div>

    <!-- Filtros de alertas -->
    <div class="bg-white rounded-xl p-4 mb-6 border border-gray-200">
      <div class="flex flex-wrap items-center gap-4">
        <div class="flex items-center gap-2">
          <label class="text-sm font-medium text-gray-700">Severidad:</label>
          <p-selectButton 
            [options]="[
              {label: 'Todas', value: 'all'},
              {label: 'Críticas', value: 'high'},
              {label: 'Importantes', value: 'medium'},
              {label: 'Informativas', value: 'low'}
            ]" 
            optionLabel="label" 
            optionValue="value"
            [(ngModel)]="selectedFilter"
            size="small"
          />
        </div>
        
        <div class="flex items-center gap-2">
          <label class="text-sm font-medium text-gray-700">Tipo:</label>
          <p-select 
            [options]="[
              {label: 'Todos los tipos', value: 'all'},
              {label: 'Stock Crítico', value: 'STOCK_CRITICO'},
              {label: 'Agotado', value: 'AGOTADO'},
              {label: 'Vencimiento', value: 'VENCIMIENTO'},
              {label: 'Sobrestock', value: 'SOBRESTOCK'},
              {label: 'Movimiento Anómalo', value: 'MOVIMIENTO_ANOMALO'}
            ]" 
            optionLabel="label"
            optionValue="value"
            placeholder="Filtrar por tipo"
            [showClear]="true"
            styleClass="h-8 w-48"
          />
        </div>
        
        <div class="flex items-center gap-2">
          <p-checkbox 
            [binary]="true"
            inputId="urgent"
          />
          <label for="urgent" class="text-sm font-medium text-gray-700">Solo urgentes</label>
        </div>
        
        <div class="ml-auto">
          <p-button 
            label="Marcar todas como leídas" 
            icon="pi pi-check" 
            severity="secondary"
            [outlined]="true"
            size="small"
          />
        </div>
      </div>
    </div>

    <!-- Lista de alertas con diseño premium -->
    <div class="space-y-4 max-h-96 overflow-y-auto pr-2">
      <div 
        *ngFor="let alerta of calcularEstadisticas().alertasCriticas; trackBy: trackByInventario; let i = index" 
        class="alert-card rounded-xl p-5 border transition-all duration-300 hover:shadow-lg"
        [ngClass]="'alert-' + alerta.severidad"
        [class.animate-pulse]="alerta.urgente"
      >
        <!-- Header de la alerta -->
        <div class="flex items-start justify-between mb-4">
          <div class="flex items-start gap-4">
            <!-- Icono de severidad -->
            <div 
              class="p-3 rounded-xl shadow-sm"
              [ngClass]="{
                'bg-red-100': alerta.severidad === 'high',
                'bg-orange-100': alerta.severidad === 'medium',
                'bg-blue-100': alerta.severidad === 'low'
              }"
            >
              <i 
                [ngClass]="{
                  'pi pi-times-circle text-red-600': alerta.severidad === 'high',
                  'pi pi-exclamation-triangle text-orange-600': alerta.severidad === 'medium',
                  'pi pi-info-circle text-blue-600': alerta.severidad === 'low'
                }"
                class="text-xl"
              ></i>
            </div>
            
            <!-- Contenido de la alerta -->
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <h4 
                  class="font-bold text-lg m-0"
                  [ngClass]="{
                    'text-red-800': alerta.severidad === 'high',
                    'text-orange-800': alerta.severidad === 'medium',
                    'text-blue-800': alerta.severidad === 'low'
                  }"
                >
                  {{alerta.producto}}
                </h4>
                
                <!-- Tags de la alerta -->
                <div class="flex gap-2">
                  <p-tag 
                    [value]="alerta.tipo.replace('_', ' ')"
                    [severity]="alerta.severidad === 'high' ? 'danger' : alerta.severidad === 'medium' ? 'warning' : 'info'"
                    size="small"
                  />
                  <p-tag 
                    value="URGENTE"
                    severity="danger"
                    size="small"
                    *ngIf="alerta.urgente"
                    class="animate-bounce"
                  />
                </div>
              </div>
              
              <!-- Descripción de la alerta -->
              <p 
                class="mb-3 text-sm leading-relaxed"
                [ngClass]="{
                  'text-red-700': alerta.severidad === 'high',
                  'text-orange-700': alerta.severidad === 'medium',
                  'text-blue-700': alerta.severidad === 'low'
                }"
              >
                {{alerta.mensaje}}
              </p>
              
              <!-- Información adicional -->
              <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 mb-3">
                <span class="flex items-center gap-1">
                  <i class="pi pi-clock"></i>
                  {{alerta.fechaAlerta | date:'dd/MM/yyyy HH:mm'}}
                </span>
                <span class="flex items-center gap-1">
                  <i class="pi pi-lightbulb"></i>
                  {{alerta.accionRecomendada}}
                </span>
              </div>
              
              <!-- Acciones recomendadas -->
              <div 
                class="rounded-lg p-3 border-l-4"
                [ngClass]="{
                  'bg-red-50 border-red-400': alerta.severidad === 'high',
                  'bg-orange-50 border-orange-400': alerta.severidad === 'medium',
                  'bg-blue-50 border-blue-400': alerta.severidad === 'low'
                }"
              >
                <div class="flex items-center gap-2 mb-2">
                  <i class="pi pi-arrow-right text-sm"></i>
                  <span class="font-medium text-sm">Acción Recomendada:</span>
                </div>
                <div class="text-sm">{{alerta.accionRecomendada}}</div>
              </div>
            </div>
          </div>
          
          <!-- Acciones de la alerta -->
          <div class="flex flex-col gap-2">
            <p-button 
              icon="pi pi-eye" 
              [rounded]="true"
              [outlined]="true"
              size="small"
              pTooltip="Ver detalles"
              class="hover:shadow-md transition-all duration-300"
            />
            <p-button 
              icon="pi pi-check" 
              [rounded]="true"
              severity="success"
              [outlined]="true"
              size="small"
              pTooltip="Marcar como resuelto"
              class="hover:shadow-md transition-all duration-300"
            />
            <p-button 
              icon="pi pi-bell-slash" 
              [rounded]="true"
              severity="secondary"
              [outlined]="true"
              size="small"
              pTooltip="Silenciar alerta"
              class="hover:shadow-md transition-all duration-300"
            />
            <p-button 
              icon="pi pi-times" 
              [rounded]="true"
              severity="danger"
              [outlined]="true"
              size="small"
              pTooltip="Descartar"
              class="hover:shadow-md transition-all duration-300"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Estado sin alertas -->
    <div *ngIf="!calcularEstadisticas().alertasCriticas.length" class="text-center py-16">
      <div class="bg-green-100 p-12 rounded-full inline-block mb-6">
        <i class="pi pi-check-circle text-6xl text-green-600"></i>
      </div>
      <h3 class="text-2xl font-bold text-gray-700 mb-3">¡Todo está bajo control!</h3>
      <p class="text-gray-500 mb-6 max-w-md mx-auto">
        No hay alertas críticas en este momento. El sistema está funcionando correctamente.
      </p>
      <div class="flex justify-center gap-3">
        <p-button 
          label="Configurar Alertas" 
          icon="pi pi-cog" 
          severity="info"
        />
        <p-button 
          label="Ver Historial" 
          icon="pi pi-history" 
          severity="secondary"
          [outlined]="true"
        />
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="text-sm text-gray-600">
        <i class="pi pi-info-circle mr-1"></i>
        Última verificación: {{inventario.fechaActualizacion | date:'dd/MM/yyyy HH:mm'}}
      </div>
      <div class="flex gap-3">
        <p-button 
          label="Configurar Alertas" 
          icon="pi pi-cog" 
          severity="secondary"
          [outlined]="true"
          (click)="configurarAlertas()" 
        />
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          class="p-button-text" 
          (click)="hideAlertasDialog()" 
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Filtros Avanzados -->
<p-dialog 
  [(visible)]="filtrosDialog" 
  [style]="{width: '900px'}" 
  header="Filtros Avanzados de Inventario" 
  [modal]="true" 
  (onHide)="hideFiltrosDialog()"
  [maximizable]="true"
>
  <div>
    <!-- Header con información -->
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-6">
      <div class="flex items-center gap-3">
        <div class="bg-blue-600 p-3 rounded-lg shadow-lg">
          <i class="pi pi-filter text-white text-xl"></i>
        </div>
        <div>
          <h3 class="text-xl font-bold text-gray-800 m-0">Búsqueda Multi-Criterio</h3>
          <p class="text-gray-600 mt-1">Configure filtros personalizados para encontrar exactamente lo que busca</p>
        </div>
      </div>
    </div>

    <!-- Formulario de filtros en tabs -->
    <p-tabView>
      <!-- Tab: Filtros Básicos -->
      <p-tabPanel header="Filtros Básicos" leftIcon="pi pi-search">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Producto y almacén -->
          <div class="space-y-4">
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">Producto</label>
              <p-select 
                [options]="productos" 
                [(ngModel)]="filtrosInventario.producto" 
                optionLabel="nombre"
                optionValue="nombre"
                placeholder="Buscar por producto"
                [filter]="true"
                [showClear]="true"
                class="w-full"
                styleClass="h-10"
              />
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">Almacén</label>
              <p-select 
                [options]="almacenes" 
                [(ngModel)]="filtrosInventario.almacen" 
                optionLabel="nombre"
                optionValue="nombre"
                placeholder="Filtrar por almacén"
                [filter]="true"
                [showClear]="true"
                class="w-full"
                styleClass="h-10"
              />
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">Estado del Inventario</label>
              <p-select 
                [options]="estadosInventario" 
                [(ngModel)]="filtrosInventario.estado" 
                optionLabel="label"
                optionValue="value"
                placeholder="Filtrar por estado"
                [showClear]="true"
                class="w-full"
                styleClass="h-10"
              />
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">Color</label>
              <input 
                type="text" 
                pInputText 
                [(ngModel)]="filtrosInventario.color"
                placeholder="Buscar por color"
                class="w-full h-10"
              />
            </div>
          </div>
          
          <!-- Rangos numéricos -->
          <div class="space-y-4">
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">Rango de Stock</label>
              <div class="grid grid-cols-2 gap-3">
                <p-inputNumber
                  [(ngModel)]="filtrosInventario.stockMin"
                  placeholder="Stock mínimo"
                  [showButtons]="false"
                  [min]="0"
                  class="w-full"
                  styleClass="h-10"
                />
                <p-inputNumber
                  [(ngModel)]="filtrosInventario.stockMax"
                  placeholder="Stock máximo"
                  [showButtons]="false"
                  [min]="0"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">Rango de Valor</label>
              <div class="grid grid-cols-2 gap-3">
                <p-inputNumber
                  [(ngModel)]="filtrosInventario.valorMin"
                  mode="currency"
                  currency="USD"
                  locale="en-US"
                  placeholder="Valor mínimo"
                  [showButtons]="false"
                  [min]="0"
                  class="w-full"
                  styleClass="h-10"
                />
                <p-inputNumber
                  [(ngModel)]="filtrosInventario.valorMax"
                  mode="currency"
                  currency="USD"
                  locale="en-US"
                  placeholder="Valor máximo"
                  [showButtons]="false"
                  [min]="0"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">Talla</label>
              <input 
                type="text" 
                pInputText 
                [(ngModel)]="filtrosInventario.talla"
                placeholder="Buscar por talla"
                class="w-full h-10"
              />
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">Rango de Fechas</label>
              <div class="grid grid-cols-2 gap-3">
                <p-calendar 
                  [(ngModel)]="filtrosInventario.fechaDesde"
                  [showIcon]="true"
                  placeholder="Fecha desde"
                  class="w-full"
                  styleClass="h-10"
                />
                <p-calendar 
                  [(ngModel)]="filtrosInventario.fechaHasta"
                  [showIcon]="true"
                  placeholder="Fecha hasta"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>

      <!-- Tab: Filtros Avanzados -->
      <p-tabPanel header="Filtros Avanzados" leftIcon="pi pi-cog">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Filtros de estado crítico -->
          <div class="bg-orange-50 rounded-xl p-6 border border-orange-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-exclamation-triangle text-orange-600"></i>
              Filtros de Estado Crítico
            </h4>
            <div class="space-y-3">
              <div class="flex items-center gap-2">
                <p-checkbox 
                  [(ngModel)]="filtrosInventario.soloStockCritico"
                  [binary]="true"
                  inputId="stockCritico"
                />
                <label for="stockCritico" class="text-sm font-medium text-gray-700">Solo productos con stock crítico</label>
              </div>
              
              <div class="flex items-center gap-2">
                <p-checkbox 
                  [(ngModel)]="filtrosInventario.soloAgotados"
                  [binary]="true"
                  inputId="agotados"
                />
                <label for="agotados" class="text-sm font-medium text-gray-700">Solo productos agotados</label>
              </div>
              
              <div class="flex items-center gap-2">
                <p-checkbox 
                  [binary]="true"
                  inputId="sinMovimiento"
                />
                <label for="sinMovimiento" class="text-sm font-medium text-gray-700">Sin movimiento en 30 días</label>
              </div>
              
              <div class="flex items-center gap-2">
                <p-checkbox 
                  [binary]="true"
                  inputId="vencimiento"
                />
                <label for="vencimiento" class="text-sm font-medium text-gray-700">Próximos a vencer (60 días)</label>
              </div>
            </div>
          </div>

          <!-- Filtros de categorización -->
          <div class="bg-purple-50 rounded-xl p-6 border border-purple-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-tags text-purple-600"></i>
              Categorización ABC
            </h4>
            <div class="space-y-3">
              <div class="flex items-center gap-2">
                <p-checkbox 
                  [binary]="true"
                  inputId="categoriaA"
                />
                <label for="categoriaA" class="text-sm font-medium text-gray-700">Categoría A (Alto valor)</label>
              </div>
              
              <div class="flex items-center gap-2">
                <p-checkbox 
                  [binary]="true"
                  inputId="categoriaB"
                />
                <label for="categoriaB" class="text-sm font-medium text-gray-700">Categoría B (Valor medio)</label>
              </div>
              
              <div class="flex items-center gap-2">
                <p-checkbox 
                  [binary]="true"
                  inputId="categoriaC"
                />
                <label for="categoriaC" class="text-sm font-medium text-gray-700">Categoría C (Bajo valor)</label>
              </div>
            </div>
            
            <!-- Filtro de rotación -->
            <div class="mt-6">
              <label class="text-sm font-medium text-gray-700 mb-2 block">Rotación Anual</label>
              <div class="space-y-2">
                <div class="flex justify-between text-sm text-gray-600">
                  <span>0x/año</span>
                  <span>20x/año</span>
                </div>
                <p-slider 
                  [(ngModel)]="rangeValues" 
                  [range]="true"
                  [min]="0"
                  [max]="20"
                  [step]="0.5"
                  class="w-full"
                />
                <div class="text-center text-sm text-gray-600">
                  Rango seleccionado: 2x - 15x por año
                </div>
              </div>
            </div>
          </div>

          <!-- Filtros de ubicación -->
          <div class="bg-blue-50 rounded-xl p-6 border border-blue-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-map-marker text-blue-600"></i>
              Ubicación y Trazabilidad
            </h4>
            <div class="space-y-4">
              <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">Ubicación Específica</label>
                <input 
                  type="text" 
                  pInputText 
                  placeholder="Ej: Pasillo A, Estante 3"
                  class="w-full h-10"
                />
              </div>
              
              <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">Número de Lote</label>
                <input 
                  type="text" 
                  pInputText 
                  placeholder="Buscar por lote"
                  class="w-full h-10"
                />
              </div>
              
              <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">Proveedor</label>
                <input 
                  type="text" 
                  pInputText 
                  placeholder="Filtrar por proveedor"
                  class="w-full h-10"
                />
              </div>
            </div>
          </div>

          <!-- Filtros de rendimiento -->
          <div class="bg-green-50 rounded-xl p-6 border border-green-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-chart-line text-green-600"></i>
              Análisis de Rendimiento
            </h4>
            <div class="space-y-4">
              <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">Margen de Ganancia (%)</label>
                <div class="grid grid-cols-2 gap-3">
                  <p-inputNumber
                    placeholder="Margen mín"
                    suffix="%"
                    [showButtons]="false"
                    [min]="0"
                    [max]="100"
                    class="w-full"
                    styleClass="h-10"
                  />
                  <p-inputNumber
                    placeholder="Margen máx"
                    suffix="%"
                    [showButtons]="false"
                    [min]="0"
                    [max]="100"
                    class="w-full"
                    styleClass="h-10"
                  />
                </div>
              </div>
              
              <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">Tendencia de Demanda</label>
                <p-select 
                  [options]="[
                    {label: 'Todas las tendencias', value: 'all'},
                    {label: 'Subiendo', value: 'SUBIENDO'},
                    {label: 'Bajando', value: 'BAJANDO'},
                    {label: 'Estable', value: 'ESTABLE'}
                  ]" 
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Filtrar por tendencia"
                  [showClear]="true"
                  class="w-full"
                  styleClass="h-10"
                />
              </div>
              
              <div class="flex items-center gap-2">
                <p-checkbox 
                  [binary]="true"
                  inputId="topPerformers"
                />
                <label for="topPerformers" class="text-sm font-medium text-gray-700">Solo mejores productos (Top 20%)</label>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>

      <!-- Tab: Filtros Guardados -->
      <p-tabPanel header="Filtros Guardados" leftIcon="pi pi-bookmark">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Filtros predefinidos -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-star text-yellow-600"></i>
              Filtros Predefinidos
            </h4>
            <div class="space-y-3">
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-all duration-300">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium text-gray-800">Stock Crítico</div>
                    <div class="text-sm text-gray-600">Productos con stock bajo o agotado</div>
                  </div>
                  <p-button 
                    label="Aplicar" 
                    icon="pi pi-check" 
                    size="small"
                    [outlined]="true"
                  />
                </div>
              </div>
              
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-all duration-300">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium text-gray-800">Alto Valor</div>
                    <div class="text-sm text-gray-600">Productos categoría A con alto valor</div>
                  </div>
                  <p-button 
                    label="Aplicar" 
                    icon="pi pi-check" 
                    size="small"
                    [outlined]="true"
                  />
                </div>
              </div>
              
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-all duration-300">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium text-gray-800">Sin Movimiento</div>
                    <div class="text-sm text-gray-600">Productos sin actividad en 30+ días</div>
                  </div>
                  <p-button 
                    label="Aplicar" 
                    icon="pi pi-check" 
                    size="small"
                    [outlined]="true"
                  />
                </div>
              </div>
              
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-all duration-300">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium text-gray-800">Próximos a Vencer</div>
                    <div class="text-sm text-gray-600">Productos con vencimiento en 60 días</div>
                  </div>
                  <p-button 
                    label="Aplicar" 
                    icon="pi pi-check" 
                    size="small"
                    [outlined]="true"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Filtros personalizados guardados -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
              <i class="pi pi-bookmark text-blue-600"></i>
              Mis Filtros Guardados
            </h4>
            
            <!-- Guardar filtro actual -->
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
              <div class="flex items-center gap-3 mb-3">
                <i class="pi pi-save text-blue-600"></i>
                <span class="font-medium text-blue-800">Guardar Filtro Actual</span>
              </div>
              <div class="flex gap-3">
                <input 
                  type="text" 
                  pInputText 
                  placeholder="Nombre del filtro"
                  class="flex-1 h-10"
                />
                <p-button 
                  label="Guardar" 
                  icon="pi pi-save" 
                  size="small"
                />
              </div>
            </div>
            
            <!-- Lista de filtros guardados -->
            <div class="space-y-3">
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-all duration-300">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium text-gray-800">Mi Filtro Custom 1</div>
                    <div class="text-sm text-gray-600">Creado el 15/05/2025</div>
                  </div>
                  <div class="flex gap-2">
                    <p-button 
                      icon="pi pi-check" 
                      size="small"
                      [outlined]="true"
                      pTooltip="Aplicar"
                    />
                    <p-button 
                      icon="pi pi-pencil" 
                      size="small"
                      severity="secondary"
                      [outlined]="true"
                      pTooltip="Editar"
                    />
                    <p-button 
                      icon="pi pi-trash" 
                      size="small"
                      severity="danger"
                      [outlined]="true"
                      pTooltip="Eliminar"
                    />
                  </div>
                </div>
              </div>
              
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-all duration-300">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium text-gray-800">Almacén Principal</div>
                    <div class="text-sm text-gray-600">Creado el 10/05/2025</div>
                  </div>
                  <div class="flex gap-2">
                    <p-button 
                      icon="pi pi-check" 
                      size="small"
                      [outlined]="true"
                      pTooltip="Aplicar"
                    />
                    <p-button 
                      icon="pi pi-pencil" 
                      size="small"
                      severity="secondary"
                      [outlined]="true"
                      pTooltip="Editar"
                    />
                    <p-button 
                      icon="pi pi-trash" 
                      size="small"
                      severity="danger"
                      [outlined]="true"
                      pTooltip="Eliminar"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>

    <!-- Resumen de filtros activos -->
    <div class="bg-gray-50 rounded-xl p-4 mt-6" *ngIf="hayFiltrosActivos()">
      <h5 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
        <i class="pi pi-filter text-gray-600"></i>
        Filtros Activos
      </h5>
      <div class="flex flex-wrap gap-2">
        <p-chip 
          label="Producto: Zapatillas Nike"
          [removable]="true"
          (onRemove)="removerFiltro('producto')"
          *ngIf="filtrosInventario.producto"
        />
        <p-chip 
          label="Estado: Disponible"
          [removable]="true"
          (onRemove)="removerFiltro('estado')"
          *ngIf="filtrosInventario.estado"
        />
        <p-chip 
          label="Solo Stock Crítico"
          [removable]="true"
          (onRemove)="removerFiltro('stockCritico')"
          *ngIf="filtrosInventario.soloStockCritico"
        />
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="text-sm text-gray-600">
        <i class="pi pi-info-circle mr-1"></i>
        {{contarResultadosFiltros()}} resultados encontrados
      </div>
      <div class="flex gap-3">
        <p-button 
          label="Limpiar Todo" 
          icon="pi pi-times" 
          severity="secondary"
          [outlined]="true"
          (click)="limpiarTodosFiltros()" 
        />
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          class="p-button-text" 
          (click)="hideFiltrosDialog()" 
        />
        <p-button 
          label="Aplicar Filtros" 
          icon="pi pi-check" 
          (click)="aplicarFiltros(); hideFiltrosDialog()" 
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Análisis ABC Detallado -->
<p-dialog 
  [(visible)]="analisisAbcDialog" 
  [style]="{width: '1200px'}" 
  header="Análisis ABC Detallado" 
  [modal]="true" 
  (onHide)="hideAnalisisAbcDialog()"
  [maximizable]="true"
>
  <div>
    <!-- Header con información del análisis -->
    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-purple-600 p-3 rounded-lg shadow-lg">
            <i class="pi pi-sort-amount-down text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-xl font-bold text-gray-800 m-0">Análisis ABC Avanzado</h3>
            <p class="text-gray-600 mt-1">Clasificación inteligente por valor e importancia estratégica</p>
          </div>
        </div>
        <div class="text-right">
          <div class="text-3xl font-bold text-purple-600">{{inventariosFiltrados.length}}</div>
          <div class="text-sm text-gray-600">Productos Analizados</div>
        </div>
      </div>
    </div>

    <!-- Resumen ABC con métricas -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div 
        *ngFor="let categoria of categoriasABC" 
        class="rounded-xl p-6 text-white relative overflow-hidden"
        [ngClass]="'abc-' + categoria.categoria.toLowerCase()"
      >
        <!-- Efecto de brillo -->
        <div class="absolute top-0 right-0 w-20 h-20 bg-white opacity-10 rounded-full -mr-10 -mt-10"></div>
        
        <div class="relative">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h4 class="text-2xl font-bold m-0">{{categoria.label}}</h4>
              <p class="opacity-90 text-sm mt-1">{{categoria.descripcion}}</p>
            </div>
            <div class="text-right">
              <div class="text-3xl font-bold">{{getProductosPorCategoria(categoria)}}</div>
              <div class="opacity-90 text-sm">productos</div>
            </div>
          </div>
          
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="opacity-90">Valor Total:</span>
              <span class="font-bold">${{getValorPorCategoria(categoria) | number:'1.0-0'}}</span>
            </div>
            <div class="flex justify-between">
              <span class="opacity-90">% del Total:</span>
              <span class="font-bold">{{getPorcentajePorCategoria(categoria) | number:'1.0-0'}}%</span>
            </div>
            <div class="flex justify-between">
              <span class="opacity-90">Rotación Prom:</span>
              <span class="font-bold">{{getRandomFloat(2, 12)}}x/año</span>
            </div>
          </div>
          
          <!-- Barra de progreso -->
          <div class="mt-4">
            <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
              <div 
                class="bg-white h-2 rounded-full transition-all duration-1000"
                [style.width.%]="getPorcentajePorCategoria(categoria)"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Análisis detallado por categoría -->
    <p-accordion [multiple]="true" [activeIndex]="[0]">
      <p-accordionTab 
        *ngFor="let categoria of categoriasABC" 
        [header]="'Análisis Detallado - Categoría ' + categoria.categoria"
      >
        <ng-template pTemplate="header">
          <div class="flex items-center gap-3 w-full">
            <div 
              class="w-6 h-6 rounded-full flex items-center justify-center text-white font-bold text-sm"
              [style.background-color]="categoria.color"
            >
              {{categoria.categoria}}
            </div>
            <span class="font-bold">Categoría {{categoria.categoria}} - {{categoria.descripcion}}</span>
            <div class="ml-auto flex items-center gap-2">
              <p-tag 
                [value]="getProductosPorCategoria(categoria) + ' productos'"
                severity="secondary"
                size="small"
              />
              <p-tag 
                value="'$' + (getValorPorCategoria(categoria) || 0) | number:'1.0-0'"
                [style]="{'background-color': categoria.color, 'color': 'white'}"
                size="small"
              />
            </div>
          </div>
        </ng-template>
        
        <div class="pt-4">
          <!-- Métricas de la categoría -->
          <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-gray-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold" [style.color]="categoria.color">
                {{getProductosPorCategoria(categoria)}}
              </div>
              <div class="text-sm text-gray-600">Total Productos</div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-green-600">
                ${{getValorPorCategoria(categoria) | number:'1.0-0'}}
              </div>
              <div class="text-sm text-gray-600">Valor Total</div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-blue-600">
                {{getPorcentajePorCategoria(categoria) | number:'1.0-0'}}%
              </div>
              <div class="text-sm text-gray-600">% del Total</div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-purple-600">
                {{getRandomFloat(1, 9)}}x
              </div>
              <div class="text-sm text-gray-600">Rotación Promedio</div>
            </div>
          </div>

          <!-- Lista de productos en la categoría -->
          <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <div class="bg-gray-50 p-4 border-b border-gray-200">
              <h5 class="font-bold text-gray-800 m-0 flex items-center gap-2">
                <i class="pi pi-list" [style.color]="categoria.color"></i>
                Productos en Categoría {{categoria.categoria}}
              </h5>
            </div>
            
            <div class="max-h-64 overflow-y-auto">
              <div 
              *ngFor="let inventario of getInventariosPorCategoria(categoria); let i = index"
                class="flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200"
              >
                <div class="flex items-center gap-4">
                  <div 
                    class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm"
                    [style.background-color]="categoria.color"
                  >
                    {{i + 1}}
                  </div>
                  <div class="flex items-center gap-3">
                    <div 
                      class="w-4 h-4 rounded-full" 
                      [style.background-color]="inventario.color?.codigoHex || '#ccc'"
                    ></div>
                    <div>
                      <div class="font-medium text-gray-800">{{inventario.producto?.nombre}}</div>
                      <div class="text-sm text-gray-600">
                        {{inventario.color?.nombre}} - Talla {{inventario.talla?.numero}} - {{inventario.almacen?.nombre}}
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="grid grid-cols-4 gap-6 text-center">
                  <div>
                    <div class="font-bold text-blue-600">{{inventario.cantidad}}</div>
                    <div class="text-xs text-gray-500">Stock</div>
                  </div>
                  <div>
                    <div class="font-bold text-green-600">${{inventario.valorUnitario | number:'1.0-0'}}</div>
                    <div class="text-xs text-gray-500">Valor Unit.</div>
                  </div>
                  <div>
                    <div class="font-bold" [style.color]="categoria.color">${{inventario.valorTotal | number:'1.0-0'}}</div>
                    <div class="text-xs text-gray-500">Valor Total</div>
                  </div>
                  <div>
                    <div class="font-bold text-purple-600">{{inventario.rotacion | number:'1.1-1'}}x</div>
                    <div class="text-xs text-gray-500">Rotación</div>
                  </div>
                </div>
                
                <div class="flex gap-2">
                  <p-button 
                    icon="pi pi-eye" 
                    size="small"
                    [outlined]="true"
                    pTooltip="Ver detalle"
                    (click)="mostrarDetalle(inventario)"
                  />
                  <p-button 
                    icon="pi pi-chart-line" 
                    size="small"
                    severity="info"
                    [outlined]="true"
                    pTooltip="Ver análisis"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Recomendaciones específicas -->
          <div class="mt-6 p-4 rounded-lg border-l-4" [style.border-left-color]="categoria.color" [style.background-color]="categoria.color + '10'">
            <h6 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
              <i class="pi pi-lightbulb" [style.color]="categoria.color"></i>
              Recomendaciones para Categoría {{categoria.categoria}}
            </h6>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
              <ul class="space-y-1" *ngIf="categoria.categoria === 'A'">
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-green-600"></i>
                  Control de inventario estricto y frecuente
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-green-600"></i>
                  Proveedores confiables y tiempo de entrega corto
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-green-600"></i>
                  Stock de seguridad optimizado
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-green-600"></i>
                  Monitoreo diario de niveles
                </li>
              </ul>
              
              <ul class="space-y-1" *ngIf="categoria.categoria === 'B'">
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-orange-600"></i>
                  Control moderado con revisiones periódicas
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-orange-600"></i>
                  Múltiples proveedores como respaldo
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-orange-600"></i>
                  Stock balanceado según demanda
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-orange-600"></i>
                  Revisión quincenal de inventarios
                </li>
              </ul>
              
              <ul class="space-y-1" *ngIf="categoria.categoria === 'C'">
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-red-600"></i>
                  Control básico y revisiones mensuales
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-red-600"></i>
                  Proveedores económicos y pedidos grandes
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-red-600"></i>
                  Stock mínimo necesario
                </li>
                <li class="flex items-center gap-2">
                  <i class="pi pi-check text-red-600"></i>
                  Considerar eliminación de productos lentos
                </li>
              </ul>
            </div>
          </div>
        </div>
      </p-accordionTab>
    </p-accordion>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center">
      <div class="text-sm text-gray-600">
        <i class="pi pi-info-circle mr-1"></i>
        Análisis actualizado: {{inventario.fechaActualizacion | date:'dd/MM/yyyy HH:mm'}}
      </div>
      <div class="flex gap-3">
        <p-button 
          label="Recalcular ABC" 
          icon="pi pi-refresh" 
          severity="secondary"
          [outlined]="true"
          (click)="recalcularABC()" 
        />
        <p-button 
          label="Exportar Análisis" 
          icon="pi pi-download" 
          severity="info"
          (click)="exportarAnalisisABC()" 
        />
        <p-button 
          label="Cerrar" 
          icon="pi pi-times" 
          class="p-button-text" 
          (click)="hideAnalisisAbcDialog()" 
        />
      </div>
    </div>
  </ng-template>
</p-dialog>