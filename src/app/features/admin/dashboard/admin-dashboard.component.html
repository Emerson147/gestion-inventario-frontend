<app-toast-notification
  [toasts]="toastService.getCurrentToasts()"
  (toastDismissed)="onToastDismissed($event)"
></app-toast-notification>

<!-- Header del Dashboard -->
<div class="bg-white dark:bg-surface-900 rounded-[2.5rem] p-8 mb-8 shadow-sm border border-surface-200 dark:border-surface-800 relative overflow-hidden group transition-all duration-300 hover:shadow-md animate-fade-in">
  
  <div class="absolute top-0 right-0 w-96 h-96 bg-indigo-50 dark:bg-indigo-900/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/3 opacity-60 pointer-events-none transition-transform duration-1000 group-hover:scale-110"></div>

  <div class="flex flex-col xl:flex-row justify-between items-start xl:items-center gap-8 relative z-10">
    
    <div class="flex items-center gap-6">
      
      <div class="w-20 h-20 rounded-3xl bg-surface-50 dark:bg-surface-800 flex items-center justify-center border border-surface-100 dark:border-surface-700 shadow-inner text-indigo-600 dark:text-indigo-400">
         <i class="pi pi-building text-3xl"></i>
      </div>
      
      <div class="flex flex-col">
        <div class="flex items-center gap-2 mb-1">
            <span class="px-2.5 py-0.5 rounded-lg bg-surface-100 dark:bg-surface-800 text-surface-600 dark:text-surface-300 text-[10px] font-bold uppercase tracking-widest border border-surface-200 dark:border-surface-700">
                {{ rolUsuario || 'Usuario' }}
            </span>
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse" pTooltip="Sistema en lÃ­nea"></span>
        </div>
        
        <h1 class="text-3xl font-bold text-surface-900 dark:text-surface-0 m-0 tracking-tight leading-none mb-1">
          Hola, {{ nombreUsuario || 'Bienvenido' }} ðŸ‘‹
        </h1>
        
        <p class="text-surface-500 dark:text-surface-400 m-0 text-base flex items-center gap-1">
          Panel de control de <strong class="text-indigo-600 dark:text-indigo-400 font-bold ml-1">La Peruanita</strong>
        </p>
      </div>
    </div>

    <div class="w-full xl:w-auto flex flex-col sm:flex-row items-center gap-4">
        
        <div class="w-full sm:w-auto px-6 py-3 rounded-2xl bg-surface-50 dark:bg-surface-800 border border-surface-100 dark:border-surface-700 flex items-center justify-center sm:justify-start gap-4 transition-colors hover:border-indigo-100">
            <div class="flex flex-col items-center justify-center w-8 border-r border-surface-200 dark:border-surface-600 pr-3">
                <span class="text-[10px] font-bold text-red-500 uppercase">{{ fechaActual | date:'MMM' }}</span>
                <span class="text-lg font-bold text-surface-900 dark:text-surface-0 leading-none">{{ fechaActual | date:'dd' }}</span>
            </div>
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-surface-400 uppercase tracking-wider">Hoy</span>
                <span class="text-sm font-medium text-surface-600 dark:text-surface-300">
                    {{ fechaActual | date:'EEEE' | titlecase }}
                </span>
            </div>
        </div>

        <button 
            class="w-full sm:w-auto px-6 py-3.5 rounded-2xl bg-surface-900 dark:bg-surface-0 hover:bg-black dark:hover:bg-surface-200 text-white dark:text-surface-900 font-bold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 group/btn"
            pTooltip="Ver mÃ©tricas clave"
            tooltipPosition="bottom">
            <span>Reporte Flash</span>
            <i class="pi pi-bolt text-yellow-400 group-hover/btn:animate-pulse"></i>
        </button>

    </div>

  </div>
</div>

<!-- KPIs Principales en cards premium -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-8" *ngIf="kpis.length > 0">
  
  <div *ngFor="let kpi of kpis; trackBy: trackByKpiId" 
       class="group bg-white dark:bg-surface-900 rounded-2xl p-5 border border-surface-200 dark:border-surface-700 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1 relative overflow-hidden">
    
    <div class="absolute top-0 right-0 w-16 h-16 rounded-full blur-2xl opacity-0 group-hover:opacity-20 transition-opacity duration-300 pointer-events-none"
         [style.background-color]="kpi.color"></div>

    <div class="relative z-10 flex flex-col justify-between h-full gap-4">
      
      <div class="flex items-start justify-between">
        
        <div class="w-12 h-12 rounded-2xl flex items-center justify-center transition-transform duration-300 group-hover:scale-110"
             [style.background-color]="kpi.color + '15'" 
             [style.color]="kpi.color">
          <i [class]="getIconClass(kpi.icon)" class="text-xl"></i>
        </div>

        <div class="px-2.5 py-1 rounded-lg text-[11px] font-bold flex items-center gap-1 border"
             [ngClass]="{
                'bg-emerald-50 text-emerald-700 border-emerald-100': kpi.porcentajeCambio > 0,
                'bg-red-50 text-red-700 border-red-100': kpi.porcentajeCambio < 0,
                'bg-surface-100 text-surface-600 border-surface-200': kpi.porcentajeCambio === 0
             }">
            <i class="pi text-[10px]" 
               [ngClass]="{
                  'pi-arrow-up': kpi.porcentajeCambio > 0,
                  'pi-arrow-down': kpi.porcentajeCambio < 0,
                  'pi-minus': kpi.porcentajeCambio === 0
               }"></i>
            <span>{{ kpi.porcentajeCambio | number: '1.1-1' }}%</span>
        </div>
      </div>

      <div>
        <div class="text-3xl font-bold text-surface-900 dark:text-surface-0 tracking-tight leading-none mb-1">
            {{ formatearValor(kpi.valor, kpi.tipo) }}
        </div>
        <div class="text-[10px] font-bold text-surface-400 dark:text-surface-500 uppercase tracking-widest truncate" title="{{ kpi.titulo }}">
            {{ kpi.titulo }}
        </div>
      </div>
      
      <div class="pt-3 border-t border-surface-100 dark:border-surface-800 mt-1" *ngIf="kpi.descripcion">
          <p class="text-xs text-surface-500 dark:text-surface-400 m-0 line-clamp-1 flex items-center gap-1">
              <i class="pi pi-info-circle text-[10px]"></i>
              {{ kpi.descripcion }}
          </p>
      </div>

    </div>
  </div>

</div>

<!-- Toolbar limpia del dashboard -->
<div class="mb-8 animate-fade-in">
  <div class="bg-white dark:bg-surface-900 p-2 pl-4 rounded-2xl border border-surface-200 dark:border-surface-700 shadow-sm flex flex-col md:flex-row items-center justify-between gap-4">
    
    <div class="flex flex-wrap items-center justify-center md:justify-start gap-4 w-full md:w-auto">
      
      <div class="flex items-center gap-2 px-3 py-1.5 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 rounded-lg border border-emerald-100 dark:border-emerald-900/30 shadow-sm">
          <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
          </span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Sistema Operativo</span>
      </div>

      <div class="hidden sm:block w-px h-6 bg-surface-200 dark:bg-surface-700"></div>

      <div class="flex items-center gap-2 text-xs text-surface-500 dark:text-surface-400">
          <i class="pi pi-database text-indigo-500"></i>
          <span><strong class="text-surface-900 dark:text-surface-0">{{ kpis.length }}</strong> mÃ©tricas trackeando</span>
      </div>

      <div class="hidden sm:block w-px h-6 bg-surface-200 dark:bg-surface-700"></div>

      <div class="flex items-center gap-2 text-xs text-surface-500 dark:text-surface-400">
          <i class="pi pi-clock"></i>
          <span>Sync: <strong class="font-mono text-surface-900 dark:text-surface-0">{{ ultimaActualizacion | date:'HH:mm:ss' }}</strong></span>
      </div>

    </div>

    <div class="flex items-center gap-2 w-full md:w-auto justify-between md:justify-end">
      
      <button
        (click)="actualizarDatos()"
        [disabled]="loading"
        class="w-10 h-10 flex items-center justify-center rounded-xl bg-surface-50 dark:bg-surface-800 text-surface-500 hover:text-surface-900 dark:hover:text-surface-0 border border-transparent hover:border-surface-200 transition-all active:scale-95 disabled:opacity-50"
        pTooltip="Forzar ActualizaciÃ³n"
        tooltipPosition="top">
        <i class="pi pi-refresh" [ngClass]="{'pi-spin': loading}"></i>
      </button>

      <button
        (click)="mostrarEstadisticas()"
        class="w-10 h-10 flex items-center justify-center rounded-xl bg-surface-50 dark:bg-surface-800 text-surface-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 border border-transparent hover:border-purple-100 transition-all active:scale-95"
        pTooltip="Ver Analytics"
        tooltipPosition="top">
        <i class="pi pi-chart-pie"></i>
      </button>

      <button
        (click)="exportarDatos()"
        class="md:hidden w-10 h-10 flex items-center justify-center rounded-xl bg-surface-50 dark:bg-surface-800 text-surface-500 hover:text-emerald-600 hover:bg-emerald-50 border border-transparent hover:border-emerald-100 transition-all active:scale-95">
        <i class="pi pi-download"></i>
      </button>

      <button
        (click)="exportarDatos()"
        class="hidden md:flex px-5 py-2.5 bg-surface-900 dark:bg-surface-0 hover:bg-black dark:hover:bg-surface-200 text-white dark:text-surface-900 rounded-xl font-bold text-sm shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all items-center gap-2">
        <i class="pi pi-download text-xs"></i>
        <span>Descargar Reporte</span>
      </button>

    </div>

  </div>
</div>

<!-- SecciÃ³n de widgets principales -->
<div class="grid grid-cols-12 gap-6">
  <!-- MÃ©tricas bÃ¡sicas (cards de contadores) -->
  <app-dashboard-widget class="contents" />

  <!-- EstadÃ­sticas y widgets adicionales -->
  <!-- <div class="col-span-12 xl:col-span-6">
    <app-stats-widget />
  </div> -->

  <!-- <div class="col-span-12 xl:col-span-6">
    <app-recent-sales-widget />
  </div> -->
  <!--   
  <div class="col-span-12 xl:col-span-6">
    <app-best-selling-widget />
  </div>
  
  <div class="col-span-12 xl:col-span-6">
    <app-revenue-stream-widget />
  </div> -->

  <!-- <div class="col-span-12">
    <app-notifications-widget />
  </div> -->
</div>



